"use strict";var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__esm=(e,n)=>function(){return e&&(n=(0,e[__getOwnPropNames(e)[0]])(e=0)),n},__commonJS=(e,n)=>function(){return n||(0,e[__getOwnPropNames(e)[0]])((n={exports:{}}).exports,n),n.exports},__export=(e,n)=>{for(var r in n)__defProp(e,r,{get:n[r],enumerable:!0})},__copyProps=(e,n,r,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of __getOwnPropNames(n))!__hasOwnProp.call(e,f)&&f!==r&&__defProp(e,f,{get:()=>n[f],enumerable:!(o=__getOwnPropDesc(n,f))||o.enumerable});return e},__toESM=(e,n,r)=>(r=e!=null?__create(__getProtoOf(e)):{},__copyProps(n||!e||!e.__esModule?__defProp(r,"default",{value:e,enumerable:!0}):r,e)),__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),__decorateClass=(e,n,r,o)=>{for(var f=o>1?void 0:o?__getOwnPropDesc(n,r):n,c=e.length-1,d;c>=0;c--)(d=e[c])&&(f=(o?d(n,r,f):d(f))||f);return o&&f&&__defProp(n,r,f),f};function deepAssign(e,...n){return n.forEach(r=>{Object.keys(r).forEach(o=>{typeof r[o]!="object"?e[o]=r[o]:e[o]=deepAssign(e[o]||{},r[o])})}),e}var init_utils=__esm({"lib/i18n/utils.ts"(){"use strict"}}),action_exports={};__export(action_exports,{blockElement:()=>blockElement,braceArg:()=>braceArg,chapter:()=>chapter,column:()=>column,columnHeadline:()=>columnHeadline,columnTerminator:()=>columnTerminator,content:()=>content,contents:()=>contents,dlistElement:()=>dlistElement,headline:()=>headline,inlineElement:()=>inlineElement,olistElement:()=>olistElement,setup:()=>setup,text:()=>text,ulistElement:()=>ulistElement});function checkRuleName(e){"use strict";if(!RuleName[e])throw new Error(`unknown rule: ${e}`);return e}function setup(e){"use strict";env=e}function content(e,n){"use strict";return{syntax:checkRuleName(e),location:env.location(),content:n}}function contents(e,n,r){"use strict";let o=[n];return r&&(Array.isArray(r.content)?r.content.forEach(f=>o.push(f)):o.push(r.content)),{syntax:checkRuleName(e),location:env.location(),content:o}}function text(e,n){"use strict";return{syntax:checkRuleName(e),location:env.location(),text:n}}function chapter(e,n,r){"use strict";return{syntax:checkRuleName("Chapter"),location:env.location(),comments:e,headline:n,text:r}}function headline(e,n,r){"use strict";return{syntax:checkRuleName("Headline"),location:env.location(),level:e.length,label:n,caption:r}}function blockElement(e,n,r=[]){return{syntax:checkRuleName("BlockElement"),location:env.location(),symbol:e,args:n,content:r}}function inlineElement(e,n=[]){return{syntax:checkRuleName("InlineElement"),location:env.location(),symbol:e,content:n}}function column(e,n){"use strict";return{syntax:checkRuleName("Column"),location:env.location(),headline:e,text:n}}function columnHeadline(e,n,r){"use strict";return{syntax:checkRuleName("ColumnHeadline"),location:env.location(),level:e.length,label:n,caption:r}}function columnTerminator(e){"use strict";return{syntax:checkRuleName("ColumnTerminator"),location:env.location(),level:e.length}}function braceArg(e){"use strict";return{syntax:checkRuleName("BraceArg"),location:env.location(),arg:e}}function ulistElement(e,n){"use strict";return{syntax:checkRuleName("UlistElement"),location:env.location(),level:e.length,text:n}}function olistElement(e,n){"use strict";return{syntax:checkRuleName("OlistElement"),location:env.location(),no:parseInt(e,10),text:n}}function dlistElement(e,n){"use strict";return{syntax:checkRuleName("DlistElement"),location:env.location(),text:e,content:n}}var env,init_action=__esm({"lib/peg/action.ts"(){"use strict";init_parser()}}),require_grammar=__commonJS({"resources/grammar.js"(e,n){"use strict";function r(c,d){function u(){this.constructor=c}u.prototype=d.prototype,c.prototype=new u}function o(c,d,u,b){this.message=c,this.expected=d,this.found=u,this.location=b,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,o)}r(o,Error),o.buildMessage=function(c,d){var u={literal:function(A){return'"'+y(A.text)+'"'},class:function(A){var F="",O;for(O=0;O<A.parts.length;O++)F+=A.parts[O]instanceof Array?B(A.parts[O][0])+"-"+B(A.parts[O][1]):B(A.parts[O]);return"["+(A.inverted?"^":"")+F+"]"},any:function(A){return"any character"},end:function(A){return"end of input"},other:function(A){return A.description}};function b(A){return A.charCodeAt(0).toString(16).toUpperCase()}function y(A){return A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(F){return"\\x0"+b(F)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(F){return"\\x"+b(F)})}function B(A){return A.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(F){return"\\x0"+b(F)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(F){return"\\x"+b(F)})}function C(A){return u[A.type](A)}function S(A){var F=new Array(A.length),O,P;for(O=0;O<A.length;O++)F[O]=C(A[O]);if(F.sort(),F.length>0){for(O=1,P=1;O<F.length;O++)F[O-1]!==F[O]&&(F[P]=F[O],P++);F.length=P}switch(F.length){case 1:return F[0];case 2:return F[0]+" or "+F[1];default:return F.slice(0,-1).join(", ")+", or "+F[F.length-1]}}function k(A){return A?'"'+y(A)+'"':"end of input"}return"Expected "+S(c)+" but "+k(d)+" found."};function f(c,d){d=d!==void 0?d:{};var u={},b={Start:St},y=St,B=v("start"),C=function(i){return T.content("Start",i)},S=v("chapters"),k=function(i,l){return T.contents("Chapters",i,l)},A=v("chapter"),F=function(i,l,a){return T.chapter(i,l,a)},O=v("headline"),P="=",$=j("=",!1),U=function(i,l,a){return T.headline(i,l,a)},M=v("contents"),W=Mn(),K=function(i,l){return T.contents("Contents",i,l)},ue=v("content"),se=function(i){return T.content("Content",i)},iu=v("paragraph"),pt=function(i){return T.content("Paragraph",i)},ru=v("paragraph subs"),dt=function(i,l){return T.contents("ParagraphSubs",i,l)},su=v("paragraph sub"),De=function(i){return T.content("ParagraphSub",i)},ou=v("text of content"),Z=/^[^\r\n]/,Q=ie(["\r",`
`],!0,!1),mt=function(i){return T.text("ContentText",i)},lu=v("block element"),ke="//",gt=j("//",!1),Le="{",ze=j("{",!1),G="//}",Ae=j("//}",!1),au=function(i,l,a){return T.blockElement(i,l,a)},cu=function(i,l){return T.blockElement(i,l)},fu=v("inline element"),ge="@<",qe=j("@<",!1),_e=/^[^>\r\n]/,Ee=ie([">","\r",`
`],!0,!1),Me=">",Ue=j(">",!1),Xe="}",Ve=j("}",!1),We=function(i,l){return T.inlineElement(i,l)},Je="|",Ye=j("|",!1),Ke="$",Ze=j("$",!1),hu=v("column"),pu=function(i,l){return T.column(i,l)},du=v("column headline"),_t="[column]",mu=j("[column]",!1),gu=function(i,l,a){return T.columnHeadline(i,l,a)},_u=v("column contents"),Eu=function(i,l){return T.contents("ColumnContents",i,l)},Cu=v("column content"),oe=function(i){return T.content("ColumnContent",i)},bu=v("column terminator"),Et="[/column]",Fu=j("[/column]",!1),xu=function(i){return T.columnTerminator(i)},yu=v("bracket argument"),Bu="[",Au=j("[",!1),Qe="]",Ge=j("]",!1),wu=function(i){return T.content("BracketArg",i)},Du=v("bracket arg subs"),ku=function(i,l){return T.contents("BracketArgSubs",i,l)},vu=v("bracket arg sub"),Ct=function(i){return T.content("BracketArgSub",i)},Pu=v("text of bracket arg"),J="\\\\",le=j("\\\\",!1),ve="\\]",bt=j("\\]",!1),ae="\\",ce=j("\\",!1),Su=function(i){return T.text("BracketArgText",i)},$u=v("brace argument"),Pe=/^[^\r\n}\\]/,Se=ie(["\r",`
`,"}","\\"],!0,!1),Ce="\\}",et=j("\\}",!1),Nu=function(i){return T.braceArg(i)},Tu=v("contents of block element"),Ru=function(i,l){return T.contents("BlockElementContents",i,l)},Ou=v("content of block element"),be=function(i){return T.content("BlockElementContent",i)},Iu=v("paragraph in block"),ju=v("paragraph subs in block"),Hu=v("paragraph sub in block"),Lu=v("text of content in block"),tt=v("contents of inline element"),ut=function(i,l){return T.contents("InlineElementContents",i,l)},nt=v("content of inline element"),it=function(i){qn("Inlines cannot not contain other inlines.")},rt=function(i){return T.content("InlineElementContent",i)},st=v("text of inline element"),ot=function(i){return T.text("InlineElementContentText",i.map(function(l){return l.filter(function(a){return a!=null}).join("")}).join(""))},lt=v("char of inline element content"),ne=`\r
`,$e=j(`\r
`,!1),Ne=`
`,Te=j(`
`,!1),at=function(i){return i},ct=function(){return"\\"},zu=function(){return"}"},Ft="\\|",qu=j("\\|",!1),Mu=function(){return"|"},xt="\\$",Uu=j("\\$",!1),Xu=function(){return"$"},Vu=v("inline content"),Wu=function(i){return T.content("SinglelineContent",i)},Ju=v("children of inline content"),Yu=function(i,l){return T.contents("ContentInlines",i,l)},Ku=v("child of inline content"),yt=function(i){return T.content("ContentInline",i)},Zu=v("text of child of inline content"),Qu=function(i){return T.text("ContentInlineText",i)},Gu=v("ulist"),tn=function(i,l){return T.contents("Ulist",i,l)},un=v("ulist element"),fe=" ",he=j(" ",!1),Bt="*",At=j("*",!1),nn=function(i,l){return T.ulistElement(i,l)},rn=v("olist"),sn=function(i,l){return T.contents("Olist",i,l)},on=v("olist element"),ln=".",an=j(".",!1),cn=function(i,l){return T.olistElement(i,l)},fn=v("dlist"),hn=function(i,l){return T.contents("Dlist",i,l)},pn=v("dlist element"),dn=":",mn=j(":",!1),gn=function(i,l){return T.dlistElement(i,l)},_n=v("contents of dlist element"),En=function(i,l){return T.contents("DlistElementContents",i,l)},Cn=v("content of dlist element"),Fe=/^[ \t]/,xe=ie([" ","	"],!1,!1),bn=function(i){return T.content("DlistElementContent",i)},Fn=v("signle line comments"),xn=function(i,l){return T.contents("SinglelineComments",i,l)},yn=v("signle line comment"),wt="#@",Bn=j("#@",!1),An=function(i){return T.text("SinglelineComment",i)},wn=v("digits"),Dn=v("digit"),kn=/^[0-9]/,vn=ie([["0","9"]],!1,!1),Pn=v("lower alphabet"),Sn=/^[a-z]/,$n=ie([["a","z"]],!1,!1),Nn=v("newline"),Tn=v("blank lines"),Rn=v("spacer"),Dt=/^[ \t\r\n]/,kt=ie([" ","	","\r",`
`],!1,!1),On=v("space"),In=/^[ \u3000\t]/,jn=ie([" ","\u3000","	"],!1,!1),Hn=v("end of file"),s=0,x=0,Re=[{line:1,column:1}],ee=0,ft=[],h=0,Oe;if("startRule"in d){if(!(d.startRule in b))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');y=b[d.startRule]}function Ln(){return c.substring(x,s)}function zn(){return we(x,s)}function Ei(i,l){throw l=l!==void 0?l:we(x,s),Pt([v(i)],c.substring(x,s),l)}function qn(i,l){throw l=l!==void 0?l:we(x,s),Xn(i,l)}function j(i,l){return{type:"literal",text:i,ignoreCase:l}}function ie(i,l,a){return{type:"class",parts:i,inverted:l,ignoreCase:a}}function Mn(){return{type:"any"}}function Un(){return{type:"end"}}function v(i){return{type:"other",description:i}}function vt(i){var l=Re[i],a;if(l)return l;for(a=i-1;!Re[a];)a--;for(l=Re[a],l={line:l.line,column:l.column};a<i;)c.charCodeAt(a)===10?(l.line++,l.column=1):l.column++,a++;return Re[i]=l,l}function we(i,l){var a=vt(i),p=vt(l);return{start:{offset:i,line:a.line,column:a.column},end:{offset:l,line:p.line,column:p.column}}}function g(i){s<ee||(s>ee&&(ee=s,ft=[]),ft.push(i))}function Xn(i,l){return new o(i,null,null,l)}function Pt(i,l,a){return new o(o.buildMessage(i,l),i,l,a)}function St(){var i,l,a,p;return h++,i=s,l=Gt(),l!==u?(a=$t(),a===u&&(a=null),a!==u?(p=Gt(),p!==u?(x=i,l=C(a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(B)),i}function $t(){var i,l,a;return h++,i=s,l=Nt(),l!==u?(a=$t(),a===u&&(a=null),a!==u?(x=i,l=k(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(S)),i}function Nt(){var i,l,a,p;return h++,i=s,l=Zt(),l===u&&(l=null),l!==u?(a=Tt(),a!==u?(p=Rt(),p===u&&(p=null),p!==u?(x=i,l=F(l,a,p),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(A)),i}function Tt(){var i,l,a,p,m,E;if(h++,i=s,l=[],c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($)),a!==u)for(;a!==u;)l.push(a),c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($));else l=u;if(l!==u)if(a=Lt(),a===u&&(a=null),a!==u){for(p=[],m=Y();m!==u;)p.push(m),m=Y();p!==u?(m=Be(),m!==u?(E=X(),E!==u?(x=i,l=U(l,a,m),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(O)),i}function Rt(){var i,l,a,p,m;return h++,i=s,l=s,h++,c.length>s?(a=c.charAt(s),s++):(a=u,h===0&&g(W)),h--,a!==u?(s=l,l=void 0):l=u,l!==u?(a=Vn(),a!==u?(p=Rt(),p===u&&(p=null),p!==u?(m=X(),m!==u?(x=i,l=K(a,p),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(M)),i}function Vn(){var i,l;return h++,i=s,l=te(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=ye(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=pe(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=de(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=me(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=Ot(),l!==u&&(x=i,l=se(l)),i=l,i===u&&(i=s,l=Yn(),l!==u&&(x=i,l=se(l)),i=l)))))),h--,i===u&&(l=u,h===0&&g(ue)),i}function Ot(){var i,l,a,p;return h++,i=s,l=s,h++,c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($)),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=It(),a!==u?(p=X(),p!==u?(x=i,l=pt(a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(iu)),i}function It(){var i,l,a;return h++,i=s,l=Wn(),l!==u?(a=It(),a===u&&(a=null),a!==u?(x=i,l=dt(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(ru)),i}function Wn(){var i,l,a;return h++,i=s,l=q(),l!==u?(a=V(),a===u&&(a=null),a!==u?(x=i,l=De(l),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=Jn(),l!==u?(a=V(),a===u&&(a=null),a!==u?(x=i,l=De(l),i=l):(s=i,i=u)):(s=i,i=u)),h--,i===u&&(l=u,h===0&&g(su)),i}function Jn(){var i,l,a,p,m,E,_,w,R,H,L,I,D,N;if(h++,i=s,l=s,a=s,p=s,h++,m=V(),h--,m===u?p=void 0:(s=p,p=u),p!==u)if(m=s,h++,E=Tt(),h--,E===u?m=void 0:(s=m,m=u),m!==u)if(E=s,h++,_=te(),h--,_===u?E=void 0:(s=E,E=u),E!==u)if(_=s,h++,w=ye(),h--,w===u?_=void 0:(s=_,_=u),_!==u)if(w=s,h++,R=pe(),h--,R===u?w=void 0:(s=w,w=u),w!==u)if(R=s,h++,H=de(),h--,H===u?R=void 0:(s=R,R=u),R!==u)if(H=s,h++,L=me(),h--,L===u?H=void 0:(s=H,H=u),H!==u){if(L=[],I=s,D=s,h++,N=q(),h--,N===u?D=void 0:(s=D,D=u),D!==u?(Z.test(c.charAt(s))?(N=c.charAt(s),s++):(N=u,h===0&&g(Q)),N!==u?(D=[D,N],I=D):(s=I,I=u)):(s=I,I=u),I!==u)for(;I!==u;)L.push(I),I=s,D=s,h++,N=q(),h--,N===u?D=void 0:(s=D,D=u),D!==u?(Z.test(c.charAt(s))?(N=c.charAt(s),s++):(N=u,h===0&&g(Q)),N!==u?(D=[D,N],I=D):(s=I,I=u)):(s=I,I=u);else L=u;L!==u?(p=[p,m,E,_,w,R,H,L],a=p):(s=a,a=u)}else s=a,a=u;else s=a,a=u;else s=a,a=u;else s=a,a=u;else s=a,a=u;else s=a,a=u;else s=a,a=u;return a!==u?l=c.substring(l,s):l=a,l!==u&&(x=i,l=mt(l)),i=l,h--,i===u&&(l=u,h===0&&g(ou)),i}function ye(){var i,l,a,p,m,E,_,w,R;if(h++,i=s,c.substr(s,2)===ke?(l=ke,s+=2):(l=u,h===0&&g(gt)),l!==u){if(a=s,p=[],m=je(),m!==u)for(;m!==u;)p.push(m),m=je();else p=u;if(p!==u?a=c.substring(a,s):a=p,a!==u){for(p=[],m=Ie();m!==u;)p.push(m),m=Ie();p!==u?(c.charCodeAt(s)===123?(m=Le,s++):(m=u,h===0&&g(ze)),m!==u?(E=X(),E!==u?(_=zt(),_===u&&(_=null),_!==u?(c.substr(s,3)===G?(w=G,s+=3):(w=u,h===0&&g(Ae)),w!==u?(R=X(),R!==u?(x=i,l=au(a,p,_),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u}else s=i,i=u;if(i===u)if(i=s,c.substr(s,2)===ke?(l=ke,s+=2):(l=u,h===0&&g(gt)),l!==u){if(a=s,p=[],m=je(),m!==u)for(;m!==u;)p.push(m),m=je();else p=u;if(p!==u?a=c.substring(a,s):a=p,a!==u){for(p=[],m=Ie();m!==u;)p.push(m),m=Ie();p!==u?(m=X(),m!==u?(x=i,l=cu(a,p),i=l):(s=i,i=u)):(s=i,i=u)}else s=i,i=u}else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(lu)),i}function q(){var i,l,a,p,m,E,_;if(h++,i=s,c.substr(s,2)===ge?(l=ge,s+=2):(l=u,h===0&&g(qe)),l!==u){if(a=s,p=[],_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee)),m!==u)for(;m!==u;)p.push(m),_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee));else p=u;p!==u?a=c.substring(a,s):a=p,a!==u?(c.charCodeAt(s)===62?(p=Me,s++):(p=u,h===0&&g(Ue)),p!==u?(c.charCodeAt(s)===123?(m=Le,s++):(m=u,h===0&&g(ze)),m!==u?(E=Mt(),E===u&&(E=null),E!==u?(c.charCodeAt(s)===125?(_=Xe,s++):(_=u,h===0&&g(Ve)),_!==u?(x=i,l=We(a,E),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;if(i===u){if(i=s,c.substr(s,2)===ge?(l=ge,s+=2):(l=u,h===0&&g(qe)),l!==u){if(a=s,p=[],_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee)),m!==u)for(;m!==u;)p.push(m),_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee));else p=u;p!==u?a=c.substring(a,s):a=p,a!==u?(c.charCodeAt(s)===62?(p=Me,s++):(p=u,h===0&&g(Ue)),p!==u?(c.charCodeAt(s)===124?(m=Je,s++):(m=u,h===0&&g(Ye)),m!==u?(E=Ut(),E===u&&(E=null),E!==u?(c.charCodeAt(s)===124?(_=Je,s++):(_=u,h===0&&g(Ye)),_!==u?(x=i,l=We(a,E),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;if(i===u)if(i=s,c.substr(s,2)===ge?(l=ge,s+=2):(l=u,h===0&&g(qe)),l!==u){if(a=s,p=[],_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee)),m!==u)for(;m!==u;)p.push(m),_e.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(Ee));else p=u;p!==u?a=c.substring(a,s):a=p,a!==u?(c.charCodeAt(s)===62?(p=Me,s++):(p=u,h===0&&g(Ue)),p!==u?(c.charCodeAt(s)===36?(m=Ke,s++):(m=u,h===0&&g(Ze)),m!==u?(E=Xt(),E===u&&(E=null),E!==u?(c.charCodeAt(s)===36?(_=Ke,s++):(_=u,h===0&&g(Ze)),_!==u?(x=i,l=We(a,E),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u}return h--,i===u&&(l=u,h===0&&g(fu)),i}function Yn(){var i,l,a,p;return h++,i=s,l=Kn(),l!==u?(a=jt(),a===u&&(a=null),a!==u?(p=re(),p===u&&(p=null),p!==u?(x=i,l=pu(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(hu)),i}function Kn(){var i,l,a,p,m,E,_,w;if(h++,i=s,l=[],c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($)),a!==u)for(;a!==u;)l.push(a),c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($));else l=u;if(l!==u)if(c.substr(s,8)===_t?(a=_t,s+=8):(a=u,h===0&&g(mu)),a!==u)if(p=Lt(),p===u&&(p=null),p!==u){for(m=[],E=Y();E!==u;)m.push(E),E=Y();if(m!==u){for(E=[],_=Y();_!==u;)E.push(_),_=Y();E!==u?(_=Be(),_!==u?(w=X(),w!==u?(x=i,l=gu(l,p,_),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u}else s=i,i=u;else s=i,i=u;else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(du)),i}function jt(){var i,l,a,p,m;return h++,i=s,l=s,h++,c.length>s?(a=c.charAt(s),s++):(a=u,h===0&&g(W)),h--,a!==u?(s=l,l=void 0):l=u,l!==u?(a=Zn(),a!==u?(p=jt(),p===u&&(p=null),p!==u?(m=X(),m!==u?(x=i,l=Eu(a,p),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(_u)),i}function Zn(){var i,l,a;return h++,i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=te(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=ye(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=pe(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=de(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=me(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=Ot(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,l=s,h++,a=re(),h--,a===u?l=void 0:(s=l,l=u),l!==u?(a=Nt(),a!==u?(x=i,l=oe(a),i=l):(s=i,i=u)):(s=i,i=u))))))),h--,i===u&&(l=u,h===0&&g(Cu)),i}function re(){var i,l,a,p,m;if(h++,i=s,l=[],c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($)),a!==u)for(;a!==u;)l.push(a),c.charCodeAt(s)===61?(a=P,s++):(a=u,h===0&&g($));else l=u;if(l!==u)if(c.substr(s,9)===Et?(a=Et,s+=9):(a=u,h===0&&g(Fu)),a!==u){for(p=[],m=Y();m!==u;)p.push(m),m=Y();p!==u?(m=X(),m!==u?(x=i,l=xu(l),i=l):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(bu)),i}function Ie(){var i,l,a,p;return h++,i=s,c.charCodeAt(s)===91?(l=Bu,s++):(l=u,h===0&&g(Au)),l!==u?(a=Ht(),a!==u?(c.charCodeAt(s)===93?(p=Qe,s++):(p=u,h===0&&g(Ge)),p!==u?(x=i,l=wu(a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(yu)),i}function Ht(){var i,l,a;return h++,i=s,l=Qn(),l!==u?(a=Ht(),a===u&&(a=null),a!==u?(x=i,l=ku(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Du)),i}function Qn(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=Ct(l)),i=l,i===u&&(i=s,l=Gn(),l!==u&&(x=i,l=Ct(l)),i=l),h--,i===u&&(l=u,h===0&&g(vu)),i}function Gn(){var i,l,a,p,m,E,_,w,R;if(h++,i=s,l=s,a=[],p=s,m=s,h++,E=V(),h--,E===u?m=void 0:(s=m,m=u),m!==u?(E=s,h++,_=q(),h--,_===u?E=void 0:(s=E,E=u),E!==u?(c.substr(s,2)===J?(_=J,s+=2):(_=u,h===0&&g(le)),_===u&&(c.substr(s,2)===ve?(_=ve,s+=2):(_=u,h===0&&g(bt)),_===u&&(c.charCodeAt(s)===92?(_=ae,s++):(_=u,h===0&&g(ce)),_===u&&(_=s,w=s,h++,c.charCodeAt(s)===93?(R=Qe,s++):(R=u,h===0&&g(Ge)),h--,R===u?w=void 0:(s=w,w=u),w!==u?(c.length>s?(R=c.charAt(s),s++):(R=u,h===0&&g(W)),R!==u?(w=[w,R],_=w):(s=_,_=u)):(s=_,_=u)))),_!==u?(m=[m,E,_],p=m):(s=p,p=u)):(s=p,p=u)):(s=p,p=u),p!==u)for(;p!==u;)a.push(p),p=s,m=s,h++,E=V(),h--,E===u?m=void 0:(s=m,m=u),m!==u?(E=s,h++,_=q(),h--,_===u?E=void 0:(s=E,E=u),E!==u?(c.substr(s,2)===J?(_=J,s+=2):(_=u,h===0&&g(le)),_===u&&(c.substr(s,2)===ve?(_=ve,s+=2):(_=u,h===0&&g(bt)),_===u&&(c.charCodeAt(s)===92?(_=ae,s++):(_=u,h===0&&g(ce)),_===u&&(_=s,w=s,h++,c.charCodeAt(s)===93?(R=Qe,s++):(R=u,h===0&&g(Ge)),h--,R===u?w=void 0:(s=w,w=u),w!==u?(c.length>s?(R=c.charAt(s),s++):(R=u,h===0&&g(W)),R!==u?(w=[w,R],_=w):(s=_,_=u)):(s=_,_=u)))),_!==u?(m=[m,E,_],p=m):(s=p,p=u)):(s=p,p=u)):(s=p,p=u);else a=u;return a!==u?l=c.substring(l,s):l=a,l!==u&&(x=i,l=Su(l)),i=l,h--,i===u&&(l=u,h===0&&g(Pu)),i}function Lt(){var i,l,a,p,m,E,_;if(h++,i=s,c.charCodeAt(s)===123?(l=Le,s++):(l=u,h===0&&g(ze)),l!==u){if(a=s,p=[],m=s,E=[],Pe.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Se)),_!==u)for(;_!==u;)E.push(_),Pe.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Se));else E=u;for(E!==u?(c.substr(s,2)===J?(_=J,s+=2):(_=u,h===0&&g(le)),_===u&&(c.substr(s,2)===Ce?(_=Ce,s+=2):(_=u,h===0&&g(et)),_===u&&(c.charCodeAt(s)===92?(_=ae,s++):(_=u,h===0&&g(ce)))),_===u&&(_=null),_!==u?(E=[E,_],m=E):(s=m,m=u)):(s=m,m=u);m!==u;){if(p.push(m),m=s,E=[],Pe.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Se)),_!==u)for(;_!==u;)E.push(_),Pe.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Se));else E=u;E!==u?(c.substr(s,2)===J?(_=J,s+=2):(_=u,h===0&&g(le)),_===u&&(c.substr(s,2)===Ce?(_=Ce,s+=2):(_=u,h===0&&g(et)),_===u&&(c.charCodeAt(s)===92?(_=ae,s++):(_=u,h===0&&g(ce)))),_===u&&(_=null),_!==u?(E=[E,_],m=E):(s=m,m=u)):(s=m,m=u)}p!==u?a=c.substring(a,s):a=p,a!==u?(c.charCodeAt(s)===125?(p=Xe,s++):(p=u,h===0&&g(Ve)),p!==u?(x=i,l=Nu(a),i=l):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;return h--,i===u&&(l=u,h===0&&g($u)),i}function zt(){var i,l,a,p;return h++,i=s,l=ei(),l!==u?(a=zt(),a===u&&(a=null),a!==u?(p=X(),p!==u?(x=i,l=Ru(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Tu)),i}function ei(){var i,l;return h++,i=s,l=te(),l!==u&&(x=i,l=be(l)),i=l,i===u&&(i=s,l=ye(),l!==u&&(x=i,l=be(l)),i=l,i===u&&(i=s,l=pe(),l!==u&&(x=i,l=be(l)),i=l,i===u&&(i=s,l=de(),l!==u&&(x=i,l=be(l)),i=l,i===u&&(i=s,l=me(),l!==u&&(x=i,l=be(l)),i=l,i===u&&(i=s,l=ti(),l!==u&&(x=i,l=be(l)),i=l))))),h--,i===u&&(l=u,h===0&&g(Ou)),i}function ti(){var i,l,a;return h++,i=s,l=qt(),l!==u?(a=X(),a!==u?(x=i,l=pt(l),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Iu)),i}function qt(){var i,l,a;return h++,i=s,l=ui(),l!==u?(a=qt(),a===u&&(a=null),a!==u?(x=i,l=dt(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(ju)),i}function ui(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=De(l)),i=l,i===u&&(i=s,l=ni(),l!==u&&(x=i,l=De(l)),i=l),h--,i===u&&(l=u,h===0&&g(Hu)),i}function ni(){var i,l,a,p,m,E,_,w,R,H,L,I,D,N,z;if(h++,i=s,l=s,a=[],p=s,m=s,h++,c.substr(s,3)===G?(E=G,s+=3):(E=u,h===0&&g(Ae)),E===u&&(E=s,_=V(),_!==u?(c.substr(s,3)===G?(w=G,s+=3):(w=u,h===0&&g(Ae)),w!==u?(_=[_,w],E=_):(s=E,E=u)):(s=E,E=u)),h--,E===u?m=void 0:(s=m,m=u),m!==u)if(E=V(),E===u&&(E=null),E!==u)if(_=s,h++,w=te(),h--,w===u?_=void 0:(s=_,_=u),_!==u)if(w=s,h++,R=ye(),h--,R===u?w=void 0:(s=w,w=u),w!==u)if(R=s,h++,H=pe(),h--,H===u?R=void 0:(s=R,R=u),R!==u)if(H=s,h++,L=de(),h--,L===u?H=void 0:(s=H,H=u),H!==u)if(L=s,h++,I=me(),h--,I===u?L=void 0:(s=L,L=u),L!==u){if(I=[],D=s,N=s,h++,z=q(),h--,z===u?N=void 0:(s=N,N=u),N!==u?(Z.test(c.charAt(s))?(z=c.charAt(s),s++):(z=u,h===0&&g(Q)),z!==u?(N=[N,z],D=N):(s=D,D=u)):(s=D,D=u),D!==u)for(;D!==u;)I.push(D),D=s,N=s,h++,z=q(),h--,z===u?N=void 0:(s=N,N=u),N!==u?(Z.test(c.charAt(s))?(z=c.charAt(s),s++):(z=u,h===0&&g(Q)),z!==u?(N=[N,z],D=N):(s=D,D=u)):(s=D,D=u);else I=u;I!==u?(D=V(),D===u&&(D=null),D!==u?(m=[m,E,_,w,R,H,L,I,D],p=m):(s=p,p=u)):(s=p,p=u)}else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;if(p!==u)for(;p!==u;)if(a.push(p),p=s,m=s,h++,c.substr(s,3)===G?(E=G,s+=3):(E=u,h===0&&g(Ae)),E===u&&(E=s,_=V(),_!==u?(c.substr(s,3)===G?(w=G,s+=3):(w=u,h===0&&g(Ae)),w!==u?(_=[_,w],E=_):(s=E,E=u)):(s=E,E=u)),h--,E===u?m=void 0:(s=m,m=u),m!==u)if(E=V(),E===u&&(E=null),E!==u)if(_=s,h++,w=te(),h--,w===u?_=void 0:(s=_,_=u),_!==u)if(w=s,h++,R=ye(),h--,R===u?w=void 0:(s=w,w=u),w!==u)if(R=s,h++,H=pe(),h--,H===u?R=void 0:(s=R,R=u),R!==u)if(H=s,h++,L=de(),h--,L===u?H=void 0:(s=H,H=u),H!==u)if(L=s,h++,I=me(),h--,I===u?L=void 0:(s=L,L=u),L!==u){if(I=[],D=s,N=s,h++,z=q(),h--,z===u?N=void 0:(s=N,N=u),N!==u?(Z.test(c.charAt(s))?(z=c.charAt(s),s++):(z=u,h===0&&g(Q)),z!==u?(N=[N,z],D=N):(s=D,D=u)):(s=D,D=u),D!==u)for(;D!==u;)I.push(D),D=s,N=s,h++,z=q(),h--,z===u?N=void 0:(s=N,N=u),N!==u?(Z.test(c.charAt(s))?(z=c.charAt(s),s++):(z=u,h===0&&g(Q)),z!==u?(N=[N,z],D=N):(s=D,D=u)):(s=D,D=u);else I=u;I!==u?(D=V(),D===u&&(D=null),D!==u?(m=[m,E,_,w,R,H,L,I,D],p=m):(s=p,p=u)):(s=p,p=u)}else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else s=p,p=u;else a=u;return a!==u?l=c.substring(l,s):l=a,l!==u&&(x=i,l=mt(l)),i=l,h--,i===u&&(l=u,h===0&&g(Lu)),i}function Mt(){var i,l,a;return h++,i=s,l=ii(),l!==u?(a=Mt(),a===u&&(a=null),a!==u?(x=i,l=ut(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(tt)),i}function Ut(){var i,l,a;return h++,i=s,l=ri(),l!==u?(a=Ut(),a===u&&(a=null),a!==u?(x=i,l=ut(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(tt)),i}function Xt(){var i,l,a;return h++,i=s,l=si(),l!==u?(a=Xt(),a===u&&(a=null),a!==u?(x=i,l=ut(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(tt)),i}function ii(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=it(l)),i=l,i===u&&(i=s,l=oi(),l!==u&&(x=i,l=rt(l)),i=l),h--,i===u&&(l=u,h===0&&g(nt)),i}function ri(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=it(l)),i=l,i===u&&(i=s,l=li(),l!==u&&(x=i,l=rt(l)),i=l),h--,i===u&&(l=u,h===0&&g(nt)),i}function si(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=it(l)),i=l,i===u&&(i=s,l=ai(),l!==u&&(x=i,l=rt(l)),i=l),h--,i===u&&(l=u,h===0&&g(nt)),i}function oi(){var i,l,a,p,m;if(h++,i=s,l=[],a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Vt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u),a!==u)for(;a!==u;)l.push(a),a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Vt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u);else l=u;return l!==u&&(x=i,l=ot(l)),i=l,h--,i===u&&(l=u,h===0&&g(st)),i}function li(){var i,l,a,p,m;if(h++,i=s,l=[],a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Wt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u),a!==u)for(;a!==u;)l.push(a),a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Wt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u);else l=u;return l!==u&&(x=i,l=ot(l)),i=l,h--,i===u&&(l=u,h===0&&g(st)),i}function ai(){var i,l,a,p,m;if(h++,i=s,l=[],a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Jt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u),a!==u)for(;a!==u;)l.push(a),a=s,p=s,h++,m=q(),h--,m===u?p=void 0:(s=p,p=u),p!==u?(m=Jt(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u);else l=u;return l!==u&&(x=i,l=ot(l)),i=l,h--,i===u&&(l=u,h===0&&g(st)),i}function Vt(){var i,l,a;return h++,i=s,l=s,h++,c.charCodeAt(s)===92?(a=ae,s++):(a=u,h===0&&g(ce)),a===u&&(c.charCodeAt(s)===125?(a=Xe,s++):(a=u,h===0&&g(Ve)),a===u&&(c.substr(s,2)===ne?(a=ne,s+=2):(a=u,h===0&&g($e)),a===u&&(c.charCodeAt(s)===10?(a=Ne,s++):(a=u,h===0&&g(Te))))),h--,a===u?l=void 0:(s=l,l=u),l!==u?(c.length>s?(a=c.charAt(s),s++):(a=u,h===0&&g(W)),a!==u?(x=i,l=at(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,c.substr(s,2)===J?(l=J,s+=2):(l=u,h===0&&g(le)),l!==u&&(x=i,l=ct()),i=l,i===u&&(i=s,c.substr(s,2)===Ce?(l=Ce,s+=2):(l=u,h===0&&g(et)),l!==u&&(x=i,l=zu()),i=l)),h--,i===u&&(l=u,h===0&&g(lt)),i}function Wt(){var i,l,a;return h++,i=s,l=s,h++,c.charCodeAt(s)===92?(a=ae,s++):(a=u,h===0&&g(ce)),a===u&&(c.charCodeAt(s)===124?(a=Je,s++):(a=u,h===0&&g(Ye)),a===u&&(c.substr(s,2)===ne?(a=ne,s+=2):(a=u,h===0&&g($e)),a===u&&(c.charCodeAt(s)===10?(a=Ne,s++):(a=u,h===0&&g(Te))))),h--,a===u?l=void 0:(s=l,l=u),l!==u?(c.length>s?(a=c.charAt(s),s++):(a=u,h===0&&g(W)),a!==u?(x=i,l=at(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,c.substr(s,2)===J?(l=J,s+=2):(l=u,h===0&&g(le)),l!==u&&(x=i,l=ct()),i=l,i===u&&(i=s,c.substr(s,2)===Ft?(l=Ft,s+=2):(l=u,h===0&&g(qu)),l!==u&&(x=i,l=Mu()),i=l)),h--,i===u&&(l=u,h===0&&g(lt)),i}function Jt(){var i,l,a;return h++,i=s,l=s,h++,c.charCodeAt(s)===92?(a=ae,s++):(a=u,h===0&&g(ce)),a===u&&(c.charCodeAt(s)===36?(a=Ke,s++):(a=u,h===0&&g(Ze)),a===u&&(c.substr(s,2)===ne?(a=ne,s+=2):(a=u,h===0&&g($e)),a===u&&(c.charCodeAt(s)===10?(a=Ne,s++):(a=u,h===0&&g(Te))))),h--,a===u?l=void 0:(s=l,l=u),l!==u?(c.length>s?(a=c.charAt(s),s++):(a=u,h===0&&g(W)),a!==u?(x=i,l=at(a),i=l):(s=i,i=u)):(s=i,i=u),i===u&&(i=s,c.substr(s,2)===J?(l=J,s+=2):(l=u,h===0&&g(le)),l!==u&&(x=i,l=ct()),i=l,i===u&&(i=s,c.substr(s,2)===xt?(l=xt,s+=2):(l=u,h===0&&g(Uu)),l!==u&&(x=i,l=Xu()),i=l)),h--,i===u&&(l=u,h===0&&g(lt)),i}function Be(){var i,l,a;return h++,i=s,l=Yt(),l!==u?(a=V(),a===u&&(a=_i()),a!==u?(x=i,l=Wu(l),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Vu)),i}function Yt(){var i,l,a;return h++,i=s,l=ci(),l!==u?(a=Yt(),a===u&&(a=null),a!==u?(x=i,l=Yu(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Ju)),i}function ci(){var i,l;return h++,i=s,l=q(),l!==u&&(x=i,l=yt(l)),i=l,i===u&&(i=s,l=fi(),l!==u&&(x=i,l=yt(l)),i=l),h--,i===u&&(l=u,h===0&&g(Ku)),i}function fi(){var i,l,a,p,m,E;if(h++,i=s,l=s,a=[],p=s,m=s,h++,E=q(),h--,E===u?m=void 0:(s=m,m=u),m!==u?(Z.test(c.charAt(s))?(E=c.charAt(s),s++):(E=u,h===0&&g(Q)),E!==u?(m=[m,E],p=m):(s=p,p=u)):(s=p,p=u),p!==u)for(;p!==u;)a.push(p),p=s,m=s,h++,E=q(),h--,E===u?m=void 0:(s=m,m=u),m!==u?(Z.test(c.charAt(s))?(E=c.charAt(s),s++):(E=u,h===0&&g(Q)),E!==u?(m=[m,E],p=m):(s=p,p=u)):(s=p,p=u);else a=u;return a!==u?l=c.substring(l,s):l=a,l!==u&&(x=i,l=Qu(l)),i=l,h--,i===u&&(l=u,h===0&&g(Zu)),i}function pe(){var i,l,a,p;return h++,i=s,l=hi(),l===u&&(l=te()),l!==u?(a=pe(),a===u&&(a=null),a!==u?(p=X(),p!==u?(x=i,l=tn(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Gu)),i}function hi(){var i,l,a,p,m;if(h++,i=s,l=[],c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he)),a!==u)for(;a!==u;)l.push(a),c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he));else l=u;if(l!==u){if(a=[],c.charCodeAt(s)===42?(p=Bt,s++):(p=u,h===0&&g(At)),p!==u)for(;p!==u;)a.push(p),c.charCodeAt(s)===42?(p=Bt,s++):(p=u,h===0&&g(At));else a=u;if(a!==u){for(p=[],m=Y();m!==u;)p.push(m),m=Y();p!==u?(m=Be(),m!==u?(x=i,l=nn(a,m),i=l):(s=i,i=u)):(s=i,i=u)}else s=i,i=u}else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(un)),i}function de(){var i,l,a,p;return h++,i=s,l=pi(),l===u&&(l=te()),l!==u?(a=de(),a===u&&(a=null),a!==u?(p=X(),p!==u?(x=i,l=sn(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(rn)),i}function pi(){var i,l,a,p,m,E;if(h++,i=s,l=[],c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he)),a!==u)for(;a!==u;)l.push(a),c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he));else l=u;if(l!==u)if(a=gi(),a!==u)if(c.charCodeAt(s)===46?(p=ln,s++):(p=u,h===0&&g(an)),p!==u){for(m=[],E=Y();E!==u;)m.push(E),E=Y();m!==u?(E=Be(),E!==u?(x=i,l=cn(a,E),i=l):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;else s=i,i=u;else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(on)),i}function me(){var i,l,a,p;return h++,i=s,l=di(),l===u&&(l=te()),l!==u?(a=me(),a===u&&(a=null),a!==u?(p=X(),p!==u?(x=i,l=hn(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(fn)),i}function di(){var i,l,a,p,m,E,_,w;for(h++,i=s,l=[],c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he));a!==u;)l.push(a),c.charCodeAt(s)===32?(a=fe,s++):(a=u,h===0&&g(he));if(l!==u)if(c.charCodeAt(s)===58?(a=dn,s++):(a=u,h===0&&g(mn)),a!==u)if(c.charCodeAt(s)===32?(p=fe,s++):(p=u,h===0&&g(he)),p!==u){for(m=[],E=Y();E!==u;)m.push(E),E=Y();m!==u?(E=Be(),E!==u?(_=Kt(),_!==u?(w=X(),w!==u?(x=i,l=gn(E,_),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)):(s=i,i=u)}else s=i,i=u;else s=i,i=u;else s=i,i=u;return h--,i===u&&(l=u,h===0&&g(pn)),i}function Kt(){var i,l,a,p;return h++,i=s,l=mi(),l!==u?(a=Kt(),a===u&&(a=null),a!==u?(p=X(),p!==u?(x=i,l=En(l,a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(_n)),i}function mi(){var i,l,a,p;if(h++,i=s,l=[],Fe.test(c.charAt(s))?(a=c.charAt(s),s++):(a=u,h===0&&g(xe)),a!==u)for(;a!==u;)l.push(a),Fe.test(c.charAt(s))?(a=c.charAt(s),s++):(a=u,h===0&&g(xe));else l=u;return l!==u?(a=Be(),a!==u?(p=V(),p===u&&(p=null),p!==u?(x=i,l=bn(a),i=l):(s=i,i=u)):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Cn)),i}function Zt(){var i,l,a;return h++,i=s,l=te(),l!==u?(a=Zt(),a===u&&(a=null),a!==u?(x=i,l=xn(l,a),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Fn)),i}function te(){var i,l,a,p,m,E,_;if(h++,i=s,l=s,a=s,c.substr(s,2)===wt?(p=wt,s+=2):(p=u,h===0&&g(Bn)),p!==u){for(m=s,E=[],Z.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Q));_!==u;)E.push(_),Z.test(c.charAt(s))?(_=c.charAt(s),s++):(_=u,h===0&&g(Q));E!==u?m=c.substring(m,s):m=E,m!==u?(E=V(),E===u&&(E=null),E!==u?(p=[p,m,E],a=p):(s=a,a=u)):(s=a,a=u)}else s=a,a=u;return a!==u?l=c.substring(l,s):l=a,l!==u?(a=X(),a!==u?(x=i,l=An(l),i=l):(s=i,i=u)):(s=i,i=u),h--,i===u&&(l=u,h===0&&g(yn)),i}function gi(){var i,l,a;if(h++,i=s,l=[],a=Qt(),a!==u)for(;a!==u;)l.push(a),a=Qt();else l=u;return l!==u?i=c.substring(i,s):i=l,h--,i===u&&(l=u,h===0&&g(wn)),i}function Qt(){var i,l;return h++,kn.test(c.charAt(s))?(i=c.charAt(s),s++):(i=u,h===0&&g(vn)),h--,i===u&&(l=u,h===0&&g(Dn)),i}function je(){var i,l;return h++,Sn.test(c.charAt(s))?(i=c.charAt(s),s++):(i=u,h===0&&g($n)),h--,i===u&&(l=u,h===0&&g(Pn)),i}function V(){var i,l;return h++,c.substr(s,2)===ne?(i=ne,s+=2):(i=u,h===0&&g($e)),i===u&&(c.charCodeAt(s)===10?(i=Ne,s++):(i=u,h===0&&g(Te))),h--,i===u&&(l=u,h===0&&g(Nn)),i}function X(){var i,l,a,p,m;for(h++,i=s,l=[],a=s,p=[],Fe.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(xe));m!==u;)p.push(m),Fe.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(xe));for(p!==u?(m=V(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u);a!==u;){for(l.push(a),a=s,p=[],Fe.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(xe));m!==u;)p.push(m),Fe.test(c.charAt(s))?(m=c.charAt(s),s++):(m=u,h===0&&g(xe));p!==u?(m=V(),m!==u?(p=[p,m],a=p):(s=a,a=u)):(s=a,a=u)}return l!==u?i=c.substring(i,s):i=l,h--,i===u&&(l=u,h===0&&g(Tn)),i}function Gt(){var i,l,a;for(h++,i=s,l=[],Dt.test(c.charAt(s))?(a=c.charAt(s),s++):(a=u,h===0&&g(kt));a!==u;)l.push(a),Dt.test(c.charAt(s))?(a=c.charAt(s),s++):(a=u,h===0&&g(kt));return l!==u?i=c.substring(i,s):i=l,h--,i===u&&(l=u,h===0&&g(Rn)),i}function Y(){var i,l;return h++,In.test(c.charAt(s))?(i=c.charAt(s),s++):(i=u,h===0&&g(jn)),h--,i===u&&(l=u,h===0&&g(On)),i}function _i(){var i,l;return h++,i=s,h++,c.length>s?(l=c.charAt(s),s++):(l=u,h===0&&g(W)),h--,l===u?i=void 0:(s=i,i=u),h--,i===u&&(l=u,h===0&&g(Hn)),i}var T=(init_action(),__toCommonJS(action_exports));if(T.setup({text:Ln,location:zn}),Oe=y(),Oe!==u&&s===c.length)return Oe;throw Oe!==u&&s<c.length&&g(Un()),Pt(ft,ee<c.length?c.charAt(ee):null,ee<c.length?we(ee,ee+1):we(ee,ee))}n.exports={SyntaxError:o,parse:f}}});function walk(e,n){"use strict";if(!e)return;let r=n(e);r&&walk(r,n)}function visit(e,n){"use strict";_visit(()=>new SyncTaskPool,e,n)}function visitAsync(e,n){"use strict";return Promise.resolve(_visit(()=>new AsyncTaskPool,e,n))}function _visit(e,n,r){"use strict";let o={visitDefaultPre:r.visitDefaultPre,visitDefaultPost:r.visitDefaultPost||(()=>{}),visitBlockElementPre:r.visitBlockElementPre||r.visitNodePre||r.visitDefaultPre,visitBlockElementPost:r.visitBlockElementPost||r.visitNodePost||r.visitDefaultPost||(()=>{}),visitInlineElementPre:r.visitInlineElementPre||r.visitNodePre||r.visitDefaultPre,visitInlineElementPost:r.visitInlineElementPost||r.visitNodePost||r.visitDefaultPost||(()=>{}),visitNodePre:r.visitNodePre||r.visitDefaultPre,visitNodePost:r.visitNodePost||r.visitDefaultPost||(()=>{}),visitArgumentPre:r.visitArgumentPre||r.visitDefaultPre,visitArgumentPost:r.visitArgumentPost||r.visitDefaultPost||(()=>{}),visitChapterPre:r.visitChapterPre||r.visitNodePre||r.visitDefaultPre,visitChapterPost:r.visitChapterPost||r.visitNodePost||r.visitDefaultPost||(()=>{}),visitParagraphPre:r.visitParagraphPre||r.visitNodePre||r.visitDefaultPre,visitParagraphPost:r.visitParagraphPost||r.visitNodePost||(()=>{}),visitHeadlinePre:r.visitHeadlinePre||r.visitDefaultPre,visitHeadlinePost:r.visitHeadlinePost||r.visitDefaultPost||(()=>{}),visitUlistPre:r.visitUlistPre||r.visitNodePre||r.visitDefaultPre,visitUlistPost:r.visitUlistPost||r.visitNodePost||r.visitDefaultPost||(()=>{}),visitOlistPre:r.visitOlistPre||r.visitDefaultPre,visitOlistPost:r.visitOlistPost||r.visitDefaultPost||(()=>{}),visitDlistPre:r.visitDlistPre||r.visitDefaultPre,visitDlistPost:r.visitDlistPost||r.visitDefaultPost||(()=>{}),visitColumnPre:r.visitColumnPre||r.visitNodePre||r.visitDefaultPre,visitColumnPost:r.visitColumnPost||r.visitNodePost||r.visitDefaultPost||(()=>{}),visitColumnHeadlinePre:r.visitColumnHeadlinePre||r.visitDefaultPre,visitColumnHeadlinePost:r.visitColumnHeadlinePost||r.visitDefaultPost||(()=>{}),visitTextPre:r.visitTextPre||r.visitDefaultPre,visitTextPost:r.visitTextPost||r.visitDefaultPost||(()=>{}),visitSingleLineCommentPre:r.visitSingleLineCommentPre||r.visitDefaultPre,visitSingleLineCommentPost:r.visitSingleLineCommentPost||r.visitDefaultPost||(()=>{})};return o.visitDefaultPre=o.visitDefaultPre.bind(r),o.visitDefaultPost=o.visitDefaultPost.bind(r),o.visitBlockElementPre=o.visitBlockElementPre.bind(r),o.visitBlockElementPost=o.visitBlockElementPost.bind(r),o.visitInlineElementPre=o.visitInlineElementPre.bind(r),o.visitInlineElementPost=o.visitInlineElementPost.bind(r),o.visitNodePre=o.visitNodePre.bind(r),o.visitNodePost=o.visitNodePost.bind(r),o.visitArgumentPre=o.visitArgumentPre.bind(r),o.visitArgumentPost=o.visitArgumentPost.bind(r),o.visitChapterPre=o.visitChapterPre.bind(r),o.visitChapterPost=o.visitChapterPost.bind(r),o.visitHeadlinePre=o.visitHeadlinePre.bind(r),o.visitHeadlinePost=o.visitHeadlinePost.bind(r),o.visitUlistPre=o.visitUlistPre.bind(r),o.visitUlistPost=o.visitUlistPost.bind(r),o.visitOlistPre=o.visitOlistPre.bind(r),o.visitOlistPost=o.visitOlistPost.bind(r),o.visitDlistPre=o.visitDlistPre.bind(r),o.visitDlistPost=o.visitDlistPost.bind(r),o.visitColumnPre=o.visitColumnPre.bind(r),o.visitColumnPost=o.visitColumnPost.bind(r),o.visitColumnHeadlinePre=o.visitColumnHeadlinePre.bind(r),o.visitColumnHeadlinePost=o.visitColumnHeadlinePost.bind(r),o.visitTextPre=o.visitTextPre.bind(r),o.visitTextPost=o.visitTextPost.bind(r),o.visitSingleLineCommentPre=o.visitSingleLineCommentPre.bind(r),o.visitSingleLineCommentPost=o.visitSingleLineCommentPost.bind(r),_visitSub(e,null,n,o)}function _visitSub(e,n,r,o){"use strict";if(r instanceof BlockElementSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitBlockElementPre(r,n);return c.handle(d,{next:()=>{f.args.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))}),f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitBlockElementPost(f,n)),c.consume()})()}else if(r instanceof InlineElementSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitInlineElementPre(r,n);return c.handle(d,{next:()=>{f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitInlineElementPost(f,n)),c.consume()})()}else if(r instanceof ArgumentSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitArgumentPre(f,n);return c.handle(d,{next:()=>{},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitArgumentPost(f,n)),c.consume()})()}else if(r instanceof ChapterSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitChapterPre(f,n);return c.handle(d,{next:()=>{f.comments&&f.comments.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))}),c.add(()=>_visitSub(e,f,f.headline,o)),f.text&&f.text.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))}),f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitChapterPost(f,n)),c.consume()})()}else if(r instanceof HeadlineSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitHeadlinePre(r,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.label,o)),c.add(()=>_visitSub(e,f,f.caption,o))},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitHeadlinePost(f,n)),c.consume()})()}else if(r instanceof ColumnSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitColumnPre(f,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.headline,o)),f.text&&f.text.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitColumnPost(f,n)),c.consume()})()}else if(r instanceof ColumnHeadlineSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitColumnHeadlinePre(f,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.caption,o))},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitColumnHeadlinePost(f,n)),c.consume()})()}else if(r instanceof UlistElementSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitUlistPre(r,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.text,o)),f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,r,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitUlistPost(f,n)),c.consume()})()}else if(r instanceof OlistElementSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitOlistPre(r,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.text,o))},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitOlistPost(f,n)),c.consume()})()}else if(r instanceof DlistElementSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitDlistPre(r,n);return c.handle(d,{next:()=>{c.add(()=>_visitSub(e,f,f.text,o)),c.add(()=>_visitSub(e,f,f.content,o))},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitDlistPost(f,n)),c.consume()})()}else if(r instanceof NodeSyntaxTree&&(r.ruleName===7||r.ruleName===20)){let f=r;return(()=>{let c=e(),d=o.visitParagraphPre(f,n);return c.handle(d,{next:()=>{f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,f,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitParagraphPost(f,n)),c.consume()})()}else if(r instanceof NodeSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitNodePre(f,n);return c.handle(d,{next:()=>{f.childNodes.forEach(u=>{c.add(()=>_visitSub(e,f,u,o))})},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitNodePost(f,n)),c.consume()})()}else if(r instanceof TextNodeSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitTextPre(f,n);return c.handle(d,{next:()=>{},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitTextPost(f,n)),c.consume()})()}else if(r instanceof SingleLineCommentSyntaxTree){let f=r;return(()=>{let c=e(),d=o.visitSingleLineCommentPre(f,n);return c.handle(d,{next:()=>{},func:()=>{typeof d=="function"&&d(o)}}),c.add(()=>o.visitSingleLineCommentPost(f,n)),c.consume()})()}else return r?(()=>{let f=e(),c=o.visitDefaultPre(r,n);return f.handle(c,{next:()=>{},func:()=>{typeof c=="function"&&c(o)}}),f.add(()=>o.visitDefaultPost(r,n)),f.consume()})():e().consume()}var SyncTaskPool,AsyncTaskPool,init_walker=__esm({"lib/parser/walker.ts"(){"use strict";init_parser(),SyncTaskPool=class{constructor(){this.tasks=[]}add(e){this.tasks.push(e)}handle(e,n){typeof e>"u"||typeof e=="boolean"&&e?n.next():typeof e=="function"&&n.func()}consume(){return this.tasks.map(e=>e())}},AsyncTaskPool=class{constructor(){this.tasks=[]}add(e){this.tasks.push(()=>Promise.resolve(e()))}handle(e,n){typeof e>"u"||typeof e=="boolean"&&e?n.next():e&&typeof e.then=="function"?this.tasks.push(()=>Promise.resolve(e)):typeof e=="function"&&n.func()}consume(){return new Promise(n=>{let r=[],o=()=>{let f=this.tasks.shift();if(!f){n(r);return}f().then(c=>{r.push(c),o()})};o()})}}}}),parser_exports={};__export(parser_exports,{ArgumentSyntaxTree:()=>ArgumentSyntaxTree,BlockElementSyntaxTree:()=>BlockElementSyntaxTree,ChapterSyntaxTree:()=>ChapterSyntaxTree,ColumnHeadlineSyntaxTree:()=>ColumnHeadlineSyntaxTree,ColumnSyntaxTree:()=>ColumnSyntaxTree,DlistElementSyntaxTree:()=>DlistElementSyntaxTree,HeadlineSyntaxTree:()=>HeadlineSyntaxTree,InlineElementSyntaxTree:()=>InlineElementSyntaxTree,NodeSyntaxTree:()=>NodeSyntaxTree,OlistElementSyntaxTree:()=>OlistElementSyntaxTree,ParseError:()=>ParseError,RuleName:()=>RuleName,SingleLineCommentSyntaxTree:()=>SingleLineCommentSyntaxTree,SyntaxTree:()=>SyntaxTree2,TextNodeSyntaxTree:()=>TextNodeSyntaxTree,UlistElementSyntaxTree:()=>UlistElementSyntaxTree,parse:()=>parse2,transform:()=>transform});function parse2(e){"use strict";let n=PEG.parse(e),r=transform(n).toNode();visit(r,{visitDefaultPre:f=>{},visitParagraphPre:f=>{let c=f.childNodes[0].toNode();f.childNodes=c.childNodes}}),r.childNodes.length!==0&&reconstruct(r.childNodes[0].toNode(),f=>f.headline.level);let o=[];return visit(r,{visitDefaultPre:f=>{f.ruleName===31&&o.push(f.toNode())}}),o.forEach(f=>{reconstruct(f,c=>c.level)}),visit(r,{visitDefaultPre:(f,c)=>{f.parentNode=c}}),visit(r,{visitDefaultPre:(f,c)=>{},visitChapterPre:f=>{f.text.forEach((c,d,u)=>{c.prev=u[d-1],c.next=u[d+1]})},visitColumnPre:f=>{f.text.forEach((c,d,u)=>{c.prev=u[d-1],c.next=u[d+1]})},visitNodePre:f=>{f.childNodes.forEach((c,d,u)=>{c.prev=u[d-1],c.next=u[d+1]})}}),{ast:r,cst:n}}function transform(e){"use strict";if(!e)return null;let n=RuleName[e.syntax];if(typeof n>"u")throw new ParseError(e,"unknown rule: "+e.syntax);switch(n){case 3:return new ChapterSyntaxTree(e);case 11:return new BlockElementSyntaxTree(e);case 4:return new HeadlineSyntaxTree(e);case 12:return new InlineElementSyntaxTree(e);case 39:return new ColumnSyntaxTree(e);case 40:return new ColumnHeadlineSyntaxTree(e);case 17:return new ArgumentSyntaxTree(e);case 32:return new UlistElementSyntaxTree(e);case 34:return new OlistElementSyntaxTree(e);case 36:return new DlistElementSyntaxTree(e);case 10:case 16:case 23:case 26:case 30:return new TextNodeSyntaxTree(e);case 45:return new SingleLineCommentSyntaxTree(e);case 2:case 5:case 8:case 14:case 18:case 21:case 24:case 41:case 28:case 31:case 33:case 35:case 37:case 44:return new NodeSyntaxTree(e);case 1:case 7:case 13:case 20:case 22:case 38:return new NodeSyntaxTree(e);case 6:case 9:case 15:case 19:case 25:case 42:case 27:case 29:return transform(e.content);default:return new SyntaxTree2(e)}}function reconstruct(e,n){"use strict";let r=e.childNodes,o=[],f={parent:null,children:[]};r.forEach(c=>{c.ruleName===45?f.children.push(c):f.parent?n(f.parent)<n(c)?f.children.push(c):(o.push(f),f={parent:c,children:[]}):f.parent=c}),f.parent&&o.push(f),e.childNodes=[],o.forEach(c=>{const d=c.parent;d&&(e.childNodes.push(d),c.children.forEach(u=>{d.childNodes.push(u)}),reconstruct(d,n))})}var PEG,ParseError,RuleName,SyntaxTree2,NodeSyntaxTree,ChapterSyntaxTree,HeadlineSyntaxTree,BlockElementSyntaxTree,InlineElementSyntaxTree,ColumnSyntaxTree,ColumnHeadlineSyntaxTree,ArgumentSyntaxTree,UlistElementSyntaxTree,OlistElementSyntaxTree,DlistElementSyntaxTree,TextNodeSyntaxTree,SingleLineCommentSyntaxTree,init_parser=__esm({"lib/parser/parser.ts"(){"use strict";PEG=__toESM(require_grammar()),init_walker(),ParseError=class eu{constructor(n,r){this.syntax=n,this.message=r,Error.captureStackTrace&&Error.captureStackTrace(this,eu),this.name="ParseError"}},RuleName=(e=>(e[e.SyntaxError=0]="SyntaxError",e[e.Start=1]="Start",e[e.Chapters=2]="Chapters",e[e.Chapter=3]="Chapter",e[e.Headline=4]="Headline",e[e.Contents=5]="Contents",e[e.Content=6]="Content",e[e.Paragraph=7]="Paragraph",e[e.ParagraphSubs=8]="ParagraphSubs",e[e.ParagraphSub=9]="ParagraphSub",e[e.ContentText=10]="ContentText",e[e.BlockElement=11]="BlockElement",e[e.InlineElement=12]="InlineElement",e[e.BracketArg=13]="BracketArg",e[e.BracketArgSubs=14]="BracketArgSubs",e[e.BracketArgSub=15]="BracketArgSub",e[e.BracketArgText=16]="BracketArgText",e[e.BraceArg=17]="BraceArg",e[e.BlockElementContents=18]="BlockElementContents",e[e.BlockElementContent=19]="BlockElementContent",e[e.BlockElementParagraph=20]="BlockElementParagraph",e[e.BlockElementParagraphSubs=21]="BlockElementParagraphSubs",e[e.BlockElementParagraphSub=22]="BlockElementParagraphSub",e[e.BlockElementContentText=23]="BlockElementContentText",e[e.InlineElementContents=24]="InlineElementContents",e[e.InlineElementContent=25]="InlineElementContent",e[e.InlineElementContentText=26]="InlineElementContentText",e[e.SinglelineContent=27]="SinglelineContent",e[e.ContentInlines=28]="ContentInlines",e[e.ContentInline=29]="ContentInline",e[e.ContentInlineText=30]="ContentInlineText",e[e.Ulist=31]="Ulist",e[e.UlistElement=32]="UlistElement",e[e.Olist=33]="Olist",e[e.OlistElement=34]="OlistElement",e[e.Dlist=35]="Dlist",e[e.DlistElement=36]="DlistElement",e[e.DlistElementContents=37]="DlistElementContents",e[e.DlistElementContent=38]="DlistElementContent",e[e.Column=39]="Column",e[e.ColumnHeadline=40]="ColumnHeadline",e[e.ColumnContents=41]="ColumnContents",e[e.ColumnContent=42]="ColumnContent",e[e.ColumnTerminator=43]="ColumnTerminator",e[e.SinglelineComments=44]="SinglelineComments",e[e.SinglelineComment=45]="SinglelineComment",e))(RuleName||{}),SyntaxTree2=class{constructor(e){if(this.ruleName=RuleName[e.syntax],typeof this.ruleName>"u")throw new ParseError(e,"unknown rule: "+e.syntax);let n=e.location.end||e.location.start;this.location={start:{line:e.location.start.line,column:e.location.start.column,offset:e.location.start.offset},end:{line:n.line,column:n.column,offset:n.offset}}}toJSON(){let e={},n=[];for(let r in this)r==="ruleName"?e[r]=RuleName[this.ruleName]:r==="prev"||r==="next"||r==="parentNode"||(r==="childNodes"?n.push((o=>()=>{e[o]=this[o]})(r)):r==="fqn"||typeof this[r]!="function"&&(e[r]=this[r]));return n.forEach(r=>r()),e}toString(e=0){let n=this.makeIndent(e)+`SyntaxTree:[
`;return n+=this.makeIndent(e+1)+"offset = "+this.location.start.offset+`,
`,n+=this.makeIndent(e+1)+"line="+this.location.start.line+`,
`,n+=this.makeIndent(e+1)+"column="+this.location.start.column+`,
`,n+=this.makeIndent(e+1)+"name="+RuleName[this.ruleName]+`,
`,this.toStringHook(e,n),n+=this.makeIndent(e)+"]",n}makeIndent(e){let n="";for(let r=0;r<e;r++)n+="  ";return n}toStringHook(e,n){}checkNumber(e){if(typeof e!="number")throw new Error("number required. actual:"+typeof e+":"+e);return e}checkString(e){if(typeof e!="string")throw new Error("string required. actual:"+typeof e+":"+e);return e}checkObject(e){if(typeof e!="object")throw new Error("object required. actual:"+typeof e+":"+e);return e}checkArray(e){if(Array.isArray(e))return e;throw console.log(JSON.stringify(e,null,2)),new Error("array required. actual:"+typeof e+":"+e)}checkSyntaxType(e){return this instanceof e}isNode(){return this.checkSyntaxType(NodeSyntaxTree)}isBlockElement(){return this.checkSyntaxType(BlockElementSyntaxTree)}isInlineElement(){return this.checkSyntaxType(InlineElementSyntaxTree)}isArgument(){return this.checkSyntaxType(ArgumentSyntaxTree)}isChapter(){return this.checkSyntaxType(ChapterSyntaxTree)}isHeadline(){return this.checkSyntaxType(HeadlineSyntaxTree)}isUlist(){return this.checkSyntaxType(UlistElementSyntaxTree)}isOlist(){return this.checkSyntaxType(OlistElementSyntaxTree)}isDlist(){return this.checkSyntaxType(DlistElementSyntaxTree)}isTextNode(){return this.checkSyntaxType(TextNodeSyntaxTree)}isSingleLineComment(){return this.checkSyntaxType(SingleLineCommentSyntaxTree)}toOtherNode(e){if(this instanceof e)return this;throw new Error("this node is not "+e.name+", actual "+this.constructor.name)}toNode(){return this.toOtherNode(NodeSyntaxTree)}toBlockElement(){return this.toOtherNode(BlockElementSyntaxTree)}toInlineElement(){return this.toOtherNode(InlineElementSyntaxTree)}toArgument(){return this.toOtherNode(ArgumentSyntaxTree)}toChapter(){return this.toOtherNode(ChapterSyntaxTree)}toColumn(){return this.toOtherNode(ColumnSyntaxTree)}toHeadline(){return this.toOtherNode(HeadlineSyntaxTree)}toColumnHeadline(){return this.toOtherNode(ColumnHeadlineSyntaxTree)}toUlist(){return this.toOtherNode(UlistElementSyntaxTree)}toOlist(){return this.toOtherNode(OlistElementSyntaxTree)}toDlist(){return this.toOtherNode(DlistElementSyntaxTree)}toTextNode(){return this.toOtherNode(TextNodeSyntaxTree)}toSingleLineCommentNode(){return this.toOtherNode(SingleLineCommentSyntaxTree)}},NodeSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.childNodes=[],this.processChildNodes(e.content)}processChildNodes(e){Array.isArray(e)?e.forEach(n=>{let r=transform(n);r&&this.childNodes.push(r)}):e!==""&&e&&(n=>{let r=transform(n);r&&this.childNodes.push(r)})(e)}toStringHook(e,n){this.childNodes.length!==0&&(n+=this.makeIndent(e+1)+"childNodes["+this.childNodes.length+`]=[
`,this.childNodes.forEach(r=>{n+=r.toString(e+2),n+=`
`}),n+=this.makeIndent(e+1)+`]
`)}},ChapterSyntaxTree=class tu extends NodeSyntaxTree{constructor(n){if(super(n),n.comments&&n.comments.content?this.comments=this.checkArray(n.comments.content).map(r=>transform(r).toSingleLineCommentNode()):this.comments=[],this.headline=transform(this.checkObject(n.headline)).toHeadline(),typeof n.text=="string"||n.text===null){this.text=[];return}this.text=this.checkArray(n.text.content).map(r=>transform(r)),delete this.childNodes,this.childNodes=[]}get level(){return this.headline.level}get fqn(){let n=[];return walk(this,o=>(o instanceof tu&&n.unshift(o),o.parentNode)),n.map(o=>o.no).join(".")}},HeadlineSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.level=this.checkNumber(e.level),e.label&&(this.label=transform(this.checkObject(e.label)).toArgument()),this.caption=transform(this.checkObject(e.caption)).toNode()}},BlockElementSyntaxTree=class extends NodeSyntaxTree{constructor(e){super(e),this.symbol=this.checkString(e.symbol),this.args=this.checkArray(e.args).map(n=>transform(n).toNode())}},InlineElementSyntaxTree=class extends NodeSyntaxTree{constructor(e){super(e),this.symbol=this.checkString(e.symbol)}},ColumnSyntaxTree=class extends NodeSyntaxTree{constructor(e){if(super(e),this.headline=transform(this.checkObject(e.headline)).toColumnHeadline(),typeof e.text=="string"||e.text===null){this.text=[];return}this.text=this.checkArray(e.text.content).map(n=>transform(n)),delete this.childNodes,this.childNodes=[]}get level(){return this.headline.level}get fqn(){let e=[];return walk(this,r=>(r instanceof ChapterSyntaxTree&&e.unshift(r),r.parentNode)),e.map(r=>r.no).join(".")}},ColumnHeadlineSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.level=this.checkNumber(e.level),e.label&&(this.label=transform(this.checkObject(e.label)).toArgument()),this.caption=transform(this.checkObject(e.caption)).toNode()}},ArgumentSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.arg=this.checkString(e.arg)}},UlistElementSyntaxTree=class extends NodeSyntaxTree{constructor(e){super(e),this.level=this.checkNumber(e.level),this.text=transform(this.checkObject(e.text)),delete this.childNodes,this.childNodes=[]}},OlistElementSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.no=this.checkNumber(e.no),this.text=transform(this.checkObject(e.text))}},DlistElementSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.text=transform(this.checkObject(e.text)),this.content=transform(this.checkObject(e.content))}},TextNodeSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.text=this.checkString(e.text).replace(/\n+$/,"")}},SingleLineCommentSyntaxTree=class extends SyntaxTree2{constructor(e){super(e),this.text=this.checkString(e.text).replace(/^#@/,"").replace(/\n+$/,"")}}}});function replace(e){"use strict";return n=>e}var DummyError,AnalyzerError,init_exception=__esm({"lib/js/exception.ts"(){DummyError=class{constructor(e){this.message=e}},DummyError=__decorateClass([replace(Error)],DummyError),AnalyzerError=class uu extends DummyError{constructor(n){super(n),this.name="AnalyzerError",this.message=n,Error.captureStackTrace&&Error.captureStackTrace(this,uu)}}}}),builder_exports={};__export(builder_exports,{DefaultBuilder:()=>DefaultBuilder});var DefaultBuilder,init_builder=__esm({"lib/builder/builder.ts"(){"use strict";init_i18n(),init_exception(),init_parser(),init_walker(),init_utils2(),DefaultBuilder=class{constructor(){this.extention="bug"}get name(){return this.constructor.name}init(e){return this.book=e,Promise.all(e.allChunks.map(n=>this.processAst(n))).then(()=>null)}getDefaultVisitorArg(e){return{visitDefaultPre:n=>{},visitChapterPre:n=>this.chapterPre(e,n),visitChapterPost:n=>this.chapterPost(e,n),visitHeadlinePre:n=>this.headlinePre(e,"hd",n),visitHeadlinePost:n=>this.headlinePost(e,"hd",n),visitColumnPre:n=>this.columnPre(e,n),visitColumnPost:n=>this.columnPost(e,n),visitColumnHeadlinePre:n=>this.columnHeadlinePre(e,n),visitColumnHeadlinePost:n=>this.columnHeadlinePost(e,n),visitParagraphPre:n=>this.paragraphPre(e,"p",n),visitParagraphPost:n=>this.paragraphPost(e,"p",n),visitUlistPre:n=>this.ulistPre(e,"ul",n),visitUlistPost:n=>this.ulistPost(e,"ul",n),visitOlistPre:n=>this.olistPre(e,"ol",n),visitOlistPost:n=>this.olistPost(e,"ol",n),visitDlistPre:n=>this.dlistPre(e,"dl",n),visitDlistPost:n=>this.dlistPost(e,"dl",n),visitBlockElementPre:n=>this.blockPre(e,n.symbol,n),visitBlockElementPost:n=>this.blockPost(e,n.symbol,n),visitInlineElementPre:n=>this.inlinePre(e,n.symbol,n),visitInlineElementPost:n=>this.inlinePost(e,n.symbol,n),visitTextPre:n=>{this.text(e,n)},visitSingleLineCommentPre:n=>{this.singleLineComment(e,n)}}}processAst(e){let n=e.createBuilderProcess(this);return visitAsync(e.tree.ast,this.getDefaultVisitorArg(n)).then(()=>(this.processPost(n,e),Promise.all(e.nodes.map(r=>this.processAst(r))).then(()=>null)))}escape(e){throw new Error("please override this method")}getChapterTitle(e,n){let r=null;return visit(n.tree.ast,{visitDefaultPre:(o,f)=>!r,visitChapterPre:(o,f)=>(r=o,!1)}),r?nodeContentToString(e,r.headline):null}processPost(e,n){}chapterPre(e,n){}chapterPost(e,n){}headlinePre(e,n,r){}headlinePost(e,n,r){}columnPre(e,n){}columnPost(e,n){}columnHeadlinePre(e,n){}columnHeadlinePost(e,n){}paragraphPre(e,n,r){}paragraphPost(e,n,r){}ulistPre(e,n,r){}ulistPost(e,n,r){}olistPre(e,n,r){}olistPost(e,n,r){}dlistPre(e,n,r){}dlistPost(e,n,r){}text(e,n){e.out(n.text)}blockPre(e,n,r){let o;if(o=this[`block_${n}`],typeof o=="function")return o.call(this,e,r);if(o=this[`block_${n}_pre`],typeof o!="function")throw new AnalyzerError(`block_${n}_pre or block_${n} is not Function`);return o.call(this,e,r)}blockPost(e,n,r){let o;if(o=this[`block_${n}`],typeof o!="function"){if(o=this[`block_${n}_post`],typeof o!="function")throw new AnalyzerError(`block_${n}_post is not Function`);return o.call(this,e,r)}}inlinePre(e,n,r){let o;if(o=this[`inline_${n}`],typeof o=="function")return o.call(this,e,r);if(o=this[`inline_${n}_pre`],typeof o!="function")throw new AnalyzerError(`inline_${n}_pre or inline_${n} is not Function`);return o.call(this,e,r)}inlinePost(e,n,r){let o;if(o=this[`inline_${n}`],typeof o!="function"){if(o=this[`inline_${n}_post`],typeof o!="function")throw new AnalyzerError(`inline_${n}_post is not Function`);return o.call(this,e,r)}}ulistParentHelper(e,n,r,o=n.level){if(o!==1){if(findUp(n.parentNode,c=>c instanceof UlistElementSyntaxTree?c.level===o-1:!1))return;r(),this.ulistParentHelper(e,n,r,o-1)}}findReference(e,n){let r=e.symbols.filter(o=>o.node===n);if(r.length!==1)throw new AnalyzerError("invalid status.");return r[0]}inline_hd_pre(e,n){e.out("\u300C");const r=this.findReference(e,n).referenceTo?.referenceNode?.parentNode.toChapter();return r?(r.level===1?e.out(r.fqn).out("\u7AE0 "):e.out(r.fqn).out(" "),visit(r.headline.caption,this.getDefaultVisitorArg(e)),!1):(e.error(t("builder.chapter_not_found",1),n),!1)}inline_hd_post(e,n){e.out("\u300D")}block_raw(e,n){let r=nodeContentToString(e,n.args[0]),o=r.match(/\|(.+)\|/);return o&&o[1]?o[1].split(",").some(c=>this.name.toLowerCase()===`${c}builder`)&&e.outRaw(r.substring(o[0].length)):e.outRaw(r),!1}inline_raw(e,n){let r=nodeContentToString(e,n),o=r.match(/\|(.+)\|/);return o&&o[1]?o[1].split(",").some(c=>this.name.toLowerCase()===`${c}builder`)&&e.outRaw(r.substring(o[0].length)):e.outRaw(r),!1}singleLineComment(e,n){}parseTable(e){return this.parseTableContents(this.parseTableLines(e))}parseTableLines(e){const n=[];let r=[],o=e.length>0?e[0].location.start.line:0;return e.forEach(f=>{if(f.location.start.line!==o&&(n.push(r),r=[]),o=f.location.start.line,f.isInlineElement()){r.push(f.toInlineElement());return}const c=f.location.start.offset,d=f.location.start.line,u=f.location.start.column,b=f.toTextNode().text;let y=0,B=0;do{const C=b.indexOf(`
`,y),S={offset:y+c,line:B+d,column:y+u},k=C+1,A=C<0?b.substring(y):b.substring(y,k);if(r.push({text:A,location:{start:S,end:{offset:S.offset+A.length-1,line:S.line,column:S.column+A.length-1}}}),o=S.line,C<0)break;n.push(r),r=[],y=k,B++}while(y<b.length)}),r.length>0&&n.push(r),n}parseTableContents(e){const n=[];let r=[],o=[],f=0;e.forEach((d,u)=>{d.forEach((b,y)=>{if(b instanceof InlineElementSyntaxTree){o.push(b);return}const B=d.length===1?b.text.trim():y===0?b.text.trimStart():y===d.length-1?b.text.trimEnd():b.text;if(B.match(/^(-{12,}|={12,})$/g)!=null){f===0&&(f=u);return}const C=B.split(/\t/g),S=C.length-1;C.forEach((k,A)=>{if(!k.length&&!o.length)return;let F;k==="."?F="":F=k.startsWith("..")?k.substr(1):k,o.push(new TextNodeSyntaxTree({syntax:"InlineElementContentText",location:b.location,text:F})),A!==S&&o.length>0&&(r.push({nodes:o}),o=[])})}),o.length>0&&(r.push({nodes:o}),o=[]),r.length>0&&(n.push(r),r=[])}),o.length>0&&r.push({nodes:o}),r.length>0&&n.push(r);let c=0;for(const d of n.map(u=>u.length))d>c&&(c=d);return n.forEach(d=>{const u=d[d.length-1],b=u.nodes[u.nodes.length-1].location;for(let y=d.length;y<c;y++)d.push({nodes:[new TextNodeSyntaxTree({syntax:"InlineElementContentText",location:{start:{line:b.start.line,column:b.start.column,offset:b.start.offset},end:{line:b.end?.line,column:b.end?.column,offset:b.end?.offset}},text:""})]})}),{cells:n,headerRowCount:f}}}}}),textBuilder_exports={};__export(textBuilder_exports,{TextBuilder:()=>TextBuilder});var TextBuilder,init_textBuilder=__esm({"lib/builder/textBuilder.ts"(){"use strict";init_builder(),init_i18n(),init_parser(),init_walker(),init_utils2(),TextBuilder=class extends DefaultBuilder{constructor(){super(...arguments),this.extention="txt"}escape(e){return e}headlinePre(e,n,r){if(e.out("\u25A0H").out(r.level).out("\u25A0"),r.level===1){let o=t("builder.chapter",r.parentNode.no);e.out(o).out("\u3000")}else r.level<4&&e.out(getHeadlineLevels(r).join(".")).out("\u3000")}headlinePost(e,n,r){e.out(`

`)}columnHeadlinePre(e,n){return e.out(`
\u25C6\u2192\u958B\u59CB:\u30B3\u30E9\u30E0\u2190\u25C6
`),e.out("\u25A0"),r=>{visit(n.caption,r)}}columnHeadlinePost(e,n){e.out(`
`)}columnPost(e,n){e.out(`\u25C6\u2192\u7D42\u4E86:\u30B3\u30E9\u30E0\u2190\u25C6

`)}paragraphPost(e,n,r){e.out(`
`)}ulistPre(e,n,r){this.ulistParentHelper(e,r,()=>{e.out(`

\u25CF	`)}),r.parentNode instanceof UlistElementSyntaxTree&&!(r.prev instanceof UlistElementSyntaxTree)?e.out(`

`):r.parentNode instanceof UlistElementSyntaxTree&&e.out(""),e.out("\u25CF	")}ulistPost(e,n,r){e.out(`
`)}olistPre(e,n,r){e.out(r.no).out("	")}olistPost(e,n,r){e.out(`
`)}dlistPre(e,n,r){return o=>{e.out("\u2605"),visit(r.text,o),e.out(`\u2606
`),e.out("	"),visit(r.content,o),e.out(`
`)}}dlistPost(e,n,r){e.out(`
`)}block_list_pre(e,n){e.out(`\u25C6\u2192\u958B\u59CB:\u30EA\u30B9\u30C8\u2190\u25C6
`);let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.list",r.fqn,n.no);return e.out(o).out("\u3000"),f=>{visit(n.args[1],f),e.outRaw(`

`);const c=n.childNodes.length;let d=0;n.childNodes.forEach(u=>{visit(u,f),d++,d<c&&e.out(`
`)})}}block_list_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u30EA\u30B9\u30C8\u2190\u25C6
`)}block_listnum_pre(e,n){e.out(`\u25C6\u2192\u958B\u59CB:\u30EA\u30B9\u30C8\u2190\u25C6
`);let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.list",r.fqn,n.no);e.out(o).out("\u3000");let f=1;return c=>{visit(n.args[1],c);let d=0;n.childNodes.forEach((b,y,B)=>{b.isTextNode()&&(d+=b.toTextNode().text.split(`
`).length)});let u=Math.max(linesToFigure(d),2);e.outRaw(`

`),n.childNodes.forEach((b,y,B)=>{if(b.isTextNode()){let C=!!B[y+1],k=b.toTextNode().text.split(`
`);k.forEach((A,F)=>{e.out(padLeft(String(f)," ",u)).out(": "),e.out(A),(!C||k.length-1!==F)&&f++,e.out(`
`)})}else visit(b,c);f++})}}block_listnum_post(e,n){e.out(`\u25C6\u2192\u7D42\u4E86:\u30EA\u30B9\u30C8\u2190\u25C6
`)}inline_list(e,n){let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=this.findReference(e,n).referenceTo.referenceNode.toBlockElement(),f=t("builder.list",r.fqn,o.no);return e.out(f),!1}block_emlist_pre(e,n){return e.out(`\u25C6\u2192\u958B\u59CB:\u30A4\u30F3\u30E9\u30A4\u30F3\u30EA\u30B9\u30C8\u2190\u25C6
`),r=>{n.args[0]&&(e.out("\u25A0"),visit(n.args[0],r),e.out(`
`));const o=n.childNodes.length;let f=0;n.childNodes.forEach(c=>{visit(c,r),f++,f<o&&e.out(`
`)})}}block_emlist_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u30A4\u30F3\u30E9\u30A4\u30F3\u30EA\u30B9\u30C8\u2190\u25C6
`)}block_emlistnum_pre(e,n){e.out(`\u25C6\u2192\u958B\u59CB:\u30A4\u30F3\u30E9\u30A4\u30F3\u30EA\u30B9\u30C8\u2190\u25C6
`);let r=1;return o=>{n.args[0]&&(e.out("\u25A0"),visit(n.args[0],o),e.out(`
`));let f=0;n.childNodes.forEach((d,u,b)=>{d.isTextNode()&&(f+=d.toTextNode().text.split(`
`).length)});let c=Math.max(linesToFigure(f),2);n.childNodes.forEach((d,u,b)=>{if(d.isTextNode()){let y=!!b[u+1],C=d.toTextNode().text.split(`
`);C.forEach((S,k)=>{e.out(padLeft(String(r)," ",c)).out(": "),e.out(S),(!y||C.length-1!==k)&&r++,e.out(`
`)})}else visit(d,o);r++})}}block_emlistnum_post(e,n){e.out(`\u25C6\u2192\u7D42\u4E86:\u30A4\u30F3\u30E9\u30A4\u30F3\u30EA\u30B9\u30C8\u2190\u25C6
`)}inline_br(e,n){e.out(`
`)}inline_b_pre(e,n){e.out("\u2605")}inline_b_post(e,n){e.out("\u2606")}inline_code_pre(e,n){e.out("\u25B3")}inline_code_post(e,n){e.out("\u2606")}inline_href_pre(e,n){e.out("\u25B3")}inline_href_post(e,n){e.out("\u2606")}inline_href(e,n){let r=null,o=nodeContentToString(e,n);return o.indexOf(",")!==-1&&(r=o.slice(0,o.indexOf(",")),o=o.slice(o.indexOf(",")+1).trimLeft()),r?e.out(o).out("\uFF08\u25B3").out(r).out("\u2606\uFF09"):e.out("\u25B3").out(o).out("\u2606"),!1}block_label(e,n){return!1}inline_ruby(e,n){let o=nodeContentToString(e,n).split(",");return e.out(o[0]),f=>{n.childNodes.forEach(c=>{e.out("\u25C6\u2192DTP\u9023\u7D61:\u300C").out(o[0]),e.out("\u300D\u306B\u300C ").out(o[1].trim()).out("\u300D\u3068\u30EB\u30D3\u2190\u25C6")})}}inline_u_pre(e,n){e.out("\uFF20")}inline_u_post(e,n){e.out("\uFF20\u25C6\u2192\uFF20\u301C\uFF20\u90E8\u5206\u306B\u4E0B\u7DDA\u2190\u25C6")}inline_kw(e,n){return e.out("\u2605"),r=>{n.childNodes.forEach(o=>{let c=nodeContentToString(e,o).split(","),d=c[0],u=(c[1]||"").trimLeft();e.out(`${d}\u2606`),u&&e.out(`\uFF08${u}\uFF09`)})}}inline_tt_pre(e,n){e.out("\u25B3")}inline_tt_post(e,n){e.out("\u2606")}inline_em_pre(e,n){e.warn(t("compile.deprecated_inline_symbol","em"),n),e.out("@<em>{")}inline_em_post(e,n){e.out("}")}block_image(e,n){let r=nodeContentToString(e,n.args[0]);return e.findImageFile(r).then(o=>{let f=nodeContentToString(e,n.args[1]);return e.out(`\u25C6\u2192\u958B\u59CB:\u56F3\u2190\u25C6
`),e.out("\u56F3").out(e.base.chapter.no).out(".").out(n.no).out("\u3000").out(f).out(`
`),e.out(`
`),e.out("\u25C6\u2192").out(o).out(`\u2190\u25C6
`),e.out(`\u25C6\u2192\u7D42\u4E86:\u56F3\u2190\u25C6
`),!1}).catch(o=>(e.error(t("builder.image_not_found",o),n),!1))}block_indepimage(e,n){return e.out("\u25C6\u2192\u753B\u50CF ").out(nodeContentToString(e,n.args[0])).out(`\u2190\u25C6
`),n.args[1]&&e.out("\u56F3\u3000").out(nodeContentToString(e,n.args[1])).out(`

`),!1}block_graph_pre(e,n){e.outRaw(`\u25C6\u2192\u958B\u59CB:\u56F3\u2190\u25C6
`);let r=nodeContentToString(e,n.args[1]);return e.outRaw("graph: ").out(r).outRaw(`</p>
`),o=>{n.childNodes.forEach(f=>{visit(f,o)})}}block_graph_post(e,n){e.outRaw(`\u25C6\u2192\u7D42\u4E86:\u56F3\u2190\u25C6
`)}inline_img(e,n){let r=this.findReference(e,n).referenceTo.referenceNode.toBlockElement();return e.out("\u56F3").out(e.base.chapter.no).out(".").out(r.no).out(`
`),!1}inline_icon(e,n){let r=e.base.chapter.name,o=r.substring(0,r.length-3),f=nodeContentToString(e,n),c="images/"+o+"-"+f+".png";return e.out("\u25C6\u2192\u753B\u50CF ").out(c).out("\u2190\u25C6"),!1}block_footnote(e,n){return e.out("\u3010\u6CE8").out(n.no).out("\u3011"),r=>{visit(n.args[1],r),e.out(`
`)}}inline_fn(e,n){let r=this.findReference(e,n).referenceTo.referenceNode.toBlockElement();return e.out("\u3010\u6CE8").out(r.no).out("\u3011"),!1}block_lead_pre(e,n){e.out(`\u25C6\u2192\u958B\u59CB:\u30EA\u30FC\u30C9\u2190\u25C6
`)}block_lead_post(e,n){e.out(`\u25C6\u2192\u7D42\u4E86:\u30EA\u30FC\u30C9\u2190\u25C6
`)}inline_tti_pre(e,n){e.out("\u25B2")}inline_tti_post(e,n){e.out("\u2606\u25C6\u2192\u7B49\u5E45\u30D5\u30A9\u30F3\u30C8\u30A4\u30BF\u2190\u25C6")}inline_ttb_pre(e,n){e.out("\u2605")}inline_ttb_post(e,n){e.out("\u2606\u25C6\u2192\u7B49\u5E45\u30D5\u30A9\u30F3\u30C8\u592A\u5B57\u2190\u25C6")}block_noindent(e,n){return e.out(`\u25C6\u2192DTP\u9023\u7D61:\u6B21\u306E1\u884C\u30A4\u30F3\u30C7\u30F3\u30C8\u306A\u3057\u2190\u25C6
`),!1}block_blankline(e,n){return e.out(`
`),!1}block_source_pre(e,n){return e.out(`\u25C6\u2192\u958B\u59CB:\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u30EA\u30B9\u30C8\u2190\u25C6
`),e.out("\u25A0").out(nodeContentToString(e,n.args[0])).out(`
`),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_source_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u30EA\u30B9\u30C8\u2190\u25C6
`)}block_cmd_pre(e,n){return e.out(`\u25C6\u2192\u958B\u59CB:\u30B3\u30DE\u30F3\u30C9\u2190\u25C6
`),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_cmd_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u30B3\u30DE\u30F3\u30C9\u2190\u25C6
`)}block_quote_pre(e,n){return e.out(`\u25C6\u2192\u958B\u59CB:\u5F15\u7528\u2190\u25C6
`),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_quote_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u5F15\u7528\u2190\u25C6
`)}inline_ami_pre(e,n){}inline_ami_post(e,n){e.out("\u25C6\u2192DTP\u9023\u7D61:\u300C").out(nodeContentToString(e,n)).out("\u300D\u306B\u7DB2\u30AB\u30B1\u2190\u25C6")}inline_bou_pre(e,n){}inline_bou_post(e,n){e.out("\u25C6\u2192DTP\u9023\u7D61:\u300C").out(nodeContentToString(e,n)).out("\u300D\u306B\u508D\u70B9\u2190\u25C6")}inline_del_pre(e,n){e.out("\u25C6\u2192\u958B\u59CB:\u524A\u9664\u8868\u73FE\u2190\u25C6")}inline_del_post(e,n){e.out("\u25C6\u2192\u7D42\u4E86:\u524A\u9664\u8868\u73FE\u2190\u25C6")}inline_i_pre(e,n){e.out("\u25B2")}inline_i_post(e,n){e.out("\u2606")}inline_ins_pre(e,n){e.out("\u25C6\u2192\u958B\u59CB:\u633F\u5165\u8868\u73FE\u2190\u25C6")}inline_ins_post(e,n){e.out("\u25C6\u2192\u7D42\u4E86:\u633F\u5165\u8868\u73FE\u2190\u25C6")}inline_m_pre(e,n){e.outRaw("TODO: ")}inline_m_post(e,n){e.outRaw("")}inline_strong_pre(e,n){e.out("\u2605")}inline_strong_post(e,n){e.out("\u2606")}inline_tcy_pre(e,n){e.out("\u25C6\u2192\u958B\u59CB:\u56DE\u8EE2\u2190\u25C6")}inline_tcy_post(e,n){e.out("\u25C6\u2192\u7D42\u4E86:\u7E26\u56DE\u8EE2\u2190\u25C6")}inline_uchar(e,n){let r=nodeContentToString(e,n),o=parseInt(r,16),f="";for(;o!==0;)f=String.fromCharCode(o&65535)+f,o>>>=16;return e.out(f),!1}block_table_pre(e,n){e.out(`
\u25C6\u2192\u958B\u59CB:\u8868\u2190\u25C6
`);let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.table",r.fqn,n.no);e.out(o).out("\u3000").out(nodeContentToString(e,n.args[1])).out(`

`);const f=this.parseTable(n.childNodes);return c=>{if(f.headerRowCount===0)f.cells.forEach(d=>{if(d.length!==0){e.out("\u2605"),d[0].nodes.forEach(u=>{visit(u,c)}),e.out("\u2606");for(let u=1;u<d.length;u++)e.outRaw("	"),d[u].nodes.forEach(b=>{visit(b,c)});e.outRaw(`
`)}});else{let d=0;for(;d<f.headerRowCount;d++){const u=f.cells[d];u.forEach((b,y)=>{e.out("\u2605"),b.nodes.forEach(B=>{visit(B,c)}),e.out("\u2606"),y<u.length-1?e.outRaw("	"):e.outRaw(`
`)})}for(;d<f.cells.length;d++){const u=f.cells[d];u.forEach((b,y)=>{b.nodes.forEach(B=>{visit(B,c)}),y<u.length-1?e.outRaw("	"):e.outRaw(`
`)})}}}}block_table_post(e,n){e.out(`\u25C6\u2192\u7D42\u4E86:\u8868\u2190\u25C6

`)}inline_table(e,n){let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=this.findReference(e,n).referenceTo.referenceNode.toBlockElement(),f=t("builder.table",r.fqn,o.no);return e.out(f),!1}block_tsize(e,n){return!1}block_comment_pre(e,n){return this.book.config.isDraft?(e.out("\u25C6\u2192"),r=>{n.childNodes.forEach(o=>{visit(o,r)})}):!1}block_comment_post(e,n){this.book.config.isDraft&&e.out(`\u2190\u25C6
`)}inline_comment_pre(e,n){return this.book.config.isDraft?(e.out("\u25C6\u2192"),!0):!1}inline_comment_post(e,n){this.book.config.isDraft&&e.out("\u2190\u25C6")}inline_chap(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r);return e.out("\u7B2C").out(o.no).out("\u7AE0"),!1}inline_title(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r),f=this.getChapterTitle(e,o);return e.out(f),!1}inline_chapref(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r),f=this.getChapterTitle(e,o);return e.out("\u7B2C").out(o.no).out("\u7AE0\u300C").out(f).out("\u300D"),!1}inline_idx(e,n){const r=nodeContentToString(e,n);return e.out(`${r}\u25C6\u2192\u7D22\u5F15\u9805\u76EE:${r}\u2190\u25C6`),!1}inline_hidx(e,n){const r=nodeContentToString(e,n);return e.out(`\u25C6\u2192\u7D22\u5F15\u9805\u76EE:${r}\u2190\u25C6`),!1}block_flushright_pre(e,n){return e.out(`\u25C6\u2192\u958B\u59CB:\u53F3\u5BC4\u305B\u2190\u25C6
`),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_flushright_post(e,n){e.out(`
\u25C6\u2192\u7D42\u4E86:\u53F3\u5BC4\u305B\u2190\u25C6
`)}block_captionblock_pre(e,n,r){if(n.out(`\u25C6\u2192\u958B\u59CB:${e}\u2190\u25C6
`),r.args[0]){let o=nodeContentToString(n,r.args[0]);n.out(`\u25A0${o}
`)}}block_captionblock_post(e,n,r){n.out(`\u25C6\u2192\u7D42\u4E86:${e}\u2190\u25C6
`)}block_info_pre(e,n){this.block_captionblock_pre("\u60C5\u5831",e,n)}block_info_post(e,n){this.block_captionblock_post("\u60C5\u5831",e,n)}block_note_pre(e,n){this.block_captionblock_pre("\u30CE\u30FC\u30C8",e,n)}block_note_post(e,n){this.block_captionblock_post("\u30CE\u30FC\u30C8",e,n)}block_memo_pre(e,n){this.block_captionblock_pre("\u30E1\u30E2",e,n)}block_memo_post(e,n){this.block_captionblock_post("\u30E1\u30E2",e,n)}block_tip_pre(e,n){this.block_captionblock_pre("TIP",e,n)}block_tip_post(e,n){this.block_captionblock_post("TIP",e,n)}block_warning_pre(e,n){this.block_captionblock_pre("\u5371\u967A",e,n)}block_warning_post(e,n){this.block_captionblock_post("\u5371\u967A",e,n)}block_important_pre(e,n){this.block_captionblock_pre("\u91CD\u8981",e,n)}block_important_post(e,n){this.block_captionblock_post("\u91CD\u8981",e,n)}block_caution_pre(e,n){this.block_captionblock_pre("\u8B66\u544A",e,n)}block_caution_post(e,n){this.block_captionblock_post("\u8B66\u544A",e,n)}block_notice_pre(e,n){this.block_captionblock_pre("\u6CE8\u610F",e,n)}block_notice_post(e,n){this.block_captionblock_post("\u6CE8\u610F",e,n)}}}}),htmlBuilder_exports={};__export(htmlBuilder_exports,{HtmlBuilder:()=>HtmlBuilder});var HtmlBuilder,init_htmlBuilder=__esm({"lib/builder/htmlBuilder.ts"(){"use strict";init_i18n(),init_builder(),init_parser(),init_walker(),init_utils2(),HtmlBuilder=class extends DefaultBuilder{constructor(e=!0){super(),this.standalone=e,this.extention="html",this.escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}}escape(e){let n=new RegExp(`[${Object.keys(this.escapeMap).join("")}]`,"g");return String(e).replace(n,r=>this.escapeMap[r])}normalizeId(e){return e.match(/^[a-z][a-z0-9_/-]*$/i)?e:e.match(/^[0-9_.-][a-z0-9_.-]*$/i)?`id_${e}`:`id_${encodeURIComponent(e.replace(/_/g,"__").replace(/ /g,"-")).replace(/%/g,"_").replace(/\+/g,"-")}`}processPost(e,n){if(this.standalone){let r="";r+=`<?xml version="1.0" encoding="UTF-8"?>
`,r+=`<!DOCTYPE html>
`,r+=`<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="ja">
`,r+=`<head>
`,r+=`  <meta charset="UTF-8" />
`,r+=`  <link rel="stylesheet" type="text/css" href="stylesheet.css" />
`,r+=`  <meta name="generator" content="Re:VIEW" />
`;let o=null;visit(n.tree.ast,{visitDefaultPre:()=>{},visitChapterPre:f=>{f.headline.level===1&&(o=nodeContentToString(e,f.headline.caption,!0))}}),r+="  <title>"+this.escape(o)+`</title>
`,r+=`</head>
`,r+=`<body>
`,e.pushOut(r),e.outRaw(`</body>
`),e.outRaw(`</html>
`)}}headlinePre(e,n,r){if(e.outRaw("<h").out(r.level),r.label&&e.outRaw(' id="').out(this.normalizeId(r.label.arg)).outRaw('"'),e.outRaw(">"),e.outRaw('<a id="h').out(getHeadlineLevels(r).join("-")).outRaw('"></a>'),r.level===1){let o=t("builder.chapter",r.parentNode.no);e.outRaw('<span class="secno">'),e.out(o).out("\u3000"),e.outRaw("</span>")}else r.level<4&&e.out(getHeadlineLevels(r).join(".")).out("\u3000")}headlinePost(e,n,r){e.outRaw("</h").out(r.level).outRaw(`>
`)}columnPre(e,n){e.outRaw(`<div class="column">

`)}columnPost(e,n){e.outRaw(`</div>
`)}columnHeadlinePre(e,n){return e.outRaw("<h").out(n.level),n.label&&e.outRaw(' id="').out(this.normalizeId(n.label.arg)).outRaw('"'),e.outRaw(">"),e.outRaw('<a id="column-').out(n.parentNode.no).outRaw('"></a>'),r=>{visit(n.caption,r)}}columnHeadlinePost(e,n){e.outRaw("</h").out(n.level).outRaw(`>
`)}paragraphPre(e,n,r){r.prev&&r.prev.isBlockElement()&&r.prev.toBlockElement().symbol==="noindent"?e.outRaw('<p class="noindent">'):e.outRaw("<p>")}paragraphPost(e,n,r){e.outRaw(`</p>
`)}ulistPre(e,n,r){this.ulistParentHelper(e,r,()=>{e.outRaw(`<ul>
<li>`)}),r.prev instanceof UlistElementSyntaxTree||e.outRaw(`<ul>
`),e.outRaw("<li>")}ulistPost(e,n,r){e.outRaw(`</li>
`),r.next instanceof UlistElementSyntaxTree||e.outRaw(`</ul>
`),this.ulistParentHelper(e,r,()=>{e.outRaw(`</li>
</ul>
`)})}olistPre(e,n,r){r.prev instanceof OlistElementSyntaxTree||e.outRaw(`<ol>
`),e.outRaw("<li>")}olistPost(e,n,r){e.outRaw(`</li>
`),r.next instanceof OlistElementSyntaxTree||e.outRaw(`</ol>
`)}dlistPre(e,n,r){return r.prev instanceof DlistElementSyntaxTree||e.outRaw(`<dl>
`),o=>{e.outRaw("<dt>"),visit(r.text,o),e.outRaw(`</dt>
`),e.outRaw("<dd>"),visit(r.content,o),e.outRaw(`</dd>
`)}}dlistPost(e,n,r){r.next instanceof DlistElementSyntaxTree||e.outRaw(`</dl>
`)}block_list_pre(e,n){e.outRaw(`<div class="caption-code">
`);let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.list",r.fqn,n.no);return e.outRaw('<p class="caption">').out(o).outRaw(": "),f=>{visit(n.args[1],f),e.outRaw(`</p>
`),e.outRaw('<pre class="list">');const c=n.childNodes.length;let d=0;n.childNodes.forEach(u=>{visit(u,f),d++,d<c&&e.out(`
`)})}}block_list_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}block_listnum_pre(e,n){e.outRaw(`<div class="code">
`);let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.list",r.fqn,n.no);e.outRaw('<p class="caption">').out(o).out(": ");let f=1;return c=>{visit(n.args[1],c),e.outRaw(`</p>
`),e.outRaw('<pre class="list">');let d=0;n.childNodes.forEach(B=>{B.isTextNode()&&(d+=B.toTextNode().text.split(`
`).length)});let u=Math.max(linesToFigure(d),2);const b=n.childNodes.length;let y=0;n.childNodes.forEach((B,C,S)=>{if(B.isTextNode()){let k=!!S[C+1],F=B.toTextNode().text.split(`
`);F.forEach((O,P)=>{e.out(padLeft(String(f)," ",u)).out(": "),e.out(O),(!k||F.length-1!==P)&&f++,F.length-1!==P&&e.out(`
`)})}else visit(B,c);y++,y<b&&e.out(`
`),f++})}}block_listnum_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}inline_list(e,n){let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=this.findReference(e,n).referenceTo.referenceNode.toBlockElement(),f=t("builder.list",r.fqn,o.no);return e.out(f),!1}block_emlist_pre(e,n){return e.outRaw(`<div class="emlist-code">
`),r=>{n.args[0]&&(e.outRaw('<p class="caption">'),visit(n.args[0],r),e.outRaw(`</p>
`)),e.outRaw('<pre class="emlist">');const o=n.childNodes.length;let f=0;n.childNodes.forEach(c=>{visit(c,r),f++,f<o&&e.out(`
`)})}}block_emlist_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}block_emlistnum_pre(e,n){e.outRaw(`<div class="emlistnum-code">
`),e.outRaw('<pre class="emlist">');let r=1;return o=>{let f=0;n.childNodes.forEach(b=>{b.isTextNode()&&(f+=b.toTextNode().text.split(`
`).length)});let c=Math.max(linesToFigure(f),2);const d=n.childNodes.length;let u=0;n.childNodes.forEach((b,y,B)=>{if(b.isTextNode()){let C=!!B[y+1],k=b.toTextNode().text.split(`
`);k.forEach((A,F)=>{e.out(padLeft(String(r)," ",c)).out(": "),e.out(A),(!C||k.length-1!==F)&&r++,k.length-1!==F&&e.out(`
`)})}else visit(b,o);u++,u<d&&e.out(`
`),r++})}}block_emlistnum_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}inline_br(e,n){e.outRaw("<br />")}inline_b_pre(e,n){e.outRaw("<b>")}inline_b_post(e,n){e.outRaw("</b>")}inline_code_pre(e,n){e.outRaw('<code class="inline-code tt">')}inline_code_post(e,n){e.outRaw("</code>")}inline_href(e,n){let r=nodeContentToString(e,n),o=r;return r.indexOf(",")!==-1&&(o=r.slice(r.indexOf(",")+1).trimLeft(),r=r.slice(0,r.indexOf(","))),e.outRaw('<a href="').outRaw(r).outRaw('" class="link">').out(o).outRaw("</a>"),!1}block_label(e,n){return e.outRaw('<a id="'),e.out(nodeContentToString(e,n.args[0])),e.outRaw(`"></a>
`),!1}inline_tt_pre(e,n){e.outRaw('<code class="tt">')}inline_tt_post(e,n){e.outRaw("</code>")}inline_ruby_pre(e,n){return e.outRaw("<ruby>"),r=>{n.childNodes.forEach(o=>{let c=nodeContentToString(e,o).split(",");e.out(c[0]),e.outRaw("<rp>\uFF08</rp>"),e.outRaw("<rt>").out(c[1]).outRaw("</rt>"),e.outRaw("<rp>\uFF09</rp>")})}}inline_ruby_post(e,n){e.outRaw("</ruby>")}inline_u_pre(e,n){e.outRaw("<u>")}inline_u_post(e,n){e.outRaw("</u>")}inline_kw_pre(e,n){return e.outRaw('<b class="kw">'),r=>{n.childNodes.forEach(o=>{let c=nodeContentToString(e,o).split(","),d=c[0],u=(c[1]||"").trimLeft();e.out(`${d}`),u&&e.out(` (${u})`)})}}inline_kw_post(e,n){let f=nodeContentToString(e,n).split(",")[0];e.outRaw("</b>").outRaw("<!-- IDX:").out(f).outRaw(" -->")}inline_em_pre(e,n){e.outRaw("<em>")}inline_em_post(e,n){e.outRaw("</em>")}block_image(e,n){let r=nodeContentToString(e,n.args[0]);return e.findImageFile(r).then(o=>{let f=nodeContentToString(e,n.args[1]),c=1;if(n.args[2]){let u=new RegExp("scale=(\\d+(?:\\.\\d+))").exec(nodeContentToString(e,n.args[2]));u&&(c=parseFloat(u[1]))}if(e.outRaw('<div id="').out(r).outRaw(`" class="image">
`),c!==1){let d=`000${c*100}`;d=d.substr(d.length-3),e.outRaw(`<img src="${o}" alt="`).out(f).outRaw('" class="width-').out(d).outRaw(`per" />
`)}else e.outRaw(`<img src="${o}" alt="`).out(f).outRaw(`" />
`);return e.outRaw(`<p class="caption">
`),e.out("\u56F3").out(e.base.chapter.no).out(".").out(n.no).out(": ").out(f),e.outRaw(`
</p>
`),e.outRaw(`</div>
`),!1}).catch(o=>(e.error(t("builder.image_not_found",o),n),!1))}block_indepimage(e,n){let r=nodeContentToString(e,n.args[0]);return e.findImageFile(r).then(o=>{let f="";n.args[1]&&(f=nodeContentToString(e,n.args[1]));let c=1;if(n.args[2]){let u=new RegExp("scale=(\\d+(?:\\.\\d+))").exec(nodeContentToString(e,n.args[2]));u&&(c=parseFloat(u[1]))}if(e.outRaw(`<div class="image">
`),c!==1){let d=`000${c*100}`;d=d.substr(d.length-3),e.outRaw(`<img src="${o}" alt="`).out(f).outRaw('" class="width-').out(d).outRaw(`per" />
`)}else e.outRaw(`<img src="${o}" alt="`).out(f).outRaw(`" />
`);return n.args[1]&&(e.outRaw(`<p class="caption">
`),e.out("\u56F3: ").out(f),e.outRaw(`
</p>
`)),e.outRaw(`</div>
`),!1})}block_graph_pre(e,n){e.outRaw(`<div>
`);let r=nodeContentToString(e,n.args[1]);return e.outRaw("<p>graph: ").out(r).outRaw(`</p>
`),e.outRaw("<pre>"),o=>{n.childNodes.forEach(f=>{visit(f,o)})}}block_graph_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}inline_img(e,n){let r=this.findReference(e,n).referenceTo.referenceNode.toBlockElement();return e.out("\u56F3").out(e.base.chapter.no).out(".").out(r.no),!1}inline_icon(e,n){let r=e.base.chapter.name,o=r.substring(0,r.length-3),f=nodeContentToString(e,n),c="images/"+this.escape(o)+"-"+this.escape(f)+".png";return e.outRaw('<img src="'+c+'" alt="[').out(f).outRaw(']" />'),!1}block_footnote(e,n){let r=nodeContentToString(e,n.args[0]);return e.outRaw('<div class="footnote" epub:type="footnote" id="fn-').outRaw(r).outRaw('"><p class="footnote">'),e.outRaw("[*").out(n.no).outRaw("] "),o=>{visit(n.args[1],o),e.outRaw(`</p></div>
`)}}inline_fn(e,n){let r=this.findReference(e,n).referenceTo.referenceNode.toBlockElement(),o=nodeContentToString(e,r.args[0]);return e.outRaw('<a id="fnb-').out(o).outRaw('" href="#fn-').out(o).outRaw('" class="noteref" epub:type="noteref">*').out(r.no).outRaw("</a>"),!1}block_lead_pre(e,n){e.outRaw(`<div class="lead">
`)}block_lead_post(e,n){e.outRaw(`</div>
`)}inline_tti_pre(e,n){e.outRaw('<code class="tt"><i>')}inline_tti_post(e,n){e.outRaw("</i></code>")}inline_ttb_pre(e,n){e.outRaw('<code class="tt"><b>')}inline_ttb_post(e,n){e.outRaw("</b></code>")}block_noindent(e,n){return!1}block_blankline(e,n){return e.outRaw(`<p><br /></p>
`),!1}block_source_pre(e,n){return e.outRaw(`<div class="source-code">
`),e.outRaw('<p class="caption">').out(nodeContentToString(e,n.args[0])).outRaw(`</p>
`),e.outRaw('<pre class="source">'),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_source_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}block_cmd_pre(e,n){return e.outRaw(`<div class="cmd-code">
`),e.outRaw('<pre class="cmd">'),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_cmd_post(e,n){e.outRaw(`
</pre>
`).outRaw(`</div>
`)}block_quote_pre(e,n){return e.outRaw("<blockquote><p>"),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_quote_post(e,n){e.outRaw(`</p></blockquote>
`)}inline_ami_pre(e,n){e.outRaw('<span class="ami">')}inline_ami_post(e,n){e.outRaw("</span>")}inline_bou_pre(e,n){e.outRaw('<span class="bou">')}inline_bou_post(e,n){e.outRaw("</span>")}inline_del_pre(e,n){e.outRaw("<del>")}inline_del_post(e,n){e.outRaw("</del>")}inline_i_pre(e,n){e.outRaw("<i>")}inline_i_post(e,n){e.outRaw("</i>")}inline_ins_pre(e,n){e.outRaw("<ins>")}inline_ins_post(e,n){e.outRaw("</ins>")}inline_m_pre(e,n){e.outRaw("<span>TODO: ")}inline_m_post(e,n){e.outRaw("</span>")}inline_strong_pre(e,n){e.outRaw("<strong>")}inline_strong_post(e,n){e.outRaw("</strong>")}inline_tcy_pre(e,n){e.outRaw('<span class="tcy">')}inline_tcy_post(e,n){e.outRaw("</span>")}inline_uchar_pre(e,n){e.outRaw("&#x")}inline_uchar_post(e,n){e.outRaw(";")}block_table_pre(e,n){let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=t("builder.table",r.fqn,n.no);e.outRaw("<div"),n.args[0]!=null&&e.outRaw(' id="').out(this.normalizeId(n.args[0].childNodes[0].toNode().childNodes[0].toTextNode().text)).outRaw('"'),e.outRaw(` class="table">
`),e.outRaw('<p class="caption">').out(o).out(": ").out(nodeContentToString(e,n.args[1])).outRaw(`</p>
`),e.outRaw(`<table>
`);const f=this.parseTable(n.childNodes);return c=>{if(f.headerRowCount===0)f.cells.forEach(d=>{if(d.length!==0){e.outRaw("<tr>"),e.outRaw("<th>"),d[0].nodes.forEach(u=>{visit(u,c)}),e.outRaw("</th>");for(let u=1;u<d.length;u++)e.outRaw("<td>"),d[u].nodes.forEach(b=>{visit(b,c)}),e.outRaw("</td>");e.outRaw(`</tr>
`)}});else{let d=0;for(;d<f.headerRowCount;d++)e.outRaw("<tr>"),f.cells[d].forEach(u=>{e.outRaw("<th>"),u.nodes.forEach(b=>{visit(b,c)}),e.outRaw("</th>")}),e.outRaw(`</tr>
`);for(;d<f.cells.length;d++)e.outRaw("<tr>"),f.cells[d].forEach(u=>{e.outRaw("<td>"),u.nodes.forEach(b=>{visit(b,c)}),e.outRaw("</td>")}),e.outRaw(`</tr>
`)}}}block_table_post(e,n){e.outRaw(`</table>
`).outRaw(`</div>
`)}inline_table(e,n){let r=findChapter(n,1);if(!r)return e.error(t("builder.chapter_not_found",1),n),!1;let o=this.findReference(e,n).referenceTo.referenceNode.toBlockElement(),f=t("builder.table",r.fqn,o.no);return e.outRaw('<span class="tableref">').out(f).outRaw("</span>"),!1}block_tsize(e,n){return!1}block_comment_pre(e,n){return this.book.config.isDraft?(e.outRaw('<div class="draft-comment">'),r=>{n.childNodes.forEach(o=>{visit(o,r)})}):!1}block_comment_post(e,n){this.book.config.isDraft&&e.outRaw(`</div>
`)}inline_comment_pre(e,n){return this.book.config.isDraft?(e.outRaw('<span class="draft-comment">'),!0):!1}inline_comment_post(e,n){this.book.config.isDraft&&e.outRaw("</span>")}inline_chap(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r);return e.out(t("builder.chapter",o.no)),!1}inline_title(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r),f=this.getChapterTitle(e,o);return e.out(f),!1}inline_chapref(e,n){let r=nodeContentToString(e,n),o=e.findChapter(r),f=this.getChapterTitle(e,o);return e.out(t("builder.chapter_ref",o.no,f)),!1}inline_idx(e,n){const r=nodeContentToString(e,n);return e.out(r).outRaw("<!-- IDX:").out(r).outRaw(" -->"),!1}inline_hidx(e,n){const r=nodeContentToString(e,n);return e.outRaw("<!-- IDX:").out(r).outRaw(" -->"),!1}block_flushright_pre(e,n){return e.outRaw('<p class="flushright">'),r=>{n.childNodes.forEach(o=>{visit(o,r)})}}block_flushright_post(e,n){e.outRaw(`</p>
`)}block_captionblock_pre(e,n,r){if(n.outRaw(`<div class="${e}">
`),r.args[0]){let o=nodeContentToString(n,r.args[0]);n.outRaw('<p class="caption">').out(o).outRaw(`</p>
`)}}block_captionblock_post(e,n,r){n.outRaw(`</div>
`)}block_info_pre(e,n){this.block_captionblock_pre("info",e,n)}block_info_post(e,n){this.block_captionblock_post("info",e,n)}block_note_pre(e,n){this.block_captionblock_pre("note",e,n)}block_note_post(e,n){this.block_captionblock_post("note",e,n)}block_memo_pre(e,n){this.block_captionblock_pre("memo",e,n)}block_memo_post(e,n){this.block_captionblock_post("memo",e,n)}block_tip_pre(e,n){this.block_captionblock_pre("tip",e,n)}block_tip_post(e,n){this.block_captionblock_post("tip",e,n)}block_warning_pre(e,n){this.block_captionblock_pre("warning",e,n)}block_warning_post(e,n){this.block_captionblock_post("warning",e,n)}block_important_pre(e,n){this.block_captionblock_pre("important",e,n)}block_important_post(e,n){this.block_captionblock_post("important",e,n)}block_caution_pre(e,n){this.block_captionblock_pre("caution",e,n)}block_caution_post(e,n){this.block_captionblock_post("caution",e,n)}block_notice_pre(e,n){this.block_captionblock_pre("notice",e,n)}block_notice_post(e,n){this.block_captionblock_post("notice",e,n)}}}}),analyzer_exports={};__export(analyzer_exports,{AcceptableSyntax:()=>AcceptableSyntax,AcceptableSyntaxes:()=>AcceptableSyntaxes,DefaultAnalyzer:()=>DefaultAnalyzer,SyntaxType:()=>SyntaxType});var SyntaxType,AcceptableSyntaxes,AcceptableSyntax,AnalyzeProcess,DefaultAnalyzer,init_analyzer=__esm({"lib/parser/analyzer.ts"(){"use strict";init_i18n(),init_exception(),init_parser(),init_utils2(),SyntaxType=(e=>(e[e.Block=0]="Block",e[e.Inline=1]="Inline",e[e.Other=2]="Other",e))(SyntaxType||{}),AcceptableSyntaxes=class{constructor(e){this.acceptableSyntaxes=e}find(e){let n;if(e instanceof InlineElementSyntaxTree){let r=e;n=this.inlines.filter(o=>o.symbolName===r.symbol)}else if(e instanceof BlockElementSyntaxTree){let r=e;n=this.blocks.filter(o=>o.symbolName===r.symbol)}else n=this.others.filter(r=>e instanceof r.clazz);return n}get inlines(){return this.acceptableSyntaxes.filter(e=>e.type===1)}get blocks(){return this.acceptableSyntaxes.filter(e=>e.type===0)}get others(){return this.acceptableSyntaxes.filter(e=>e.type===2)}toJSON(){return{rev:"1",SyntaxType,acceptableSyntaxes:this.acceptableSyntaxes}}},AcceptableSyntax=class{constructor(){this.argsLength=[],this.allowInline=!0,this.allowFullySyntax=!1}toJSON(){return{type:this.type,class:this.clazz?this.clazz.name:void 0,symbolName:this.symbolName,argsLength:this.argsLength.length!==0?this.argsLength:void 0,description:this.description}}},AnalyzeProcess=class{constructor(){this.acceptableSyntaxes=[]}prepare(){this.current=new AcceptableSyntax}build(e){switch(e.indexOf("block_")===0?(this.current.type=this.current.type||0,this.current.symbolName=this.current.symbolName||e.substring(6)):e.indexOf("inline_")===0?(this.current.type=this.current.type||1,this.current.symbolName=this.current.symbolName||e.substring(7)):(this.current.type=this.current.type||2,this.current.symbolName=this.current.symbolName||e),this.current.type){case 0:if(this.current.argsLength.length===0)throw new AnalyzerError("must call builder.checkArgsLength(...number[]) in "+e);break;case 2:if(!this.current.clazz)throw new AnalyzerError("must call builder.setClass(class) in "+e);break;case 1:break}if(!this.current.description)throw new AnalyzerError("must call builder.setDescription(string) in "+e);if(!this.current.process)throw new AnalyzerError("must call builder.processNode(func) in "+e);this.acceptableSyntaxes.push(this.current)}setSyntaxType(e){this.current.type=e}setClass(e){this.current.clazz=e}setSymbol(e){this.current.symbolName=e}setDescription(e){this.current.description=e}checkArgsLength(...e){this.current.argsLength=e}setAllowInline(e){this.current.allowInline=e}setAllowFullySyntax(e){this.current.allowFullySyntax=e}processNode(e){this.current.process=e}},DefaultAnalyzer=class{getAcceptableSyntaxes(){return this._acceptableSyntaxes||(this._acceptableSyntaxes=this.constructAcceptableSyntaxes()),new AcceptableSyntaxes(this._acceptableSyntaxes)}constructAcceptableSyntaxes(){let e=new AnalyzeProcess;for(let n in this){if(typeof this[n]!="function")continue;let r=null;n.indexOf("block_")===0?r=this[n]:n.indexOf("inline_")===0?r=this[n]:n==="headline"?r=this[n]:n==="column"?r=this[n]:n==="ulist"?r=this[n]:n==="olist"?r=this[n]:n==="dlist"&&(r=this[n]),r&&(e.prepare(),r.bind(this)(e),e.build(n))}return e.acceptableSyntaxes}headline(e){e.setSyntaxType(2),e.setClass(HeadlineSyntaxTree),e.setDescription(t("description.headline")),e.processNode((n,r)=>{let o=r.toHeadline(),f=null;if(o.label?f=o.label.arg:f=nodeContentToString(n,o.caption),n.addSymbol({symbolName:"hd",labelName:f,node:o}),o.level===1){let c=null;o.label?c=o.label.arg:c=n.chapter.name.substr(0,n.chapter.name.lastIndexOf(".re")),n.addSymbol({symbolName:"chapter",labelName:c,node:o})}})}column(e){e.setSyntaxType(2),e.setClass(ColumnSyntaxTree),e.setDescription(t("description.column")),e.processNode((n,r)=>{let o=r.toColumn();o.no=n.nextIndex("column"),n.addSymbol({symbolName:"column",node:o})})}ulist(e){e.setSyntaxType(2),e.setClass(UlistElementSyntaxTree),e.setDescription(t("description.ulist")),e.processNode((n,r)=>{let o=r.toUlist();n.addSymbol({symbolName:"ul",node:o})})}olist(e){e.setSyntaxType(2),e.setClass(OlistElementSyntaxTree),e.setDescription(t("description.olist")),e.processNode((n,r)=>{let o=r.toOlist();n.addSymbol({symbolName:"ol",node:o})})}dlist(e){e.setSyntaxType(2),e.setClass(DlistElementSyntaxTree),e.setDescription(t("description.dlist")),e.processNode((n,r)=>{let o=r.toDlist();n.addSymbol({symbolName:"dl",node:o})})}block_list(e){e.setSyntaxType(0),e.setSymbol("list"),e.setDescription(t("description.block_list")),e.checkArgsLength(2,3),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("list"),n.addSymbol({symbolName:o.symbol,labelName:nodeContentToString(n,o.args[0]),node:o})})}block_listnum(e){e.setSyntaxType(0),e.setSymbol("listnum"),e.setDescription(t("description.block_listnum")),e.checkArgsLength(2,3),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("list"),n.addSymbol({symbolName:"list",labelName:nodeContentToString(n,o.args[0]),node:o})})}inline_list(e){e.setSyntaxType(1),e.setSymbol("list"),e.setDescription(t("description.inline_list")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o)),node:o})})}block_emlist(e){e.setSyntaxType(0),e.setSymbol("emlist"),e.setDescription(t("description.block_emlist")),e.checkArgsLength(0,1,2),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:o.symbol,node:o})})}block_emlistnum(e){e.setSyntaxType(0),e.setSymbol("emlistnum"),e.setDescription(t("description.block_emlistnum")),e.checkArgsLength(0,1,2),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:"emlist",node:o})})}inline_hd(e){e.setSyntaxType(1),e.setSymbol("hd"),e.setDescription(t("description.inline_hd")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o)),node:o})})}block_image(e){e.setSyntaxType(0),e.setSymbol("image"),e.setDescription(t("description.block_image")),e.checkArgsLength(2,3),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("image"),n.addSymbol({symbolName:o.symbol,labelName:nodeContentToString(n,o.args[0]),node:o})})}block_indepimage(e){e.setSyntaxType(0),e.setSymbol("indepimage"),e.setDescription(t("description.block_indepimage")),e.checkArgsLength(1,2,3),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:o.symbol,node:o})})}block_graph(e){e.setSyntaxType(0),e.setSymbol("graph"),e.setDescription(t("description.block_graph")),e.checkArgsLength(2,3),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("image"),n.addSymbol({symbolName:"image",labelName:nodeContentToString(n,o.args[0]),node:o})})}inline_img(e){e.setSyntaxType(1),e.setSymbol("img"),e.setDescription(t("description.inline_img")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o),"image"),node:o})})}inline_icon(e){e.setSyntaxType(0),e.setSymbol("icon"),e.setDescription(t("description.inline_icon")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,node:o})})}block_footnote(e){e.setSyntaxType(0),e.setSymbol("footnote"),e.setDescription(t("description.block_footnote")),e.checkArgsLength(2),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("footnote"),n.addSymbol({symbolName:o.symbol,labelName:nodeContentToString(n,o.args[0]),node:o})})}inline_fn(e){e.setSyntaxType(1),e.setSymbol("fn"),e.setDescription(t("description.inline_fn")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o),"footnote"),node:o})})}inline_idx(e){e.setSyntaxType(1),e.setSymbol("idx"),e.setDescription(t("description.inline_idx")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,node:o})})}inline_hidx(e){e.setSyntaxType(1),e.setSymbol("hidx"),e.setDescription(t("description.inline_hidx")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,node:o})})}blockDecorationSyntax(e,n,...r){e.setSyntaxType(0),e.setSymbol(n),e.setDescription(t("description.block_"+n)),e.checkArgsLength.apply(e,r),e.processNode((o,f)=>{let c=f.toBlockElement();o.addSymbol({symbolName:c.symbol,node:c})})}block_lead(e){this.blockDecorationSyntax(e,"lead",0),e.setAllowFullySyntax(!0)}block_noindent(e){this.blockDecorationSyntax(e,"noindent",0)}block_blankline(e){this.blockDecorationSyntax(e,"blankline",0)}block_source(e){this.blockDecorationSyntax(e,"source",1)}block_cmd(e){this.blockDecorationSyntax(e,"cmd",0)}block_quote(e){this.blockDecorationSyntax(e,"quote",0)}inlineDecorationSyntax(e,n){e.setSyntaxType(1),e.setSymbol(n),e.setDescription(t("description.inline_"+n)),e.processNode((r,o)=>{let f=o.toInlineElement();r.addSymbol({symbolName:f.symbol,node:f})})}inline_br(e){this.inlineDecorationSyntax(e,"br")}inline_ruby(e){this.inlineDecorationSyntax(e,"ruby")}inline_b(e){this.inlineDecorationSyntax(e,"b")}inline_code(e){this.inlineDecorationSyntax(e,"code")}inline_tt(e){this.inlineDecorationSyntax(e,"tt")}inline_href(e){this.inlineDecorationSyntax(e,"href")}block_label(e){e.setSyntaxType(0),e.setSymbol("label"),e.setDescription(t("description.block_label")),e.checkArgsLength(1),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("label"),n.addSymbol({symbolName:o.symbol,labelName:nodeContentToString(n,o.args[0]),node:o})})}inline_u(e){this.inlineDecorationSyntax(e,"u")}inline_kw(e){this.inlineDecorationSyntax(e,"kw")}inline_em(e){this.inlineDecorationSyntax(e,"em")}inline_tti(e){this.inlineDecorationSyntax(e,"tti")}inline_ttb(e){this.inlineDecorationSyntax(e,"ttb")}inline_ami(e){this.inlineDecorationSyntax(e,"ami")}inline_bou(e){this.inlineDecorationSyntax(e,"bou")}inline_del(e){this.inlineDecorationSyntax(e,"del")}inline_i(e){this.inlineDecorationSyntax(e,"i")}inline_ins(e){this.inlineDecorationSyntax(e,"ins")}inline_m(e){this.inlineDecorationSyntax(e,"m")}inline_strong(e){this.inlineDecorationSyntax(e,"strong")}inline_tcy(e){this.inlineDecorationSyntax(e,"tcy")}inline_uchar(e){this.inlineDecorationSyntax(e,"uchar")}block_table(e){e.setSyntaxType(0),e.setSymbol("table"),e.setDescription(t("description.block_table")),e.checkArgsLength(2),e.processNode((n,r)=>{let o=r.toBlockElement();o.no=n.nextIndex("table"),n.addSymbol({symbolName:o.symbol,labelName:nodeContentToString(n,o.args[0]),node:o})})}inline_table(e){e.setSyntaxType(1),e.setSymbol("table"),e.setDescription(t("description.inline_table")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o)),node:o})})}block_tsize(e){e.setSyntaxType(0),e.setDescription(t("description.block_tsize")),e.checkArgsLength(1),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:o.symbol,node:o})})}block_raw(e){e.setSyntaxType(0),e.setSymbol("raw"),e.setDescription(t("description.block_raw")),e.checkArgsLength(1),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:o.symbol,node:o})})}inline_raw(e){e.setSyntaxType(1),e.setSymbol("raw"),e.setDescription(t("description.inline_raw")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,node:o})})}block_comment(e){e.setSyntaxType(0),e.setSymbol("comment"),e.setDescription(t("description.block_comment")),e.checkArgsLength(0),e.processNode((n,r)=>{let o=r.toBlockElement();n.addSymbol({symbolName:o.symbol,node:o})})}inline_comment(e){e.setSyntaxType(1),e.setSymbol("comment"),e.setDescription(t("description.inline_comment")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,node:o})})}inline_chap(e){e.setSyntaxType(1),e.setSymbol("chap"),e.setDescription(t("description.inline_chap")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o),"chapter"),node:o})})}inline_title(e){e.setSyntaxType(1),e.setSymbol("title"),e.setDescription(t("description.inline_title")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o),"chapter"),node:o})})}inline_chapref(e){e.setSyntaxType(1),e.setSymbol("chapref"),e.setDescription(t("description.inline_chapref")),e.processNode((n,r)=>{let o=r.toInlineElement();n.addSymbol({symbolName:o.symbol,referenceTo:n.constructReferenceTo(o,nodeContentToString(n,o),"chapter"),node:o})})}block_flushright(e){this.blockDecorationSyntax(e,"flushright",0)}blockBoxedContentSyntax(e,n){this.blockDecorationSyntax(e,n,0),e.setAllowFullySyntax(!0)}block_note(e){this.blockBoxedContentSyntax(e,"note")}block_memo(e){this.blockBoxedContentSyntax(e,"memo")}block_tip(e){this.blockBoxedContentSyntax(e,"tip")}block_info(e){this.blockBoxedContentSyntax(e,"info")}block_warning(e){this.blockBoxedContentSyntax(e,"warning")}block_important(e){this.blockBoxedContentSyntax(e,"important")}block_caution(e){this.blockBoxedContentSyntax(e,"caution")}block_notice(e){this.blockBoxedContentSyntax(e,"notice")}}}}),validator_exports={};__export(validator_exports,{DefaultValidator:()=>DefaultValidator});var DefaultValidator,init_validator=__esm({"lib/parser/validator.ts"(){"use strict";init_i18n(),init_analyzer(),init_walker(),init_utils2(),DefaultValidator=class{start(e,n,r){this.acceptableSyntaxes=n,this.builders=r,this.checkBuilder(e,n,r),this.checkBook(e),this.resolveSymbolAndReference(e)}checkBuilder(e,n,r=[]){n.acceptableSyntaxes.forEach(o=>{let f="";switch(o.type){case 2:return;case 0:f="block_";break;case 1:f="inline_";break}let c=f+o.symbolName,d=f+o.symbolName+"_pre";r.forEach(u=>{u[c]||u[d]||e.process.error(SyntaxType[o.type]+" "+o.symbolName+" is not supported in "+u.name)})})}checkBook(e){e.predef.forEach(n=>this.checkChunk(n)),e.contents.forEach(n=>this.checkChunk(n)),e.appendix.forEach(n=>this.checkChunk(n)),e.postdef.forEach(n=>this.checkChunk(n))}checkChunk(e){visit(e.tree.ast,{visitDefaultPre:n=>{},visitHeadlinePre:n=>{let r=this.acceptableSyntaxes.find(n);if(r.length!==1){e.process.error(t("compile.syntax_definietion_error"),n);return}return r[0].process(e.process,n)},visitColumnPre:n=>{let r=this.acceptableSyntaxes.find(n);if(r.length!==1){e.process.error(t("compile.syntax_definietion_error"),n);return}return r[0].process(e.process,n)},visitBlockElementPre:n=>{let r=this.acceptableSyntaxes.find(n);if(r.length!==1){e.process.error(t("compile.block_not_supported",n.symbol),n);return}let o=r[0].argsLength,f=n.args||[];if(o.indexOf(f.length)===-1){let c=o.map(u=>Number(u).toString()).join(" or "),d=t("compile.args_length_mismatch",c,f.length);e.process.error(d,n);return}return r[0].process(e.process,n)},visitInlineElementPre:n=>{let r=this.acceptableSyntaxes.find(n);if(r.length!==1){e.process.error(t("compile.inline_not_supported",n.symbol),n);return}return r[0].process(e.process,n)}}),visit(e.tree.ast,{visitDefaultPre:n=>{},visitChapterPre:n=>{n.level===1?findChapter(n)||e.process.error(t("compile.chapter_not_toplevel"),n):findChapter(n.parentNode)||e.process.error(t("compile.chapter_topleve_eq1"),n)}}),this.chechBlockGraphTool(e)}chechBlockGraphTool(e){visit(e.tree.ast,{visitDefaultPre:n=>{},visitBlockElementPre:n=>{if(n.symbol!=="graph")return;let r=n.args[1];if(!r)return;let o=nodeContentToString(e.process,r);switch(o){case"graphviz":break;case"gnuplot":case"blockdiag":case"aafigure":e.process.info(t("compile.graph_tool_is_not_recommended"),r);break;default:e.process.error(t("compile.unknown_graph_tool",o),r)}}})}resolveSymbolAndReference(e){let n=e.allChunks.reduce((r,o)=>r.concat(o.process.symbols),[]);n.forEach(r=>{const o=r.referenceTo;if(o&&!o.chapter&&o.chapterName){const f=`${o.chapterName}.re`;e.allChunks.forEach(c=>{f===c.name&&(o.chapter=c)})}}),n.forEach(r=>{if(r.referenceTo&&!r.referenceTo.referenceNode){let o=r.referenceTo;if(n.forEach(f=>{o.chapter===f.chapter&&o.targetSymbol===f.symbolName&&(o.label==null||o.label===f.labelName)&&(o.referenceNode=f.node)}),!o.referenceNode){r.chapter.process.error(t("compile.reference_is_missing",o.targetSymbol,o.label??o.chapterName),r.node);return}}}),n.forEach(r=>{n.forEach(o=>{if(r!==o&&r.chapter===o.chapter&&r.symbolName===o.symbolName&&r.labelName&&o.labelName&&r.labelName===o.labelName){r.symbolName==="hd"?r.chapter.process.error(t("compile.duplicated_label_headline"),r.node,o.node):r.chapter.process.error(t("compile.duplicated_label"),r.node,o.node);return}})})}}}}),BookStructure,ContentStructure,init_configRaw=__esm({"lib/controller/configRaw.ts"(){"use strict";BookStructure=class ht{constructor(n,r,o,f){this.predef=n,this.contents=r,this.appendix=o,this.postdef=f,this.predef=this.predef||[],this.contents=this.contents||[],this.appendix=this.appendix||[],this.postdef=this.postdef||[]}static createBook(n){if(!n)return new ht([],[],[],[]);let r=(n.predef||n.PREDEF||[]).map(d=>ContentStructure.createChapter(d)),o=(n.contents||n.CHAPS||[]).map(d=>d?typeof d=="string"?ContentStructure.createChapter(d):d.chapter?ContentStructure.createChapter(d.chapter):d.part?ContentStructure.createPart(d.part):typeof d.file=="string"&&d.chapters?ContentStructure.createPart(d):typeof d.file=="string"?ContentStructure.createChapter(d):typeof d=="object"?ContentStructure.createPart({file:Object.keys(d)[0],chapters:d[Object.keys(d)[0]].map(u=>({file:u}))}):null:null),f=(n.appendix||n.APPENDIX||[]).map(d=>ContentStructure.createChapter(d)),c=(n.postdef||n.POSTDEF||[]).map(d=>ContentStructure.createChapter(d));return new ht(r,o,f,c)}},ContentStructure=class He{constructor(n,r){this.part=n,this.chapter=r}static createChapter(n){return typeof n=="string"?new He(null,{file:n}):n&&typeof n.file=="string"?new He(null,n):null}static createPart(n){if(!n)return null;let r={file:n.file,chapters:(n.chapters||[]).map(o=>typeof o=="string"?{file:o}:o)};return new He(r,null)}}}}),require_styles=__commonJS({"node_modules/colors/lib/styles.js"(e,n){var r={};n.exports=r;var o={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(o).forEach(function(f){var c=o[f],d=r[f]=[];d.open="\x1B["+c[0]+"m",d.close="\x1B["+c[1]+"m"})}}),require_has_flag=__commonJS({"node_modules/colors/lib/system/has-flag.js"(e,n){"use strict";n.exports=function(r,o){o=o||process.argv;var f=o.indexOf("--"),c=/^-{1,2}/.test(r)?"":"--",d=o.indexOf(c+r);return d!==-1&&(f===-1?!0:d<f)}}}),require_supports_colors=__commonJS({"node_modules/colors/lib/system/supports-colors.js"(e,n){"use strict";var r=require("os"),o=require_has_flag(),f=process.env,c=void 0;o("no-color")||o("no-colors")||o("color=false")?c=!1:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(c=!0),"FORCE_COLOR"in f&&(c=f.FORCE_COLOR.length===0||parseInt(f.FORCE_COLOR,10)!==0);function d(y){return y===0?!1:{level:y,hasBasic:!0,has256:y>=2,has16m:y>=3}}function u(y){if(c===!1)return 0;if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2;if(y&&!y.isTTY&&c!==!0)return 0;var B=c?1:0;if(process.platform==="win32"){var C=r.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(C[0])>=10&&Number(C[2])>=10586?Number(C[2])>=14931?3:2:1}if("CI"in f)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(function(k){return k in f})||f.CI_NAME==="codeship"?1:B;if("TEAMCITY_VERSION"in f)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(f.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in f){var S=parseInt((f.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(f.TERM_PROGRAM){case"iTerm.app":return S>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(f.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(f.TERM)||"COLORTERM"in f?1:(f.TERM==="dumb",B)}function b(y){var B=u(y);return d(B)}n.exports={supportsColor:b,stdout:b(process.stdout),stderr:b(process.stderr)}}}),require_trap=__commonJS({"node_modules/colors/lib/custom/trap.js"(e,n){n.exports=function(o,f){var c="";o=o||"Run the trap, drop the bass",o=o.split("");var d={a:["@","\u0104","\u023A","\u0245","\u0394","\u039B","\u0414"],b:["\xDF","\u0181","\u0243","\u026E","\u03B2","\u0E3F"],c:["\xA9","\u023B","\u03FE"],d:["\xD0","\u018A","\u0500","\u0501","\u0502","\u0503"],e:["\xCB","\u0115","\u018E","\u0258","\u03A3","\u03BE","\u04BC","\u0A6C"],f:["\u04FA"],g:["\u0262"],h:["\u0126","\u0195","\u04A2","\u04BA","\u04C7","\u050A"],i:["\u0F0F"],j:["\u0134"],k:["\u0138","\u04A0","\u04C3","\u051E"],l:["\u0139"],m:["\u028D","\u04CD","\u04CE","\u0520","\u0521","\u0D69"],n:["\xD1","\u014B","\u019D","\u0376","\u03A0","\u048A"],o:["\xD8","\xF5","\xF8","\u01FE","\u0298","\u047A","\u05DD","\u06DD","\u0E4F"],p:["\u01F7","\u048E"],q:["\u09CD"],r:["\xAE","\u01A6","\u0210","\u024C","\u0280","\u042F"],s:["\xA7","\u03DE","\u03DF","\u03E8"],t:["\u0141","\u0166","\u0373"],u:["\u01B1","\u054D"],v:["\u05D8"],w:["\u0428","\u0460","\u047C","\u0D70"],x:["\u04B2","\u04FE","\u04FC","\u04FD"],y:["\xA5","\u04B0","\u04CB"],z:["\u01B5","\u0240"]};return o.forEach(function(u){u=u.toLowerCase();var b=d[u]||[" "],y=Math.floor(Math.random()*b.length);typeof d[u]<"u"?c+=d[u][y]:c+=u}),c}}}),require_zalgo=__commonJS({"node_modules/colors/lib/custom/zalgo.js"(e,n){n.exports=function(o,f){o=o||"   he is here   ";var c={up:["\u030D","\u030E","\u0304","\u0305","\u033F","\u0311","\u0306","\u0310","\u0352","\u0357","\u0351","\u0307","\u0308","\u030A","\u0342","\u0313","\u0308","\u034A","\u034B","\u034C","\u0303","\u0302","\u030C","\u0350","\u0300","\u0301","\u030B","\u030F","\u0312","\u0313","\u0314","\u033D","\u0309","\u0363","\u0364","\u0365","\u0366","\u0367","\u0368","\u0369","\u036A","\u036B","\u036C","\u036D","\u036E","\u036F","\u033E","\u035B","\u0346","\u031A"],down:["\u0316","\u0317","\u0318","\u0319","\u031C","\u031D","\u031E","\u031F","\u0320","\u0324","\u0325","\u0326","\u0329","\u032A","\u032B","\u032C","\u032D","\u032E","\u032F","\u0330","\u0331","\u0332","\u0333","\u0339","\u033A","\u033B","\u033C","\u0345","\u0347","\u0348","\u0349","\u034D","\u034E","\u0353","\u0354","\u0355","\u0356","\u0359","\u035A","\u0323"],mid:["\u0315","\u031B","\u0300","\u0301","\u0358","\u0321","\u0322","\u0327","\u0328","\u0334","\u0335","\u0336","\u035C","\u035D","\u035E","\u035F","\u0360","\u0362","\u0338","\u0337","\u0361"," \u0489"]},d=[].concat(c.up,c.down,c.mid);function u(B){var C=Math.floor(Math.random()*B);return C}function b(B){var C=!1;return d.filter(function(S){C=S===B}),C}function y(B,C){var S="",k,A;C=C||{},C.up=typeof C.up<"u"?C.up:!0,C.mid=typeof C.mid<"u"?C.mid:!0,C.down=typeof C.down<"u"?C.down:!0,C.size=typeof C.size<"u"?C.size:"maxi",B=B.split("");for(A in B)if(!b(A)){switch(S=S+B[A],k={up:0,down:0,mid:0},C.size){case"mini":k.up=u(8),k.mid=u(2),k.down=u(8);break;case"maxi":k.up=u(16)+3,k.mid=u(4)+1,k.down=u(64)+3;break;default:k.up=u(8)+1,k.mid=u(6)/2,k.down=u(8)+1;break}var F=["up","mid","down"];for(var O in F)for(var P=F[O],$=0;$<=k[P];$++)C[P]&&(S=S+c[P][u(c[P].length)])}return S}return y(o,f)}}}),require_america=__commonJS({"node_modules/colors/lib/maps/america.js"(e,n){n.exports=function(r){return function(o,f,c){if(o===" ")return o;switch(f%3){case 0:return r.red(o);case 1:return r.white(o);case 2:return r.blue(o)}}}}}),require_zebra=__commonJS({"node_modules/colors/lib/maps/zebra.js"(e,n){n.exports=function(r){return function(o,f,c){return f%2===0?o:r.inverse(o)}}}}),require_rainbow=__commonJS({"node_modules/colors/lib/maps/rainbow.js"(e,n){n.exports=function(r){var o=["red","yellow","green","blue","magenta"];return function(f,c,d){return f===" "?f:r[o[c++%o.length]](f)}}}}),require_random=__commonJS({"node_modules/colors/lib/maps/random.js"(e,n){n.exports=function(r){var o=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(f,c,d){return f===" "?f:r[o[Math.round(Math.random()*(o.length-2))]](f)}}}}),require_colors=__commonJS({"node_modules/colors/lib/colors.js"(e,n){var r={};n.exports=r,r.themes={};var o=require("util"),f=r.styles=require_styles(),c=Object.defineProperties,d=new RegExp(/[\r\n]+/g);r.supportsColor=require_supports_colors().supportsColor,typeof r.enabled>"u"&&(r.enabled=r.supportsColor()!==!1),r.enable=function(){r.enabled=!0},r.disable=function(){r.enabled=!1},r.stripColors=r.strip=function(P){return(""+P).replace(/\x1B\[\d+m/g,"")};var u=r.stylize=function($,U){if(!r.enabled)return $+"";var M=f[U];return!M&&U in r?r[U]($):M.open+$+M.close},b=/[|\\{}()[\]^$+*?.]/g,y=function(P){if(typeof P!="string")throw new TypeError("Expected a string");return P.replace(b,"\\$&")};function B(P){var $=function U(){return k.apply(U,arguments)};return $._styles=P,$.__proto__=S,$}var C=function(){var P={};return f.grey=f.gray,Object.keys(f).forEach(function($){f[$].closeRe=new RegExp(y(f[$].close),"g"),P[$]={get:function(){return B(this._styles.concat($))}}}),P}(),S=c(function(){},C);function k(){var P=Array.prototype.slice.call(arguments),$=P.map(function(ue){return ue!=null&&ue.constructor===String?ue:o.inspect(ue)}).join(" ");if(!r.enabled||!$)return $;for(var U=$.indexOf(`
`)!=-1,M=this._styles,W=M.length;W--;){var K=f[M[W]];$=K.open+$.replace(K.closeRe,K.open)+K.close,U&&($=$.replace(d,function(ue){return K.close+ue+K.open}))}return $}r.setTheme=function(P){if(typeof P=="string"){console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}for(var $ in P)(function(U){r[U]=function(M){if(typeof P[U]=="object"){var W=M;for(var K in P[U])W=r[P[U][K]](W);return W}return r[P[U]](M)}})($)};function A(){var P={};return Object.keys(C).forEach(function($){P[$]={get:function(){return B([$])}}}),P}var F=function($,U){var M=U.split("");return M=M.map($),M.join("")};r.trap=require_trap(),r.zalgo=require_zalgo(),r.maps={},r.maps.america=require_america()(r),r.maps.zebra=require_zebra()(r),r.maps.rainbow=require_rainbow()(r),r.maps.random=require_random()(r);for(O in r.maps)(function(P){r[P]=function($){return F(r.maps[P],$)}})(O);var O;c(r,A())}}),require_extendStringPrototype=__commonJS({"node_modules/colors/lib/extendStringPrototype.js"(e,n){var r=require_colors();n.exports=function(){var o=function(d,u){String.prototype.__defineGetter__(d,u)};o("strip",function(){return r.strip(this)}),o("stripColors",function(){return r.strip(this)}),o("trap",function(){return r.trap(this)}),o("zalgo",function(){return r.zalgo(this)}),o("zebra",function(){return r.zebra(this)}),o("rainbow",function(){return r.rainbow(this)}),o("random",function(){return r.random(this)}),o("america",function(){return r.america(this)});var f=Object.keys(r.styles);f.forEach(function(d){o(d,function(){return r.stylize(this,d)})});function c(d){var u=["__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","charAt","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf","charCodeAt","indexOf","lastIndexOf","length","localeCompare","match","repeat","replace","search","slice","split","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimLeft","trimRight"];Object.keys(d).forEach(function(b){if(u.indexOf(b)!==-1)console.log("warn: ".red+("String.prototype"+b).magenta+" is probably something you don't want to override.  Ignoring style name");else if(typeof d[b]=="string")r[b]=r[d[b]],o(b,function(){return r[b](this)});else{var y=function(B){for(var C=B||this,S=0;S<d[b].length;S++)C=r[d[b][S]](C);return C};o(b,y),r[b]=function(B){return y(B)}}})}r.setTheme=function(d){if(typeof d=="string"){console.log("colors.setTheme now only accepts an object, not a string. If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}else c(d)}}}}),require_lib=__commonJS({"node_modules/colors/lib/index.js"(e,n){var r=require_colors();n.exports=r,require_extendStringPrototype()()}}),Config,NodeJSConfig,WebBrowserConfig,init_config=__esm({"lib/controller/config.ts"(){"use strict";init_builder(),init_configRaw(),init_compilerModel(),init_analyzer(),init_validator(),init_utils2(),Config=class{constructor(e){this.original=e}get isDraft(){return!1}get read(){throw new Error("please implements this method")}get write(){throw new Error("please implements this method")}get exists(){throw new Error("please implements this method")}get analyzer(){return this.original.analyzer||new DefaultAnalyzer}get validators(){let e=this.original;return!e.validators||e.validators.length===0?[new DefaultValidator]:Array.isArray(e.validators)?e.validators:[e.validators]}get builders(){if(this._builders)return this._builders;let e=this.original;return!e.builders||e.builders.length===0?this._builders=[new DefaultBuilder]:Array.isArray(e.builders)?this._builders=e.builders:this._builders=[e.builders],this._builders}get listener(){throw new Error("please implements this method")}get book(){return this._bookStructure||(this._bookStructure=BookStructure.createBook(this.original.book)),this._bookStructure}resolvePath(e){throw new Error("please implements this method")}},NodeJSConfig=class extends Config{constructor(e,n){super(n),this.options=e,this.original=n}get isDraft(){return this.options.draft??!1}get read(){return this.original.read||IO.read}get write(){return this.original.write||IO.write}get exists(){return e=>{let n=require("fs"),r=require("path"),o=this.original.basePath||__dirname;return new Promise(c=>{n.exists(r.resolve(o,e),d=>{c({path:e,result:d})})})}}get listener(){if(this._listener)return this._listener;let e=this.original.listener||{};return e.onAcceptables=e.onAcceptables||(()=>{}),e.onSymbols=e.onSymbols||(()=>{}),e.onReports=e.onReports||(n=>this.onReports(n)),e.onCompileSuccess=e.onCompileSuccess||(n=>this.onCompileSuccess(n)),e.onCompileFailed=e.onCompileFailed||(()=>this.onCompileFailed()),this._listener=e,this._listener}onReports(e){require_lib().setTheme({info:"cyan",warn:"yellow",error:"red"}),e.forEach(r=>{let o="";if(r.chapter&&(o+=r.chapter.name+" "),r.nodes&&r.nodes.forEach(f=>{o+="["+f.location.start.line+","+f.location.start.column+"] "}),o+=r.message,r.level===2)console.warn(o.error);else if(r.level===1)console.error(o.warn);else if(r.level===0)console.info(o.info);else throw new Error("unknown report level.")})}onCompileSuccess(e){this.options?.inproc||process.exit(0)}onCompileFailed(){this.options?.inproc||process.exit(1)}resolvePath(e){let n=require("path"),r=this.options.base||"./";return n.join(r,e)}},WebBrowserConfig=class extends Config{constructor(e,n){super(n),this.options=e,this.original=n}get isDraft(){return this.options.draft??!1}get read(){return this.original.read||(()=>{throw new Error("please implement config.read method")})}get write(){return this.original.write||(()=>{throw new Error("please implement config.write method")})}get exists(){return e=>window.location.protocol==="file:"?this._existsFileScheme(e):this._existsHttpScheme(e)}_existsFileScheme(e){return new Promise(r=>{let o=document.createElement("canvas");o.width=200,o.height=14,o.getContext("2d").fillText("file://\u3067\u306F\u753B\u50CF\u306E\u5B58\u5728\u30C1\u30A7\u30C3\u30AF\u304C\u3067\u304D\u307E\u305B\u3093",2,10);let c=o.toDataURL();r({path:c,result:!0})})}_existsHttpScheme(e){return new Promise(r=>{try{let o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===4&&(o.status===200||o.status===304?r({path:e,result:!0}):r({path:e,result:!1}))},o.open("GET",e),o.setRequestHeader("If-Modified-Since",new Date().toUTCString()),o.send()}catch(o){o instanceof DOMException&&console.log(o.message),r({path:e,result:!1})}})}get listener(){if(this._listener)return this._listener;let e=this.original.listener||{};return e.onAcceptables=e.onAcceptables||(()=>{}),e.onSymbols=e.onSymbols||(()=>{}),e.onReports=e.onReports||this.onReports,e.onCompileSuccess=e.onCompileSuccess||this.onCompileSuccess,e.onCompileFailed=e.onCompileFailed||this.onCompileFailed,this._listener=e,this._listener}onReports(e){e.forEach(n=>{let r="";if(n.chapter&&(r+=n.chapter.name+" "),n.nodes&&n.nodes.forEach(o=>{r+="["+o.location.start.line+","+o.location.start.column+"] "}),r+=n.message,n.level===2)console.warn(r);else if(n.level===1)console.error(r);else if(n.level===0)console.info(r);else throw new Error("unknown report level.")})}onCompileSuccess(e){}onCompileFailed(e){}resolvePath(e){if(!this.options.base)return e;let n=this.options.base;return!this.endWith(n,"/")&&!this.startWith(e,"/")&&(n+="/"),n+e}startWith(e,n){return e.indexOf(n)===0}endWith(e,n){return e.indexOf(n,e.length-n.length)!==-1}}}}),SyntaxPreprocessor,init_preprocessor=__esm({"lib/parser/preprocessor.ts"(){"use strict";init_parser(),init_walker(),init_utils2(),SyntaxPreprocessor=class{start(e){this.acceptableSyntaxes=e.acceptableSyntaxes,e.predef.forEach(n=>this.preprocessChunk(n)),e.contents.forEach(n=>this.preprocessChunk(n)),e.appendix.forEach(n=>this.preprocessChunk(n)),e.postdef.forEach(n=>this.preprocessChunk(n))}preprocessChunk(e){visit(e.tree.ast,{visitDefaultPre:n=>{},visitColumnPre:n=>{this.preprocessColumnSyntax(e,n)},visitBlockElementPre:n=>{this.preprocessBlockSyntax(e,n)}}),e.nodes.forEach(n=>this.preprocessChunk(n))}preprocessColumnSyntax(e,n){function r(o,f,c=n.parentNode.toChapter()){if(f.level<=c.level){r(o.parentNode.toNode(),f,c.parentNode.toChapter());return}c.childNodes.splice(c.childNodes.indexOf(o)+1,0,f),n.text.splice(n.text.indexOf(f),1)}visit(n,{visitDefaultPre:o=>{},visitColumnPre:o=>{},visitChapterPre:o=>{n.level<o.headline.level||r(n,o)}}),visit(e.tree.ast,{visitDefaultPre:(o,f)=>{o.parentNode=f}}),visit(e.tree.ast,{visitDefaultPre:(o,f)=>{},visitChapterPre:o=>{o.text.forEach((f,c,d)=>{f.prev=d[c-1],f.next=d[c+1]})},visitColumnPre:o=>{o.text.forEach((f,c,d)=>{f.prev=d[c-1],f.next=d[c+1]})},visitNodePre:o=>{o.childNodes.forEach((f,c,d)=>{f.prev=d[c-1],f.next=d[c+1]})}})}preprocessBlockSyntax(e,n){if(n.childNodes.length===0)return;let r=this.acceptableSyntaxes.find(n);if(r.length!==1)return;let o=r[0];if(!o.allowFullySyntax)if(o.allowInline){let f=null,c=[],d=null;if(visit(n.childNodes[0],{visitDefaultPre:u=>{u.ruleName===24||u.ruleName===25||u.ruleName===26||(f||(f={offset:u.location.start.offset,line:u.location.start.line,column:u.location.start.column}),d=u)},visitInlineElementPre:u=>{let b=new TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:f?.offset??u.location.start.offset,line:f?.line??u.location.start.line,column:f?.column??u.location.start.column},end:{offset:u.location.start.offset,line:void 0,column:void 0}},text:f?.offset==null?"":e.process.input.substring(f.offset,u.location.start.offset)});b.text.length>0&&c.push(b),c.push(u),f=null,d=u},visitSingleLineCommentPre:u=>{if(!f){d=u;return}let b=new TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:f.offset,line:f.line,column:f.column},end:{offset:u.location.start.offset,line:void 0,column:void 0}},text:e.process.input.substring(f.offset,u.location.start.offset)});b.text&&c.push(b),f=null,d=u}}),f){let u=new TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:f.offset,line:f.line,column:f.column},end:{offset:n.location.start.offset,line:void 0,column:void 0}},text:e.process.input.substring(f.offset,d.location.end.offset)});u.text.length>0&&c.push(u)}n.childNodes=c}else{let f=n.childNodes[0],c=n.childNodes[n.childNodes.length-1],d=new TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:f.location.start.offset,line:f.location.start.line,column:f.location.start.column},end:{offset:c.location.start.offset,line:void 0,column:void 0}},text:nodeContentToString(e.process,n)});n.childNodes=[d]}}}}}),controller_exports={};__export(controller_exports,{Controller:()=>Controller});var PEG2,Controller,init_controller=__esm({"lib/controller/controller.ts"(){"use strict";PEG2=__toESM(require_grammar()),init_compilerModel(),init_parser(),init_config(),init_configRaw(),init_parser(),init_preprocessor(),init_textBuilder(),init_htmlBuilder(),init_walker(),init_utils2(),Controller=class{constructor(e={}){this.options=e,this.builders={TextBuilder,HtmlBuilder}}initConfig(e){isNodeJS()?this.config=new NodeJSConfig(this.options,e):this.config=new WebBrowserConfig(this.options,e)}process(){return Promise.resolve(new Book2(this.config)).then(e=>this.acceptableSyntaxes(e)).then(e=>this.toContentChunk(e)).then(e=>this.readReVIEWFiles(e)).then(e=>this.parseContent(e)).then(e=>this.preprocessContent(e)).then(e=>this.processContent(e)).then(e=>this.writeContent(e)).then(e=>this.compileFinished(e)).catch(e=>this.handleError(e))}acceptableSyntaxes(e){return e.acceptableSyntaxes=e.config.analyzer.getAcceptableSyntaxes(),e.config.listener.onAcceptables(e.acceptableSyntaxes)===!1?(e.config.listener.onCompileFailed(),Promise.reject(null)):Promise.resolve(e)}toContentChunk(e){let n=(r,o)=>{let f=null;if(r.part)f=new ContentChunk(e,r.part.file),r.part.chapters.forEach(c=>{n(ContentStructure.createChapter(c),f)});else if(r.chapter)f=new ContentChunk(e,o,r.chapter.file);else return null;return o&&o.nodes.push(f),f};return e.predef=this.config.book.predef.map(r=>n(r)),e.contents=this.config.book.contents.map(r=>n(r)),e.appendix=this.config.book.appendix.map(r=>n(r)),e.postdef=this.config.book.postdef.map(r=>n(r)),e}readReVIEWFiles(e){let n=[],r=o=>{let f=e.config.resolvePath(o.name);n.push(e.config.read(f).then(c=>o.input=c)),o.nodes.forEach(c=>r(c))};return e.predef.forEach(o=>r(o)),e.contents.forEach(o=>r(o)),e.appendix.forEach(o=>r(o)),e.postdef.forEach(o=>r(o)),Promise.all(n).then(()=>e)}parseContent(e){let n=r=>{try{r.tree=parse2(r.input)}catch(o){if(!(o instanceof PEG2.SyntaxError))throw o;let f=o,c=new SyntaxTree2({syntax:f.name,location:{start:{line:f.line,column:f.column,offset:f.offset},end:void 0}});r.tree={ast:c,cst:null}}r.nodes.forEach(o=>n(o))};return e.predef.forEach(r=>n(r)),e.contents.forEach(r=>n(r)),e.appendix.forEach(r=>n(r)),e.postdef.forEach(r=>n(r)),e}preprocessContent(e){let n=(f,c)=>{let d=[];visit(f.tree.ast,{visitDefaultPre:y=>{},visitChapterPre:y=>{d.push(y)}});let u=0,b=1;d.forEach(y=>{let B=y.headline.level;u=Math.max(u,B);let C;if(b>B)for(C=B+1;C<=u;C++)c[C]=0;else if(b<B)for(C=B;C<=u;C++)c[C]=0;b=B,c[B]=(c[B]||0)+1,y.no=c[B]}),f.no=c[1],f.nodes.forEach(y=>n(y,c))},r=(f,c={})=>{f.forEach(d=>n(d,c))};return r(e.predef),r(e.contents),r(e.appendix),r(e.postdef),new SyntaxPreprocessor().start(e),e}processContent(e){if(e.config.validators.forEach(r=>{r.start(e,e.acceptableSyntaxes,this.config.builders)}),e.reports.some(r=>r.level===2))return Promise.resolve(e);let n=e.allChunks.reduce((r,o)=>r.concat(o.process.symbols),[]);return this.config.listener.onSymbols(n)===!1?Promise.resolve(e):Promise.all(this.config.builders.map(r=>r.init(e))).then(()=>e)}writeContent(e){let n=[],r=o=>{o.builderProcesses.forEach(f=>{let d=o.name.substr(0,o.name.lastIndexOf(".re"))+"."+f.builder.extention;n.push(this.config.write(d,f.result))}),o.nodes.forEach(f=>r(f))};return e.predef.forEach(o=>r(o)),e.contents.forEach(o=>r(o)),e.appendix.forEach(o=>r(o)),e.postdef.forEach(o=>r(o)),Promise.all(n).then(()=>e)}compileFinished(e){return e.config.listener.onReports(e.reports),e.hasError?e.config.listener.onCompileFailed(e):e.config.listener.onCompileSuccess(e),e}handleError(e){return console.error("unexpected error",e),e&&e.stack&&console.error(e.stack),Promise.reject(e)}}}});function start(e,n){"use strict";let r=new Controller(n);return e(r),r.process()}var init_lib=__esm({"lib/index.ts"(){"use strict";init_compilerModel(),init_controller(),init_parser(),init_parser(),init_analyzer(),init_validator(),init_builder(),init_htmlBuilder(),init_textBuilder(),init_analyzer()}});function isBrowser(){"use strict";return typeof window<"u"}function isNodeJS(){"use strict";return typeof atom<"u"?!0:!isBrowser()&&!isAMD()&&typeof exports=="object"}function isAMD(){"use strict";return typeof define=="function"&&define.amd}function nodeContentToString(e,n,r){"use strict";let o=Number.MAX_VALUE,f=-1,c={visitDefaultPre:u=>{o=Math.min(o,u.location.start.offset),f=Math.max(f,u.location.end.offset)}},d=null;return d={visitDefaultPre:u=>{},visitNodePre:u=>(u.childNodes.forEach(b=>visit(b,r?d:c)),!1),visitHeadlinePre:u=>(visit(u.caption,c),!1),visitUlistPre:u=>(visit(u.text,c),!1),visitDlistPre:u=>(visit(u.text,c),visit(u.content,c),!1),visitOlistPre:u=>(visit(u.text,c),!1),visitTextPre:u=>(visit(r?u:n,c),!1)},visit(n,d),f<0?"":e.input.substring(o,f)}function findUp(e,n){"use strict";let r=null;return walk(e,o=>n(o)?(r=o,null):o.parentNode),r}function findChapter(e,n){"use strict";let r=null;return walk(e,o=>o instanceof ChapterSyntaxTree&&(r=o,typeof n>"u"||o.level===n)?null:o.parentNode),r}function getHeadlineLevels(e){const n={};let r=0;walk(e,f=>(f instanceof ChapterSyntaxTree?(n[f.level]=f.no,r=Math.max(r,f.level)):f instanceof ColumnSyntaxTree&&(n[f.level]=-1,r=Math.max(r,f.level)),f.parentNode));const o=[];for(let f=1;f<=r;f++)n[f]===-1?o.push(0):typeof n[f]>"u"?o.push(1):o.push(n[f]||0);return o}function target2builder(e){"use strict";let n=e.charAt(0).toUpperCase()+e.substring(1)+"Builder";return n==="TextBuilder"?new TextBuilder:n==="HtmlBuilder"?new HtmlBuilder:null}function linesToFigure(e){"use strict";return String(e).length}function padLeft(e,n,r){"use strict";return r<=e.length?e:stringRepeat(r-e.length,n)+e}function stringRepeat(e,n){"use strict";return new Array(e+1).join(n)}var IO,Exec,init_utils2=__esm({"lib/utils/utils.ts"(){"use strict";init_compilerModel(),init_parser(),init_textBuilder(),init_htmlBuilder(),init_analyzer(),init_validator(),init_walker(),init_lib(),(e=>{"use strict";function n(o){let f=require("fs");return new Promise((c,d)=>{f.readFile(o,{encoding:"utf8"},(u,b)=>{u?d(u):c(b)})})}e.read=n;function r(o,f){let c=require("fs");return new Promise((d,u)=>{c.writeFile(o,f,b=>{b?u(b):d(null)})})}e.write=r})(IO||(IO={})),(e=>{"use strict";function n(r,o,f,c){"use strict";let d=c||{};if(d.read=d.read||(()=>Promise.resolve(r)),d.analyzer=d.analyzer||new DefaultAnalyzer,d.validators=d.validators||[new DefaultValidator],f&&target2builder(f)==null&&(console.error(f+" is not exists in builder"),process.exit(1)),d.builders=d.builders,!d.builders)if(f){let B=target2builder(f);if(!B)return Promise.reject(`unknown target: ${f}`);d.builders=[B]}else d.builders=[new TextBuilder];d.book=d.book||{contents:[{file:o}]},d.book.contents=d.book.contents||[{file:o}];let u={};d.write=d.write||((B,C)=>u[B]=C),d.listener=d.listener||{onReports:()=>{},onCompileSuccess:()=>{},onCompileFailed:()=>{}},d.listener.onReports=d.listener.onReports||(()=>{}),d.listener.onCompileSuccess=d.listener.onCompileSuccess||(()=>{}),d.listener.onCompileFailed=d.listener.onCompileFailed||(()=>{});let b=d.listener.onCompileSuccess;d.listener.onCompileSuccess=B=>{b(B)};let y=d.listener.onCompileFailed;return d.listener.onCompileFailed=B=>{y(B)},start(B=>{B.initConfig(d)}).then(B=>({book:B,results:u}))}e.singleCompile=n})(Exec||(Exec={}))}}),en,init_en=__esm({"lib/i18n/en.ts"(){"use strict";en={sample:"Hello!"}}}),ja,init_ja=__esm({"lib/i18n/ja.ts"(){"use strict";ja={sample:"\u3053\u3093\u3061\u3083\u30FC\u3059\uFF01",description:{headline:`\u30C1\u30E3\u30D7\u30BF\u30FC\u306E\u59CB\u307E\u308A\u3092\u793A\u3057\u307E\u3059\u3002
"= \u898B\u51FA\u3057" \u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,column:`\u30B3\u30E9\u30E0\u306E\u59CB\u307E\u308A\u3092\u793A\u3057\u307E\u3059\u3002
"===[column] \u898B\u51FA\u3057" \u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002
"===[/column]"\u3092\u4F7F\u3046\u304B\u3001\u6B21\u306E\u898B\u51FA\u3057\u304C\u59CB\u307E\u308B\u3068\u30B3\u30E9\u30E0\u306E\u7D42\u308F\u308A\u306B\u306A\u308A\u307E\u3059\u3002`,ulist:`\u756A\u53F7\u306A\u3057\u7B87\u6761\u66F8\u304D\u3092\u793A\u3057\u307E\u3059\u3002*\u8A18\u53F7\u3092\u3064\u306A\u3052\u3066\u66F8\u304F\u3068\u3055\u3089\u306B\u30A4\u30F3\u30C7\u30F3\u30C8\u3057\u305F\u7B87\u6761\u66F8\u304D\u306B\u3059\u308B\u4E8B\u304C\u3067\u304D\u307E\u3059\u3002
 * \u98DF\u6599\u54C1\u3092\u8CB7\u3046\u3053\u3068\u3002
 ** \u725B\u4E73
 ** \u306B\u3093\u3058\u3093
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u884C\u982D\u306B\u5FC5\u305A\u534A\u89D2\u30B9\u30DA\u30FC\u30B9\u304C\u5FC5\u8981\u3067\u3059\u3002`,olist:`\u6570\u5B57\u4ED8\u304D\u7B87\u6761\u66F8\u304D\u3092\u793A\u3057\u307E\u3059\u3002
 1. \u306F\u3058\u3081\u306B\u795E\u306F\u5929\u3068\u5730\u3068\u3092\u60F3\u50CF\u3055\u308C\u305F\u3002
 2. \u5730\u306F\u5F62\u306A\u304F\u3001\u3080\u306A\u3057\u304F\u3001\u3084\u307F\u304C\u6DF5\u306E\u304A\u3082\u3066\u306B\u3042\u308A\u3001\u795E\u306E\u970A\u304C\u6C34\u306E\u304A\u3082\u3066\u3092\u304A\u304A\u3063\u3066\u3044\u305F\u3002
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u884C\u982D\u306B\u5FC5\u305A\u534A\u89D2\u30B9\u30DA\u30FC\u30B9\u304C\u5FC5\u8981\u3067\u3059\u3002`,dlist:`\u7528\u8A9E\u30EA\u30B9\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
: \u30EC\u30D0\u30AC\u30C1\u30E3
  \u30EC\u30D0\u30FC\u3092\u30AC\u30C1\u30E3\u30AC\u30C1\u30E3\u52D5\u304B\u3059\u3053\u3068\u3002\u719F\u7DF4\u8005\u306F\u30EC\u30D0\u30AC\u30C1\u30E3\u3059\u3079\u304D\u6642\u3068\u3057\u306A\u3044\u6642\u3092\u660E\u78BA\u306B\u4F7F\u3044\u5206\u3051\u52DD\u5229\u3092\u63B4\u307F\u53D6\u308B\u3002
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u672C\u6587\u306E\u884C\u306F\u5148\u982D\u306B\u534A\u89D2\u30B9\u30DA\u30FC\u30B9\u304B\u30BF\u30D6\u304C\u5FC5\u8981\u3067\u3059\u3002`,block_list:`\u30EA\u30B9\u30C8\u3092\u793A\u3057\u307E\u3059\u3002\u6280\u8853\u66F8\u3067\u306F\u30D7\u30ED\u30B0\u30E9\u30E0\u30B3\u30FC\u30C9\u306E\u63B2\u8F09\u306B\u4F7F\u3044\u307E\u3059\u3002
//list[label][caption]{
alert("Hello!");
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_list:`\u30EA\u30B9\u30C8\u3078\u306E\u53C2\u7167\u3092\u793A\u3057\u307E\u3059\u3002
//list[hoge][caption]{alert("Hello!");
//}
 \u3092\u53C2\u7167\u3059\u308B\u6642\u306F @<list>{hoge} \u3068\u66F8\u304D\u307E\u3059\u3002`,block_listnum:`\u884C\u756A\u53F7\u4ED8\u304D\u306E\u30EA\u30B9\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
//listnum[hello.js][\u30CF\u30ED\u30FC\u30EF\u30FC\u30EB\u30C9]{
console.log("Hello world!");
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_emlist:`\u975E\u63A1\u756A\u306E\u30EA\u30B9\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
//emlist[\u30CF\u30ED\u30FC\u30EF\u30FC\u30EB\u30C9]{
console.log("Hello world");
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_emlistnum:`\u884C\u756A\u53F7\u4ED8\u304D\u306E\u975E\u63A1\u756A\u306E\u30EA\u30B9\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
//emlistnum{
console.log("Hello world");
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_image:`\u56F3\u8868\u3092\u793A\u3057\u307E\u3059\u3002
//image[sample][\u30B5\u30F3\u30D7\u30EB][scale=0.3]{
\u30E1\u30E2
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002
\u7AE0\u306E\u30D5\u30A1\u30A4\u30EB\u540D\u304Ctest.re\u306E\u5834\u5408\u3001images/test/sample.jpg\u304C\u53C2\u7167\u3055\u308C\u307E\u3059\u3002
\u753B\u50CF\u306E\u30B5\u30A4\u30BA\u3092\u8ABF\u6574\u3057\u305F\u3044\u5834\u5408\u3001scale\u3067\u500D\u7387\u304C\u6307\u5B9A\u3067\u304D\u307E\u3059\u3002
\u4E2D\u306B\u66F8\u304B\u308C\u3066\u3044\u308B\u30E1\u30E2\u306F\u7121\u8996\u3055\u308C\u307E\u3059\u3002`,block_indepimage:`\u975E\u63A1\u756A\u306E\u56F3\u8868\u3092\u793A\u3057\u307E\u3059\u3002
//image[sample][\u30B5\u30F3\u30D7\u30EB][scale=0.3]{
\u30E1\u30E2
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u8A73\u7D30\u306F //image \u3068\u540C\u69D8\u3067\u3059\u3002`,block_graph:`\u30B0\u30E9\u30D5\u3092\u793A\u3057\u307E\u3059\u3002
//graph[sample][\u30C4\u30FC\u30EB\u540D][\u30B5\u30F3\u30D7\u30EB]{
\u30E1\u30E2
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002
\u6587\u7AE0\u4E2D\u304B\u3089\u53C2\u7167\u3059\u308B\u6642\u306F@<img>{sample}\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002
\u4E2D\u306B\u66F8\u304B\u308C\u3066\u3044\u308B\u30E1\u30E2\u306F\u7121\u8996\u3055\u308C\u307E\u3059\u3002`,inline_img:`\u56F3\u8868\u3078\u306E\u53C2\u7167\u3092\u793A\u3057\u307E\u3059\u3002
//image[sample][\u30B5\u30F3\u30D7\u30EB]{
//}
\u3092\u53C2\u7167\u3059\u308B\u3068\u304D\u306F @<img>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002`,inline_icon:`\u6587\u4E2D\u306B\u8868\u793A\u3055\u308C\u308B\u56F3\u8868\u3092\u793A\u3057\u307E\u3059\u3002
@<icon>{sample}\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u7AE0\u306E\u30D5\u30A1\u30A4\u30EB\u540D\u304Ctest.re\u306E\u5834\u5408\u3001images/test-sample.jpen\u304C\u53C2\u7167\u3055\u308C\u307E\u3059\u3002`,block_footnote:`\u811A\u6CE8\u3092\u793A\u3057\u307E\u3059\u3002
//footnote[sample][\u30B5\u30F3\u30D7\u30EB\u3068\u3057\u3066\u306F\u3044\u3055\u3055\u304B\u8C6A\u83EF\u3059\u304E\u308B\u304B\u3082\uFF01]
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_fn:`\u811A\u6CE8\u3078\u306E\u53C2\u7167\u3092\u793A\u3057\u307E\u3059\u3002
//footnote[sample][\u30B5\u30F3\u30D7\u30EB\u3068\u3044\u3046\u306B\u306F\u30B7\u30E7\u30DC\u3059\u304E\u308B]
\u3092\u53C2\u7167\u3059\u308B\u3068\u304D\u306F @<fn>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002`,block_lead:`\u30EA\u30FC\u30C9\u5206\u3092\u793A\u3057\u307E\u3059\u3002
//lead{
\u4E16\u754C\u3092\u5909\u3048\u305F\u304F\u306F\u306A\u3044\u304B\uFF1F
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002lead\u8A18\u6CD5\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u3084\u30D6\u30ED\u30C3\u30AF\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_noindent:`\u30D1\u30E9\u30B0\u30E9\u30D5\u3092\u5207\u3089\u305A\u306B\u6B21\u306E\u8981\u7D20\u3092\u7D9A\u3051\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
//noindent
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_blankline:`1\u884C\u3076\u3093\u306E\u7A7A\u884C\u3092\u660E\u793A\u3057\u3066\u5165\u308C\u307E\u3059\u3002
//blankline
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_source:`\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306E\u5F15\u7528\u3092\u793A\u3057\u307E\u3059\u3002
//source[hello.js]{
console.log("Hello world!");
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_cmd:`\u30B3\u30DE\u30F3\u30C9\u30E9\u30A4\u30F3\u306E\u30AD\u30E3\u30D7\u30C1\u30E3\u3092\u793A\u3057\u307E\u3059\u3002
//cmd{
$ git clone git@github.com:vvakame/review.js.git
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_quote:`\u5F15\u7528\u3092\u793A\u3057\u307E\u3059\u3002
//quote{
\u795E\u306F\u8A00\u3063\u3066\u3044\u308B\u2026\u3053\u3053\u3067\u6B7B\u306C\u5B9A\u3081\u3067\u306F\u306A\u3044\u3068\u2026
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_hd:"TODO \u5F8C\u3067\u66F8\u304F\u3002\u898B\u51FA\u3057\u53C2\u7167\u3092\u4F5C\u6210\u3059\u308B\u3002",inline_code:`\u77ED\u3044\u30D7\u30ED\u30B0\u30E9\u30E0\u30B3\u30FC\u30C9\u3092\u8A18\u8FF0\u3057\u307E\u3059\u3002
@<code>{alert("Hello!");}
\u9577\u3044\u30BD\u30FC\u30B9\u30B3\u30FC\u30C9\u306B\u306Flist\u8A18\u6CD5\u3092\u4F7F\u3044\u307E\u3057\u3087\u3046\u3002`,inline_br:"\u6539\u884C\u3092\u793A\u3057\u307E\u3059\u3002\u30EA\u30B9\u30C8\u5185\u3067\u306E\u6539\u884C\u3084\u3001\u6BB5\u843D\u3092\u5909\u3048\u305A\u306B\u6539\u884C\u3092\u3057\u305F\u3044\u5834\u5408\u306B\u4F7F\u3044\u307E\u3059\u3002",inline_u:`\u4E0B\u7DDA\u306B\u3057\u307E\u3059\u3002
@<u>{\u3053\u306E\u90E8\u5206\u304C\u4E0B\u7DDA\u306B\u306A\u308B}`,inline_ruby:`\u8AAD\u307F\u4EEE\u540D\u3092\u632F\u308A\u307E\u3059\u3002
@<ruby>{\u7F8A,\u3072\u3064\u3058}`,inline_b:`\u30DC\u30FC\u30EB\u30C9(\u592A\u5B57)\u306B\u3057\u307E\u3059\u3002
@<b>{\u3053\u306E\u90E8\u5206\u304C\u592A\u5B57\u306B\u306A\u308B}`,inline_href:`\u30EA\u30F3\u30AF\u3092\u793A\u3057\u307E\u3059\u3002
URL\u3092\u66F8\u304D\u305F\u3044\u5834\u5408\u306B\u4F7F\u3044\u307E\u3059\u3002
@<href>{https://github.com/vvakame/review.js} \u307E\u305F\u306F @<href>{https://github.com/vvakame/review.js, review.js} \u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_label:`\u30A2\u30F3\u30AB\u30FC\u3092\u793A\u3057\u307E\u3059\u3002
@<href>{#anchor}\u304B\u3089\u98DB\u3093\u3067\u6765\u3089\u308C\u308B\u3088\u3046\u306B\u3059\u308B\u305F\u3081\u306B\u306F
//label[anchor]
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_kw:`\u30AD\u30FC\u30EF\u30FC\u30C9\u3092\u793A\u3057\u307E\u3059\u3002
\u305D\u308C\u306F\u304A\u304B\u3057\u3044\u3060\u308D\u3046@<kw>{JK, \u5E38\u8B58\u7684\u306B\u8003\u3048\u3066}\u3002
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_tti:`\u30C6\u30EC\u30BF\u30A4\u30D7\u6587\u5B57(\u7B49\u5E45\u30D5\u30A9\u30F3\u30C8)\u306E\u30A4\u30BF\u30EA\u30C3\u30AF\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<tti>{keyword}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_ttb:`\u30C6\u30EC\u30BF\u30A4\u30D7\u6587\u5B57(\u7B49\u5E45\u30D5\u30A9\u30F3\u30C8)\u306E\u30DC\u30FC\u30EB\u30C9\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<ttb>{class}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_ami:`\u7DB2\u639B\u3051\u6709\u308A\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<ami>{\u91CD\u70B9\uFF01}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_bou:`\u508D\u70B9\u6709\u308A\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<bou>{\u306A\u3093\u3060\u3063\u3066\uFF1F}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_del:`\u524A\u9664\u7B87\u6240\u3092\u660E\u793A\u3057\u307E\u3059\u3002
\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u306F\u6253\u3061\u6D88\u3057\u7DDA\u304C\u5F15\u304B\u308C\u307E\u3059\u3002
@<del>{\u524A\u9664}\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_i:`\u30A4\u30BF\u30EA\u30C3\u30AF\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<i>{\u659C\u4F53}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_ins:`\u633F\u5165\u7B87\u6240\u3092\u660E\u793A\u3057\u307E\u3059\u3002
\u30C7\u30D5\u30A9\u30EB\u30C8\u3067\u306F\u4E0B\u7DDA\u304C\u5F15\u304B\u308C\u307E\u3059\u3002
@<ins>{\u633F\u5165}\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_m:`TeX\u306E\u5F0F\u3092\u633F\u5165\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<m>{TeX\u5F0F}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_strong:`\u30DC\u30FC\u30EB\u30C9\u3067\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<strong>{\u5F37\u8ABF\uFF01}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_tcy:`\u7E26\u66F8\u304D\u306E\u6587\u66F8\u306B\u304A\u3044\u3066\u6587\u5B57\u3092\u7E26\u4E2D\u6A2A\u3067\u51FA\u529B\u3057\u307E\u3059\u3002
@<tcy>{AB}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_uchar:`\u6307\u5B9A\u3055\u308C\u305F\u5024\u309216\u9032\u6570\u306E\u5024\u3068\u3057\u3066\u6271\u3044\u3001Unicode\u6587\u5B57\u3068\u3057\u3066\u51FA\u529B\u3059\u308B\u3053\u3068\u3092\u793A\u3057\u307E\u3059\u3002
@<uchar>{1F64B}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,inline_tt:"\u56F2\u307E\u308C\u305F\u30C6\u30AD\u30B9\u30C8\u3092\u7B49\u5E45\u30D5\u30A9\u30F3\u30C8\u3067\u8868\u793A\u3057\u307E\u3059\u3002",inline_em:`\u30C6\u30AD\u30B9\u30C8\u3092\u5F37\u8ABF\u3057\u307E\u3059\u3002
@<em>{\u3053\u306E\u3088\u3046\u306B\u5F37\u8ABF\u3055\u308C\u307E\u3059}`,block_raw:`\u751F\u30C7\u30FC\u30BF\u3092\u8868\u3057\u307E\u3059\u3002
//raw[|html,text|\u307B\u3052]\u3068\u66F8\u304F\u3068\u3001\u51FA\u529B\u5148\u304Chtml\u304Btext\u306E\u6642\u306E\u307F\u5185\u5BB9\u304C\u305D\u306E\u307E\u307E\u51FA\u529B\u3055\u308C\u307E\u3059\u3002
Re:VIEW\u306E\u8A18\u6CD5\u3092\u8D85\u3048\u3066\u305D\u306E\u307E\u307E\u51FA\u529B\u3055\u308C\u308B\u306E\u3067\u3001\u69CB\u9020\u3092\u58CA\u3055\u306C\u3088\u3046\u614E\u91CD\u306B\u4F7F\u3063\u3066\u304F\u3060\u3055\u3044\u3002`,inline_raw:`\u751F\u30C7\u30FC\u30BF\u3092\u8868\u3057\u307E\u3059\u3002
@<raw>{|html,text|\u307B\u3052}\u3068\u66F8\u304F\u3068\u3001\u51FA\u529B\u5148\u304Chtml\u304Btext\u306E\u6642\u306E\u307F\u5185\u5BB9\u304C\u305D\u306E\u307E\u307E\u51FA\u529B\u3055\u308C\u307E\u3059\u3002
Re:VIEW\u306E\u8A18\u6CD5\u3092\u8D85\u3048\u3066\u305D\u306E\u307E\u307E\u51FA\u529B\u3055\u308C\u308B\u306E\u3067\u3001\u69CB\u9020\u3092\u58CA\u3055\u306C\u3088\u3046\u614E\u91CD\u306B\u4F7F\u3063\u3066\u304F\u3060\u3055\u3044\u3002`,block_comment:`\u30B3\u30E1\u30F3\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
//comment{
\u30B3\u30E1\u30F3\u30C8\u3067\u3059\u3088\u30FC
//}
\u3068\u66F8\u304F\u3053\u3068\u306B\u3088\u308A\u3001\u6587\u66F8\u306B\u306F\u51FA\u529B\u3055\u308C\u306A\u3044\u6587\u3092\u66F8\u304F\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002`,inline_comment:`\u30B3\u30E1\u30F3\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
@<comment>{\u30B3\u30E1\u30F3\u30C8\u3067\u3059\u3088\u30FC}\u3068\u66F8\u304F\u3053\u3068\u306B\u3088\u308A\u3001\u6587\u66F8\u306B\u306F\u51FA\u529B\u3055\u308C\u306A\u3044\u6587\u3092\u66F8\u304F\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002`,inline_chap:`\u7AE0\u756A\u53F7\u3092\u793A\u3057\u307E\u3059\u3002
\u30D5\u30A1\u30A4\u30EB\u540D\u306E.re\u306E\u524D\u306E\u90E8\u5206\u304B =={sample} \u30BF\u30A4\u30C8\u30EB \u306E{}\u90E8\u5206\u3092\u53C2\u7167\u3057\u307E\u3059\u3002@<chap>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002`,inline_title:`\u7AE0\u30BF\u30A4\u30C8\u30EB\u3092\u793A\u3057\u307E\u3059\u3002
\u30D5\u30A1\u30A4\u30EB\u540D\u306E.re\u306E\u524D\u306E\u90E8\u5206\u304B =={sample} \u30BF\u30A4\u30C8\u30EB \u306E{}\u90E8\u5206\u3092\u53C2\u7167\u3057\u307E\u3059\u3002@<title>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002`,inline_chapref:`\u7AE0\u756A\u53F7+\u7AE0\u30BF\u30A4\u30C8\u30EB\u3092\u793A\u3057\u307E\u3059\u3002
\u30D5\u30A1\u30A4\u30EB\u540D\u306E.re\u306E\u524D\u306E\u90E8\u5206\u304B =={sample} \u30BF\u30A4\u30C8\u30EB \u306E{}\u90E8\u5206\u3092\u53C2\u7167\u3057\u307E\u3059\u3002@<chapref>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002`,inline_idx:"\u6587\u5B57\u5217\u3092\u51FA\u529B\u3059\u308B\u3068\u3068\u3082\u306B\u3001\u7D22\u5F15\u3068\u3057\u3066\u767B\u9332\u3057\u307E\u3059\u3002\n`\u89AA\u7D22\u5F15\u6587\u5B57\u5217<<>>\u5B50\u7D22\u5F15\u6587\u5B57\u5217`\u306E\u3088\u3046\u306B\u89AA\u5B50\u95A2\u4FC2\u306B\u3042\u308B\u7D22\u5F15\u3082\u5B9A\u7FA9\u3067\u304D\u307E\u3059\u3002\n@<idx>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002",inline_hidx:"\u7D22\u5F15\u3068\u3057\u3066\u767B\u9332\u3057\u307E\u3059 (idx \u3068\u7570\u306A\u308A\u3001\u7D19\u9762\u5185\u306B\u51FA\u529B\u306F\u3057\u307E\u305B\u3093)\u3002\n`\u89AA\u7D22\u5F15\u6587\u5B57\u5217<<>>\u5B50\u7D22\u5F15\u6587\u5B57\u5217`\u306E\u3088\u3046\u306B\u89AA\u5B50\u95A2\u4FC2\u306B\u3042\u308B\u7D22\u5F15\u3082\u5B9A\u7FA9\u3067\u304D\u307E\u3059\u3002\n@<hidx>{sample} \u3068\u66F8\u304D\u307E\u3059\u3002",block_flushright:`\u53F3\u5BC4\u305B\u3092\u793A\u3057\u307E\u3059\u3002
//flushright{
\u795E\u306F\u8A00\u3063\u3066\u3044\u308B\u2026\u3053\u3053\u3067\u5DE6\u3078\u884C\u304F\u5B9A\u3081\u3067\u306F\u306A\u3044\u3068\u2026
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002`,block_memo:`\u3061\u3087\u3063\u3068\u3057\u305F\u30E1\u30E2\u3092\u793A\u3057\u307E\u3059\u3002
//memo[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u3088\u308A\u8A73\u3057\u3044\u60C5\u5831\u306FURL:XXXX\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_info:`\u3061\u3087\u3063\u3068\u3057\u305F\u53C2\u8003\u60C5\u5831\u3092\u793A\u3057\u307E\u3059\u3002
//info[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u3088\u308A\u8A73\u3057\u3044\u60C5\u5831\u306FURL:XXXX\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_tip:`\u3061\u3087\u3063\u3068\u3057\u305FTips\u3092\u793A\u3057\u307E\u3059\u3002
//tip[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u3088\u308A\u8A73\u3057\u3044\u60C5\u5831\u306FURL:XXXX\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_note:`\u3061\u3087\u3063\u3068\u3057\u305F\u30CE\u30FC\u30C8\u3092\u793A\u3057\u307E\u3059\u3002
//note[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u3088\u308A\u8A73\u3057\u3044\u60C5\u5831\u306FURL:XXXX\u3092\u53C2\u7167\u304F\u3060\u3055\u3044\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_warning:`\u3061\u3087\u3063\u3068\u3057\u305F\u8B66\u544A\u60C5\u5831\u3092\u793A\u3057\u307E\u3059\u3002
//warning[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u5148\u307B\u3069\u306E\u4F8B\u3068\u306F\u51FA\u529B\u7D50\u679C\u304C\u7570\u306A\u308A\u307E\u3059\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_important:`\u3061\u3087\u3063\u3068\u3057\u305F\u91CD\u8981\u60C5\u5831\u3092\u793A\u3057\u307E\u3059\u3002
//important[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u4E00\u5B9A\u671F\u9593\u64CD\u4F5C\u3057\u306A\u3044\u5834\u5408\u3001\u30AD\u30E3\u30C3\u30B7\u30E5\u306F\u524A\u9664\u3055\u308C\u308B\u3053\u3068\u304C\u3042\u308A\u307E\u3059\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_caution:`\u3061\u3087\u3063\u3068\u3057\u305F\u8B66\u544A\u60C5\u5831\u3092\u793A\u3057\u307E\u3059\u3002
//caution[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u4E00\u5EA6\u5B9F\u884C\u3059\u308B\u3068\u4FEE\u6B63\u306F\u3067\u304D\u307E\u305B\u3093\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_notice:`\u3061\u3087\u3063\u3068\u3057\u305F\u6CE8\u610F\u60C5\u5831\u3092\u793A\u3057\u307E\u3059\u3002
//notice[\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3]{
\u30A8\u30E9\u30FC\u304C\u306A\u3051\u308C\u3070\u7279\u306B\u4F55\u3082\u51FA\u529B\u3055\u308C\u307E\u305B\u3093\u3002
//}
\u3068\u3044\u3046\u5F62\u5F0F\u3067\u66F8\u304D\u307E\u3059\u3002\u30D6\u30ED\u30C3\u30AF\u4E2D\u3067\u306F\u3001\u5168\u3066\u306E\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u304C\u5229\u7528\u3067\u304D\u307E\u3059\u3002`,block_table:`\u30C6\u30FC\u30D6\u30EB\u3092\u793A\u3057\u307E\u3059\u3002
TODO \u6B63\u3057\u304F\u5B9F\u88C5\u3057\u305F\u5F8C\u306B\u66F8\u304F`,inline_table:`\u30C6\u30FC\u30D6\u30EB\u3078\u306E\u53C2\u7167\u3092\u793A\u3057\u307E\u3059\u3002
TODO \u6B63\u3057\u304F\u5B9F\u88C5\u3057\u305F\u5F8C\u306B\u66F8\u304F`,block_tsize:`\u30C6\u30FC\u30D6\u30EB\u306E\u5927\u304D\u3055\u3092\u6307\u5B9A\u3057\u307E\u3059\u3002
TODO \u6B63\u3057\u304F\u5B9F\u88C5\u3057\u305F\u5F8C\u306B\u66F8\u304F`},compile:{file_not_exists:"\u30D5\u30A1\u30A4\u30EB %s \u304C\u958B\u3051\u307E\u305B\u3093\u3002",block_not_supported:"%s \u3068\u3044\u3046\u30D6\u30ED\u30C3\u30AF\u69CB\u6587\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002",inline_not_supported:"%s \u3068\u3044\u3046\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002",part_is_missing:"\u30D1\u30FC\u30C8 %s \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",chapter_is_missing:"\u30C1\u30E3\u30D7\u30BF\u30FC %s \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",reference_is_missing:"\u53C2\u7167\u5148 %s \u306E %s \u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002",duplicated_label:"\u30E9\u30D9\u30EB\u306B\u91CD\u8907\u304C\u3042\u308B\u3088\u3046\u3067\u3059\u3002",duplicated_label_headline:"\u30E9\u30D9\u30EB\u306B\u91CD\u8907\u304C\u3042\u308B\u3088\u3046\u3067\u3059\u3002 =={a-label} \u30E9\u30D9\u30EB \u306E\u3088\u3046\u306B\u660E\u793A\u7684\u306B\u30E9\u30D9\u30EB\u3092\u6307\u5B9A\u3059\u308B\u3053\u3068\u3092\u56DE\u907F\u3059\u308B\u3053\u3068\u304C\u3067\u304D\u307E\u3059\u3002",args_length_mismatch:"\u5F15\u6570\u306E\u6570\u306B\u9F5F\u9F6C\u304C\u3042\u308A\u307E\u3059\u3002 \u671F\u5F85\u5024 %s, \u5B9F\u969B %s",args_hd_path_not_implemented:"\u30AD\u30E3\u30D7\u30B7\u30E7\u30F3\u306B\u3088\u308B\u53C2\u7167\u306F\u307E\u3060\u5B9F\u88C5\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002{\u30E9\u30D9\u30EB}\u304B{\u7AE0ID|\u30E9\u30D9\u30EB}\u306E\u5F62\u5F0F\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u6307\u5B9A\u3055\u308C\u305F\u8981\u7D20\u306F %s \u3067\u3057\u305F\u3002",body_string_only:"\u5185\u5BB9\u306F\u5168\u3066\u6587\u5B57\u3067\u306A\u3051\u308C\u3070\u3044\u3051\u307E\u305B\u3093\u3002",chapter_not_toplevel:"\u6DF1\u30551\u306E\u30C1\u30E3\u30D7\u30BF\u30FC\u306F\u6700\u4E0A\u4F4D\u306B\u306A\u3051\u308C\u3070\u3044\u3051\u307E\u305B\u3093\u3002",chapter_topleve_eq1:"\u6700\u4E0A\u4F4D\u306E\u30C1\u30E3\u30D7\u30BF\u30FC\u306F\u6DF1\u30551\u306E\u3082\u306E\u3067\u306A\u3051\u308C\u3070\u3044\u3051\u307E\u305B\u3093\u3002",deprecated_inline_symbol:"%s \u3068\u3044\u3046\u30A4\u30F3\u30E9\u30A4\u30F3\u69CB\u6587\u306F\u975E\u63A8\u5968\u3067\u3059\u3002",graph_tool_is_not_recommended:"graph\u7528\u30C4\u30FC\u30EB\u306B\u306Fgraphviz\u3092\u304A\u3059\u3059\u3081\u3057\u307E\u3059\u3002",unknown_graph_tool:"%s \u3068\u3044\u3046graph\u7528\u30C4\u30FC\u30EB\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002"},builder:{chapter_not_found:"\u6DF1\u3055 %d \u306B\u30DE\u30C3\u30C1\u3059\u308B\u30C1\u30E3\u30D7\u30BF\u30FC\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",image_not_found:"ID: %s \u306B\u30DE\u30C3\u30C1\u3059\u308B\u753B\u50CF\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002",chapter:"\u7B2C%d\u7AE0",chapter_ref:"\u7B2C%d\u7AE0\u300C%s\u300D",list:"\u30EA\u30B9\u30C8%s.%s",table:"\u8868%s.%s"}}}}),require_sprintf=__commonJS({"node_modules/sprintf-js/src/sprintf.js"(e){(function(){"use strict";var n={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(u){return f(d(u),arguments)}function o(u,b){return r.apply(null,[u].concat(b||[]))}function f(u,b){var y=1,B=u.length,C,S="",k,A,F,O,P,$,U,M;for(k=0;k<B;k++)if(typeof u[k]=="string")S+=u[k];else if(typeof u[k]=="object"){if(F=u[k],F.keys)for(C=b[y],A=0;A<F.keys.length;A++){if(C==null)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',F.keys[A],F.keys[A-1]));C=C[F.keys[A]]}else F.param_no?C=b[F.param_no]:C=b[y++];if(n.not_type.test(F.type)&&n.not_primitive.test(F.type)&&C instanceof Function&&(C=C()),n.numeric_arg.test(F.type)&&typeof C!="number"&&isNaN(C))throw new TypeError(r("[sprintf] expecting number but found %T",C));switch(n.number.test(F.type)&&(U=C>=0),F.type){case"b":C=parseInt(C,10).toString(2);break;case"c":C=String.fromCharCode(parseInt(C,10));break;case"d":case"i":C=parseInt(C,10);break;case"j":C=JSON.stringify(C,null,F.width?parseInt(F.width):0);break;case"e":C=F.precision?parseFloat(C).toExponential(F.precision):parseFloat(C).toExponential();break;case"f":C=F.precision?parseFloat(C).toFixed(F.precision):parseFloat(C);break;case"g":C=F.precision?String(Number(C.toPrecision(F.precision))):parseFloat(C);break;case"o":C=(parseInt(C,10)>>>0).toString(8);break;case"s":C=String(C),C=F.precision?C.substring(0,F.precision):C;break;case"t":C=String(!!C),C=F.precision?C.substring(0,F.precision):C;break;case"T":C=Object.prototype.toString.call(C).slice(8,-1).toLowerCase(),C=F.precision?C.substring(0,F.precision):C;break;case"u":C=parseInt(C,10)>>>0;break;case"v":C=C.valueOf(),C=F.precision?C.substring(0,F.precision):C;break;case"x":C=(parseInt(C,10)>>>0).toString(16);break;case"X":C=(parseInt(C,10)>>>0).toString(16).toUpperCase();break}n.json.test(F.type)?S+=C:(n.number.test(F.type)&&(!U||F.sign)?(M=U?"+":"-",C=C.toString().replace(n.sign,"")):M="",P=F.pad_char?F.pad_char==="0"?"0":F.pad_char.charAt(1):" ",$=F.width-(M+C).length,O=F.width&&$>0?P.repeat($):"",S+=F.align?M+C+O:P==="0"?M+O+C:O+M+C)}return S}var c=Object.create(null);function d(u){if(c[u])return c[u];for(var b=u,y,B=[],C=0;b;){if((y=n.text.exec(b))!==null)B.push(y[0]);else if((y=n.modulo.exec(b))!==null)B.push("%");else if((y=n.placeholder.exec(b))!==null){if(y[2]){C|=1;var S=[],k=y[2],A=[];if((A=n.key.exec(k))!==null)for(S.push(A[1]);(k=k.substring(A[0].length))!=="";)if((A=n.key_access.exec(k))!==null)S.push(A[1]);else if((A=n.index_access.exec(k))!==null)S.push(A[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");y[2]=S}else C|=2;if(C===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");B.push({placeholder:y[0],param_no:y[1],keys:y[2],sign:y[3],pad_char:y[4],align:y[5],width:y[6],precision:y[7],type:y[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");b=b.substring(y[0].length)}return c[u]=B}typeof e<"u"&&(e.sprintf=r,e.vsprintf=o),typeof window<"u"&&(window.sprintf=r,window.vsprintf=o,typeof define=="function"&&define.amd&&define(function(){return{sprintf:r,vsprintf:o}}))})()}});function setup2(e="ja"){resource=deepAssign({},langs.en,langs.ja,langs[e])}function t(e,...n){let r=e.split("."),o=resource;if(r.forEach(f=>{o=o[f]}),typeof o!="string")throw new Error(`unknown key: ${e}`);return sprintf(o,...n)}var langs,resource,sprintf,init_i18n=__esm({"lib/i18n/i18n.ts"(){"use strict";init_utils(),init_utils2(),init_en(),init_ja(),langs={ja,en},resource=deepAssign({},langs.en,langs.ja),typeof window<"u"&&window.sprintf?sprintf=window.sprintf:sprintf=require_sprintf().sprintf,isNodeJS?.(),setup2()}}),compilerModel_exports={};__export(compilerModel_exports,{Book:()=>Book2,BookProcess:()=>BookProcess,BuilderProcess:()=>BuilderProcess2,ContentChunk:()=>ContentChunk,Process:()=>Process2,ProcessReport:()=>ProcessReport2,ReportLevel:()=>ReportLevel});var ReportLevel,ProcessReport2,BookProcess,Process2,BuilderProcess2,Book2,ContentChunk,init_compilerModel=__esm({"lib/model/compilerModel.ts"(){"use strict";init_i18n(),init_walker(),ReportLevel=(e=>(e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error",e))(ReportLevel||{}),ProcessReport2=class{constructor(e,n,r,o,f=[]){this.level=e,this.part=n,this.chapter=r,this.message=o,this.nodes=f}},BookProcess=class{constructor(){this.reports=[]}info(e){this.reports.push(new ProcessReport2(0,null,null,e))}warn(e){this.reports.push(new ProcessReport2(1,null,null,e))}error(e){this.reports.push(new ProcessReport2(2,null,null,e))}},Process2=class{constructor(e,n,r){this.part=e,this.chapter=n,this.input=r,this.symbols=[],this.indexCounter={},this.afterProcess=[],this._reports=[]}info(e,...n){this._reports.push(new ProcessReport2(0,this.part,this.chapter,e,n))}warn(e,...n){this._reports.push(new ProcessReport2(1,this.part,this.chapter,e,n))}error(e,...n){this._reports.push(new ProcessReport2(2,this.part,this.chapter,e,n))}nextIndex(e){let n=this.indexCounter[e];return typeof n>"u"?n=1:n++,this.indexCounter[e]=n,n}get reports(){return this._reports.sort((e,n)=>e.nodes.length===0&&n.nodes.length===0?0:e.nodes.length===0?-1:n.nodes.length===0?1:e.nodes[0].location.start.offset-n.nodes[0].location.start.offset)}addSymbol(e){e.chapter=this.chapter,this.symbols.push(e)}get missingSymbols(){let e=[];return this.symbols.forEach(n=>{n.referenceTo&&!n.referenceTo.referenceNode&&e.push(n)}),e}constructReferenceTo(e,n,r=e.symbol,o="|"){let f=n.split(o);if(r==="chapter"){if(f.length!==1){let c=t("compile.args_length_mismatch","1",f.length);return this.error(c,e),null}return{chapterName:f[0],targetSymbol:r}}if(r==="fn"){if(f.length!==1){let c=t("compile.args_length_mismatch","1",f.length);return this.error(c,e),null}return{chapter:this.chapter,chapterName:this.chapter?.name,targetSymbol:r,label:f[0]}}if(r!=="hd"){if(f.length===2)return{chapterName:f[0],targetSymbol:r,label:f[1]};if(f.length===1)return{chapter:this.chapter,chapterName:this.chapter?.name,targetSymbol:r,label:f[0]};{let c=t("compile.args_length_mismatch","1 or 2",f.length);return this.error(c,e),null}}else{if(f.length===2)return{chapterName:f[0],targetSymbol:r,label:f[1]};if(f.length===1)return{chapter:this.chapter,chapterName:this.chapter?.name,targetSymbol:r,label:f[0]};{let c=t("compile.args_hd_path_not_implemented",f.length);return this.error(c,e),null}}}addAfterProcess(e){this.afterProcess.push(e)}doAfterProcess(){this.afterProcess.forEach(e=>e()),this.afterProcess=[]}},BuilderProcess2=class{constructor(e,n){this.builder=e,this.base=n,this.result=""}get info(){return this.base.info.bind(this.base)}get warn(){return this.base.warn.bind(this.base)}get error(){return this.base.error.bind(this.base)}out(e){return this.result+=this.builder.escape(e),this}outRaw(e){return this.result+=e,this}pushOut(e){return this.result=e+this.result,this}get input(){return this.base.input}get symbols(){return this.base.symbols}findChapter(e){return this.base.chapter.book.allChunks.filter(o=>{if(o.name.substr(0,o.name.lastIndexOf(".re"))===e)return!0;let c=null;return visit(o.tree.ast,{visitDefaultPre:(d,u)=>!c,visitChapterPre:(d,u)=>(c=d,!1)}),c&&c.headline.label?c.headline.label.arg===e:!1})[0]}findImageFile(e){let n=(this.base.part||this.base.chapter).book.config,r=[];return(()=>{let f=["images/"],c=[this.builder.extention+"/",""],d=[!0,!1],u=(this.base.chapter||this.base.part).name;u=u.substring(0,u.lastIndexOf("."));let b=["/","-"],y=["png","jpg","jpeg","gif"];f.forEach(B=>{c.forEach(C=>{d.forEach(S=>{b.forEach(k=>{y.forEach(A=>{let F="";F+=B,F+=C,S&&(F+=u,F+=k),F+=e+"."+A,r.indexOf(F)===-1&&r.push(F)})})})})})})(),new Promise((f,c)=>{let d=()=>{if(r.length===0){c(e);return}let u=r.shift();n.exists(u).then(b=>{if(b.result){f(b.path);return}d()})};d()})}},Book2=class{constructor(e){this.config=e,this.process=new BookProcess,this.predef=[],this.contents=[],this.appendix=[],this.postdef=[]}get allChunks(){let e=[],n=r=>{e.push(r),r.nodes.forEach(o=>n(o))};return this.predef.forEach(r=>n(r)),this.contents.forEach(r=>n(r)),this.appendix.forEach(r=>n(r)),this.postdef.forEach(r=>n(r)),e}get reports(){let e=[];e=e.concat(this.process.reports);let n=r=>{e=e.concat(r.process.reports),r.nodes.forEach(o=>n(o))};return this.predef.forEach(r=>n(r)),this.contents.forEach(r=>n(r)),this.appendix.forEach(r=>n(r)),this.postdef.forEach(r=>n(r)),e}get hasError(){return this.reports.some(e=>e.level===2)}get hasWarning(){return this.reports.some(e=>e.level===1)}},ContentChunk=class nu{constructor(n,r,o){this.book=n,this.nodes=[],this.builderProcesses=[],r instanceof nu?(this.parent=r,this.name=o):typeof o=="string"?this.name=o:this.name=r;let f=r||null,c=this;this.process=new Process2(f,c,null)}get input(){return this._input}set input(n){this._input=n,this.process.input=n}createBuilderProcess(n){let r=new BuilderProcess2(n,this.process);return this.builderProcesses.push(r),r}findResultByBuilder(n){let r;return typeof n=="string"?r=this.builderProcesses.filter(o=>o.builder.name===n):r=this.builderProcesses.filter(o=>o.builder===n),r[0].result}}}}),__createBinding=exports&&exports.__createBinding||(Object.create?function(e,n,r,o){o===void 0&&(o=r);var f=Object.getOwnPropertyDescriptor(n,r);(!f||("get"in f?!n.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(e,o,f)}:function(e,n,r,o){o===void 0&&(o=r),e[o]=n[r]}),__exportStar=exports&&exports.__exportStar||function(e,n){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(n,r)&&__createBinding(n,e,r)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SyntaxType=exports.TextBuilder=exports.HtmlBuilder=exports.DefaultBuilder=exports.DefaultValidator=exports.DefaultAnalyzer=exports.AcceptableSyntaxes=exports.SyntaxTree=exports.ProcessReport=exports.ReportLevel=exports.ContentChunk=exports.Book=void 0,exports.start=start2;var compilerModel_1=(init_compilerModel(),__toCommonJS(compilerModel_exports));Object.defineProperty(exports,"Book",{enumerable:!0,get:function(){return compilerModel_1.Book}}),Object.defineProperty(exports,"ContentChunk",{enumerable:!0,get:function(){return compilerModel_1.ContentChunk}}),Object.defineProperty(exports,"ReportLevel",{enumerable:!0,get:function(){return compilerModel_1.ReportLevel}}),Object.defineProperty(exports,"ProcessReport",{enumerable:!0,get:function(){return compilerModel_1.ProcessReport}});var controller_1=(init_controller(),__toCommonJS(controller_exports)),parser_1=(init_parser(),__toCommonJS(parser_exports));Object.defineProperty(exports,"SyntaxTree",{enumerable:!0,get:function(){return parser_1.SyntaxTree}}),__exportStar((init_parser(),__toCommonJS(parser_exports)),exports);var analyzer_1=(init_analyzer(),__toCommonJS(analyzer_exports));Object.defineProperty(exports,"AcceptableSyntaxes",{enumerable:!0,get:function(){return analyzer_1.AcceptableSyntaxes}}),Object.defineProperty(exports,"DefaultAnalyzer",{enumerable:!0,get:function(){return analyzer_1.DefaultAnalyzer}});var validator_1=(init_validator(),__toCommonJS(validator_exports));Object.defineProperty(exports,"DefaultValidator",{enumerable:!0,get:function(){return validator_1.DefaultValidator}});var builder_1=(init_builder(),__toCommonJS(builder_exports));Object.defineProperty(exports,"DefaultBuilder",{enumerable:!0,get:function(){return builder_1.DefaultBuilder}});var htmlBuilder_1=(init_htmlBuilder(),__toCommonJS(htmlBuilder_exports));Object.defineProperty(exports,"HtmlBuilder",{enumerable:!0,get:function(){return htmlBuilder_1.HtmlBuilder}});var textBuilder_1=(init_textBuilder(),__toCommonJS(textBuilder_exports));Object.defineProperty(exports,"TextBuilder",{enumerable:!0,get:function(){return textBuilder_1.TextBuilder}});var analyzer_2=(init_analyzer(),__toCommonJS(analyzer_exports));Object.defineProperty(exports,"SyntaxType",{enumerable:!0,get:function(){return analyzer_2.SyntaxType}});function start2(e,n){"use strict";var r=new controller_1.Controller(n);return e(r),r.process()}
