!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ReVIEW=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.DefaultBuilder=void 0;var i18n_1=require("../i18n/i18n"),exception_1=require("../js/exception"),parser_1=require("../parser/parser"),walker_1=require("../parser/walker"),utils_1=require("../utils/utils"),require=(()=>{function DefaultBuilder(){this.extention="bug"}return Object.defineProperty(DefaultBuilder.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),DefaultBuilder.prototype.init=function(book){var _this=this;return this.book=book,Promise.all(book.allChunks.map(function(chunk){return _this.processAst(chunk)})).then(function(){return null})},DefaultBuilder.prototype.getDefaultVisitorArg=function(process){var _this=this;return{visitDefaultPre:function(_node){},visitChapterPre:function(node){return _this.chapterPre(process,node)},visitChapterPost:function(node){return _this.chapterPost(process,node)},visitHeadlinePre:function(node){return _this.headlinePre(process,"hd",node)},visitHeadlinePost:function(node){return _this.headlinePost(process,"hd",node)},visitColumnPre:function(node){return _this.columnPre(process,node)},visitColumnPost:function(node){return _this.columnPost(process,node)},visitColumnHeadlinePre:function(node){return _this.columnHeadlinePre(process,node)},visitColumnHeadlinePost:function(node){return _this.columnHeadlinePost(process,node)},visitParagraphPre:function(node){return _this.paragraphPre(process,"p",node)},visitParagraphPost:function(node){return _this.paragraphPost(process,"p",node)},visitUlistPre:function(node){return _this.ulistPre(process,"ul",node)},visitUlistPost:function(node){return _this.ulistPost(process,"ul",node)},visitOlistPre:function(node){return _this.olistPre(process,"ol",node)},visitOlistPost:function(node){return _this.olistPost(process,"ol",node)},visitDlistPre:function(node){return _this.dlistPre(process,"dl",node)},visitDlistPost:function(node){return _this.dlistPost(process,"dl",node)},visitBlockElementPre:function(node){return _this.blockPre(process,node.symbol,node)},visitBlockElementPost:function(node){return _this.blockPost(process,node.symbol,node)},visitInlineElementPre:function(node){return _this.inlinePre(process,node.symbol,node)},visitInlineElementPost:function(node){return _this.inlinePost(process,node.symbol,node)},visitTextPre:function(node){_this.text(process,node)},visitSingleLineCommentPre:function(node){_this.singleLineComment(process,node)}}},DefaultBuilder.prototype.processAst=function(chunk){var _this=this,process=chunk.createBuilderProcess(this);return(0,walker_1.visitAsync)(chunk.tree.ast,this.getDefaultVisitorArg(process)).then(function(){return _this.processPost(process,chunk),Promise.all(chunk.nodes.map(function(chunk){return _this.processAst(chunk)})).then(function(){return null})})},DefaultBuilder.prototype.escape=function(_data){throw new Error("please override this method")},DefaultBuilder.prototype.getChapterTitle=function(process,chapter){var chapterNode=null;return(0,walker_1.visit)(chapter.tree.ast,{visitDefaultPre:function(_node,_parent){return!chapterNode},visitChapterPre:function(node,_parent){return chapterNode=node,!1}}),chapterNode?(0,utils_1.nodeContentToString)(process,chapterNode.headline):null},DefaultBuilder.prototype.processPost=function(_process,_chunk){},DefaultBuilder.prototype.chapterPre=function(_process,_node){},DefaultBuilder.prototype.chapterPost=function(_process,_node){},DefaultBuilder.prototype.headlinePre=function(_process,_name,_node){},DefaultBuilder.prototype.headlinePost=function(_process,_name,_node){},DefaultBuilder.prototype.columnPre=function(_process,_node){},DefaultBuilder.prototype.columnPost=function(_process,_node){},DefaultBuilder.prototype.columnHeadlinePre=function(_process,_node){},DefaultBuilder.prototype.columnHeadlinePost=function(_process,_node){},DefaultBuilder.prototype.paragraphPre=function(_process,_name,_node){},DefaultBuilder.prototype.paragraphPost=function(_process,_name,_node){},DefaultBuilder.prototype.ulistPre=function(_process,_name,_node){},DefaultBuilder.prototype.ulistPost=function(_process,_name,_node){},DefaultBuilder.prototype.olistPre=function(_process,_name,_node){},DefaultBuilder.prototype.olistPost=function(_process,_name,_node){},DefaultBuilder.prototype.dlistPre=function(_process,_name,_node){},DefaultBuilder.prototype.dlistPost=function(_process,_name,_node){},DefaultBuilder.prototype.text=function(process,node){process.out(node.text)},DefaultBuilder.prototype.blockPre=function(process,name,node){var func=this["block_".concat(name)];if("function"!=typeof func&&"function"!=typeof(func=this["block_".concat(name,"_pre")]))throw new exception_1.AnalyzerError("block_".concat(name,"_pre or block_").concat(name," is not Function"));return func.call(this,process,node)},DefaultBuilder.prototype.blockPost=function(process,name,node){var func=this["block_".concat(name)];if("function"!=typeof func){if("function"!=typeof(func=this["block_".concat(name,"_post")]))throw new exception_1.AnalyzerError("block_".concat(name,"_post is not Function"));return func.call(this,process,node)}},DefaultBuilder.prototype.inlinePre=function(process,name,node){var func=this["inline_".concat(name)];if("function"!=typeof func&&"function"!=typeof(func=this["inline_".concat(name,"_pre")]))throw new exception_1.AnalyzerError("inline_".concat(name,"_pre or inline_").concat(name," is not Function"));return func.call(this,process,node)},DefaultBuilder.prototype.inlinePost=function(process,name,node){var func=this["inline_".concat(name)];if("function"!=typeof func){if("function"!=typeof(func=this["inline_".concat(name,"_post")]))throw new exception_1.AnalyzerError("inline_".concat(name,"_post is not Function"));return func.call(this,process,node)}},DefaultBuilder.prototype.ulistParentHelper=function(process,node,action,currentLevel){1===(currentLevel=void 0===currentLevel?node.level:currentLevel)||(0,utils_1.findUp)(node.parentNode,function(n){return n instanceof parser_1.UlistElementSyntaxTree&&n.level===currentLevel-1})||(action(),this.ulistParentHelper(process,node,action,currentLevel-1))},DefaultBuilder.prototype.findReference=function(process,node){process=process.symbols.filter(function(symbol){return symbol.node===node});if(1!==process.length)throw new exception_1.AnalyzerError("invalid status.");return process[0]},DefaultBuilder.prototype.inline_hd_pre=function(process,node){process.out("「");var _a=null==(_a=null==(_a=this.findReference(process,node).referenceTo)?void 0:_a.referenceNode)?void 0:_a.parentNode.toChapter();return _a?(1===_a.level?process.out(_a.fqn).out("章 "):process.out(_a.fqn).out(" "),(0,walker_1.visit)(_a.headline.caption,this.getDefaultVisitorArg(process))):process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1},DefaultBuilder.prototype.inline_hd_post=function(process,_node){process.out("」")},DefaultBuilder.prototype.block_raw=function(process,node){var _this=this,node=(0,utils_1.nodeContentToString)(process,node.args[0]),matches=node.match(/\|(.+)\|/);return matches&&matches[1]?matches[1].split(",").some(function(name){return _this.name.toLowerCase()==="".concat(name,"builder")})&&process.outRaw(node.substring(matches[0].length)):process.outRaw(node),!1},DefaultBuilder.prototype.inline_raw=function(process,node){var _this=this,node=(0,utils_1.nodeContentToString)(process,node),matches=node.match(/\|(.+)\|/);return matches&&matches[1]?matches[1].split(",").some(function(name){return _this.name.toLowerCase()==="".concat(name,"builder")})&&process.outRaw(node.substring(matches[0].length)):process.outRaw(node),!1},DefaultBuilder.prototype.singleLineComment=function(_process,_node){},DefaultBuilder.prototype.parseTable=function(tableContents){return this.parseTableContents(this.parseTableLines(tableContents))},DefaultBuilder.prototype.parseTableLines=function(tableContents){var result=[],currentLine=[],lastLineNumber=0<tableContents.length?tableContents[0].location.start.line:0;return tableContents.forEach(function(node){if(node.location.start.line!==lastLineNumber&&(result.push(currentLine),currentLine=[]),lastLineNumber=node.location.start.line,node.isInlineElement())currentLine.push(node.toInlineElement());else{var positionOffset=node.location.start.offset,lineNumberOffset=node.location.start.line,columnOffset=node.location.start.column,text=node.toTextNode().text,currentOffset=0,lineNumber=0;do{var lineEnd=text.indexOf("\n",currentOffset),startLocation={offset:currentOffset+positionOffset,line:lineNumber+lineNumberOffset,column:currentOffset+columnOffset},nextOffset=lineEnd+1,content=lineEnd<0?text.substring(currentOffset):text.substring(currentOffset,nextOffset)}while((currentLine.push({text:content,location:{start:startLocation,end:{offset:startLocation.offset+content.length-1,line:startLocation.line,column:startLocation.column+content.length-1}}}),lastLineNumber=startLocation.line,!(lineEnd<0))&&(result.push(currentLine),currentLine=[],lineNumber++,(currentOffset=nextOffset)<text.length))}}),0<currentLine.length&&result.push(currentLine),result},DefaultBuilder.prototype.parseTableContents=function(lines){for(var rows=[],currentRow=[],currentCell=[],headerRowCount=0,maxColumns=(lines.forEach(function(line,rowNumber){line.forEach(function(node,columnNumber){var lastTokenNumber;node instanceof parser_1.InlineElementSyntaxTree?currentCell.push(node):null!=(columnNumber=1===line.length?node.text.trim():0===columnNumber?node.text.trimStart():columnNumber===line.length-1?node.text.trimEnd():node.text).match(/^(-{12,}|={12,})$/g)?0===headerRowCount&&(headerRowCount=rowNumber):(columnNumber=columnNumber.split(/\t/g),lastTokenNumber=columnNumber.length-1,columnNumber.forEach(function(cell,tokenNumber){(cell.length||currentCell.length)&&(cell="."===cell?"":cell.startsWith("..")?cell.substr(1):cell,currentCell.push(new parser_1.TextNodeSyntaxTree({syntax:"InlineElementContentText",location:node.location,text:cell})),tokenNumber!==lastTokenNumber)&&0<currentCell.length&&(currentRow.push({nodes:currentCell}),currentCell=[])}))}),0<currentCell.length&&(currentRow.push({nodes:currentCell}),currentCell=[]),0<currentRow.length&&(rows.push(currentRow),currentRow=[])}),0<currentCell.length&&currentRow.push({nodes:currentCell}),0<currentRow.length&&rows.push(currentRow),0),_i=0,_a=rows.map(function(cells){return cells.length});_i<_a.length;_i++){var columns=_a[_i];maxColumns<columns&&(maxColumns=columns)}return rows.forEach(function(row){for(var _a,cell=row[row.length-1],location=cell.nodes[cell.nodes.length-1].location,c=row.length;c<maxColumns;c++)row.push({nodes:[new parser_1.TextNodeSyntaxTree({syntax:"InlineElementContentText",location:{start:{line:location.start.line,column:location.start.column,offset:location.start.offset},end:{line:null==(_a=location.end)?void 0:_a.line,column:null==(_a=location.end)?void 0:_a.column,offset:null==(_a=location.end)?void 0:_a.offset}},text:""})]})}),{cells:rows,headerRowCount:headerRowCount}},DefaultBuilder})();exports.DefaultBuilder=require},{"../i18n/i18n":8,"../js/exception":12,"../parser/parser":15,"../parser/walker":18,"../utils/utils":20}],2:[function(require,module,exports){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),i18n_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlBuilder=void 0,require("../i18n/i18n")),builder_1=require("./builder"),parser_1=require("../parser/parser"),walker_1=require("../parser/walker"),utils_1=require("../utils/utils"),require=(_super=>{function HtmlBuilder(standalone){void 0===standalone&&(standalone=!0);var _this=_super.call(this)||this;return _this.standalone=standalone,_this.extention="html",_this.escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},_this}return __extends(HtmlBuilder,_super),HtmlBuilder.prototype.escape=function(data){var _this=this,regexp=new RegExp("[".concat(Object.keys(this.escapeMap).join(""),"]"),"g");return String(data).replace(regexp,function(c){return _this.escapeMap[c]})},HtmlBuilder.prototype.normalizeId=function(label){return label.match(/^[a-z][a-z0-9_/-]*$/i)?label:label.match(/^[0-9_.-][a-z0-9_.-]*$/i)?"id_".concat(label):"id_".concat(encodeURIComponent(label.replace(/_/g,"__").replace(/ /g,"-")).replace(/%/g,"_").replace(/\+/g,"-"))},HtmlBuilder.prototype.processPost=function(process,chunk){var pre,name_1;this.standalone&&(pre="",pre+='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="ja">\n<head>\n  <meta charset="UTF-8" />\n  <link rel="stylesheet" type="text/css" href="stylesheet.css" />\n  <meta name="generator" content="Re:VIEW" />\n',(name_1=null,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(){},visitChapterPre:function(node){1===node.headline.level&&(name_1=(0,utils_1.nodeContentToString)(process,node.headline.caption,!0))}}),pre+="  <title>"+this.escape(name_1)+"</title>\n",process.pushOut(pre=pre+"</head>\n"+"<body>\n"),process.outRaw("</body>\n"),process.outRaw("</html>\n"))},HtmlBuilder.prototype.headlinePre=function(process,_name,node){var text;process.outRaw("<h").out(node.level),node.label&&process.outRaw(' id="').out(this.normalizeId(node.label.arg)).outRaw('"'),process.outRaw(">"),process.outRaw('<a id="h').out((0,utils_1.getHeadlineLevels)(node).join("-")).outRaw('"></a>'),1===node.level?(text=(0,i18n_1.t)("builder.chapter",node.parentNode.no),process.outRaw('<span class="secno">'),process.out(text).out("　"),process.outRaw("</span>")):node.level<4&&process.out((0,utils_1.getHeadlineLevels)(node).join(".")).out("　")},HtmlBuilder.prototype.headlinePost=function(process,_name,node){process.outRaw("</h").out(node.level).outRaw(">\n")},HtmlBuilder.prototype.columnPre=function(process,_node){process.outRaw('<div class="column">\n\n')},HtmlBuilder.prototype.columnPost=function(process,_node){process.outRaw("</div>\n")},HtmlBuilder.prototype.columnHeadlinePre=function(process,node){return process.outRaw("<h").out(node.level),node.label&&process.outRaw(' id="').out(this.normalizeId(node.label.arg)).outRaw('"'),process.outRaw(">"),process.outRaw('<a id="column-').out(node.parentNode.no).outRaw('"></a>'),function(v){(0,walker_1.visit)(node.caption,v)}},HtmlBuilder.prototype.columnHeadlinePost=function(process,node){process.outRaw("</h").out(node.level).outRaw(">\n")},HtmlBuilder.prototype.paragraphPre=function(process,_name,node){node.prev&&node.prev.isBlockElement()&&"noindent"===node.prev.toBlockElement().symbol?process.outRaw('<p class="noindent">'):process.outRaw("<p>")},HtmlBuilder.prototype.paragraphPost=function(process,_name,_node){process.outRaw("</p>\n")},HtmlBuilder.prototype.ulistPre=function(process,_name,node){this.ulistParentHelper(process,node,function(){process.outRaw("<ul>\n<li>")}),node.prev instanceof parser_1.UlistElementSyntaxTree==!1&&process.outRaw("<ul>\n"),process.outRaw("<li>")},HtmlBuilder.prototype.ulistPost=function(process,_name,node){process.outRaw("</li>\n"),node.next instanceof parser_1.UlistElementSyntaxTree==!1&&process.outRaw("</ul>\n"),this.ulistParentHelper(process,node,function(){process.outRaw("</li>\n</ul>\n")})},HtmlBuilder.prototype.olistPre=function(process,_name,node){node.prev instanceof parser_1.OlistElementSyntaxTree==!1&&process.outRaw("<ol>\n"),process.outRaw("<li>")},HtmlBuilder.prototype.olistPost=function(process,_name,node){process.outRaw("</li>\n"),node.next instanceof parser_1.OlistElementSyntaxTree==!1&&process.outRaw("</ol>\n")},HtmlBuilder.prototype.dlistPre=function(process,_name,node){return node.prev instanceof parser_1.DlistElementSyntaxTree==!1&&process.outRaw("<dl>\n"),function(v){process.outRaw("<dt>"),(0,walker_1.visit)(node.text,v),process.outRaw("</dt>\n"),process.outRaw("<dd>"),(0,walker_1.visit)(node.content,v),process.outRaw("</dd>\n")}},HtmlBuilder.prototype.dlistPost=function(process,_name,node){node.next instanceof parser_1.DlistElementSyntaxTree==!1&&process.outRaw("</dl>\n")},HtmlBuilder.prototype.block_list_pre=function(process,node){process.outRaw('<div class="caption-code">\n');var chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.list",chapter.fqn,node.no),process.outRaw('<p class="caption">').out(chapter).outRaw(": "),function(v){(0,walker_1.visit)(node.args[1],v),process.outRaw("</p>\n"),process.outRaw('<pre class="list">');var nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n")})}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},HtmlBuilder.prototype.block_list_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.block_listnum_pre=function(process,node){process.outRaw('<div class="code">\n');var lineCount,chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.list",chapter.fqn,node.no),process.outRaw('<p class="caption">').out(chapter).out(": "),lineCount=1,function(v){(0,walker_1.visit)(node.args[1],v),process.outRaw("</p>\n"),process.outRaw('<pre class="list">');var lineCountMax=0,lineDigit=(node.childNodes.forEach(function(node){node.isTextNode()&&(lineCountMax+=node.toTextNode().text.split("\n").length)}),Math.max((0,utils_1.linesToFigure)(lineCountMax),2)),nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node,index,childNodes){var hasNext_1,lines_1;node.isTextNode()?(hasNext_1=!!childNodes[index+1],(lines_1=node.toTextNode().text.split("\n")).forEach(function(line,index){process.out((0,utils_1.padLeft)(String(lineCount)," ",lineDigit)).out(": "),process.out(line),hasNext_1&&lines_1.length-1===index||lineCount++,lines_1.length-1!==index&&process.out("\n")})):(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n"),lineCount++})}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},HtmlBuilder.prototype.block_listnum_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.inline_list=function(process,node){var listNode,chapter=(0,utils_1.findChapter)(node,1);return chapter?(listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),chapter=(0,i18n_1.t)("builder.list",chapter.fqn,listNode.no),process.out(chapter)):process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1},HtmlBuilder.prototype.block_emlist_pre=function(process,node){return process.outRaw('<div class="emlist-code">\n'),function(v){node.args[0]&&(process.outRaw('<p class="caption">'),(0,walker_1.visit)(node.args[0],v),process.outRaw("</p>\n")),process.outRaw('<pre class="emlist">');var nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n")})}},HtmlBuilder.prototype.block_emlist_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.block_emlistnum_pre=function(process,node){process.outRaw('<div class="emlistnum-code">\n'),process.outRaw('<pre class="emlist">');var lineCount=1;return function(v){var lineCountMax=0,lineDigit=(node.childNodes.forEach(function(node){node.isTextNode()&&(lineCountMax+=node.toTextNode().text.split("\n").length)}),Math.max((0,utils_1.linesToFigure)(lineCountMax),2)),nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node,index,childNodes){var hasNext_2,lines_2;node.isTextNode()?(hasNext_2=!!childNodes[index+1],(lines_2=node.toTextNode().text.split("\n")).forEach(function(line,index){process.out((0,utils_1.padLeft)(String(lineCount)," ",lineDigit)).out(": "),process.out(line),hasNext_2&&lines_2.length-1===index||lineCount++,lines_2.length-1!==index&&process.out("\n")})):(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n"),lineCount++})}},HtmlBuilder.prototype.block_emlistnum_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.inline_br=function(process,_node){process.outRaw("<br />")},HtmlBuilder.prototype.inline_b_pre=function(process,_node){process.outRaw("<b>")},HtmlBuilder.prototype.inline_b_post=function(process,_node){process.outRaw("</b>")},HtmlBuilder.prototype.inline_code_pre=function(process,_node){process.outRaw('<code class="inline-code tt">')},HtmlBuilder.prototype.inline_code_post=function(process,_node){process.outRaw("</code>")},HtmlBuilder.prototype.inline_href=function(process,node){var node=(0,utils_1.nodeContentToString)(process,node),text=node;return-1!==node.indexOf(",")&&(text=node.slice(node.indexOf(",")+1).trimLeft(),node=node.slice(0,node.indexOf(","))),process.outRaw('<a href="').outRaw(node).outRaw('" class="link">').out(text).outRaw("</a>"),!1},HtmlBuilder.prototype.block_label=function(process,node){return process.outRaw('<a id="'),process.out((0,utils_1.nodeContentToString)(process,node.args[0])),process.outRaw('"></a>\n'),!1},HtmlBuilder.prototype.inline_tt_pre=function(process,_node){process.outRaw('<code class="tt">')},HtmlBuilder.prototype.inline_tt_post=function(process,_node){process.outRaw("</code>")},HtmlBuilder.prototype.inline_ruby_pre=function(process,node){return process.outRaw("<ruby>"),function(_v){node.childNodes.forEach(function(node){node=(0,utils_1.nodeContentToString)(process,node).split(",");process.out(node[0]),process.outRaw("<rp>（</rp>"),process.outRaw("<rt>").out(node[1]).outRaw("</rt>"),process.outRaw("<rp>）</rp>")})}},HtmlBuilder.prototype.inline_ruby_post=function(process,_node){process.outRaw("</ruby>")},HtmlBuilder.prototype.inline_u_pre=function(process,_node){process.outRaw("<u>")},HtmlBuilder.prototype.inline_u_post=function(process,_node){process.outRaw("</u>")},HtmlBuilder.prototype.inline_kw_pre=function(process,node){return process.outRaw('<b class="kw">'),function(_v){node.childNodes.forEach(function(node){var node=(0,utils_1.nodeContentToString)(process,node).split(","),pre=node[0],node=(node[1]||"").trimLeft();process.out("".concat(pre)),node&&process.out(" (".concat(node,")"))})}},HtmlBuilder.prototype.inline_kw_post=function(process,node){node=(0,utils_1.nodeContentToString)(process,node).split(",")[0];process.outRaw("</b>").outRaw("\x3c!-- IDX:").out(node).outRaw(" --\x3e")},HtmlBuilder.prototype.inline_em_pre=function(process,_node){process.outRaw("<em>")},HtmlBuilder.prototype.inline_em_post=function(process,_node){process.outRaw("</em>")},HtmlBuilder.prototype.block_image=function(process,node){var label=(0,utils_1.nodeContentToString)(process,node.args[0]);return process.findImageFile(label).then(function(imagePath){var result,caption=(0,utils_1.nodeContentToString)(process,node.args[1]),scale=1;return node.args[2]&&(result=new RegExp("scale=(\\d+(?:\\.\\d+))").exec((0,utils_1.nodeContentToString)(process,node.args[2])))&&(scale=parseFloat(result[1])),process.outRaw('<div id="').out(label).outRaw('" class="image">\n'),1!==scale?(result=(result="000".concat(100*scale)).substr(result.length-3),process.outRaw('<img src="'.concat(imagePath,'" alt="')).out(caption).outRaw('" class="width-').out(result).outRaw('per" />\n')):process.outRaw('<img src="'.concat(imagePath,'" alt="')).out(caption).outRaw('" />\n'),process.outRaw('<p class="caption">\n'),process.out("図").out(process.base.chapter.no).out(".").out(node.no).out(": ").out(caption),process.outRaw("\n</p>\n"),process.outRaw("</div>\n"),!1}).catch(function(id){return process.error((0,i18n_1.t)("builder.image_not_found",id),node),!1})},HtmlBuilder.prototype.block_indepimage=function(process,node){var label=(0,utils_1.nodeContentToString)(process,node.args[0]);return process.findImageFile(label).then(function(imagePath){var result,caption="",scale=(node.args[1]&&(caption=(0,utils_1.nodeContentToString)(process,node.args[1])),1);return node.args[2]&&(result=new RegExp("scale=(\\d+(?:\\.\\d+))").exec((0,utils_1.nodeContentToString)(process,node.args[2])))&&(scale=parseFloat(result[1])),process.outRaw('<div class="image">\n'),1!==scale?(result=(result="000".concat(100*scale)).substr(result.length-3),process.outRaw('<img src="'.concat(imagePath,'" alt="')).out(caption).outRaw('" class="width-').out(result).outRaw('per" />\n')):process.outRaw('<img src="'.concat(imagePath,'" alt="')).out(caption).outRaw('" />\n'),node.args[1]&&(process.outRaw('<p class="caption">\n'),process.out("図: ").out(caption),process.outRaw("\n</p>\n")),process.outRaw("</div>\n"),!1})},HtmlBuilder.prototype.block_graph_pre=function(process,node){process.outRaw("<div>\n");var toolName=(0,utils_1.nodeContentToString)(process,node.args[1]);return process.outRaw("<p>graph: ").out(toolName).outRaw("</p>\n"),process.outRaw("<pre>"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},HtmlBuilder.prototype.block_graph_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.inline_img=function(process,node){node=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("図").out(process.base.chapter.no).out(".").out(node.no),!1},HtmlBuilder.prototype.inline_icon=function(process,node){var chapterFileName=process.base.chapter.name,chapterFileName=chapterFileName.substring(0,chapterFileName.length-3),node=(0,utils_1.nodeContentToString)(process,node),chapterFileName="images/"+this.escape(chapterFileName)+"-"+this.escape(node)+".png";return process.outRaw('<img src="'+chapterFileName+'" alt="[').out(node).outRaw(']" />'),!1},HtmlBuilder.prototype.block_footnote=function(process,node){var label=(0,utils_1.nodeContentToString)(process,node.args[0]);return process.outRaw('<div class="footnote" epub:type="footnote" id="fn-').outRaw(label).outRaw('"><p class="footnote">'),process.outRaw("[*").out(node.no).outRaw("] "),function(v){(0,walker_1.visit)(node.args[1],v),process.outRaw("</p></div>\n")}},HtmlBuilder.prototype.inline_fn=function(process,node){var node=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),label=(0,utils_1.nodeContentToString)(process,node.args[0]);return process.outRaw('<a id="fnb-').out(label).outRaw('" href="#fn-').out(label).outRaw('" class="noteref" epub:type="noteref">*').out(node.no).outRaw("</a>"),!1},HtmlBuilder.prototype.block_lead_pre=function(process,_node){process.outRaw('<div class="lead">\n')},HtmlBuilder.prototype.block_lead_post=function(process,_node){process.outRaw("</div>\n")},HtmlBuilder.prototype.inline_tti_pre=function(process,_node){process.outRaw('<code class="tt"><i>')},HtmlBuilder.prototype.inline_tti_post=function(process,_node){process.outRaw("</i></code>")},HtmlBuilder.prototype.inline_ttb_pre=function(process,_node){process.outRaw('<code class="tt"><b>')},HtmlBuilder.prototype.inline_ttb_post=function(process,_node){process.outRaw("</b></code>")},HtmlBuilder.prototype.block_noindent=function(_process,_node){return!1},HtmlBuilder.prototype.block_blankline=function(process,_node){return process.outRaw("<p><br /></p>\n"),!1},HtmlBuilder.prototype.block_source_pre=function(process,node){return process.outRaw('<div class="source-code">\n'),process.outRaw('<p class="caption">').out((0,utils_1.nodeContentToString)(process,node.args[0])).outRaw("</p>\n"),process.outRaw('<pre class="source">'),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},HtmlBuilder.prototype.block_source_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.block_cmd_pre=function(process,node){return process.outRaw('<div class="cmd-code">\n'),process.outRaw('<pre class="cmd">'),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},HtmlBuilder.prototype.block_cmd_post=function(process,_node){process.outRaw("\n</pre>\n").outRaw("</div>\n")},HtmlBuilder.prototype.block_quote_pre=function(process,node){return process.outRaw("<blockquote><p>"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},HtmlBuilder.prototype.block_quote_post=function(process,_node){process.outRaw("</p></blockquote>\n")},HtmlBuilder.prototype.inline_ami_pre=function(process,_node){process.outRaw('<span class="ami">')},HtmlBuilder.prototype.inline_ami_post=function(process,_node){process.outRaw("</span>")},HtmlBuilder.prototype.inline_bou_pre=function(process,_node){process.outRaw('<span class="bou">')},HtmlBuilder.prototype.inline_bou_post=function(process,_node){process.outRaw("</span>")},HtmlBuilder.prototype.inline_del_pre=function(process,_node){process.outRaw("<del>")},HtmlBuilder.prototype.inline_del_post=function(process,_node){process.outRaw("</del>")},HtmlBuilder.prototype.inline_i_pre=function(process,_node){process.outRaw("<i>")},HtmlBuilder.prototype.inline_i_post=function(process,_node){process.outRaw("</i>")},HtmlBuilder.prototype.inline_ins_pre=function(process,_node){process.outRaw("<ins>")},HtmlBuilder.prototype.inline_ins_post=function(process,_node){process.outRaw("</ins>")},HtmlBuilder.prototype.inline_m_pre=function(process,_node){process.outRaw("<span>TODO: ")},HtmlBuilder.prototype.inline_m_post=function(process,_node){process.outRaw("</span>")},HtmlBuilder.prototype.inline_strong_pre=function(process,_node){process.outRaw("<strong>")},HtmlBuilder.prototype.inline_strong_post=function(process,_node){process.outRaw("</strong>")},HtmlBuilder.prototype.inline_tcy_pre=function(process,_node){process.outRaw('<span class="tcy">')},HtmlBuilder.prototype.inline_tcy_post=function(process,_node){process.outRaw("</span>")},HtmlBuilder.prototype.inline_uchar_pre=function(process,_node){process.outRaw("&#x")},HtmlBuilder.prototype.inline_uchar_post=function(process,_node){process.outRaw(";")},HtmlBuilder.prototype.block_table_pre=function(process,node){var table,chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.table",chapter.fqn,node.no),process.outRaw("<div"),null!=node.args[0]&&process.outRaw(' id="').out(this.normalizeId(node.args[0].childNodes[0].toNode().childNodes[0].toTextNode().text)).outRaw('"'),process.outRaw(' class="table">\n'),process.outRaw('<p class="caption">').out(chapter).out(": ").out((0,utils_1.nodeContentToString)(process,node.args[1])).outRaw("</p>\n"),process.outRaw("<table>\n"),table=this.parseTable(node.childNodes),function(v){if(0===table.headerRowCount)table.cells.forEach(function(columns){if(0!==columns.length){process.outRaw("<tr>"),process.outRaw("<th>"),columns[0].nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.outRaw("</th>");for(var c=1;c<columns.length;c++)process.outRaw("<td>"),columns[c].nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.outRaw("</td>");process.outRaw("</tr>\n")}});else{for(var r=0;r<table.headerRowCount;r++)process.outRaw("<tr>"),table.cells[r].forEach(function(columns){process.outRaw("<th>"),columns.nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.outRaw("</th>")}),process.outRaw("</tr>\n");for(;r<table.cells.length;r++)process.outRaw("<tr>"),table.cells[r].forEach(function(columns){process.outRaw("<td>"),columns.nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.outRaw("</td>")}),process.outRaw("</tr>\n")}}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},HtmlBuilder.prototype.block_table_post=function(process,_node){process.outRaw("</table>\n").outRaw("</div>\n")},HtmlBuilder.prototype.inline_table=function(process,node){var listNode,chapter=(0,utils_1.findChapter)(node,1);return chapter?(listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),chapter=(0,i18n_1.t)("builder.table",chapter.fqn,listNode.no),process.outRaw('<span class="tableref">').out(chapter).outRaw("</span>")):process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1},HtmlBuilder.prototype.block_tsize=function(_process,_node){return!1},HtmlBuilder.prototype.block_comment_pre=function(process,node){return!!this.book.config.isDraft&&(process.outRaw('<div class="draft-comment">'),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})})},HtmlBuilder.prototype.block_comment_post=function(process,_node){this.book.config.isDraft&&process.outRaw("</div>\n")},HtmlBuilder.prototype.inline_comment_pre=function(process,_node){return!!this.book.config.isDraft&&(process.outRaw('<span class="draft-comment">'),!0)},HtmlBuilder.prototype.inline_comment_post=function(process,_node){this.book.config.isDraft&&process.outRaw("</span>")},HtmlBuilder.prototype.inline_chap=function(process,node){node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node);return process.out((0,i18n_1.t)("builder.chapter",node.no)),!1},HtmlBuilder.prototype.inline_title=function(process,node){node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node),node=this.getChapterTitle(process,node);return process.out(node),!1},HtmlBuilder.prototype.inline_chapref=function(process,node){var node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node),title=this.getChapterTitle(process,node);return process.out((0,i18n_1.t)("builder.chapter_ref",node.no,title)),!1},HtmlBuilder.prototype.inline_idx=function(process,node){node=(0,utils_1.nodeContentToString)(process,node);return process.out(node).outRaw("\x3c!-- IDX:").out(node).outRaw(" --\x3e"),!1},HtmlBuilder.prototype.inline_hidx=function(process,node){node=(0,utils_1.nodeContentToString)(process,node);return process.outRaw("\x3c!-- IDX:").out(node).outRaw(" --\x3e"),!1},HtmlBuilder.prototype.block_flushright_pre=function(process,node){return process.outRaw('<p class="flushright">'),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},HtmlBuilder.prototype.block_flushright_post=function(process,_node){process.outRaw("</p>\n")},HtmlBuilder.prototype.block_captionblock_pre=function(typename,process,node){process.outRaw('<div class="'.concat(typename,'">\n')),node.args[0]&&(typename=(0,utils_1.nodeContentToString)(process,node.args[0]),process.outRaw('<p class="caption">').out(typename).outRaw("</p>\n"))},HtmlBuilder.prototype.block_captionblock_post=function(_typename,process,_node){process.outRaw("</div>\n")},HtmlBuilder.prototype.block_info_pre=function(process,node){this.block_captionblock_pre("info",process,node)},HtmlBuilder.prototype.block_info_post=function(process,node){this.block_captionblock_post("info",process,node)},HtmlBuilder.prototype.block_note_pre=function(process,node){this.block_captionblock_pre("note",process,node)},HtmlBuilder.prototype.block_note_post=function(process,node){this.block_captionblock_post("note",process,node)},HtmlBuilder.prototype.block_memo_pre=function(process,node){this.block_captionblock_pre("memo",process,node)},HtmlBuilder.prototype.block_memo_post=function(process,node){this.block_captionblock_post("memo",process,node)},HtmlBuilder.prototype.block_tip_pre=function(process,node){this.block_captionblock_pre("tip",process,node)},HtmlBuilder.prototype.block_tip_post=function(process,node){this.block_captionblock_post("tip",process,node)},HtmlBuilder.prototype.block_warning_pre=function(process,node){this.block_captionblock_pre("warning",process,node)},HtmlBuilder.prototype.block_warning_post=function(process,node){this.block_captionblock_post("warning",process,node)},HtmlBuilder.prototype.block_important_pre=function(process,node){this.block_captionblock_pre("important",process,node)},HtmlBuilder.prototype.block_important_post=function(process,node){this.block_captionblock_post("important",process,node)},HtmlBuilder.prototype.block_caution_pre=function(process,node){this.block_captionblock_pre("caution",process,node)},HtmlBuilder.prototype.block_caution_post=function(process,node){this.block_captionblock_post("caution",process,node)},HtmlBuilder.prototype.block_notice_pre=function(process,node){this.block_captionblock_pre("notice",process,node)},HtmlBuilder.prototype.block_notice_post=function(process,node){this.block_captionblock_post("notice",process,node)},HtmlBuilder})(builder_1.DefaultBuilder);exports.HtmlBuilder=require},{"../i18n/i18n":8,"../parser/parser":15,"../parser/walker":18,"../utils/utils":20,"./builder":1}],3:[function(require,module,exports){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),builder_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextBuilder=void 0,require("./builder")),i18n_1=require("../i18n/i18n"),parser_1=require("../parser/parser"),walker_1=require("../parser/walker"),utils_1=require("../utils/utils"),require=(_super=>{function TextBuilder(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.extention="txt",_this}return __extends(TextBuilder,_super),TextBuilder.prototype.escape=function(data){return data},TextBuilder.prototype.headlinePre=function(process,_name,node){var text;process.out("■H").out(node.level).out("■"),1===node.level?(text=(0,i18n_1.t)("builder.chapter",node.parentNode.no),process.out(text).out("　")):node.level<4&&process.out((0,utils_1.getHeadlineLevels)(node).join(".")).out("　")},TextBuilder.prototype.headlinePost=function(process,_name,_node){process.out("\n\n")},TextBuilder.prototype.columnHeadlinePre=function(process,node){return process.out("\n◆→開始:コラム←◆\n"),process.out("■"),function(v){(0,walker_1.visit)(node.caption,v)}},TextBuilder.prototype.columnHeadlinePost=function(process,_node){process.out("\n")},TextBuilder.prototype.columnPost=function(process,_node){process.out("◆→終了:コラム←◆\n\n")},TextBuilder.prototype.paragraphPost=function(process,_name,_node){process.out("\n")},TextBuilder.prototype.ulistPre=function(process,_name,node){this.ulistParentHelper(process,node,function(){process.out("\n\n●\t")}),node.parentNode instanceof parser_1.UlistElementSyntaxTree&&node.prev instanceof parser_1.UlistElementSyntaxTree==!1?process.out("\n\n"):node.parentNode instanceof parser_1.UlistElementSyntaxTree&&process.out(""),process.out("●\t")},TextBuilder.prototype.ulistPost=function(process,_name,_node){process.out("\n")},TextBuilder.prototype.olistPre=function(process,_name,node){process.out(node.no).out("\t")},TextBuilder.prototype.olistPost=function(process,_name,_node){process.out("\n")},TextBuilder.prototype.dlistPre=function(process,_name,node){return function(v){process.out("★"),(0,walker_1.visit)(node.text,v),process.out("☆\n"),process.out("\t"),(0,walker_1.visit)(node.content,v),process.out("\n")}},TextBuilder.prototype.dlistPost=function(process,_name,_node){process.out("\n")},TextBuilder.prototype.block_list_pre=function(process,node){process.out("◆→開始:リスト←◆\n");var chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.list",chapter.fqn,node.no),process.out(chapter).out("　"),function(v){(0,walker_1.visit)(node.args[1],v),process.outRaw("\n\n");var nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n")})}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},TextBuilder.prototype.block_list_post=function(process,_node){process.out("\n◆→終了:リスト←◆\n")},TextBuilder.prototype.block_listnum_pre=function(process,node){process.out("◆→開始:リスト←◆\n");var lineCount,chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.list",chapter.fqn,node.no),process.out(chapter).out("　"),lineCount=1,function(v){(0,walker_1.visit)(node.args[1],v);var lineCountMax=0,lineDigit=(node.childNodes.forEach(function(node,_index,_childNodes){node.isTextNode()&&(lineCountMax+=node.toTextNode().text.split("\n").length)}),Math.max((0,utils_1.linesToFigure)(lineCountMax),2));process.outRaw("\n\n"),node.childNodes.forEach(function(node,index,childNodes){var hasNext_1,lines_1;node.isTextNode()?(hasNext_1=!!childNodes[index+1],(lines_1=node.toTextNode().text.split("\n")).forEach(function(line,index){process.out((0,utils_1.padLeft)(String(lineCount)," ",lineDigit)).out(": "),process.out(line),hasNext_1&&lines_1.length-1===index||lineCount++,process.out("\n")})):(0,walker_1.visit)(node,v),lineCount++})}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},TextBuilder.prototype.block_listnum_post=function(process,_node){process.out("◆→終了:リスト←◆\n")},TextBuilder.prototype.inline_list=function(process,node){var listNode,chapter=(0,utils_1.findChapter)(node,1);return chapter?(listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),chapter=(0,i18n_1.t)("builder.list",chapter.fqn,listNode.no),process.out(chapter)):process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1},TextBuilder.prototype.block_emlist_pre=function(process,node){return process.out("◆→開始:インラインリスト←◆\n"),function(v){node.args[0]&&(process.out("■"),(0,walker_1.visit)(node.args[0],v),process.out("\n"));var nodeCount=node.childNodes.length,nodeIndex=0;node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v),++nodeIndex<nodeCount&&process.out("\n")})}},TextBuilder.prototype.block_emlist_post=function(process,_node){process.out("\n◆→終了:インラインリスト←◆\n")},TextBuilder.prototype.block_emlistnum_pre=function(process,node){process.out("◆→開始:インラインリスト←◆\n");var lineCount=1;return function(v){node.args[0]&&(process.out("■"),(0,walker_1.visit)(node.args[0],v),process.out("\n"));var lineCountMax=0,lineDigit=(node.childNodes.forEach(function(node,_index,_childNodes){node.isTextNode()&&(lineCountMax+=node.toTextNode().text.split("\n").length)}),Math.max((0,utils_1.linesToFigure)(lineCountMax),2));node.childNodes.forEach(function(node,index,childNodes){var hasNext_2,lines_2;node.isTextNode()?(hasNext_2=!!childNodes[index+1],(lines_2=node.toTextNode().text.split("\n")).forEach(function(line,index){process.out((0,utils_1.padLeft)(String(lineCount)," ",lineDigit)).out(": "),process.out(line),hasNext_2&&lines_2.length-1===index||lineCount++,process.out("\n")})):(0,walker_1.visit)(node,v),lineCount++})}},TextBuilder.prototype.block_emlistnum_post=function(process,_node){process.out("◆→終了:インラインリスト←◆\n")},TextBuilder.prototype.inline_br=function(process,_node){process.out("\n")},TextBuilder.prototype.inline_b_pre=function(process,_node){process.out("★")},TextBuilder.prototype.inline_b_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_code_pre=function(process,_node){process.out("△")},TextBuilder.prototype.inline_code_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_href_pre=function(process,_node){process.out("△")},TextBuilder.prototype.inline_href_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_href=function(process,node){var href=null,node=(0,utils_1.nodeContentToString)(process,node);return-1!==node.indexOf(",")&&(href=node.slice(0,node.indexOf(",")),node=node.slice(node.indexOf(",")+1).trimLeft()),href?process.out(node).out("（△").out(href).out("☆）"):process.out("△").out(node).out("☆"),!1},TextBuilder.prototype.block_label=function(_process,_node){return!1},TextBuilder.prototype.inline_ruby=function(process,node){var keywordData=(0,utils_1.nodeContentToString)(process,node).split(",");return process.out(keywordData[0]),function(_v){node.childNodes.forEach(function(_node){process.out("◆→DTP連絡:「").out(keywordData[0]),process.out("」に「 ").out(keywordData[1].trim()).out("」とルビ←◆")})}},TextBuilder.prototype.inline_u_pre=function(process,_node){process.out("＠")},TextBuilder.prototype.inline_u_post=function(process,_node){process.out("＠◆→＠〜＠部分に下線←◆")},TextBuilder.prototype.inline_kw=function(process,node){return process.out("★"),function(_v){node.childNodes.forEach(function(node){var node=(0,utils_1.nodeContentToString)(process,node).split(","),pre=node[0],node=(node[1]||"").trimLeft();process.out("".concat(pre,"☆")),node&&process.out("（".concat(node,"）"))})}},TextBuilder.prototype.inline_tt_pre=function(process,_node){process.out("△")},TextBuilder.prototype.inline_tt_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_em_pre=function(process,node){process.warn((0,i18n_1.t)("compile.deprecated_inline_symbol","em"),node),process.out("@<em>{")},TextBuilder.prototype.inline_em_post=function(process,_node){process.out("}")},TextBuilder.prototype.block_image=function(process,node){var label=(0,utils_1.nodeContentToString)(process,node.args[0]);return process.findImageFile(label).then(function(imagePath){var caption=(0,utils_1.nodeContentToString)(process,node.args[1]);return process.out("◆→開始:図←◆\n"),process.out("図").out(process.base.chapter.no).out(".").out(node.no).out("　").out(caption).out("\n"),process.out("\n"),process.out("◆→").out(imagePath).out("←◆\n"),process.out("◆→終了:図←◆\n"),!1}).catch(function(id){return process.error((0,i18n_1.t)("builder.image_not_found",id),node),!1})},TextBuilder.prototype.block_indepimage=function(process,node){return process.out("◆→画像 ").out((0,utils_1.nodeContentToString)(process,node.args[0])).out("←◆\n"),node.args[1]&&process.out("図　").out((0,utils_1.nodeContentToString)(process,node.args[1])).out("\n\n"),!1},TextBuilder.prototype.block_graph_pre=function(process,node){process.outRaw("◆→開始:図←◆\n");var toolName=(0,utils_1.nodeContentToString)(process,node.args[1]);return process.outRaw("graph: ").out(toolName).outRaw("</p>\n"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},TextBuilder.prototype.block_graph_post=function(process,_node){process.outRaw("◆→終了:図←◆\n")},TextBuilder.prototype.inline_img=function(process,node){node=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("図").out(process.base.chapter.no).out(".").out(node.no).out("\n"),!1},TextBuilder.prototype.inline_icon=function(process,node){var chapterFileName=process.base.chapter.name,chapterFileName="images/"+chapterFileName.substring(0,chapterFileName.length-3)+"-"+(0,utils_1.nodeContentToString)(process,node)+".png";return process.out("◆→画像 ").out(chapterFileName).out("←◆"),!1},TextBuilder.prototype.block_footnote=function(process,node){return process.out("【注").out(node.no).out("】"),function(v){(0,walker_1.visit)(node.args[1],v),process.out("\n")}},TextBuilder.prototype.inline_fn=function(process,node){node=this.findReference(process,node).referenceTo.referenceNode.toBlockElement();return process.out("【注").out(node.no).out("】"),!1},TextBuilder.prototype.block_lead_pre=function(process,_node){process.out("◆→開始:リード←◆\n")},TextBuilder.prototype.block_lead_post=function(process,_node){process.out("◆→終了:リード←◆\n")},TextBuilder.prototype.inline_tti_pre=function(process,_node){process.out("▲")},TextBuilder.prototype.inline_tti_post=function(process,_node){process.out("☆◆→等幅フォントイタ←◆")},TextBuilder.prototype.inline_ttb_pre=function(process,_node){process.out("★")},TextBuilder.prototype.inline_ttb_post=function(process,_node){process.out("☆◆→等幅フォント太字←◆")},TextBuilder.prototype.block_noindent=function(process,_node){return process.out("◆→DTP連絡:次の1行インデントなし←◆\n"),!1},TextBuilder.prototype.block_blankline=function(process,_node){return process.out("\n"),!1},TextBuilder.prototype.block_source_pre=function(process,node){return process.out("◆→開始:ソースコードリスト←◆\n"),process.out("■").out((0,utils_1.nodeContentToString)(process,node.args[0])).out("\n"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},TextBuilder.prototype.block_source_post=function(process,_node){process.out("\n◆→終了:ソースコードリスト←◆\n")},TextBuilder.prototype.block_cmd_pre=function(process,node){return process.out("◆→開始:コマンド←◆\n"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},TextBuilder.prototype.block_cmd_post=function(process,_node){process.out("\n◆→終了:コマンド←◆\n")},TextBuilder.prototype.block_quote_pre=function(process,node){return process.out("◆→開始:引用←◆\n"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},TextBuilder.prototype.block_quote_post=function(process,_node){process.out("\n◆→終了:引用←◆\n")},TextBuilder.prototype.inline_ami_pre=function(_process,_node){},TextBuilder.prototype.inline_ami_post=function(process,node){process.out("◆→DTP連絡:「").out((0,utils_1.nodeContentToString)(process,node)).out("」に網カケ←◆")},TextBuilder.prototype.inline_bou_pre=function(_process,_node){},TextBuilder.prototype.inline_bou_post=function(process,node){process.out("◆→DTP連絡:「").out((0,utils_1.nodeContentToString)(process,node)).out("」に傍点←◆")},TextBuilder.prototype.inline_del_pre=function(process,_node){process.out("◆→開始:削除表現←◆")},TextBuilder.prototype.inline_del_post=function(process,_node){process.out("◆→終了:削除表現←◆")},TextBuilder.prototype.inline_i_pre=function(process,_node){process.out("▲")},TextBuilder.prototype.inline_i_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_ins_pre=function(process,_node){process.out("◆→開始:挿入表現←◆")},TextBuilder.prototype.inline_ins_post=function(process,_node){process.out("◆→終了:挿入表現←◆")},TextBuilder.prototype.inline_m_pre=function(process,_node){process.outRaw("TODO: ")},TextBuilder.prototype.inline_m_post=function(process,_node){process.outRaw("")},TextBuilder.prototype.inline_strong_pre=function(process,_node){process.out("★")},TextBuilder.prototype.inline_strong_post=function(process,_node){process.out("☆")},TextBuilder.prototype.inline_tcy_pre=function(process,_node){process.out("◆→開始:回転←◆")},TextBuilder.prototype.inline_tcy_post=function(process,_node){process.out("◆→終了:縦回転←◆")},TextBuilder.prototype.inline_uchar=function(process,node){for(var node=(0,utils_1.nodeContentToString)(process,node),code=parseInt(node,16),result="";0!==code;)result=String.fromCharCode(65535&code)+result,code>>>=16;return process.out(result),!1},TextBuilder.prototype.block_table_pre=function(process,node){process.out("\n◆→開始:表←◆\n");var table,chapter=(0,utils_1.findChapter)(node,1);return chapter?(chapter=(0,i18n_1.t)("builder.table",chapter.fqn,node.no),process.out(chapter).out("　").out((0,utils_1.nodeContentToString)(process,node.args[1])).out("\n\n"),table=this.parseTable(node.childNodes),function(v){if(0===table.headerRowCount)table.cells.forEach(function(columns){if(0!==columns.length){process.out("★"),columns[0].nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.out("☆");for(var c=1;c<columns.length;c++)process.outRaw("\t"),columns[c].nodes.forEach(function(node){(0,walker_1.visit)(node,v)});process.outRaw("\n")}});else{for(var r=0;r<table.headerRowCount;r++)(()=>{var columns=table.cells[r];columns.forEach(function(cell,index){process.out("★"),cell.nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),process.out("☆"),index<columns.length-1?process.outRaw("\t"):process.outRaw("\n")})})();for(;r<table.cells.length;r++)(()=>{var columns=table.cells[r];columns.forEach(function(cell,index){cell.nodes.forEach(function(node){(0,walker_1.visit)(node,v)}),index<columns.length-1?process.outRaw("\t"):process.outRaw("\n")})})()}}):(process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1)},TextBuilder.prototype.block_table_post=function(process,_node){process.out("◆→終了:表←◆\n\n")},TextBuilder.prototype.inline_table=function(process,node){var listNode,chapter=(0,utils_1.findChapter)(node,1);return chapter?(listNode=this.findReference(process,node).referenceTo.referenceNode.toBlockElement(),chapter=(0,i18n_1.t)("builder.table",chapter.fqn,listNode.no),process.out(chapter)):process.error((0,i18n_1.t)("builder.chapter_not_found",1),node),!1},TextBuilder.prototype.block_tsize=function(_process,_node){return!1},TextBuilder.prototype.block_comment_pre=function(process,node){return!!this.book.config.isDraft&&(process.out("◆→"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})})},TextBuilder.prototype.block_comment_post=function(process,_node){this.book.config.isDraft&&process.out("←◆\n")},TextBuilder.prototype.inline_comment_pre=function(process,_node){return!!this.book.config.isDraft&&(process.out("◆→"),!0)},TextBuilder.prototype.inline_comment_post=function(process,_node){this.book.config.isDraft&&process.out("←◆")},TextBuilder.prototype.inline_chap=function(process,node){node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node);return process.out("第").out(node.no).out("章"),!1},TextBuilder.prototype.inline_title=function(process,node){node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node),node=this.getChapterTitle(process,node);return process.out(node),!1},TextBuilder.prototype.inline_chapref=function(process,node){var node=(0,utils_1.nodeContentToString)(process,node),node=process.findChapter(node),title=this.getChapterTitle(process,node);return process.out("第").out(node.no).out("章「").out(title).out("」"),!1},TextBuilder.prototype.inline_idx=function(process,node){node=(0,utils_1.nodeContentToString)(process,node);return process.out("".concat(node,"◆→索引項目:").concat(node,"←◆")),!1},TextBuilder.prototype.inline_hidx=function(process,node){node=(0,utils_1.nodeContentToString)(process,node);return process.out("◆→索引項目:".concat(node,"←◆")),!1},TextBuilder.prototype.block_flushright_pre=function(process,node){return process.out("◆→開始:右寄せ←◆\n"),function(v){node.childNodes.forEach(function(node){(0,walker_1.visit)(node,v)})}},TextBuilder.prototype.block_flushright_post=function(process,_node){process.out("\n◆→終了:右寄せ←◆\n")},TextBuilder.prototype.block_captionblock_pre=function(typename,process,node){process.out("◆→開始:".concat(typename,"←◆\n")),node.args[0]&&(typename=(0,utils_1.nodeContentToString)(process,node.args[0]),process.out("■".concat(typename,"\n")))},TextBuilder.prototype.block_captionblock_post=function(typename,process,_node){process.out("◆→終了:".concat(typename,"←◆\n"))},TextBuilder.prototype.block_info_pre=function(process,node){this.block_captionblock_pre("情報",process,node)},TextBuilder.prototype.block_info_post=function(process,node){this.block_captionblock_post("情報",process,node)},TextBuilder.prototype.block_note_pre=function(process,node){this.block_captionblock_pre("ノート",process,node)},TextBuilder.prototype.block_note_post=function(process,node){this.block_captionblock_post("ノート",process,node)},TextBuilder.prototype.block_memo_pre=function(process,node){this.block_captionblock_pre("メモ",process,node)},TextBuilder.prototype.block_memo_post=function(process,node){this.block_captionblock_post("メモ",process,node)},TextBuilder.prototype.block_tip_pre=function(process,node){this.block_captionblock_pre("TIP",process,node)},TextBuilder.prototype.block_tip_post=function(process,node){this.block_captionblock_post("TIP",process,node)},TextBuilder.prototype.block_warning_pre=function(process,node){this.block_captionblock_pre("危険",process,node)},TextBuilder.prototype.block_warning_post=function(process,node){this.block_captionblock_post("危険",process,node)},TextBuilder.prototype.block_important_pre=function(process,node){this.block_captionblock_pre("重要",process,node)},TextBuilder.prototype.block_important_post=function(process,node){this.block_captionblock_post("重要",process,node)},TextBuilder.prototype.block_caution_pre=function(process,node){this.block_captionblock_pre("警告",process,node)},TextBuilder.prototype.block_caution_post=function(process,node){this.block_captionblock_post("警告",process,node)},TextBuilder.prototype.block_notice_pre=function(process,node){this.block_captionblock_pre("注意",process,node)},TextBuilder.prototype.block_notice_post=function(process,node){this.block_captionblock_post("注意",process,node)},TextBuilder})(builder_1.DefaultBuilder);exports.TextBuilder=require},{"../i18n/i18n":8,"../parser/parser":15,"../parser/walker":18,"../utils/utils":20,"./builder":1}],4:[function(require,module,exports){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),builder_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebBrowserConfig=exports.NodeJSConfig=exports.Config=void 0,require("../builder/builder")),configRaw_1=require("./configRaw"),compilerModel_1=require("../model/compilerModel"),analyzer_1=require("../parser/analyzer"),validator_1=require("../parser/validator"),utils_1=require("../utils/utils"),Config=(()=>{function Config(original){this.original=original}return Object.defineProperty(Config.prototype,"isDraft",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"read",{get:function(){throw new Error("please implements this method")},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"write",{get:function(){throw new Error("please implements this method")},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"exists",{get:function(){throw new Error("please implements this method")},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"analyzer",{get:function(){return this.original.analyzer||new analyzer_1.DefaultAnalyzer},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"validators",{get:function(){var config=this.original;return config.validators&&0!==config.validators.length?Array.isArray(config.validators)?config.validators:[config.validators]:[new validator_1.DefaultValidator]},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"builders",{get:function(){var config;return this._builders||((config=this.original).builders&&0!==config.builders.length?Array.isArray(config.builders)?this._builders=config.builders:this._builders=[config.builders]:this._builders=[new builder_1.DefaultBuilder]),this._builders},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"listener",{get:function(){throw new Error("please implements this method")},enumerable:!1,configurable:!0}),Object.defineProperty(Config.prototype,"book",{get:function(){return this._bookStructure||(this._bookStructure=configRaw_1.BookStructure.createBook(this.original.book)),this._bookStructure},enumerable:!1,configurable:!0}),Config.prototype.resolvePath=function(_path){throw new Error("please implements this method")},Config})(),NodeJSConfig=(_super=>{function NodeJSConfig(options,original){var _this=_super.call(this,original)||this;return _this.options=options,_this.original=original,_this}return __extends(NodeJSConfig,_super),Object.defineProperty(NodeJSConfig.prototype,"isDraft",{get:function(){var _a;return null!=(_a=this.options.draft)&&_a},enumerable:!1,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"read",{get:function(){return this.original.read||utils_1.IO.read},enumerable:!1,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"write",{get:function(){return this.original.write||utils_1.IO.write},enumerable:!1,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"exists",{get:function(){var _this=this;return function(path){var fs=require("fs"),_path=require("path"),basePath=_this.original.basePath||__dirname;return new Promise(function(resolve){fs.exists(_path.resolve(basePath,path),function(result){resolve({path:path,result:result})})})}},enumerable:!1,configurable:!0}),Object.defineProperty(NodeJSConfig.prototype,"listener",{get:function(){var listener,_this=this;return this._listener||((listener=this.original.listener||{}).onAcceptables=listener.onAcceptables||function(){},listener.onSymbols=listener.onSymbols||function(){},listener.onReports=listener.onReports||function(b){return _this.onReports(b)},listener.onCompileSuccess=listener.onCompileSuccess||function(b){return _this.onCompileSuccess(b)},listener.onCompileFailed=listener.onCompileFailed||function(){return _this.onCompileFailed()},this._listener=listener),this._listener},enumerable:!1,configurable:!0}),NodeJSConfig.prototype.onReports=function(reports){require("colors").setTheme({info:"cyan",warn:"yellow",error:"red"}),reports.forEach(function(report){var message="";if(report.chapter&&(message+=report.chapter.name+" "),report.nodes&&report.nodes.forEach(function(node){message+="["+node.location.start.line+","+node.location.start.column+"] "}),message+=report.message,report.level===compilerModel_1.ReportLevel.Error)console.warn(message.error);else if(report.level===compilerModel_1.ReportLevel.Warning)console.error(message.warn);else{if(report.level!==compilerModel_1.ReportLevel.Info)throw new Error("unknown report level.");console.info(message.info)}})},NodeJSConfig.prototype.onCompileSuccess=function(_book){var _a;null!=(_a=this.options)&&_a.inproc||process.exit(0)},NodeJSConfig.prototype.onCompileFailed=function(){var _a;null!=(_a=this.options)&&_a.inproc||process.exit(1)},NodeJSConfig.prototype.resolvePath=function(path){var p=require("path"),base=this.options.base||"./";return p.join(base,path)},NodeJSConfig})(exports.Config=Config),NodeJSConfig=(exports.NodeJSConfig=NodeJSConfig,(_super=>{function WebBrowserConfig(options,original){var _this=_super.call(this,original)||this;return _this.options=options,_this.original=original,_this}return __extends(WebBrowserConfig,_super),Object.defineProperty(WebBrowserConfig.prototype,"isDraft",{get:function(){var _a;return null!=(_a=this.options.draft)&&_a},enumerable:!1,configurable:!0}),Object.defineProperty(WebBrowserConfig.prototype,"read",{get:function(){return this.original.read||function(){throw new Error("please implement config.read method")}},enumerable:!1,configurable:!0}),Object.defineProperty(WebBrowserConfig.prototype,"write",{get:function(){return this.original.write||function(){throw new Error("please implement config.write method")}},enumerable:!1,configurable:!0}),Object.defineProperty(WebBrowserConfig.prototype,"exists",{get:function(){var _this=this;return function(path){return"file:"===window.location.protocol?_this._existsFileScheme(path):_this._existsHttpScheme(path)}},enumerable:!1,configurable:!0}),WebBrowserConfig.prototype._existsFileScheme=function(_path){return new Promise(function(resolve){var canvas=document.createElement("canvas");canvas.width=200,canvas.height=14,canvas.getContext("2d").fillText("file://では画像の存在チェックができません",2,10),resolve({path:canvas.toDataURL(),result:!0})})},WebBrowserConfig.prototype._existsHttpScheme=function(path){return new Promise(function(resolve){try{var xhr_1=new XMLHttpRequest;xhr_1.onreadystatechange=function(){4===xhr_1.readyState&&(200===xhr_1.status||304===xhr_1.status?resolve({path:path,result:!0}):resolve({path:path,result:!1}))},xhr_1.open("GET",path),xhr_1.setRequestHeader("If-Modified-Since",(new Date).toUTCString()),xhr_1.send()}catch(e){e instanceof DOMException&&console.log(e.message),resolve({path:path,result:!1})}})},Object.defineProperty(WebBrowserConfig.prototype,"listener",{get:function(){var listener;return this._listener||((listener=this.original.listener||{}).onAcceptables=listener.onAcceptables||function(){},listener.onSymbols=listener.onSymbols||function(){},listener.onReports=listener.onReports||this.onReports,listener.onCompileSuccess=listener.onCompileSuccess||this.onCompileSuccess,listener.onCompileFailed=listener.onCompileFailed||this.onCompileFailed,this._listener=listener),this._listener},enumerable:!1,configurable:!0}),WebBrowserConfig.prototype.onReports=function(reports){reports.forEach(function(report){var message="";if(report.chapter&&(message+=report.chapter.name+" "),report.nodes&&report.nodes.forEach(function(node){message+="["+node.location.start.line+","+node.location.start.column+"] "}),message+=report.message,report.level===compilerModel_1.ReportLevel.Error)console.warn(message);else if(report.level===compilerModel_1.ReportLevel.Warning)console.error(message);else{if(report.level!==compilerModel_1.ReportLevel.Info)throw new Error("unknown report level.");console.info(message)}})},WebBrowserConfig.prototype.onCompileSuccess=function(_book){},WebBrowserConfig.prototype.onCompileFailed=function(_book){},WebBrowserConfig.prototype.resolvePath=function(path){var base;return this.options.base?(base=this.options.base,this.endWith(base,"/")||this.startWith(path,"/")||(base+="/"),base+path):path},WebBrowserConfig.prototype.startWith=function(str,target){return 0===str.indexOf(target)},WebBrowserConfig.prototype.endWith=function(str,target){return-1!==str.indexOf(target,str.length-target.length)},WebBrowserConfig})(Config));exports.WebBrowserConfig=NodeJSConfig},{"../builder/builder":1,"../model/compilerModel":13,"../parser/analyzer":14,"../parser/validator":17,"../utils/utils":20,"./configRaw":5,colors:void 0,fs:void 0,path:void 0}],5:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ContentStructure=exports.BookStructure=void 0;var BookStructure=(()=>{function BookStructure(predef,contents,appendix,postdef){this.predef=predef,this.contents=contents,this.appendix=appendix,this.postdef=postdef,this.predef=this.predef||[],this.contents=this.contents||[],this.appendix=this.appendix||[],this.postdef=this.postdef||[]}return BookStructure.createBook=function(config){return config?new BookStructure((config.predef||config.PREDEF||[]).map(function(v){return ContentStructure.createChapter(v)}),(config.contents||config.CHAPS||[]).map(function(v){return v?"string"==typeof v?ContentStructure.createChapter(v):v.chapter?ContentStructure.createChapter(v.chapter):v.part?ContentStructure.createPart(v.part):"string"==typeof v.file&&v.chapters?ContentStructure.createPart(v):"string"==typeof v.file?ContentStructure.createChapter(v):"object"==typeof v?ContentStructure.createPart({file:Object.keys(v)[0],chapters:v[Object.keys(v)[0]].map(function(c){return{file:c}})}):null:null}),(config.appendix||config.APPENDIX||[]).map(function(v){return ContentStructure.createChapter(v)}),(config.postdef||config.POSTDEF||[]).map(function(v){return ContentStructure.createChapter(v)})):new BookStructure([],[],[],[])},BookStructure})(),ContentStructure=(exports.BookStructure=BookStructure,(()=>{function ContentStructure(part,chapter){this.part=part,this.chapter=chapter}return ContentStructure.createChapter=function(value){return"string"==typeof value?new ContentStructure(null,{file:value}):value&&"string"==typeof value.file?new ContentStructure(null,value):null},ContentStructure.createPart=function(part){return part?new ContentStructure({file:part.file,chapters:(part.chapters||[]).map(function(c){return"string"==typeof c?{file:c}:c})},null):null},ContentStructure})());exports.ContentStructure=ContentStructure},{}],6:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},PEG=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Controller=void 0,__importStar(require("../../resources/grammar"))),compilerModel_1=require("../model/compilerModel"),parser_1=require("../parser/parser"),config_1=require("./config"),configRaw_1=require("./configRaw"),parser_2=require("../parser/parser"),preprocessor_1=require("../parser/preprocessor"),textBuilder_1=require("../builder/textBuilder"),htmlBuilder_1=require("../builder/htmlBuilder"),walker_1=require("../parser/walker"),utils_1=require("../utils/utils"),__importStar=(()=>{function Controller(options){this.options=options=void 0===options?{}:options,this.builders={TextBuilder:textBuilder_1.TextBuilder,HtmlBuilder:htmlBuilder_1.HtmlBuilder}}return Controller.prototype.initConfig=function(data){(0,utils_1.isNodeJS)()?this.config=new config_1.NodeJSConfig(this.options,data):this.config=new config_1.WebBrowserConfig(this.options,data)},Controller.prototype.process=function(){var _this=this;return Promise.resolve(new compilerModel_1.Book(this.config)).then(function(book){return _this.acceptableSyntaxes(book)}).then(function(book){return _this.toContentChunk(book)}).then(function(book){return _this.readReVIEWFiles(book)}).then(function(book){return _this.parseContent(book)}).then(function(book){return _this.preprocessContent(book)}).then(function(book){return _this.processContent(book)}).then(function(book){return _this.writeContent(book)}).then(function(book){return _this.compileFinished(book)}).catch(function(err){return _this.handleError(err)})},Controller.prototype.acceptableSyntaxes=function(book){return book.acceptableSyntaxes=book.config.analyzer.getAcceptableSyntaxes(),!1===book.config.listener.onAcceptables(book.acceptableSyntaxes)?(book.config.listener.onCompileFailed(),Promise.reject(null)):Promise.resolve(book)},Controller.prototype.toContentChunk=function(book){function convert(c,parent){var chunk=null;if(c.part)chunk=new compilerModel_1.ContentChunk(book,c.part.file),c.part.chapters.forEach(function(c){convert(configRaw_1.ContentStructure.createChapter(c),chunk)});else{if(!c.chapter)return null;chunk=new compilerModel_1.ContentChunk(book,parent,c.chapter.file)}return parent&&parent.nodes.push(chunk),chunk}return book.predef=this.config.book.predef.map(function(c){return convert(c)}),book.contents=this.config.book.contents.map(function(c){return convert(c)}),book.appendix=this.config.book.appendix.map(function(c){return convert(c)}),book.postdef=this.config.book.postdef.map(function(c){return convert(c)}),book},Controller.prototype.readReVIEWFiles=function(book){function read(chunk){var resolvedPath=book.config.resolvePath(chunk.name);promises.push(book.config.read(resolvedPath).then(function(input){return chunk.input=input})),chunk.nodes.forEach(read)}var promises=[];return book.predef.forEach(read),book.contents.forEach(read),book.appendix.forEach(read),book.postdef.forEach(read),Promise.all(promises).then(function(){return book})},Controller.prototype.parseContent=function(book){function _parse(chunk){try{chunk.tree=(0,parser_2.parse)(chunk.input)}catch(e){if(!(e instanceof PEG.SyntaxError))throw e;var errorNode=new parser_1.SyntaxTree({syntax:e.name,location:{start:{line:e.line,column:e.column,offset:e.offset},end:void 0}});chunk.tree={ast:errorNode,cst:null}}chunk.nodes.forEach(_parse)}return book.predef.forEach(_parse),book.contents.forEach(_parse),book.appendix.forEach(_parse),book.postdef.forEach(_parse),book},Controller.prototype.preprocessContent=function(book){function numberingChapters(chunks,counter){void 0===counter&&(counter={}),chunks.forEach(function(chunk){return numberingChapter(chunk,counter)})}var numberingChapter=function(chunk,counter){var chapters=[],max=((0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node){},visitChapterPre:function(node){chapters.push(node)}}),0),currentLevel=1;chapters.forEach(function(chapter){var i,level=chapter.headline.level;if(max=Math.max(max,level),level<currentLevel)for(i=level+1;i<=max;i++)counter[i]=0;else if(currentLevel<level)for(i=level;i<=max;i++)counter[i]=0;counter[currentLevel=level]=(counter[level]||0)+1,chapter.no=counter[level]}),chunk.no=counter[1],chunk.nodes.forEach(function(chunk){return numberingChapter(chunk,counter)})};return numberingChapters(book.predef),numberingChapters(book.contents),numberingChapters(book.appendix),numberingChapters(book.postdef),(new preprocessor_1.SyntaxPreprocessor).start(book),book},Controller.prototype.processContent=function(book){var symbols,_this=this;return book.config.validators.forEach(function(validator){validator.start(book,book.acceptableSyntaxes,_this.config.builders)}),book.reports.some(function(report){return report.level===compilerModel_1.ReportLevel.Error})||(symbols=book.allChunks.reduce(function(p,c){return p.concat(c.process.symbols)},[]),!1===this.config.listener.onSymbols(symbols))?Promise.resolve(book):Promise.all(this.config.builders.map(function(builder){return builder.init(book)})).then(function(){return book})},Controller.prototype.writeContent=function(book){function write(chunk){chunk.builderProcesses.forEach(function(process){var fileName=chunk.name.substr(0,chunk.name.lastIndexOf(".re"))+"."+process.builder.extention;promises.push(_this.config.write(fileName,process.result))}),chunk.nodes.forEach(write)}var _this=this,promises=[];return book.predef.forEach(write),book.contents.forEach(write),book.appendix.forEach(write),book.postdef.forEach(write),Promise.all(promises).then(function(){return book})},Controller.prototype.compileFinished=function(book){return book.config.listener.onReports(book.reports),book.hasError?book.config.listener.onCompileFailed(book):book.config.listener.onCompileSuccess(book),book},Controller.prototype.handleError=function(err){return console.error("unexpected error",err),err&&err.stack&&console.error(err.stack),Promise.reject(err)},Controller})();exports.Controller=__importStar},{"../../resources/grammar":21,"../builder/htmlBuilder":2,"../builder/textBuilder":3,"../model/compilerModel":13,"../parser/parser":15,"../parser/preprocessor":16,"../parser/walker":18,"../utils/utils":20,"./config":4,"./configRaw":5}],7:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.en=void 0,exports.en={sample:"Hello!"}},{}],8:[function(require,module,exports){var sprintf,__spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||((ar=ar||Array.prototype.slice.call(from,0,i))[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))},utils_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.setup=setup,exports.t=function(str){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var parts=str.split("."),base=resource;if(parts.forEach(function(part){base=base[part]}),"string"==typeof base)return sprintf.apply(void 0,__spreadArray([base],args,!1));throw new Error("unknown key: ".concat(str))},require("./utils")),exports=require("../utils/utils"),en_1=require("./en"),langs={ja:require("./ja").ja,en:en_1.en},resource=(0,utils_1.deepAssign)({},langs.en,langs.ja);function setup(lang){resource=(0,utils_1.deepAssign)({},langs.en,langs.ja,langs[lang=void 0===lang?"ja":lang])}sprintf=("undefined"!=typeof window&&window.sprintf?window:require("sprintf-js")).sprintf,null!=exports.isNodeJS&&(0,exports.isNodeJS)(),setup()},{"../utils/utils":20,"./en":7,"./ja":9,"./utils":10,"sprintf-js":void 0}],9:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ja=void 0,exports.ja={sample:"こんちゃーす！",description:{headline:'チャプターの始まりを示します。\n"= 見出し" という形式で書きます。',column:'コラムの始まりを示します。\n"===[column] 見出し" という形式で書きます。\n"===[/column]"を使うか、次の見出しが始まるとコラムの終わりになります。',ulist:"番号なし箇条書きを示します。*記号をつなげて書くとさらにインデントした箇条書きにする事ができます。\n * 食料品を買うこと。\n ** 牛乳\n ** にんじん\nという形式で書きます。行頭に必ず半角スペースが必要です。",olist:"数字付き箇条書きを示します。\n 1. はじめに神は天と地とを想像された。\n 2. 地は形なく、むなしく、やみが淵のおもてにあり、神の霊が水のおもてをおおっていた。\nという形式で書きます。行頭に必ず半角スペースが必要です。",dlist:"用語リストを示します。\n: レバガチャ\n  レバーをガチャガチャ動かすこと。熟練者はレバガチャすべき時としない時を明確に使い分け勝利を掴み取る。\nという形式で書きます。本文の行は先頭に半角スペースかタブが必要です。",block_list:'リストを示します。技術書ではプログラムコードの掲載に使います。\n//list[label][caption]{\nalert("Hello!");\n//}\nという形式で書きます。',inline_list:'リストへの参照を示します。\n//list[hoge][caption]{alert("Hello!");\n//}\n を参照する時は @<list>{hoge} と書きます。',block_listnum:'行番号付きのリストを示します。\n//listnum[hello.js][ハローワールド]{\nconsole.log("Hello world!");\n//}\nという形式で書きます。',block_emlist:'非採番のリストを示します。\n//emlist[ハローワールド]{\nconsole.log("Hello world");\n//}\nという形式で書きます。',block_emlistnum:'行番号付きの非採番のリストを示します。\n//emlistnum{\nconsole.log("Hello world");\n//}\nという形式で書きます。',block_image:"図表を示します。\n//image[sample][サンプル][scale=0.3]{\nメモ\n//}\nという形式で書きます。\n章のファイル名がtest.reの場合、images/test/sample.jpgが参照されます。\n画像のサイズを調整したい場合、scaleで倍率が指定できます。\n中に書かれているメモは無視されます。",block_indepimage:"非採番の図表を示します。\n//image[sample][サンプル][scale=0.3]{\nメモ\n//}\nという形式で書きます。詳細は //image と同様です。",block_graph:"グラフを示します。\n//graph[sample][ツール名][サンプル]{\nメモ\n//}\nという形式で書きます。\n文章中から参照する時は@<img>{sample}が利用できます。\n中に書かれているメモは無視されます。",inline_img:"図表への参照を示します。\n//image[sample][サンプル]{\n//}\nを参照するときは @<img>{sample} と書きます。",inline_icon:"文中に表示される図表を示します。\n@<icon>{sample}という形式で書きます。章のファイル名がtest.reの場合、images/test-sample.jpenが参照されます。",block_footnote:"脚注を示します。\n//footnote[sample][サンプルとしてはいささか豪華すぎるかも！]\nという形式で書きます。",inline_fn:"脚注への参照を示します。\n//footnote[sample][サンプルというにはショボすぎる]\nを参照するときは @<fn>{sample} と書きます。",block_lead:"リード分を示します。\n//lead{\n世界を変えたくはないか？\n//}\nという形式で書きます。lead記法中では、全てのインライン構文やブロック構文が利用できます。",block_noindent:"パラグラフを切らずに次の要素を続けることを示します。\n//noindent\nという形式で書きます。",block_blankline:"1行ぶんの空行を明示して入れます。\n//blankline\nという形式で書きます。",block_source:'ソースコードの引用を示します。\n//source[hello.js]{\nconsole.log("Hello world!");\n//}\nという形式で書きます。',block_cmd:"コマンドラインのキャプチャを示します。\n//cmd{\n$ git clone git@github.com:vvakame/review.js.git\n//}\nという形式で書きます。",block_quote:"引用を示します。\n//quote{\n神は言っている…ここで死ぬ定めではないと…\n//}\nという形式で書きます。",inline_hd:"TODO 後で書く。見出し参照を作成する。",inline_code:'短いプログラムコードを記述します。\n@<code>{alert("Hello!");}\n長いソースコードにはlist記法を使いましょう。',inline_br:"改行を示します。リスト内での改行や、段落を変えずに改行をしたい場合に使います。",inline_u:"下線にします。\n@<u>{この部分が下線になる}",inline_ruby:"読み仮名を振ります。\n@<ruby>{羊,ひつじ}",inline_b:"ボールド(太字)にします。\n@<b>{この部分が太字になる}",inline_href:"リンクを示します。\nURLを書きたい場合に使います。\n@<href>{https://github.com/vvakame/review.js} または @<href>{https://github.com/vvakame/review.js, review.js} という形式で書きます。",block_label:"アンカーを示します。\n@<href>{#anchor}から飛んで来られるようにするためには\n//label[anchor]\nという形式で書きます。",inline_kw:"キーワードを示します。\nそれはおかしいだろう@<kw>{JK, 常識的に考えて}。\nという形式で書きます。",inline_tti:"テレタイプ文字(等幅フォント)のイタリックで出力することを示します。\n@<tti>{keyword}\nという形式で書きます。",inline_ttb:"テレタイプ文字(等幅フォント)のボールドで出力することを示します。\n@<ttb>{class}\nという形式で書きます。",inline_ami:"網掛け有りで出力することを示します。\n@<ami>{重点！}\nという形式で書きます。",inline_bou:"傍点有りで出力することを示します。\n@<bou>{なんだって？}\nという形式で書きます。",inline_del:"削除箇所を明示します。\nデフォルトでは打ち消し線が引かれます。\n@<del>{削除}という形式で書きます。",inline_i:"イタリックで出力することを示します。\n@<i>{斜体}\nという形式で書きます。",inline_ins:"挿入箇所を明示します。\nデフォルトでは下線が引かれます。\n@<ins>{挿入}という形式で書きます。",inline_m:"TeXの式を挿入することを示します。\n@<m>{TeX式}\nという形式で書きます。",inline_strong:"ボールドで出力することを示します。\n@<strong>{強調！}\nという形式で書きます。",inline_tcy:"縦書きの文書において文字を縦中横で出力します。\n@<tcy>{AB}\nという形式で書きます。",inline_uchar:"指定された値を16進数の値として扱い、Unicode文字として出力することを示します。\n@<uchar>{1F64B}\nという形式で書きます。",inline_tt:"囲まれたテキストを等幅フォントで表示します。",inline_em:"テキストを強調します。\n@<em>{このように強調されます}",block_raw:"生データを表します。\n//raw[|html,text|ほげ]と書くと、出力先がhtmlかtextの時のみ内容がそのまま出力されます。\nRe:VIEWの記法を超えてそのまま出力されるので、構造を壊さぬよう慎重に使ってください。",inline_raw:"生データを表します。\n@<raw>{|html,text|ほげ}と書くと、出力先がhtmlかtextの時のみ内容がそのまま出力されます。\nRe:VIEWの記法を超えてそのまま出力されるので、構造を壊さぬよう慎重に使ってください。",block_comment:"コメントを示します。\n//comment{\nコメントですよー\n//}\nと書くことにより、文書には出力されない文を書くことができます。",inline_comment:"コメントを示します。\n@<comment>{コメントですよー}と書くことにより、文書には出力されない文を書くことができます。",inline_chap:"章番号を示します。\nファイル名の.reの前の部分か =={sample} タイトル の{}部分を参照します。@<chap>{sample} と書きます。",inline_title:"章タイトルを示します。\nファイル名の.reの前の部分か =={sample} タイトル の{}部分を参照します。@<title>{sample} と書きます。",inline_chapref:"章番号+章タイトルを示します。\nファイル名の.reの前の部分か =={sample} タイトル の{}部分を参照します。@<chapref>{sample} と書きます。",inline_idx:"文字列を出力するとともに、索引として登録します。\n`親索引文字列<<>>子索引文字列`のように親子関係にある索引も定義できます。\n@<idx>{sample} と書きます。",inline_hidx:"索引として登録します (idx と異なり、紙面内に出力はしません)。\n`親索引文字列<<>>子索引文字列`のように親子関係にある索引も定義できます。\n@<hidx>{sample} と書きます。",block_flushright:"右寄せを示します。\n//flushright{\n神は言っている…ここで左へ行く定めではないと…\n//}\nという形式で書きます。",block_memo:"ちょっとしたメモを示します。\n//memo[キャプション]{\nより詳しい情報はURL:XXXXを参照ください。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_info:"ちょっとした参考情報を示します。\n//info[キャプション]{\nより詳しい情報はURL:XXXXを参照ください。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_tip:"ちょっとしたTipsを示します。\n//tip[キャプション]{\nより詳しい情報はURL:XXXXを参照ください。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_note:"ちょっとしたノートを示します。\n//note[キャプション]{\nより詳しい情報はURL:XXXXを参照ください。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_warning:"ちょっとした警告情報を示します。\n//warning[キャプション]{\n先ほどの例とは出力結果が異なります。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_important:"ちょっとした重要情報を示します。\n//important[キャプション]{\n一定期間操作しない場合、キャッシュは削除されることがあります。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_caution:"ちょっとした警告情報を示します。\n//caution[キャプション]{\n一度実行すると修正はできません。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_notice:"ちょっとした注意情報を示します。\n//notice[キャプション]{\nエラーがなければ特に何も出力されません。\n//}\nという形式で書きます。ブロック中では、全てのインライン構文が利用できます。",block_table:"テーブルを示します。\nTODO 正しく実装した後に書く",inline_table:"テーブルへの参照を示します。\nTODO 正しく実装した後に書く",block_tsize:"テーブルの大きさを指定します。\nTODO 正しく実装した後に書く"},compile:{file_not_exists:"ファイル %s が開けません。",block_not_supported:"%s というブロック構文はサポートされていません。",inline_not_supported:"%s というインライン構文はサポートされていません。",part_is_missing:"パート %s が見つかりません。",chapter_is_missing:"チャプター %s が見つかりません。",reference_is_missing:"参照先 %s の %s が見つかりません。",duplicated_label:"ラベルに重複があるようです。",duplicated_label_headline:"ラベルに重複があるようです。 =={a-label} ラベル のように明示的にラベルを指定することを回避することができます。",args_length_mismatch:"引数の数に齟齬があります。 期待値 %s, 実際 %s",args_hd_path_not_implemented:"キャプションによる参照はまだ実装されていません。{ラベル}か{章ID|ラベル}の形式を使用してください。指定された要素は %s でした。",body_string_only:"内容は全て文字でなければいけません。",chapter_not_toplevel:"深さ1のチャプターは最上位になければいけません。",chapter_topleve_eq1:"最上位のチャプターは深さ1のものでなければいけません。",deprecated_inline_symbol:"%s というインライン構文は非推奨です。",graph_tool_is_not_recommended:"graph用ツールにはgraphvizをおすすめします。",unknown_graph_tool:"%s というgraph用ツールはサポートされていません。"},builder:{chapter_not_found:"深さ %d にマッチするチャプターが見つかりませんでした。",image_not_found:"ID: %s にマッチする画像が見つかりませんでした。",chapter:"第%d章",chapter_ref:"第%d章「%s」",list:"リスト%s.%s",table:"表%s.%s"}}},{}],10:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.deepAssign=function deepAssign(target){var args=[];for(var _i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];args.forEach(function(arg){Object.keys(arg).forEach(function(key){"object"!=typeof arg[key]?target[key]=arg[key]:target[key]=deepAssign(target[key]||{},arg[key])})});return target}},{}],11:[function(require,module,exports){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)},compilerModel_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.SyntaxType=exports.TextBuilder=exports.HtmlBuilder=exports.DefaultBuilder=exports.DefaultValidator=exports.DefaultAnalyzer=exports.AcceptableSyntaxes=exports.SyntaxTree=exports.ProcessReport=exports.ReportLevel=exports.ContentChunk=exports.Book=void 0,exports.start=function(setup,options){options=new controller_1.Controller(options);return setup(options),options.process()},require("./model/compilerModel")),controller_1=(Object.defineProperty(exports,"Book",{enumerable:!0,get:function(){return compilerModel_1.Book}}),Object.defineProperty(exports,"ContentChunk",{enumerable:!0,get:function(){return compilerModel_1.ContentChunk}}),Object.defineProperty(exports,"ReportLevel",{enumerable:!0,get:function(){return compilerModel_1.ReportLevel}}),Object.defineProperty(exports,"ProcessReport",{enumerable:!0,get:function(){return compilerModel_1.ProcessReport}}),require("./controller/controller")),parser_1=require("./parser/parser"),analyzer_1=(Object.defineProperty(exports,"SyntaxTree",{enumerable:!0,get:function(){return parser_1.SyntaxTree}}),__exportStar(require("./parser/parser"),exports),require("./parser/analyzer")),validator_1=(Object.defineProperty(exports,"AcceptableSyntaxes",{enumerable:!0,get:function(){return analyzer_1.AcceptableSyntaxes}}),Object.defineProperty(exports,"DefaultAnalyzer",{enumerable:!0,get:function(){return analyzer_1.DefaultAnalyzer}}),require("./parser/validator")),builder_1=(Object.defineProperty(exports,"DefaultValidator",{enumerable:!0,get:function(){return validator_1.DefaultValidator}}),require("./builder/builder")),htmlBuilder_1=(Object.defineProperty(exports,"DefaultBuilder",{enumerable:!0,get:function(){return builder_1.DefaultBuilder}}),require("./builder/htmlBuilder")),textBuilder_1=(Object.defineProperty(exports,"HtmlBuilder",{enumerable:!0,get:function(){return htmlBuilder_1.HtmlBuilder}}),require("./builder/textBuilder")),analyzer_2=(Object.defineProperty(exports,"TextBuilder",{enumerable:!0,get:function(){return textBuilder_1.TextBuilder}}),require("./parser/analyzer"));Object.defineProperty(exports,"SyntaxType",{enumerable:!0,get:function(){return analyzer_2.SyntaxType}})},{"./builder/builder":1,"./builder/htmlBuilder":2,"./builder/textBuilder":3,"./controller/controller":6,"./model/compilerModel":13,"./parser/analyzer":14,"./parser/parser":15,"./parser/validator":17}],12:[function(require,module,exports){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;0<=i;i--)(d=decorators[i])&&(r=(c<3?d(r):3<c?d(target,key,r):d(target,key))||r);return 3<c&&r&&Object.defineProperty(target,key,r),r},DummyError=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnalyzerError=exports.DummyError=void 0,(()=>{function DummyError(message){this.message=message}var src;return __decorate([(src=Error,function(_){return src})],DummyError)})());DummyError=(_super=>{function AnalyzerError(message){var _this=_super.call(this,message)||this;return _this.name="AnalyzerError",_this.message=message,Error.captureStackTrace&&Error.captureStackTrace(_this,AnalyzerError),_this}return __extends(AnalyzerError,_super),AnalyzerError})(exports.DummyError=DummyError);exports.AnalyzerError=DummyError},{}],13:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.ContentChunk=exports.Book=exports.BuilderProcess=exports.Process=exports.BookProcess=exports.ProcessReport=exports.ReportLevel=void 0;var ReportLevel,i18n_1=require("../i18n/i18n"),walker_1=require("../parser/walker"),ProcessReport=((ReportLevel=>{ReportLevel[ReportLevel.Info=0]="Info",ReportLevel[ReportLevel.Warning=1]="Warning",ReportLevel[ReportLevel.Error=2]="Error"})(ReportLevel||(exports.ReportLevel=ReportLevel={})),function(level,part,chapter,message,nodes){void 0===nodes&&(nodes=[]),this.level=level,this.part=part,this.chapter=chapter,this.message=message,this.nodes=nodes}),BookProcess=(exports.ProcessReport=ProcessReport,(()=>{function BookProcess(){this.reports=[]}return BookProcess.prototype.info=function(message){this.reports.push(new ProcessReport(ReportLevel.Info,null,null,message))},BookProcess.prototype.warn=function(message){this.reports.push(new ProcessReport(ReportLevel.Warning,null,null,message))},BookProcess.prototype.error=function(message){this.reports.push(new ProcessReport(ReportLevel.Error,null,null,message))},BookProcess})()),Process=(exports.BookProcess=BookProcess,(()=>{function Process(part,chapter,input){this.part=part,this.chapter=chapter,this.input=input,this.symbols=[],this.indexCounter={},this.afterProcess=[],this._reports=[]}return Process.prototype.info=function(message){for(var nodes=[],_i=1;_i<arguments.length;_i++)nodes[_i-1]=arguments[_i];this._reports.push(new ProcessReport(ReportLevel.Info,this.part,this.chapter,message,nodes))},Process.prototype.warn=function(message){for(var nodes=[],_i=1;_i<arguments.length;_i++)nodes[_i-1]=arguments[_i];this._reports.push(new ProcessReport(ReportLevel.Warning,this.part,this.chapter,message,nodes))},Process.prototype.error=function(message){for(var nodes=[],_i=1;_i<arguments.length;_i++)nodes[_i-1]=arguments[_i];this._reports.push(new ProcessReport(ReportLevel.Error,this.part,this.chapter,message,nodes))},Process.prototype.nextIndex=function(kind){var nextIndex=this.indexCounter[kind];return void 0===nextIndex?nextIndex=1:nextIndex++,this.indexCounter[kind]=nextIndex},Object.defineProperty(Process.prototype,"reports",{get:function(){return this._reports.sort(function(a,b){return 0===a.nodes.length&&0===b.nodes.length?0:0===a.nodes.length?-1:0===b.nodes.length?1:a.nodes[0].location.start.offset-b.nodes[0].location.start.offset})},enumerable:!1,configurable:!0}),Process.prototype.addSymbol=function(symbol){symbol.chapter=this.chapter,this.symbols.push(symbol)},Object.defineProperty(Process.prototype,"missingSymbols",{get:function(){var result=[];return this.symbols.forEach(function(symbol){symbol.referenceTo&&!symbol.referenceTo.referenceNode&&result.push(symbol)}),result},enumerable:!1,configurable:!0}),Process.prototype.constructReferenceTo=function(node,value,targetSymbol,separator){void 0===targetSymbol&&(targetSymbol=node.symbol);var message,value=value.split(separator=void 0===separator?"|":separator);return"chapter"===targetSymbol?1!==value.length?(message=(0,i18n_1.t)("compile.args_length_mismatch","1",value.length),this.error(message,node),null):{chapterName:value[0],targetSymbol:targetSymbol}:"fn"===targetSymbol?1!==value.length?(message=(0,i18n_1.t)("compile.args_length_mismatch","1",value.length),this.error(message,node),null):{chapter:this.chapter,chapterName:null==(separator=this.chapter)?void 0:separator.name,targetSymbol:targetSymbol,label:value[0]}:"hd"!==targetSymbol?2===value.length?{chapterName:value[0],targetSymbol:targetSymbol,label:value[1]}:1===value.length?{chapter:this.chapter,chapterName:null==(separator=this.chapter)?void 0:separator.name,targetSymbol:targetSymbol,label:value[0]}:(message=(0,i18n_1.t)("compile.args_length_mismatch","1 or 2",value.length),this.error(message,node),null):2===value.length?{chapterName:value[0],targetSymbol:targetSymbol,label:value[1]}:1===value.length?{chapter:this.chapter,chapterName:null==(separator=this.chapter)?void 0:separator.name,targetSymbol:targetSymbol,label:value[0]}:(message=(0,i18n_1.t)("compile.args_hd_path_not_implemented",value.length),this.error(message,node),null)},Process.prototype.addAfterProcess=function(func){this.afterProcess.push(func)},Process.prototype.doAfterProcess=function(){this.afterProcess.forEach(function(func){return func()}),this.afterProcess=[]},Process})()),BuilderProcess=(exports.Process=Process,(()=>{function BuilderProcess(builder,base){this.builder=builder,this.base=base,this.result=""}return Object.defineProperty(BuilderProcess.prototype,"info",{get:function(){return this.base.info.bind(this.base)},enumerable:!1,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"warn",{get:function(){return this.base.warn.bind(this.base)},enumerable:!1,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"error",{get:function(){return this.base.error.bind(this.base)},enumerable:!1,configurable:!0}),BuilderProcess.prototype.out=function(data){return this.result+=this.builder.escape(data),this},BuilderProcess.prototype.outRaw=function(data){return this.result+=data,this},BuilderProcess.prototype.pushOut=function(data){return this.result=data+this.result,this},Object.defineProperty(BuilderProcess.prototype,"input",{get:function(){return this.base.input},enumerable:!1,configurable:!0}),Object.defineProperty(BuilderProcess.prototype,"symbols",{get:function(){return this.base.symbols},enumerable:!1,configurable:!0}),BuilderProcess.prototype.findChapter=function(chapId){return this.base.chapter.book.allChunks.filter(function(chunk){var chapter;return chunk.name.substr(0,chunk.name.lastIndexOf(".re"))===chapId||((chapter=null,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node,_parent){return!chapter},visitChapterPre:function(node,_parent){return chapter=node,!1}}),!(!chapter||!chapter.headline.label)&&chapter.headline.label.arg===chapId)})[0]},BuilderProcess.prototype.findImageFile=function(id){var builderList,chapSwitchList,chunkName,chapSeparatorList,extList,_this=this,config=(this.base.part||this.base.chapter).book.config,fileNameList=[];return builderList=[_this.builder.extention+"/",""],chapSwitchList=[!0,!1],chunkName=(chunkName=(_this.base.chapter||_this.base.part).name).substring(0,chunkName.lastIndexOf(".")),chapSeparatorList=["/","-"],extList=["png","jpg","jpeg","gif"],["images/"].forEach(function(imageDir){builderList.forEach(function(builder){chapSwitchList.forEach(function(chapSwitch){chapSeparatorList.forEach(function(chapSeparator){extList.forEach(function(ext){var fileName=(fileName="")+imageDir+builder;chapSwitch&&(fileName=fileName+chunkName+chapSeparator),-1===fileNameList.indexOf(fileName+=id+"."+ext)&&fileNameList.push(fileName)})})})})}),new Promise(function(resolve,reject){function checkFileExists(){var fileName;0===fileNameList.length?reject(id):(fileName=fileNameList.shift(),config.exists(fileName).then(function(result){result.result?resolve(result.path):checkFileExists()}))}checkFileExists()})},BuilderProcess})()),require=(exports.BuilderProcess=BuilderProcess,(()=>{function Book(config){this.config=config,this.process=new BookProcess,this.predef=[],this.contents=[],this.appendix=[],this.postdef=[]}return Object.defineProperty(Book.prototype,"allChunks",{get:function(){function add(chunk){tmpArray.push(chunk),chunk.nodes.forEach(add)}var tmpArray=[];return this.predef.forEach(add),this.contents.forEach(add),this.appendix.forEach(add),this.postdef.forEach(add),tmpArray},enumerable:!1,configurable:!0}),Object.defineProperty(Book.prototype,"reports",{get:function(){var results=(results=[]).concat(this.process.reports),gatherReports=function(chunk){results=results.concat(chunk.process.reports),chunk.nodes.forEach(function(chunk){return gatherReports(chunk)})};return this.predef.forEach(function(chunk){return gatherReports(chunk)}),this.contents.forEach(function(chunk){return gatherReports(chunk)}),this.appendix.forEach(function(chunk){return gatherReports(chunk)}),this.postdef.forEach(function(chunk){return gatherReports(chunk)}),results},enumerable:!1,configurable:!0}),Object.defineProperty(Book.prototype,"hasError",{get:function(){return this.reports.some(function(report){return report.level===ReportLevel.Error})},enumerable:!1,configurable:!0}),Object.defineProperty(Book.prototype,"hasWarning",{get:function(){return this.reports.some(function(report){return report.level===ReportLevel.Warning})},enumerable:!1,configurable:!0}),Book})()),require=(exports.Book=require,(()=>{function ContentChunk(book,parent,name){this.book=book,this.nodes=[],this.builderProcesses=[],parent instanceof ContentChunk?(this.parent=parent,this.name=name):this.name="string"==typeof name?name:parent;this.process=new Process(parent||null,this,null)}return Object.defineProperty(ContentChunk.prototype,"input",{get:function(){return this._input},set:function(value){this._input=value,this.process.input=value},enumerable:!1,configurable:!0}),ContentChunk.prototype.createBuilderProcess=function(builder){builder=new BuilderProcess(builder,this.process);return this.builderProcesses.push(builder),builder},ContentChunk.prototype.findResultByBuilder=function(builder){var founds="string"==typeof builder?this.builderProcesses.filter(function(process){return process.builder.name===builder}):this.builderProcesses.filter(function(process){return process.builder===builder});return founds[0].result},ContentChunk})());exports.ContentChunk=require},{"../i18n/i18n":8,"../parser/walker":18}],14:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.DefaultAnalyzer=exports.AcceptableSyntax=exports.AcceptableSyntaxes=exports.SyntaxType=void 0;var SyntaxType,i18n_1=require("../i18n/i18n"),exception_1=require("../js/exception"),parser_1=require("../parser/parser"),utils_1=require("../utils/utils"),AcceptableSyntaxes=((SyntaxType=>{SyntaxType[SyntaxType.Block=0]="Block",SyntaxType[SyntaxType.Inline=1]="Inline",SyntaxType[SyntaxType.Other=2]="Other"})(SyntaxType||(exports.SyntaxType=SyntaxType={})),(()=>{function AcceptableSyntaxes(acceptableSyntaxes){this.acceptableSyntaxes=acceptableSyntaxes}return AcceptableSyntaxes.prototype.find=function(node){var n_1,n_2;return node instanceof parser_1.InlineElementSyntaxTree?(n_1=node,this.inlines.filter(function(s){return s.symbolName===n_1.symbol})):node instanceof parser_1.BlockElementSyntaxTree?(n_2=node,this.blocks.filter(function(s){return s.symbolName===n_2.symbol})):this.others.filter(function(s){return node instanceof s.clazz})},Object.defineProperty(AcceptableSyntaxes.prototype,"inlines",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Inline})},enumerable:!1,configurable:!0}),Object.defineProperty(AcceptableSyntaxes.prototype,"blocks",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Block})},enumerable:!1,configurable:!0}),Object.defineProperty(AcceptableSyntaxes.prototype,"others",{get:function(){return this.acceptableSyntaxes.filter(function(s){return s.type===SyntaxType.Other})},enumerable:!1,configurable:!0}),AcceptableSyntaxes.prototype.toJSON=function(){return{rev:"1",SyntaxType:SyntaxType,acceptableSyntaxes:this.acceptableSyntaxes}},AcceptableSyntaxes})()),AcceptableSyntax=(exports.AcceptableSyntaxes=AcceptableSyntaxes,(()=>{function AcceptableSyntax(){this.argsLength=[],this.allowInline=!0,this.allowFullySyntax=!1}return AcceptableSyntax.prototype.toJSON=function(){return{type:this.type,class:this.clazz?this.clazz.name:void 0,symbolName:this.symbolName,argsLength:0!==this.argsLength.length?this.argsLength:void 0,description:this.description}},AcceptableSyntax})()),AnalyzeProcess=(exports.AcceptableSyntax=AcceptableSyntax,(()=>{function AnalyzeProcess(){this.acceptableSyntaxes=[]}return AnalyzeProcess.prototype.prepare=function(){this.current=new AcceptableSyntax},AnalyzeProcess.prototype.build=function(methodName){switch(0===methodName.indexOf("block_")?(this.current.type=this.current.type||SyntaxType.Block,this.current.symbolName=this.current.symbolName||methodName.substring("block_".length)):0===methodName.indexOf("inline_")?(this.current.type=this.current.type||SyntaxType.Inline,this.current.symbolName=this.current.symbolName||methodName.substring("inline_".length)):(this.current.type=this.current.type||SyntaxType.Other,this.current.symbolName=this.current.symbolName||methodName),this.current.type){case SyntaxType.Block:if(0===this.current.argsLength.length)throw new exception_1.AnalyzerError("must call builder.checkArgsLength(...number[]) in "+methodName);break;case SyntaxType.Other:if(this.current.clazz)break;throw new exception_1.AnalyzerError("must call builder.setClass(class) in "+methodName);case SyntaxType.Inline:}if(!this.current.description)throw new exception_1.AnalyzerError("must call builder.setDescription(string) in "+methodName);if(!this.current.process)throw new exception_1.AnalyzerError("must call builder.processNode(func) in "+methodName);this.acceptableSyntaxes.push(this.current)},AnalyzeProcess.prototype.setSyntaxType=function(type){this.current.type=type},AnalyzeProcess.prototype.setClass=function(clazz){this.current.clazz=clazz},AnalyzeProcess.prototype.setSymbol=function(symbolName){this.current.symbolName=symbolName},AnalyzeProcess.prototype.setDescription=function(description){this.current.description=description},AnalyzeProcess.prototype.checkArgsLength=function(){for(var argsLength=[],_i=0;_i<arguments.length;_i++)argsLength[_i]=arguments[_i];this.current.argsLength=argsLength},AnalyzeProcess.prototype.setAllowInline=function(enable){this.current.allowInline=enable},AnalyzeProcess.prototype.setAllowFullySyntax=function(enable){this.current.allowFullySyntax=enable},AnalyzeProcess.prototype.processNode=function(func){this.current.process=func},AnalyzeProcess})()),require=(()=>{function DefaultAnalyzer(){}return DefaultAnalyzer.prototype.getAcceptableSyntaxes=function(){return this._acceptableSyntaxes||(this._acceptableSyntaxes=this.constructAcceptableSyntaxes()),new AcceptableSyntaxes(this._acceptableSyntaxes)},DefaultAnalyzer.prototype.constructAcceptableSyntaxes=function(){var k,func,process=new AnalyzeProcess;for(k in this)"function"==typeof this[k]&&(func=null,func=0!==k.indexOf("block_")&&0!==k.indexOf("inline_")&&"headline"!==k&&"column"!==k&&"ulist"!==k&&"olist"!==k&&"dlist"!==k?func:this[k])&&(process.prepare(),func.bind(this)(process),process.build(k));return process.acceptableSyntaxes},DefaultAnalyzer.prototype.headline=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(parser_1.HeadlineSyntaxTree),builder.setDescription((0,i18n_1.t)("description.headline")),builder.processNode(function(process,n){var n=n.toHeadline(),label=null,label=n.label?n.label.arg:(0,utils_1.nodeContentToString)(process,n.caption);process.addSymbol({symbolName:"hd",labelName:label,node:n}),1===n.level&&(label=null,label=n.label?n.label.arg:process.chapter.name.substr(0,process.chapter.name.lastIndexOf(".re")),process.addSymbol({symbolName:"chapter",labelName:label,node:n}))})},DefaultAnalyzer.prototype.column=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(parser_1.ColumnSyntaxTree),builder.setDescription((0,i18n_1.t)("description.column")),builder.processNode(function(process,n){n=n.toColumn();n.no=process.nextIndex("column"),process.addSymbol({symbolName:"column",node:n})})},DefaultAnalyzer.prototype.ulist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(parser_1.UlistElementSyntaxTree),builder.setDescription((0,i18n_1.t)("description.ulist")),builder.processNode(function(process,n){n=n.toUlist();process.addSymbol({symbolName:"ul",node:n})})},DefaultAnalyzer.prototype.olist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(parser_1.OlistElementSyntaxTree),builder.setDescription((0,i18n_1.t)("description.olist")),builder.processNode(function(process,n){n=n.toOlist();process.addSymbol({symbolName:"ol",node:n})})},DefaultAnalyzer.prototype.dlist=function(builder){builder.setSyntaxType(SyntaxType.Other),builder.setClass(parser_1.DlistElementSyntaxTree),builder.setDescription((0,i18n_1.t)("description.dlist")),builder.processNode(function(process,n){n=n.toDlist();process.addSymbol({symbolName:"dl",node:n})})},DefaultAnalyzer.prototype.block_list=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("list"),builder.setDescription((0,i18n_1.t)("description.block_list")),builder.checkArgsLength(2,3),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("list"),process.addSymbol({symbolName:n.symbol,labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.block_listnum=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("listnum"),builder.setDescription((0,i18n_1.t)("description.block_listnum")),builder.checkArgsLength(2,3),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("list"),process.addSymbol({symbolName:"list",labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.inline_list=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("list"),builder.setDescription((0,i18n_1.t)("description.inline_list")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n)),node:n})})},DefaultAnalyzer.prototype.block_emlist=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("emlist"),builder.setDescription((0,i18n_1.t)("description.block_emlist")),builder.checkArgsLength(0,1,2),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_emlistnum=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("emlistnum"),builder.setDescription((0,i18n_1.t)("description.block_emlistnum")),builder.checkArgsLength(0,1,2),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:"emlist",node:n})})},DefaultAnalyzer.prototype.inline_hd=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("hd"),builder.setDescription((0,i18n_1.t)("description.inline_hd")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n)),node:n})})},DefaultAnalyzer.prototype.block_image=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("image"),builder.setDescription((0,i18n_1.t)("description.block_image")),builder.checkArgsLength(2,3),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("image"),process.addSymbol({symbolName:n.symbol,labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.block_indepimage=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("indepimage"),builder.setDescription((0,i18n_1.t)("description.block_indepimage")),builder.checkArgsLength(1,2,3),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_graph=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("graph"),builder.setDescription((0,i18n_1.t)("description.block_graph")),builder.checkArgsLength(2,3),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("image"),process.addSymbol({symbolName:"image",labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.inline_img=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("img"),builder.setDescription((0,i18n_1.t)("description.inline_img")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n),"image"),node:n})})},DefaultAnalyzer.prototype.inline_icon=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("icon"),builder.setDescription((0,i18n_1.t)("description.inline_icon")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_footnote=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("footnote"),builder.setDescription((0,i18n_1.t)("description.block_footnote")),builder.checkArgsLength(2),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("footnote"),process.addSymbol({symbolName:n.symbol,labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.inline_fn=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("fn"),builder.setDescription((0,i18n_1.t)("description.inline_fn")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n),"footnote"),node:n})})},DefaultAnalyzer.prototype.inline_idx=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("idx"),builder.setDescription((0,i18n_1.t)("description.inline_idx")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.inline_hidx=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("hidx"),builder.setDescription((0,i18n_1.t)("description.inline_hidx")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.blockDecorationSyntax=function(builder,symbol){for(var argsLength=[],_i=2;_i<arguments.length;_i++)argsLength[_i-2]=arguments[_i];builder.setSyntaxType(SyntaxType.Block),builder.setSymbol(symbol),builder.setDescription((0,i18n_1.t)("description.block_"+symbol)),builder.checkArgsLength.apply(builder,argsLength),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_lead=function(builder){this.blockDecorationSyntax(builder,"lead",0),builder.setAllowFullySyntax(!0)},DefaultAnalyzer.prototype.block_noindent=function(builder){this.blockDecorationSyntax(builder,"noindent",0)},DefaultAnalyzer.prototype.block_blankline=function(builder){this.blockDecorationSyntax(builder,"blankline",0)},DefaultAnalyzer.prototype.block_source=function(builder){this.blockDecorationSyntax(builder,"source",1)},DefaultAnalyzer.prototype.block_cmd=function(builder){this.blockDecorationSyntax(builder,"cmd",0)},DefaultAnalyzer.prototype.block_quote=function(builder){this.blockDecorationSyntax(builder,"quote",0)},DefaultAnalyzer.prototype.inlineDecorationSyntax=function(builder,symbol){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol(symbol),builder.setDescription((0,i18n_1.t)("description.inline_"+symbol)),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.inline_br=function(builder){this.inlineDecorationSyntax(builder,"br")},DefaultAnalyzer.prototype.inline_ruby=function(builder){this.inlineDecorationSyntax(builder,"ruby")},DefaultAnalyzer.prototype.inline_b=function(builder){this.inlineDecorationSyntax(builder,"b")},DefaultAnalyzer.prototype.inline_code=function(builder){this.inlineDecorationSyntax(builder,"code")},DefaultAnalyzer.prototype.inline_tt=function(builder){this.inlineDecorationSyntax(builder,"tt")},DefaultAnalyzer.prototype.inline_href=function(builder){this.inlineDecorationSyntax(builder,"href")},DefaultAnalyzer.prototype.block_label=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("label"),builder.setDescription((0,i18n_1.t)("description.block_label")),builder.checkArgsLength(1),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("label"),process.addSymbol({symbolName:n.symbol,labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.inline_u=function(builder){this.inlineDecorationSyntax(builder,"u")},DefaultAnalyzer.prototype.inline_kw=function(builder){this.inlineDecorationSyntax(builder,"kw")},DefaultAnalyzer.prototype.inline_em=function(builder){this.inlineDecorationSyntax(builder,"em")},DefaultAnalyzer.prototype.inline_tti=function(builder){this.inlineDecorationSyntax(builder,"tti")},DefaultAnalyzer.prototype.inline_ttb=function(builder){this.inlineDecorationSyntax(builder,"ttb")},DefaultAnalyzer.prototype.inline_ami=function(builder){this.inlineDecorationSyntax(builder,"ami")},DefaultAnalyzer.prototype.inline_bou=function(builder){this.inlineDecorationSyntax(builder,"bou")},DefaultAnalyzer.prototype.inline_del=function(builder){this.inlineDecorationSyntax(builder,"del")},DefaultAnalyzer.prototype.inline_i=function(builder){this.inlineDecorationSyntax(builder,"i")},DefaultAnalyzer.prototype.inline_ins=function(builder){this.inlineDecorationSyntax(builder,"ins")},DefaultAnalyzer.prototype.inline_m=function(builder){this.inlineDecorationSyntax(builder,"m")},DefaultAnalyzer.prototype.inline_strong=function(builder){this.inlineDecorationSyntax(builder,"strong")},DefaultAnalyzer.prototype.inline_tcy=function(builder){this.inlineDecorationSyntax(builder,"tcy")},DefaultAnalyzer.prototype.inline_uchar=function(builder){this.inlineDecorationSyntax(builder,"uchar")},DefaultAnalyzer.prototype.block_table=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("table"),builder.setDescription((0,i18n_1.t)("description.block_table")),builder.checkArgsLength(2),builder.processNode(function(process,n){n=n.toBlockElement();n.no=process.nextIndex("table"),process.addSymbol({symbolName:n.symbol,labelName:(0,utils_1.nodeContentToString)(process,n.args[0]),node:n})})},DefaultAnalyzer.prototype.inline_table=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("table"),builder.setDescription((0,i18n_1.t)("description.inline_table")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n)),node:n})})},DefaultAnalyzer.prototype.block_tsize=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setDescription((0,i18n_1.t)("description.block_tsize")),builder.checkArgsLength(1),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_raw=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("raw"),builder.setDescription((0,i18n_1.t)("description.block_raw")),builder.checkArgsLength(1),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.inline_raw=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("raw"),builder.setDescription((0,i18n_1.t)("description.inline_raw")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.block_comment=function(builder){builder.setSyntaxType(SyntaxType.Block),builder.setSymbol("comment"),builder.setDescription((0,i18n_1.t)("description.block_comment")),builder.checkArgsLength(0),builder.processNode(function(process,n){n=n.toBlockElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.inline_comment=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("comment"),builder.setDescription((0,i18n_1.t)("description.inline_comment")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,node:n})})},DefaultAnalyzer.prototype.inline_chap=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("chap"),builder.setDescription((0,i18n_1.t)("description.inline_chap")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n),"chapter"),node:n})})},DefaultAnalyzer.prototype.inline_title=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("title"),builder.setDescription((0,i18n_1.t)("description.inline_title")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n),"chapter"),node:n})})},DefaultAnalyzer.prototype.inline_chapref=function(builder){builder.setSyntaxType(SyntaxType.Inline),builder.setSymbol("chapref"),builder.setDescription((0,i18n_1.t)("description.inline_chapref")),builder.processNode(function(process,n){n=n.toInlineElement();process.addSymbol({symbolName:n.symbol,referenceTo:process.constructReferenceTo(n,(0,utils_1.nodeContentToString)(process,n),"chapter"),node:n})})},DefaultAnalyzer.prototype.block_flushright=function(builder){this.blockDecorationSyntax(builder,"flushright",0)},DefaultAnalyzer.prototype.blockBoxedContentSyntax=function(builder,symbol){this.blockDecorationSyntax(builder,symbol,0),builder.setAllowFullySyntax(!0)},DefaultAnalyzer.prototype.block_note=function(builder){this.blockBoxedContentSyntax(builder,"note")},DefaultAnalyzer.prototype.block_memo=function(builder){this.blockBoxedContentSyntax(builder,"memo")},DefaultAnalyzer.prototype.block_tip=function(builder){this.blockBoxedContentSyntax(builder,"tip")},DefaultAnalyzer.prototype.block_info=function(builder){this.blockBoxedContentSyntax(builder,"info")},DefaultAnalyzer.prototype.block_warning=function(builder){this.blockBoxedContentSyntax(builder,"warning")},DefaultAnalyzer.prototype.block_important=function(builder){this.blockBoxedContentSyntax(builder,"important")},DefaultAnalyzer.prototype.block_caution=function(builder){this.blockBoxedContentSyntax(builder,"caution")},DefaultAnalyzer.prototype.block_notice=function(builder){this.blockBoxedContentSyntax(builder,"notice")},DefaultAnalyzer})();exports.DefaultAnalyzer=require},{"../i18n/i18n":8,"../js/exception":12,"../parser/parser":15,"../utils/utils":20}],15:[function(require,module,exports){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&("get"in desc?m.__esModule:!desc.writable&&!desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},PEG=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.SingleLineCommentSyntaxTree=exports.TextNodeSyntaxTree=exports.DlistElementSyntaxTree=exports.OlistElementSyntaxTree=exports.UlistElementSyntaxTree=exports.ArgumentSyntaxTree=exports.ColumnHeadlineSyntaxTree=exports.ColumnSyntaxTree=exports.InlineElementSyntaxTree=exports.BlockElementSyntaxTree=exports.HeadlineSyntaxTree=exports.ChapterSyntaxTree=exports.NodeSyntaxTree=exports.SyntaxTree=exports.RuleName=exports.ParseError=void 0,exports.parse=function(input){var input=PEG.parse(input),root=transform(input).toNode();(0,walker_1.visit)(root,{visitDefaultPre:function(_ast){},visitParagraphPre:function(ast){var subs=ast.childNodes[0].toNode();ast.childNodes=subs.childNodes}}),0!==root.childNodes.length&&reconstruct(root.childNodes[0].toNode(),function(chapter){return chapter.headline.level});var ulistSet=[];return(0,walker_1.visit)(root,{visitDefaultPre:function(ast){ast.ruleName===RuleName.Ulist&&ulistSet.push(ast.toNode())}}),ulistSet.forEach(function(ulist){reconstruct(ulist,function(ulistElement){return ulistElement.level})}),(0,walker_1.visit)(root,{visitDefaultPre:function(ast,parent){ast.parentNode=parent}}),(0,walker_1.visit)(root,{visitDefaultPre:function(_ast,_parent){},visitChapterPre:function(ast){ast.text.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})},visitColumnPre:function(ast){ast.text.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})},visitNodePre:function(ast){ast.childNodes.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})}}),{ast:root,cst:input}},exports.transform=transform,__importStar(require("../../resources/grammar"))),walker_1=require("./walker");function transform(rawResult){if(!rawResult)return null;var rule=RuleName[rawResult.syntax];if(void 0===rule)throw new ParseError(rawResult,"unknown rule: "+rawResult.syntax);switch(rule){case RuleName.Chapter:return new ChapterSyntaxTree(rawResult);case RuleName.BlockElement:return new BlockElementSyntaxTree(rawResult);case RuleName.Headline:return new HeadlineSyntaxTree(rawResult);case RuleName.InlineElement:return new InlineElementSyntaxTree(rawResult);case RuleName.Column:return new ColumnSyntaxTree(rawResult);case RuleName.ColumnHeadline:return new ColumnHeadlineSyntaxTree(rawResult);case RuleName.BraceArg:return new ArgumentSyntaxTree(rawResult);case RuleName.UlistElement:return new UlistElementSyntaxTree(rawResult);case RuleName.OlistElement:return new OlistElementSyntaxTree(rawResult);case RuleName.DlistElement:return new DlistElementSyntaxTree(rawResult);case RuleName.ContentText:case RuleName.BracketArgText:case RuleName.BlockElementContentText:case RuleName.InlineElementContentText:case RuleName.ContentInlineText:return new TextNodeSyntaxTree(rawResult);case RuleName.SinglelineComment:return new SingleLineCommentSyntaxTree(rawResult);case RuleName.Chapters:case RuleName.Contents:case RuleName.ParagraphSubs:case RuleName.BracketArgSubs:case RuleName.BlockElementContents:case RuleName.BlockElementParagraphSubs:case RuleName.InlineElementContents:case RuleName.ColumnContents:case RuleName.ContentInlines:case RuleName.Ulist:case RuleName.Olist:case RuleName.Dlist:case RuleName.DlistElementContents:case RuleName.SinglelineComments:return new NodeSyntaxTree(rawResult);case RuleName.Start:case RuleName.Paragraph:case RuleName.BracketArg:case RuleName.BlockElementParagraph:case RuleName.BlockElementParagraphSub:case RuleName.DlistElementContent:return new NodeSyntaxTree(rawResult);case RuleName.Content:case RuleName.ParagraphSub:case RuleName.BracketArgSub:case RuleName.BlockElementContent:case RuleName.InlineElementContent:case RuleName.ColumnContent:case RuleName.SinglelineContent:case RuleName.ContentInline:return transform(rawResult.content);default:return new SyntaxTree(rawResult)}}function reconstruct(node,pickLevel){var originalChildNodes=node.childNodes,nodeSets=[],currentSet={parent:null,children:[]};originalChildNodes.forEach(function(child){child.ruleName===RuleName.SinglelineComment?currentSet.children.push(child):currentSet.parent?pickLevel(currentSet.parent)<pickLevel(child)?currentSet.children.push(child):(nodeSets.push(currentSet),currentSet={parent:child,children:[]}):currentSet.parent=child}),currentSet.parent&&nodeSets.push(currentSet),node.childNodes=[],nodeSets.forEach(function(nodes){var parent=nodes.parent;parent&&(node.childNodes.push(parent),nodes.children.forEach(function(child){parent.childNodes.push(child)}),reconstruct(parent,pickLevel))})}var RuleName,ParseError=function ParseError(syntax,message){this.syntax=syntax,this.message=message,Error.captureStackTrace&&Error.captureStackTrace(this,ParseError),this.name="ParseError"},SyntaxTree=(exports.ParseError=ParseError,(RuleName=>{RuleName[RuleName.SyntaxError=0]="SyntaxError",RuleName[RuleName.Start=1]="Start",RuleName[RuleName.Chapters=2]="Chapters",RuleName[RuleName.Chapter=3]="Chapter",RuleName[RuleName.Headline=4]="Headline",RuleName[RuleName.Contents=5]="Contents",RuleName[RuleName.Content=6]="Content",RuleName[RuleName.Paragraph=7]="Paragraph",RuleName[RuleName.ParagraphSubs=8]="ParagraphSubs",RuleName[RuleName.ParagraphSub=9]="ParagraphSub",RuleName[RuleName.ContentText=10]="ContentText",RuleName[RuleName.BlockElement=11]="BlockElement",RuleName[RuleName.InlineElement=12]="InlineElement",RuleName[RuleName.BracketArg=13]="BracketArg",RuleName[RuleName.BracketArgSubs=14]="BracketArgSubs",RuleName[RuleName.BracketArgSub=15]="BracketArgSub",RuleName[RuleName.BracketArgText=16]="BracketArgText",RuleName[RuleName.BraceArg=17]="BraceArg",RuleName[RuleName.BlockElementContents=18]="BlockElementContents",RuleName[RuleName.BlockElementContent=19]="BlockElementContent",RuleName[RuleName.BlockElementParagraph=20]="BlockElementParagraph",RuleName[RuleName.BlockElementParagraphSubs=21]="BlockElementParagraphSubs",RuleName[RuleName.BlockElementParagraphSub=22]="BlockElementParagraphSub",RuleName[RuleName.BlockElementContentText=23]="BlockElementContentText",RuleName[RuleName.InlineElementContents=24]="InlineElementContents",RuleName[RuleName.InlineElementContent=25]="InlineElementContent",RuleName[RuleName.InlineElementContentText=26]="InlineElementContentText",RuleName[RuleName.SinglelineContent=27]="SinglelineContent",RuleName[RuleName.ContentInlines=28]="ContentInlines",RuleName[RuleName.ContentInline=29]="ContentInline",RuleName[RuleName.ContentInlineText=30]="ContentInlineText",RuleName[RuleName.Ulist=31]="Ulist",RuleName[RuleName.UlistElement=32]="UlistElement",RuleName[RuleName.Olist=33]="Olist",RuleName[RuleName.OlistElement=34]="OlistElement",RuleName[RuleName.Dlist=35]="Dlist",RuleName[RuleName.DlistElement=36]="DlistElement",RuleName[RuleName.DlistElementContents=37]="DlistElementContents",RuleName[RuleName.DlistElementContent=38]="DlistElementContent",RuleName[RuleName.Column=39]="Column",RuleName[RuleName.ColumnHeadline=40]="ColumnHeadline",RuleName[RuleName.ColumnContents=41]="ColumnContents",RuleName[RuleName.ColumnContent=42]="ColumnContent",RuleName[RuleName.ColumnTerminator=43]="ColumnTerminator",RuleName[RuleName.SinglelineComments=44]="SinglelineComments",RuleName[RuleName.SinglelineComment=45]="SinglelineComment"})(RuleName||(exports.RuleName=RuleName={})),(()=>{function SyntaxTree(data){if(this.ruleName=RuleName[data.syntax],void 0===this.ruleName)throw new ParseError(data,"unknown rule: "+data.syntax);var end=data.location.end||data.location.start;this.location={start:{line:data.location.start.line,column:data.location.start.column,offset:data.location.start.offset},end:{line:end.line,column:end.column,offset:end.offset}}}return SyntaxTree.prototype.toJSON=function(){var k,_this=this,result={},lowPriorities=[];for(k in this)"ruleName"===k?result[k]=RuleName[this.ruleName]:"prev"!==k&&"next"!==k&&"parentNode"!==k&&("childNodes"===k?lowPriorities.push((k=>function(){result[k]=_this[k]})(k)):"fqn"!==k&&"function"!=typeof this[k]&&(result[k]=this[k]));return lowPriorities.forEach(function(fn){return fn()}),result},SyntaxTree.prototype.toString=function(indentLevel){var result=this.makeIndent(indentLevel=void 0===indentLevel?0:indentLevel)+"SyntaxTree:[\n",result=(result=(result=(result+=this.makeIndent(indentLevel+1)+"offset = "+this.location.start.offset+",\n")+(this.makeIndent(indentLevel+1)+"line="+this.location.start.line+",\n"))+(this.makeIndent(indentLevel+1)+"column="+this.location.start.column+",\n"))+(this.makeIndent(indentLevel+1)+"name="+RuleName[this.ruleName]+",\n");return this.toStringHook(indentLevel,result),result+=this.makeIndent(indentLevel)+"]"},SyntaxTree.prototype.makeIndent=function(indentLevel){for(var indent="",i=0;i<indentLevel;i++)indent+="  ";return indent},SyntaxTree.prototype.toStringHook=function(_indentLevel,_result){},SyntaxTree.prototype.checkNumber=function(value){if("number"!=typeof value)throw new Error("number required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkString=function(value){if("string"!=typeof value)throw new Error("string required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkObject=function(value){if("object"!=typeof value)throw new Error("object required. actual:"+typeof value+":"+value);return value},SyntaxTree.prototype.checkArray=function(value){if(Array.isArray(value))return value;throw console.log(JSON.stringify(value,null,2)),new Error("array required. actual:"+typeof value+":"+value)},SyntaxTree.prototype.checkSyntaxType=function(clazz){return this instanceof clazz},SyntaxTree.prototype.isNode=function(){return this.checkSyntaxType(NodeSyntaxTree)},SyntaxTree.prototype.isBlockElement=function(){return this.checkSyntaxType(BlockElementSyntaxTree)},SyntaxTree.prototype.isInlineElement=function(){return this.checkSyntaxType(InlineElementSyntaxTree)},SyntaxTree.prototype.isArgument=function(){return this.checkSyntaxType(ArgumentSyntaxTree)},SyntaxTree.prototype.isChapter=function(){return this.checkSyntaxType(ChapterSyntaxTree)},SyntaxTree.prototype.isHeadline=function(){return this.checkSyntaxType(HeadlineSyntaxTree)},SyntaxTree.prototype.isUlist=function(){return this.checkSyntaxType(UlistElementSyntaxTree)},SyntaxTree.prototype.isOlist=function(){return this.checkSyntaxType(OlistElementSyntaxTree)},SyntaxTree.prototype.isDlist=function(){return this.checkSyntaxType(DlistElementSyntaxTree)},SyntaxTree.prototype.isTextNode=function(){return this.checkSyntaxType(TextNodeSyntaxTree)},SyntaxTree.prototype.isSingleLineComment=function(){return this.checkSyntaxType(SingleLineCommentSyntaxTree)},SyntaxTree.prototype.toOtherNode=function(clazz){if(this instanceof clazz)return this;throw new Error("this node is not "+clazz.name+", actual "+this.constructor.name)},SyntaxTree.prototype.toNode=function(){return this.toOtherNode(NodeSyntaxTree)},SyntaxTree.prototype.toBlockElement=function(){return this.toOtherNode(BlockElementSyntaxTree)},SyntaxTree.prototype.toInlineElement=function(){return this.toOtherNode(InlineElementSyntaxTree)},SyntaxTree.prototype.toArgument=function(){return this.toOtherNode(ArgumentSyntaxTree)},SyntaxTree.prototype.toChapter=function(){return this.toOtherNode(ChapterSyntaxTree)},SyntaxTree.prototype.toColumn=function(){return this.toOtherNode(ColumnSyntaxTree)},SyntaxTree.prototype.toHeadline=function(){return this.toOtherNode(HeadlineSyntaxTree)},SyntaxTree.prototype.toColumnHeadline=function(){return this.toOtherNode(ColumnHeadlineSyntaxTree)},SyntaxTree.prototype.toUlist=function(){return this.toOtherNode(UlistElementSyntaxTree)},SyntaxTree.prototype.toOlist=function(){return this.toOtherNode(OlistElementSyntaxTree)},SyntaxTree.prototype.toDlist=function(){return this.toOtherNode(DlistElementSyntaxTree)},SyntaxTree.prototype.toTextNode=function(){return this.toOtherNode(TextNodeSyntaxTree)},SyntaxTree.prototype.toSingleLineCommentNode=function(){return this.toOtherNode(SingleLineCommentSyntaxTree)},SyntaxTree})()),NodeSyntaxTree=(_super=>{function NodeSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.childNodes=[],_this.processChildNodes(data.content),_this}return __extends(NodeSyntaxTree,_super),NodeSyntaxTree.prototype.processChildNodes=function(content){var _this=this;Array.isArray(content)?content.forEach(function(rawResult){rawResult=transform(rawResult);rawResult&&_this.childNodes.push(rawResult)}):""!==content&&content&&(content=transform(content))&&_this.childNodes.push(content)},NodeSyntaxTree.prototype.toStringHook=function(indentLevel,result){0!==this.childNodes.length&&(result+=this.makeIndent(indentLevel+1)+"childNodes["+this.childNodes.length+"]=[\n",this.childNodes.forEach(function(node){result=result+node.toString(indentLevel+2)+"\n"}),result+=this.makeIndent(indentLevel+1)+"]\n")},NodeSyntaxTree})(exports.SyntaxTree=SyntaxTree),ChapterSyntaxTree=(_super=>{function ChapterSyntaxTree(data){var _this=_super.call(this,data)||this;return data.comments&&data.comments.content?_this.comments=_this.checkArray(data.comments.content).map(function(data){return transform(data).toSingleLineCommentNode()}):_this.comments=[],_this.headline=transform(_this.checkObject(data.headline)).toHeadline(),"string"==typeof data.text||null===data.text?_this.text=[]:(_this.text=_this.checkArray(data.text.content).map(transform),delete _this.childNodes,_this.childNodes=[]),_this}return __extends(ChapterSyntaxTree,_super),Object.defineProperty(ChapterSyntaxTree.prototype,"level",{get:function(){return this.headline.level},enumerable:!1,configurable:!0}),Object.defineProperty(ChapterSyntaxTree.prototype,"fqn",{get:function(){var chapters=[];return(0,walker_1.walk)(this,function(node){return node instanceof ChapterSyntaxTree&&chapters.unshift(node),node.parentNode}),chapters.map(function(chapter){return chapter.no}).join(".")},enumerable:!1,configurable:!0}),ChapterSyntaxTree})(exports.NodeSyntaxTree=NodeSyntaxTree),HeadlineSyntaxTree=(exports.ChapterSyntaxTree=ChapterSyntaxTree,(_super=>{function HeadlineSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.level=_this.checkNumber(data.level),data.label&&(_this.label=transform(_this.checkObject(data.label)).toArgument()),_this.caption=transform(_this.checkObject(data.caption)).toNode(),_this}return __extends(HeadlineSyntaxTree,_super),HeadlineSyntaxTree})(SyntaxTree)),BlockElementSyntaxTree=(exports.HeadlineSyntaxTree=HeadlineSyntaxTree,(_super=>{function BlockElementSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.symbol=_this.checkString(data.symbol),_this.args=_this.checkArray(data.args).map(function(data){return transform(data).toNode()}),_this}return __extends(BlockElementSyntaxTree,_super),BlockElementSyntaxTree})(NodeSyntaxTree)),InlineElementSyntaxTree=(exports.BlockElementSyntaxTree=BlockElementSyntaxTree,(_super=>{function InlineElementSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.symbol=_this.checkString(data.symbol),_this}return __extends(InlineElementSyntaxTree,_super),InlineElementSyntaxTree})(NodeSyntaxTree)),ColumnSyntaxTree=(exports.InlineElementSyntaxTree=InlineElementSyntaxTree,(_super=>{function ColumnSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.headline=transform(_this.checkObject(data.headline)).toColumnHeadline(),"string"==typeof data.text||null===data.text?_this.text=[]:(_this.text=_this.checkArray(data.text.content).map(transform),delete _this.childNodes,_this.childNodes=[]),_this}return __extends(ColumnSyntaxTree,_super),Object.defineProperty(ColumnSyntaxTree.prototype,"level",{get:function(){return this.headline.level},enumerable:!1,configurable:!0}),Object.defineProperty(ColumnSyntaxTree.prototype,"fqn",{get:function(){var chapters=[];return(0,walker_1.walk)(this,function(node){return node instanceof ChapterSyntaxTree&&chapters.unshift(node),node.parentNode}),chapters.map(function(chapter){return chapter.no}).join(".")},enumerable:!1,configurable:!0}),ColumnSyntaxTree})(NodeSyntaxTree)),ColumnHeadlineSyntaxTree=(exports.ColumnSyntaxTree=ColumnSyntaxTree,(_super=>{function ColumnHeadlineSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.level=_this.checkNumber(data.level),data.label&&(_this.label=transform(_this.checkObject(data.label)).toArgument()),_this.caption=transform(_this.checkObject(data.caption)).toNode(),_this}return __extends(ColumnHeadlineSyntaxTree,_super),ColumnHeadlineSyntaxTree})(SyntaxTree)),ArgumentSyntaxTree=(exports.ColumnHeadlineSyntaxTree=ColumnHeadlineSyntaxTree,(_super=>{function ArgumentSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.arg=_this.checkString(data.arg),_this}return __extends(ArgumentSyntaxTree,_super),ArgumentSyntaxTree})(SyntaxTree)),UlistElementSyntaxTree=(exports.ArgumentSyntaxTree=ArgumentSyntaxTree,(_super=>{function UlistElementSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.level=_this.checkNumber(data.level),_this.text=transform(_this.checkObject(data.text)),delete _this.childNodes,_this.childNodes=[],_this}return __extends(UlistElementSyntaxTree,_super),UlistElementSyntaxTree})(NodeSyntaxTree)),OlistElementSyntaxTree=(exports.UlistElementSyntaxTree=UlistElementSyntaxTree,(_super=>{function OlistElementSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.no=_this.checkNumber(data.no),_this.text=transform(_this.checkObject(data.text)),_this}return __extends(OlistElementSyntaxTree,_super),OlistElementSyntaxTree})(SyntaxTree)),DlistElementSyntaxTree=(exports.OlistElementSyntaxTree=OlistElementSyntaxTree,(_super=>{function DlistElementSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.text=transform(_this.checkObject(data.text)),_this.content=transform(_this.checkObject(data.content)),_this}return __extends(DlistElementSyntaxTree,_super),DlistElementSyntaxTree})(SyntaxTree)),TextNodeSyntaxTree=(exports.DlistElementSyntaxTree=DlistElementSyntaxTree,(_super=>{function TextNodeSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.text=_this.checkString(data.text).replace(/\n+$/,""),_this}return __extends(TextNodeSyntaxTree,_super),TextNodeSyntaxTree})(SyntaxTree)),SingleLineCommentSyntaxTree=(exports.TextNodeSyntaxTree=TextNodeSyntaxTree,(_super=>{function SingleLineCommentSyntaxTree(data){var _this=_super.call(this,data)||this;return _this.text=_this.checkString(data.text).replace(/^#@/,"").replace(/\n+$/,""),_this}return __extends(SingleLineCommentSyntaxTree,_super),SingleLineCommentSyntaxTree})(SyntaxTree));exports.SingleLineCommentSyntaxTree=SingleLineCommentSyntaxTree},{"../../resources/grammar":21,"./walker":18}],16:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.SyntaxPreprocessor=void 0;var parser_1=require("./parser"),walker_1=require("./walker"),utils_1=require("../utils/utils"),require=(()=>{function SyntaxPreprocessor(){}return SyntaxPreprocessor.prototype.start=function(book){var _this=this;this.acceptableSyntaxes=book.acceptableSyntaxes,book.predef.forEach(function(chunk){return _this.preprocessChunk(chunk)}),book.contents.forEach(function(chunk){return _this.preprocessChunk(chunk)}),book.appendix.forEach(function(chunk){return _this.preprocessChunk(chunk)}),book.postdef.forEach(function(chunk){return _this.preprocessChunk(chunk)})},SyntaxPreprocessor.prototype.preprocessChunk=function(chunk){var _this=this;(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node){},visitColumnPre:function(node){_this.preprocessColumnSyntax(chunk,node)},visitBlockElementPre:function(node){_this.preprocessBlockSyntax(chunk,node)}}),chunk.nodes.forEach(function(chunk){return _this.preprocessChunk(chunk)})},SyntaxPreprocessor.prototype.preprocessColumnSyntax=function(chunk,column){(0,walker_1.visit)(column,{visitDefaultPre:function(_node){},visitColumnPre:function(_node){},visitChapterPre:function(node){column.level<node.headline.level||!function reconstruct(parent,target,to){void 0===to&&(to=column.parentNode.toChapter()),target.level<=to.level?reconstruct(parent.parentNode.toNode(),target,to.parentNode.toChapter()):(to.childNodes.splice(to.childNodes.indexOf(parent)+1,0,target),column.text.splice(column.text.indexOf(target),1))}(column,node)}}),(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(ast,parent){ast.parentNode=parent}}),(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_ast,_parent){},visitChapterPre:function(ast){ast.text.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})},visitColumnPre:function(ast){ast.text.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})},visitNodePre:function(ast){ast.childNodes.forEach(function(node,i,nodes){node.prev=nodes[i-1],node.next=nodes[i+1]})}})},SyntaxPreprocessor.prototype.preprocessBlockSyntax=function(chunk,node){var info_1,resultNodes_1,lastNode_1,syntaxes,last,textNode;0===node.childNodes.length||1!==(syntaxes=this.acceptableSyntaxes.find(node)).length||(syntaxes=syntaxes[0]).allowFullySyntax||(syntaxes.allowInline?(resultNodes_1=[],(lastNode_1=info_1=null,walker_1.visit)(node.childNodes[0],{visitDefaultPre:function(node){node.ruleName!==parser_1.RuleName.InlineElementContents&&node.ruleName!==parser_1.RuleName.InlineElementContent&&node.ruleName!==parser_1.RuleName.InlineElementContentText&&(info_1=info_1||{offset:node.location.start.offset,line:node.location.start.line,column:node.location.start.column},lastNode_1=node)},visitInlineElementPre:function(node){var _a=new parser_1.TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:null!=(_a=null==info_1?void 0:info_1.offset)?_a:node.location.start.offset,line:null!=(_a=null==info_1?void 0:info_1.line)?_a:node.location.start.line,column:null!=(_a=null==info_1?void 0:info_1.column)?_a:node.location.start.column},end:{offset:node.location.start.offset,line:void 0,column:void 0}},text:null==(null==info_1?void 0:info_1.offset)?"":chunk.process.input.substring(info_1.offset,node.location.start.offset)});0<_a.text.length&&resultNodes_1.push(_a),resultNodes_1.push(node),info_1=null,lastNode_1=node},visitSingleLineCommentPre:function(node){var textNode;lastNode_1=(info_1&&((textNode=new parser_1.TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:info_1.offset,line:info_1.line,column:info_1.column},end:{offset:node.location.start.offset,line:void 0,column:void 0}},text:chunk.process.input.substring(info_1.offset,node.location.start.offset)})).text&&resultNodes_1.push(textNode),info_1=null),node)}}),info_1&&0<(textNode=new parser_1.TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:info_1.offset,line:info_1.line,column:info_1.column},end:{offset:node.location.start.offset,line:void 0,column:void 0}},text:chunk.process.input.substring(info_1.offset,lastNode_1.location.end.offset)})).text.length&&resultNodes_1.push(textNode),node.childNodes=resultNodes_1):(syntaxes=node.childNodes[0],last=node.childNodes[node.childNodes.length-1],textNode=new parser_1.TextNodeSyntaxTree({syntax:"BlockElementContentText",location:{start:{offset:syntaxes.location.start.offset,line:syntaxes.location.start.line,column:syntaxes.location.start.column},end:{offset:last.location.start.offset,line:void 0,column:void 0}},text:(0,utils_1.nodeContentToString)(chunk.process,node)}),node.childNodes=[textNode]))},SyntaxPreprocessor})();exports.SyntaxPreprocessor=require},{"../utils/utils":20,"./parser":15,"./walker":18}],17:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.DefaultValidator=void 0;var i18n_1=require("../i18n/i18n"),analyzer_1=require("./analyzer"),walker_1=require("./walker"),utils_1=require("../utils/utils"),require=(()=>{function DefaultValidator(){}return DefaultValidator.prototype.start=function(book,acceptableSyntaxes,builders){this.acceptableSyntaxes=acceptableSyntaxes,this.builders=builders,this.checkBuilder(book,acceptableSyntaxes,builders),this.checkBook(book),this.resolveSymbolAndReference(book)},DefaultValidator.prototype.checkBuilder=function(book,acceptableSyntaxes,builders){void 0===builders&&(builders=[]),acceptableSyntaxes.acceptableSyntaxes.forEach(function(syntax){var prefix="";switch(syntax.type){case analyzer_1.SyntaxType.Other:return;case analyzer_1.SyntaxType.Block:prefix="block_";break;case analyzer_1.SyntaxType.Inline:prefix="inline_"}var funcName1=prefix+syntax.symbolName,funcName2=prefix+syntax.symbolName+"_pre";builders.forEach(function(builder){builder[funcName1]||builder[funcName2]||book.process.error(analyzer_1.SyntaxType[syntax.type]+" "+syntax.symbolName+" is not supported in "+builder.name)})})},DefaultValidator.prototype.checkBook=function(book){var _this=this;book.predef.forEach(function(chunk){return _this.checkChunk(chunk)}),book.contents.forEach(function(chunk){return _this.checkChunk(chunk)}),book.appendix.forEach(function(chunk){return _this.checkChunk(chunk)}),book.postdef.forEach(function(chunk){return _this.checkChunk(chunk)})},DefaultValidator.prototype.checkChunk=function(chunk){var _this=this;(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node){},visitHeadlinePre:function(node){var results=_this.acceptableSyntaxes.find(node);if(1===results.length)return results[0].process(chunk.process,node);chunk.process.error((0,i18n_1.t)("compile.syntax_definietion_error"),node)},visitColumnPre:function(node){var results=_this.acceptableSyntaxes.find(node);if(1===results.length)return results[0].process(chunk.process,node);chunk.process.error((0,i18n_1.t)("compile.syntax_definietion_error"),node)},visitBlockElementPre:function(node){var results=_this.acceptableSyntaxes.find(node);if(1!==results.length)chunk.process.error((0,i18n_1.t)("compile.block_not_supported",node.symbol),node);else{var expects=results[0].argsLength,arg=node.args||[];if(-1!==expects.indexOf(arg.length))return results[0].process(chunk.process,node);results=expects.map(function(n){return Number(n).toString()}).join(" or "),expects=(0,i18n_1.t)("compile.args_length_mismatch",results,arg.length),chunk.process.error(expects,node)}},visitInlineElementPre:function(node){var results=_this.acceptableSyntaxes.find(node);if(1===results.length)return results[0].process(chunk.process,node);chunk.process.error((0,i18n_1.t)("compile.inline_not_supported",node.symbol),node)}}),(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node){},visitChapterPre:function(node){1===node.level?(0,utils_1.findChapter)(node)||chunk.process.error((0,i18n_1.t)("compile.chapter_not_toplevel"),node):(0,utils_1.findChapter)(node.parentNode)||chunk.process.error((0,i18n_1.t)("compile.chapter_topleve_eq1"),node)}}),this.chechBlockGraphTool(chunk)},DefaultValidator.prototype.chechBlockGraphTool=function(chunk){(0,walker_1.visit)(chunk.tree.ast,{visitDefaultPre:function(_node){},visitBlockElementPre:function(node){if("graph"===node.symbol){var toolNameNode=node.args[1];if(toolNameNode){var toolName=(0,utils_1.nodeContentToString)(chunk.process,toolNameNode);switch(toolName){case"graphviz":break;case"gnuplot":case"blockdiag":case"aafigure":chunk.process.info((0,i18n_1.t)("compile.graph_tool_is_not_recommended"),toolNameNode);break;default:chunk.process.error((0,i18n_1.t)("compile.unknown_graph_tool",toolName),toolNameNode)}}}}})},DefaultValidator.prototype.resolveSymbolAndReference=function(book){var symbols=book.allChunks.reduce(function(p,c){return p.concat(c.process.symbols)},[]);symbols.forEach(function(symbol){var chapterFileName_1,referenceTo=symbol.referenceTo;referenceTo&&!referenceTo.chapter&&referenceTo.chapterName&&(chapterFileName_1="".concat(referenceTo.chapterName,".re"),book.allChunks.forEach(function(chunk){chapterFileName_1===chunk.name&&(referenceTo.chapter=chunk)}))}),symbols.forEach(function(symbol){var _a,reference_1;symbol.referenceTo&&!symbol.referenceTo.referenceNode&&(reference_1=symbol.referenceTo,symbols.forEach(function(symbol){reference_1.chapter!==symbol.chapter||reference_1.targetSymbol!==symbol.symbolName||null!=reference_1.label&&reference_1.label!==symbol.labelName||(reference_1.referenceNode=symbol.node)}),reference_1.referenceNode||symbol.chapter.process.error((0,i18n_1.t)("compile.reference_is_missing",reference_1.targetSymbol,null!=(_a=reference_1.label)?_a:reference_1.chapterName),symbol.node))}),symbols.forEach(function(symbol1){symbols.forEach(function(symbol2){symbol1!==symbol2&&symbol1.chapter===symbol2.chapter&&symbol1.symbolName===symbol2.symbolName&&symbol1.labelName&&symbol2.labelName&&symbol1.labelName===symbol2.labelName&&("hd"===symbol1.symbolName?symbol1.chapter.process.error((0,i18n_1.t)("compile.duplicated_label_headline"),symbol1.node,symbol2.node):symbol1.chapter.process.error((0,i18n_1.t)("compile.duplicated_label"),symbol1.node,symbol2.node))})})},DefaultValidator})();exports.DefaultValidator=require},{"../i18n/i18n":8,"../utils/utils":20,"./analyzer":14,"./walker":18}],18:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.walk=function walk(ast,actor){if(!ast)return;ast=actor(ast);ast&&walk(ast,actor)},exports.visit=function(ast,v){_visit(function(){return new SyncTaskPool},ast,v)},exports.visitAsync=function(ast,v){return Promise.resolve(_visit(function(){return new AsyncTaskPool},ast,v))};var parser_1=require("./parser");function _visit(poolGenerator,ast,v){var newV={visitDefaultPre:v.visitDefaultPre,visitDefaultPost:v.visitDefaultPost||function(){},visitBlockElementPre:v.visitBlockElementPre||v.visitNodePre||v.visitDefaultPre,visitBlockElementPost:v.visitBlockElementPost||v.visitNodePost||v.visitDefaultPost||function(){},visitInlineElementPre:v.visitInlineElementPre||v.visitNodePre||v.visitDefaultPre,visitInlineElementPost:v.visitInlineElementPost||v.visitNodePost||v.visitDefaultPost||function(){},visitNodePre:v.visitNodePre||v.visitDefaultPre,visitNodePost:v.visitNodePost||v.visitDefaultPost||function(){},visitArgumentPre:v.visitArgumentPre||v.visitDefaultPre,visitArgumentPost:v.visitArgumentPost||v.visitDefaultPost||function(){},visitChapterPre:v.visitChapterPre||v.visitNodePre||v.visitDefaultPre,visitChapterPost:v.visitChapterPost||v.visitNodePost||v.visitDefaultPost||function(){},visitParagraphPre:v.visitParagraphPre||v.visitNodePre||v.visitDefaultPre,visitParagraphPost:v.visitParagraphPost||v.visitNodePost||function(){},visitHeadlinePre:v.visitHeadlinePre||v.visitDefaultPre,visitHeadlinePost:v.visitHeadlinePost||v.visitDefaultPost||function(){},visitUlistPre:v.visitUlistPre||v.visitNodePre||v.visitDefaultPre,visitUlistPost:v.visitUlistPost||v.visitNodePost||v.visitDefaultPost||function(){},visitOlistPre:v.visitOlistPre||v.visitDefaultPre,visitOlistPost:v.visitOlistPost||v.visitDefaultPost||function(){},visitDlistPre:v.visitDlistPre||v.visitDefaultPre,visitDlistPost:v.visitDlistPost||v.visitDefaultPost||function(){},visitColumnPre:v.visitColumnPre||v.visitNodePre||v.visitDefaultPre,visitColumnPost:v.visitColumnPost||v.visitNodePost||v.visitDefaultPost||function(){},visitColumnHeadlinePre:v.visitColumnHeadlinePre||v.visitDefaultPre,visitColumnHeadlinePost:v.visitColumnHeadlinePost||v.visitDefaultPost||function(){},visitTextPre:v.visitTextPre||v.visitDefaultPre,visitTextPost:v.visitTextPost||v.visitDefaultPost||function(){},visitSingleLineCommentPre:v.visitSingleLineCommentPre||v.visitDefaultPre,visitSingleLineCommentPost:v.visitSingleLineCommentPost||v.visitDefaultPost||function(){}};return newV.visitDefaultPre=newV.visitDefaultPre.bind(v),newV.visitDefaultPost=newV.visitDefaultPost.bind(v),newV.visitBlockElementPre=newV.visitBlockElementPre.bind(v),newV.visitBlockElementPost=newV.visitBlockElementPost.bind(v),newV.visitInlineElementPre=newV.visitInlineElementPre.bind(v),newV.visitInlineElementPost=newV.visitInlineElementPost.bind(v),newV.visitNodePre=newV.visitNodePre.bind(v),newV.visitNodePost=newV.visitNodePost.bind(v),newV.visitArgumentPre=newV.visitArgumentPre.bind(v),newV.visitArgumentPost=newV.visitArgumentPost.bind(v),newV.visitChapterPre=newV.visitChapterPre.bind(v),newV.visitChapterPost=newV.visitChapterPost.bind(v),newV.visitHeadlinePre=newV.visitHeadlinePre.bind(v),newV.visitHeadlinePost=newV.visitHeadlinePost.bind(v),newV.visitUlistPre=newV.visitUlistPre.bind(v),newV.visitUlistPost=newV.visitUlistPost.bind(v),newV.visitOlistPre=newV.visitOlistPre.bind(v),newV.visitOlistPost=newV.visitOlistPost.bind(v),newV.visitDlistPre=newV.visitDlistPre.bind(v),newV.visitDlistPost=newV.visitDlistPost.bind(v),newV.visitColumnPre=newV.visitColumnPre.bind(v),newV.visitColumnPost=newV.visitColumnPost.bind(v),newV.visitColumnHeadlinePre=newV.visitColumnHeadlinePre.bind(v),newV.visitColumnHeadlinePost=newV.visitColumnHeadlinePost.bind(v),newV.visitTextPre=newV.visitTextPre.bind(v),newV.visitTextPost=newV.visitTextPost.bind(v),newV.visitSingleLineCommentPre=newV.visitSingleLineCommentPre.bind(v),newV.visitSingleLineCommentPost=newV.visitSingleLineCommentPost.bind(v),function _visitSub(poolGenerator,parent,ast,v){{var _ast_1,_ast_2,_ast_3,_ast_4,_ast_5,_ast_6,_ast_7,_ast_8,_ast_9,_ast_10,_ast_11,_ast_12,_ast_13,_ast_14;return(ast instanceof parser_1.BlockElementSyntaxTree?(_ast_1=ast,()=>{var pool=poolGenerator(),ret=v.visitBlockElementPre(ast,parent);return pool.handle(ret,{next:function(){_ast_1.args.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})}),_ast_1.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitBlockElementPost(_ast_1,parent)}),pool.consume()}):ast instanceof parser_1.InlineElementSyntaxTree?(_ast_2=ast,()=>{var pool=poolGenerator(),ret=v.visitInlineElementPre(ast,parent);return pool.handle(ret,{next:function(){_ast_2.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitInlineElementPost(_ast_2,parent)}),pool.consume()}):ast instanceof parser_1.ArgumentSyntaxTree?(_ast_3=ast,()=>{var pool=poolGenerator(),ret=v.visitArgumentPre(_ast_3,parent);return pool.handle(ret,{next:function(){},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitArgumentPost(_ast_3,parent)}),pool.consume()}):ast instanceof parser_1.ChapterSyntaxTree?(_ast_4=ast,()=>{var pool=poolGenerator(),ret=v.visitChapterPre(_ast_4,parent);return pool.handle(ret,{next:function(){_ast_4.comments&&_ast_4.comments.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})}),pool.add(function(){return _visitSub(poolGenerator,_ast_4,_ast_4.headline,v)}),_ast_4.text&&_ast_4.text.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})}),_ast_4.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitChapterPost(_ast_4,parent)}),pool.consume()}):ast instanceof parser_1.HeadlineSyntaxTree?(_ast_5=ast,()=>{var pool=poolGenerator(),ret=v.visitHeadlinePre(ast,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_5,_ast_5.label,v)}),pool.add(function(){return _visitSub(poolGenerator,_ast_5,_ast_5.caption,v)})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitHeadlinePost(_ast_5,parent)}),pool.consume()}):ast instanceof parser_1.ColumnSyntaxTree?(_ast_6=ast,()=>{var pool=poolGenerator(),ret=v.visitColumnPre(_ast_6,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_6,_ast_6.headline,v)}),_ast_6.text&&_ast_6.text.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitColumnPost(_ast_6,parent)}),pool.consume()}):ast instanceof parser_1.ColumnHeadlineSyntaxTree?(_ast_7=ast,()=>{var pool=poolGenerator(),ret=v.visitColumnHeadlinePre(_ast_7,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_7,_ast_7.caption,v)})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitColumnHeadlinePost(_ast_7,parent)}),pool.consume()}):ast instanceof parser_1.UlistElementSyntaxTree?(_ast_8=ast,()=>{var pool=poolGenerator(),ret=v.visitUlistPre(ast,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_8,_ast_8.text,v)}),_ast_8.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,ast,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitUlistPost(_ast_8,parent)}),pool.consume()}):ast instanceof parser_1.OlistElementSyntaxTree?(_ast_9=ast,()=>{var pool=poolGenerator(),ret=v.visitOlistPre(ast,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_9,_ast_9.text,v)})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitOlistPost(_ast_9,parent)}),pool.consume()}):ast instanceof parser_1.DlistElementSyntaxTree?(_ast_10=ast,()=>{var pool=poolGenerator(),ret=v.visitDlistPre(ast,parent);return pool.handle(ret,{next:function(){pool.add(function(){return _visitSub(poolGenerator,_ast_10,_ast_10.text,v)}),pool.add(function(){return _visitSub(poolGenerator,_ast_10,_ast_10.content,v)})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitDlistPost(_ast_10,parent)}),pool.consume()}):ast instanceof parser_1.NodeSyntaxTree&&(ast.ruleName===parser_1.RuleName.Paragraph||ast.ruleName===parser_1.RuleName.BlockElementParagraph)?(_ast_11=ast,()=>{var pool=poolGenerator(),ret=v.visitParagraphPre(_ast_11,parent);return pool.handle(ret,{next:function(){_ast_11.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,_ast_11,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitParagraphPost(_ast_11,parent)}),pool.consume()}):ast instanceof parser_1.NodeSyntaxTree?(_ast_12=ast,()=>{var pool=poolGenerator(),ret=v.visitNodePre(_ast_12,parent);return pool.handle(ret,{next:function(){_ast_12.childNodes.forEach(function(next){pool.add(function(){return _visitSub(poolGenerator,_ast_12,next,v)})})},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitNodePost(_ast_12,parent)}),pool.consume()}):ast instanceof parser_1.TextNodeSyntaxTree?(_ast_13=ast,()=>{var pool=poolGenerator(),ret=v.visitTextPre(_ast_13,parent);return pool.handle(ret,{next:function(){},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitTextPost(_ast_13,parent)}),pool.consume()}):ast instanceof parser_1.SingleLineCommentSyntaxTree?(_ast_14=ast,()=>{var pool=poolGenerator(),ret=v.visitSingleLineCommentPre(_ast_14,parent);return pool.handle(ret,{next:function(){},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitSingleLineCommentPost(_ast_14,parent)}),pool.consume()}):ast?()=>{var pool=poolGenerator(),ret=v.visitDefaultPre(ast,parent);return pool.handle(ret,{next:function(){},func:function(){"function"==typeof ret&&ret(v)}}),pool.add(function(){return v.visitDefaultPost(ast,parent)}),pool.consume()}:()=>{var pool=poolGenerator();return pool.consume()})()}}(poolGenerator,null,ast,newV)}var SyncTaskPool=(()=>{function SyncTaskPool(){this.tasks=[]}return SyncTaskPool.prototype.add=function(value){this.tasks.push(value)},SyncTaskPool.prototype.handle=function(value,statements){void 0===value||"boolean"==typeof value&&value?statements.next():"function"==typeof value&&statements.func()},SyncTaskPool.prototype.consume=function(){return this.tasks.map(function(task){return task()})},SyncTaskPool})(),AsyncTaskPool=(()=>{function AsyncTaskPool(){this.tasks=[]}return AsyncTaskPool.prototype.add=function(value){this.tasks.push(function(){return Promise.resolve(value())})},AsyncTaskPool.prototype.handle=function(value,statements){void 0===value||"boolean"==typeof value&&value?statements.next():value&&"function"==typeof value.then?this.tasks.push(function(){return Promise.resolve(value)}):"function"==typeof value&&statements.func()},AsyncTaskPool.prototype.consume=function(){var _this=this;return new Promise(function(resolve){function next(){var func=_this.tasks.shift();func?func().then(function(value){result.push(value),next()}):resolve(result)}var result=[];next()})},AsyncTaskPool})()},{"./parser":15}],19:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.setup=function(_env){env=_env},exports.content=function(ruleName,c){return{syntax:checkRuleName(ruleName),location:env.location(),content:c}},exports.contents=function(ruleName,c,cc){var processed=[c];cc&&(Array.isArray(cc.content)?cc.content.forEach(function(c){return processed.push(c)}):processed.push(cc.content));return{syntax:checkRuleName(ruleName),location:env.location(),content:processed}},exports.text=function(ruleName,text){return{syntax:checkRuleName(ruleName),location:env.location(),text:text}},exports.chapter=function(comments,headline,text){return{syntax:checkRuleName("Chapter"),location:env.location(),comments:comments,headline:headline,text:text}},exports.headline=function(level,label,caption){return{syntax:checkRuleName("Headline"),location:env.location(),level:level.length,label:label,caption:caption}},exports.blockElement=function(symbol,args,contents){void 0===contents&&(contents=[]);return{syntax:checkRuleName("BlockElement"),location:env.location(),symbol:symbol,args:args,content:contents}},exports.inlineElement=function(symbol,contents){void 0===contents&&(contents=[]);return{syntax:checkRuleName("InlineElement"),location:env.location(),symbol:symbol,content:contents}},exports.column=function(headline,text){return{syntax:checkRuleName("Column"),location:env.location(),headline:headline,text:text}},exports.columnHeadline=function(level,label,caption){return{syntax:checkRuleName("ColumnHeadline"),location:env.location(),level:level.length,label:label,caption:caption}},exports.columnTerminator=function(level){return{syntax:checkRuleName("ColumnTerminator"),location:env.location(),level:level.length}},exports.braceArg=function(arg){return{syntax:checkRuleName("BraceArg"),location:env.location(),arg:arg}},exports.ulistElement=function(level,text){return{syntax:checkRuleName("UlistElement"),location:env.location(),level:level.length,text:text}},exports.olistElement=function(n,text){return{syntax:checkRuleName("OlistElement"),location:env.location(),no:parseInt(n,10),text:text}},exports.dlistElement=function(text,content){return{syntax:checkRuleName("DlistElement"),location:env.location(),text:text,content:content}};var env,parser_1=require("../parser/parser");function checkRuleName(ruleName){if(parser_1.RuleName[ruleName])return ruleName;throw new Error("unknown rule: ".concat(ruleName))}},{"../parser/parser":15}],20:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.Exec=exports.IO=void 0,exports.isBrowser=isBrowser,exports.isNodeJS=function(){return"undefined"!=typeof atom||!isBrowser()&&"object"==typeof exports},exports.isAMD=isAMD,exports.flatten=function flatten(data){return data.some(function(d){return Array.isArray(d)})?flatten(data.reduce(function(p,c){return p.concat(c)},[])):data},exports.nodeToString=function(process,node){return process.input.substring(node.location.start.offset,node.location.end.offset)},exports.nodeContentToString=function(process,node,textOnly){var minPos=Number.MAX_VALUE,maxPos=-1,childVisitor={visitDefaultPre:function(node){minPos=Math.min(minPos,node.location.start.offset),maxPos=Math.max(maxPos,node.location.end.offset)}},visitor=null;return visitor={visitDefaultPre:function(_node){},visitNodePre:function(node){return node.childNodes.forEach(function(child){return(0,walker_1.visit)(child,textOnly?visitor:childVisitor)}),!1},visitHeadlinePre:function(node){return(0,walker_1.visit)(node.caption,childVisitor),!1},visitUlistPre:function(node){return(0,walker_1.visit)(node.text,childVisitor),!1},visitDlistPre:function(node){return(0,walker_1.visit)(node.text,childVisitor),(0,walker_1.visit)(node.content,childVisitor),!1},visitOlistPre:function(node){return(0,walker_1.visit)(node.text,childVisitor),!1},visitTextPre:function(text){return(0,walker_1.visit)(textOnly?text:node,childVisitor),!1}},(0,walker_1.visit)(node,visitor),maxPos<0?"":process.input.substring(minPos,maxPos)},exports.findUp=function(node,predicate){var result=null;return(0,walker_1.walk)(node,function(node){return predicate(node)?(result=node,null):node.parentNode}),result},exports.findChapter=function(node,level){var chapter=null;return(0,walker_1.walk)(node,function(node){return node instanceof parser_1.ChapterSyntaxTree&&(chapter=node,void 0===level||node.level===level)?null:node.parentNode}),chapter},exports.findChapterOrColumn=function(node,level){var chapter=null,column=null;return(0,walker_1.walk)(node,function(node){if(node instanceof parser_1.ChapterSyntaxTree){if(chapter=node,void 0===level||node.level===level)return null}else if(node instanceof parser_1.ColumnSyntaxTree&&(column=node,void 0===level||node.level===level))return null;return node.parentNode}),chapter||column},exports.getHeadlineLevels=function(node){for(var numbers={},maxLevel=0,result=((0,walker_1.walk)(node,function(node){return node instanceof parser_1.ChapterSyntaxTree?(numbers[node.level]=node.no,maxLevel=Math.max(maxLevel,node.level)):node instanceof parser_1.ColumnSyntaxTree&&(numbers[node.level]=-1,maxLevel=Math.max(maxLevel,node.level)),node.parentNode}),[]),i=1;i<=maxLevel;i++)result.push(-1===numbers[i]?0:void 0===numbers[i]?1:numbers[i]||0);return result},exports.target2builder=target2builder,exports.linesToFigure=function(lines){return String(lines).length},exports.padLeft=function(str,pad,maxLength){if(maxLength<=str.length)return str;return stringRepeat(maxLength-str.length,pad)+str},exports.stringRepeat=stringRepeat;require("../model/compilerModel");var parser_1=require("../parser/parser"),textBuilder_1=require("../builder/textBuilder"),htmlBuilder_1=require("../builder/htmlBuilder"),analyzer_1=require("../parser/analyzer"),validator_1=require("../parser/validator"),walker_1=require("../parser/walker"),index_1=require("../index");function isBrowser(){return"undefined"!=typeof window}function isAMD(){return!1}function target2builder(target){target=target.charAt(0).toUpperCase()+target.substring(1)+"Builder";return"TextBuilder"==target?new textBuilder_1.TextBuilder:"HtmlBuilder"==target?new htmlBuilder_1.HtmlBuilder:null}function stringRepeat(times,src){return new Array(times+1).join(src)}(IO=>{IO.read=function(path){var fs=require("fs");return new Promise(function(resolve,reject){fs.readFile(path,{encoding:"utf8"},function(err,data){err?reject(err):resolve(data)})})},IO.write=function(path,content){var fs=require("fs");return new Promise(function(resolve,reject){fs.writeFile(path,content,function(err){err?reject(err):resolve(null)})})}})(exports.IO={}),(Exec=>{Exec.singleCompile=function(input,fileName,target,tmpConfig){var config=tmpConfig||{};if(config.read=config.read||function(){return Promise.resolve(input)},config.analyzer=config.analyzer||new analyzer_1.DefaultAnalyzer,config.validators=config.validators||[new validator_1.DefaultValidator],target&&null==target2builder(target)&&(console.error(target+" is not exists in builder"),process.exit(1)),config.builders=config.builders,!config.builders)if(target){tmpConfig=target2builder(target);if(!tmpConfig)return Promise.reject("unknown target: ".concat(target));config.builders=[tmpConfig]}else config.builders=[new textBuilder_1.TextBuilder];config.book=config.book||{contents:[{file:fileName}]},config.book.contents=config.book.contents||[{file:fileName}];var results={},originalCompileSuccess=(config.write=config.write||function(path,content){return results[path]=content},config.listener=config.listener||{onReports:function(){},onCompileSuccess:function(){},onCompileFailed:function(){}},config.listener.onReports=config.listener.onReports||function(){},config.listener.onCompileSuccess=config.listener.onCompileSuccess||function(){},config.listener.onCompileFailed=config.listener.onCompileFailed||function(){},config.listener.onCompileSuccess),originalCompileFailed=(config.listener.onCompileSuccess=function(book){originalCompileSuccess(book)},config.listener.onCompileFailed);return config.listener.onCompileFailed=function(book){originalCompileFailed(book)},(0,index_1.start)(function(review){review.initConfig(config)}).then(function(book){return{book:book,results:results}})}})(exports.Exec={})},{"../builder/htmlBuilder":2,"../builder/textBuilder":3,"../index":11,"../model/compilerModel":13,"../parser/analyzer":14,"../parser/parser":15,"../parser/validator":17,"../parser/walker":18,fs:void 0}],21:[function(require,module,exports){function peg$SyntaxError(message,expected,found,location){this.message=message,this.expected=expected,this.found=found,this.location=location,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function ctor(){this.constructor=child}var child,parent;child=peg$SyntaxError,parent=Error,ctor.prototype=parent.prototype,child.prototype=new ctor,peg$SyntaxError.buildMessage=function(expected,found){var DESCRIBE_EXPECTATION_FNS={literal:function(expectation){return'"'+literalEscape(expectation.text)+'"'},class:function(expectation){for(var escapedParts="",i=0;i<expectation.parts.length;i++)escapedParts+=expectation.parts[i]instanceof Array?classEscape(expectation.parts[i][0])+"-"+classEscape(expectation.parts[i][1]):classEscape(expectation.parts[i]);return"["+(expectation.inverted?"^":"")+escapedParts+"]"},any:function(expectation){return"any character"},end:function(expectation){return"end of input"},other:function(expectation){return expectation.description}};function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}function literalEscape(s){return s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(ch){return"\\x"+hex(ch)})}function classEscape(s){return s.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(ch){return"\\x"+hex(ch)})}return"Expected "+(expected=>{for(var j,expectation,descriptions=new Array(expected.length),i=0;i<expected.length;i++)descriptions[i]=DESCRIBE_EXPECTATION_FNS[(expectation=expected[i]).type](expectation);if(descriptions.sort(),0<descriptions.length){for(j=i=1;i<descriptions.length;i++)descriptions[i-1]!==descriptions[i]&&(descriptions[j]=descriptions[i],j++);descriptions.length=j}switch(descriptions.length){case 1:return descriptions[0];case 2:return descriptions[0]+" or "+descriptions[1];default:return descriptions.slice(0,-1).join(", ")+", or "+descriptions[descriptions.length-1]}})(expected)+" but "+(found=>found?'"'+literalEscape(found)+'"':"end of input")(found)+" found."},module.exports={SyntaxError:peg$SyntaxError,parse:function(input,options){var peg$FAILED={},peg$startRuleFunctions={Start:peg$parseStart},peg$startRuleFunction=peg$parseStart,peg$c0=peg$otherExpectation("start"),peg$c1=function(c){return b.content("Start",c)},peg$c2=peg$otherExpectation("chapters"),peg$c3=function(c,cc){return b.contents("Chapters",c,cc)},peg$c4=peg$otherExpectation("chapter"),peg$c5=function(comments,headline,text){return b.chapter(comments,headline,text)},peg$c6=peg$otherExpectation("headline"),peg$c7="=",peg$c8=peg$literalExpectation("=",!1),peg$c9=function(level,label,caption){return b.headline(level,label,caption)},peg$c10=peg$otherExpectation("contents"),peg$c11={type:"any"},peg$c12=function(c,cc){return b.contents("Contents",c,cc)},peg$c13=peg$otherExpectation("content"),peg$c14=function(c){return b.content("Content",c)},peg$c15=peg$otherExpectation("paragraph"),peg$c16=function(c){return b.content("Paragraph",c)},peg$c17=peg$otherExpectation("paragraph subs"),peg$c18=function(c,cc){return b.contents("ParagraphSubs",c,cc)},peg$c19=peg$otherExpectation("paragraph sub"),peg$c20=function(c){return b.content("ParagraphSub",c)},peg$c21=peg$otherExpectation("text of content"),peg$c22=/^[^\r\n]/,peg$c23=peg$classExpectation(["\r","\n"],!0,!1),peg$c24=function(text){return b.text("ContentText",text)},peg$c25=peg$otherExpectation("block element"),peg$c26="//",peg$c27=peg$literalExpectation("//",!1),peg$c28="{",peg$c29=peg$literalExpectation("{",!1),peg$c30="//}",peg$c31=peg$literalExpectation("//}",!1),peg$c32=function(symbol,args,contents){return b.blockElement(symbol,args,contents)},peg$c33=function(symbol,args){return b.blockElement(symbol,args)},peg$c34=peg$otherExpectation("inline element"),peg$c35="@<",peg$c36=peg$literalExpectation("@<",!1),peg$c37=/^[^>\r\n]/,peg$c38=peg$classExpectation([">","\r","\n"],!0,!1),peg$c39=">",peg$c40=peg$literalExpectation(">",!1),peg$c41="}",peg$c42=peg$literalExpectation("}",!1),peg$c43=function(symbol,contents){return b.inlineElement(symbol,contents)},peg$c44="|",peg$c45=peg$literalExpectation("|",!1),peg$c46="$",peg$c47=peg$literalExpectation("$",!1),peg$c48=peg$otherExpectation("column"),peg$c49=function(headline,text){return b.column(headline,text)},peg$c50=peg$otherExpectation("column headline"),peg$c51="[column]",peg$c52=peg$literalExpectation("[column]",!1),peg$c53=function(level,label,caption){return b.columnHeadline(level,label,caption)},peg$c54=peg$otherExpectation("column contents"),peg$c55=function(c,cc){return b.contents("ColumnContents",c,cc)},peg$c56=peg$otherExpectation("column content"),peg$c57=function(c){return b.content("ColumnContent",c)},peg$c58=peg$otherExpectation("column terminator"),peg$c59="[/column]",peg$c60=peg$literalExpectation("[/column]",!1),peg$c61=function(level){return b.columnTerminator(level)},peg$c62=peg$otherExpectation("bracket argument"),peg$c63="[",peg$c64=peg$literalExpectation("[",!1),peg$c65="]",peg$c66=peg$literalExpectation("]",!1),peg$c67=function(c){return b.content("BracketArg",c)},peg$c68=peg$otherExpectation("bracket arg subs"),peg$c69=function(c,cc){return b.contents("BracketArgSubs",c,cc)},peg$c70=peg$otherExpectation("bracket arg sub"),peg$c71=function(c){return b.content("BracketArgSub",c)},peg$c72=peg$otherExpectation("text of bracket arg"),peg$c73="\\\\",peg$c74=peg$literalExpectation("\\\\",!1),peg$c75="\\]",peg$c76=peg$literalExpectation("\\]",!1),peg$c77="\\",peg$c78=peg$literalExpectation("\\",!1),peg$c79=function(text){return b.text("BracketArgText",text)},peg$c80=peg$otherExpectation("brace argument"),peg$c81=/^[^\r\n}\\]/,peg$c82=peg$classExpectation(["\r","\n","}","\\"],!0,!1),peg$c83="\\}",peg$c84=peg$literalExpectation("\\}",!1),peg$c85=function(arg){return b.braceArg(arg)},peg$c86=peg$otherExpectation("contents of block element"),peg$c87=function(c,cc){return b.contents("BlockElementContents",c,cc)},peg$c88=peg$otherExpectation("content of block element"),peg$c89=function(c){return b.content("BlockElementContent",c)},peg$c90=peg$otherExpectation("paragraph in block"),peg$c91=peg$otherExpectation("paragraph subs in block"),peg$c92=peg$otherExpectation("paragraph sub in block"),peg$c93=peg$otherExpectation("text of content in block"),peg$c94=peg$otherExpectation("contents of inline element"),peg$c95=function(c,cc){return b.contents("InlineElementContents",c,cc)},peg$c96=peg$otherExpectation("content of inline element"),peg$c97=function(c){var message="Inlines cannot not contain other inlines.",location=void 0;throw location=void 0!==location?location:peg$computeLocation(peg$savedPos,peg$currPos),((message,location)=>new peg$SyntaxError(message,null,null,location))(message,location)},peg$c98=function(c){return b.content("InlineElementContent",c)},peg$c99=peg$otherExpectation("text of inline element"),peg$c100=function(text){return b.text("InlineElementContentText",text.map(function(x){return x.filter(function(y){return null!=y}).join("")}).join(""))},peg$c101=peg$otherExpectation("char of inline element content"),peg$c102="\r\n",peg$c103=peg$literalExpectation("\r\n",!1),peg$c104="\n",peg$c105=peg$literalExpectation("\n",!1),peg$c106=function(char){return char},peg$c107=function(){return"\\"},peg$c108=function(){return"}"},peg$c109="\\|",peg$c110=peg$literalExpectation("\\|",!1),peg$c111=function(){return"|"},peg$c112="\\$",peg$c113=peg$literalExpectation("\\$",!1),peg$c114=function(){return"$"},peg$c115=peg$otherExpectation("inline content"),peg$c116=function(c){return b.content("SinglelineContent",c)},peg$c117=peg$otherExpectation("children of inline content"),peg$c118=function(c,cc){return b.contents("ContentInlines",c,cc)},peg$c119=peg$otherExpectation("child of inline content"),peg$c120=function(c){return b.content("ContentInline",c)},peg$c121=peg$otherExpectation("text of child of inline content"),peg$c122=function(text){return b.text("ContentInlineText",text)},peg$c123=peg$otherExpectation("ulist"),peg$c124=function(c,cc){return b.contents("Ulist",c,cc)},peg$c125=peg$otherExpectation("ulist element"),peg$c126=" ",peg$c127=peg$literalExpectation(" ",!1),peg$c128="*",peg$c129=peg$literalExpectation("*",!1),peg$c130=function(level,text){return b.ulistElement(level,text)},peg$c131=peg$otherExpectation("olist"),peg$c132=function(c,cc){return b.contents("Olist",c,cc)},peg$c133=peg$otherExpectation("olist element"),peg$c134=".",peg$c135=peg$literalExpectation(".",!1),peg$c136=function(n,text){return b.olistElement(n,text)},peg$c137=peg$otherExpectation("dlist"),peg$c138=function(c,cc){return b.contents("Dlist",c,cc)},peg$c139=peg$otherExpectation("dlist element"),peg$c140=":",peg$c141=peg$literalExpectation(":",!1),peg$c142=function(text,content){return b.dlistElement(text,content)},peg$c143=peg$otherExpectation("contents of dlist element"),peg$c144=function(c,cc){return b.contents("DlistElementContents",c,cc)},peg$c145=peg$otherExpectation("content of dlist element"),peg$c146=/^[ \t]/,peg$c147=peg$classExpectation([" ","\t"],!1,!1),peg$c148=function(c){return b.content("DlistElementContent",c)},peg$c149=peg$otherExpectation("signle line comments"),peg$c150=function(c,cc){return b.contents("SinglelineComments",c,cc)},peg$c151=peg$otherExpectation("signle line comment"),peg$c152="#@",peg$c153=peg$literalExpectation("#@",!1),peg$c154=function(text){return b.text("SinglelineComment",text)},peg$c155=peg$otherExpectation("digits"),peg$c156=peg$otherExpectation("digit"),peg$c157=/^[0-9]/,peg$c158=peg$classExpectation([["0","9"]],!1,!1),peg$c159=peg$otherExpectation("lower alphabet"),peg$c160=/^[a-z]/,peg$c161=peg$classExpectation([["a","z"]],!1,!1),peg$c162=peg$otherExpectation("newline"),peg$c163=peg$otherExpectation("blank lines"),peg$c164=peg$otherExpectation("spacer"),peg$c165=/^[ \t\r\n]/,peg$c166=peg$classExpectation([" ","\t","\r","\n"],!1,!1),peg$c167=peg$otherExpectation("space"),peg$c168=/^[ \u3000\t]/,peg$c169=peg$classExpectation([" ","　","\t"],!1,!1),peg$c170=peg$otherExpectation("end of file"),peg$currPos=0,peg$savedPos=0,peg$posDetailsCache=[{line:1,column:1}],peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0;if("startRule"in(options=void 0!==options?options:{})){if(!(options.startRule in peg$startRuleFunctions))throw new Error("Can't start parsing from rule \""+options.startRule+'".');peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}function peg$literalExpectation(text,ignoreCase){return{type:"literal",text:text,ignoreCase:ignoreCase}}function peg$classExpectation(parts,inverted,ignoreCase){return{type:"class",parts:parts,inverted:inverted,ignoreCase:ignoreCase}}function peg$otherExpectation(description){return{type:"other",description:description}}function peg$computePosDetails(pos){var p,details=peg$posDetailsCache[pos];if(details)return details;for(p=pos-1;!peg$posDetailsCache[p];)p--;for(details={line:(details=peg$posDetailsCache[p]).line,column:details.column};p<pos;)10===input.charCodeAt(p)?(details.line++,details.column=1):details.column++,p++;return peg$posDetailsCache[pos]=details}function peg$computeLocation(startPos,endPos){var startPosDetails=peg$computePosDetails(startPos),endPosDetails=peg$computePosDetails(endPos);return{start:{offset:startPos,line:startPosDetails.line,column:startPosDetails.column},end:{offset:endPos,line:endPosDetails.line,column:endPosDetails.column}}}function peg$fail(expected){peg$currPos<peg$maxFailPos||(peg$maxFailPos<peg$currPos&&(peg$maxFailPos=peg$currPos,peg$maxFailExpected=[]),peg$maxFailExpected.push(expected))}function peg$buildStructuredError(expected,found,location){return new peg$SyntaxError(peg$SyntaxError.buildMessage(expected,found),expected,found,location)}function peg$parseStart(){var s0,s2;return peg$silentFails++,s0=peg$currPos,s0=peg$parse_()!==peg$FAILED&&(s2=(s2=function peg$parseChapters(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseChapter();s0=s1!==peg$FAILED&&(s2=peg$parseChapters(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c3(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c2);return s0}())===peg$FAILED?null:s2)!==peg$FAILED&&peg$parse_()!==peg$FAILED?(peg$savedPos=s0,peg$c1(s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&0===peg$silentFails&&peg$fail(peg$c0),s0}function peg$parseChapter(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s0=(s1=(s1=function peg$parseSinglelineComments(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseSinglelineComment();s0=s1!==peg$FAILED&&(s2=peg$parseSinglelineComments(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c150(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c149);return s0}())===peg$FAILED?null:s1)!==peg$FAILED&&(s2=peg$parseHeadline())!==peg$FAILED&&(s3=(s3=function peg$parseContents(){var s0,s1,s2,s3;peg$silentFails++;s0=peg$currPos;s1=peg$currPos;peg$silentFails++;input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11));peg$silentFails--;s1=s2!==peg$FAILED?void(peg$currPos=s1):peg$FAILED;s0=s1!==peg$FAILED&&(s2=peg$parseContent(),s2!==peg$FAILED)&&(s3=(s3=peg$parseContents())===peg$FAILED?null:s3)!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c12(s2,s3)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c10);return s0}())===peg$FAILED?null:s3)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c5(s1,s2,s3)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c4),s0}function peg$parseHeadline(){var s0,s1,s2,s3,s4;if(peg$silentFails++,s0=peg$currPos,s1=[],61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8));else s1=peg$FAILED;if(s1!==peg$FAILED)if((s2=(s2=peg$parseBraceArg())===peg$FAILED?null:s2)!==peg$FAILED){for(s3=[],s4=peg$parseSpace();s4!==peg$FAILED;)s3.push(s4),s4=peg$parseSpace();s0=s3!==peg$FAILED&&(s4=peg$parseSinglelineContent())!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c9(s1,s2,s4)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c6),s0}function peg$parseContent(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseSinglelineComment())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=peg$parseBlockElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseUlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseOlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseDlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseParagraph())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s0=(s1=(()=>{var s0,s1,s2,s3,s4,s5,s6;if(peg$silentFails++,s0=peg$currPos,s1=[],61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8));else s1=peg$FAILED;if(s1!==peg$FAILED)if(input.substr(peg$currPos,8)===peg$c51?(s2=peg$c51,peg$currPos+=8):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c52)),s2!==peg$FAILED)if((s3=(s3=peg$parseBraceArg())===peg$FAILED?null:s3)!==peg$FAILED){for(s4=[],s5=peg$parseSpace();s5!==peg$FAILED;)s4.push(s5),s5=peg$parseSpace();if(s4!==peg$FAILED){for(s5=[],s6=peg$parseSpace();s6!==peg$FAILED;)s5.push(s6),s6=peg$parseSpace();s0=s5!==peg$FAILED&&(s6=peg$parseSinglelineContent())!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c53(s1,s3,s6)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c50),s0})())!==peg$FAILED&&(s2=(s2=function peg$parseColumnContents(){var s0,s1,s2,s3;peg$silentFails++;s0=peg$currPos;s1=peg$currPos;peg$silentFails++;input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11));peg$silentFails--;s1=s2!==peg$FAILED?void(peg$currPos=s1):peg$FAILED;s0=s1!==peg$FAILED&&(s2=peg$parseColumnContent(),s2!==peg$FAILED)&&(s3=(s3=peg$parseColumnContents())===peg$FAILED?null:s3)!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c55(s2,s3)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c54);return s0}())===peg$FAILED?null:s2)!==peg$FAILED&&(s3=(s3=peg$parseColumnTerminator())===peg$FAILED?null:s3)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c49(s1,s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c48),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c14(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c13),s0}function peg$parseParagraph(){var s0,s1,s2;return peg$silentFails++,s1=s0=peg$currPos,peg$silentFails++,61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8)),peg$silentFails--,s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=function peg$parseParagraphSubs(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseParagraphSub();s0=s1!==peg$FAILED&&(s2=peg$parseParagraphSubs(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c18(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c17);return s0}())!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c16(s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c15),s0}function peg$parseParagraphSub(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,(s0=(s1=peg$parseInlineElement())!==peg$FAILED&&(s2=(s2=peg$parseNewline())===peg$FAILED?null:s2)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c20(s1)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,s0=(s1=(()=>{var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13;if(peg$silentFails++,s3=s2=s1=s0=peg$currPos,peg$silentFails++,s4=peg$parseNewline(),peg$silentFails--,(s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED))!==peg$FAILED)if(s4=peg$currPos,peg$silentFails++,s5=peg$parseHeadline(),peg$silentFails--,(s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED))!==peg$FAILED)if(s5=peg$currPos,peg$silentFails++,s6=peg$parseSinglelineComment(),peg$silentFails--,(s5=s6===peg$FAILED?void 0:(peg$currPos=s5,peg$FAILED))!==peg$FAILED)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseBlockElement(),peg$silentFails--,(s6=s7===peg$FAILED?void 0:(peg$currPos=s6,peg$FAILED))!==peg$FAILED)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseUlist(),peg$silentFails--,(s7=s8===peg$FAILED?void 0:(peg$currPos=s7,peg$FAILED))!==peg$FAILED)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseOlist(),peg$silentFails--,(s8=s9===peg$FAILED?void 0:(peg$currPos=s8,peg$FAILED))!==peg$FAILED)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseDlist(),peg$silentFails--,(s9=s10===peg$FAILED?void 0:(peg$currPos=s9,peg$FAILED))!==peg$FAILED){if(s10=[],s12=s11=peg$currPos,peg$silentFails++,s13=peg$parseInlineElement(),peg$silentFails--,s12=s13===peg$FAILED?void 0:(peg$currPos=s12,peg$FAILED),(s11=s12!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s13=input.charAt(peg$currPos),peg$currPos++):(s13=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s13!==peg$FAILED)?s12=[s12,s13]:(peg$currPos=s11,peg$FAILED))!==peg$FAILED)for(;s11!==peg$FAILED;)s10.push(s11),s12=s11=peg$currPos,peg$silentFails++,s13=peg$parseInlineElement(),peg$silentFails--,s12=s13===peg$FAILED?void 0:(peg$currPos=s12,peg$FAILED),s11=s12!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s13=input.charAt(peg$currPos),peg$currPos++):(s13=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s13!==peg$FAILED)?s12=[s12,s13]:(peg$currPos=s11,peg$FAILED);else s10=peg$FAILED;s2=s10!==peg$FAILED?s3=[s3,s4,s5,s6,s7,s8,s9,s10]:(peg$currPos=s2,peg$FAILED)}else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;else peg$currPos=s2,s2=peg$FAILED;return(s1=s2!==peg$FAILED?input.substring(s1,peg$currPos):s2)!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c24(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c21),s0})())!==peg$FAILED&&(s2=(s2=peg$parseNewline())===peg$FAILED?null:s2)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c20(s1)):(peg$currPos=s0,peg$FAILED)),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c19),s0}function peg$parseBlockElement(){var s0,s1,s2,s3,s4,s6,s7;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c26?(s1=peg$c26,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c27)),s1!==peg$FAILED){if(s2=peg$currPos,s3=[],(s4=peg$parseAZ())!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),s4=peg$parseAZ();else s3=peg$FAILED;if((s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED){for(s3=[],s4=peg$parseBracketArg();s4!==peg$FAILED;)s3.push(s4),s4=peg$parseBracketArg();s0=s3!==peg$FAILED&&(123===input.charCodeAt(peg$currPos)?(s4=peg$c28,peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s4!==peg$FAILED)&&peg$parse_l()!==peg$FAILED&&(s6=(s6=function peg$parseBlockElementContents(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseBlockElementContent();s0=s1!==peg$FAILED&&(s2=peg$parseBlockElementContents(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c87(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c86);return s0}())===peg$FAILED?null:s6)!==peg$FAILED&&(input.substr(peg$currPos,3)===peg$c30?(s7=peg$c30,peg$currPos+=3):(s7=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s7!==peg$FAILED)&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c32(s2,s3,s6)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED}else peg$currPos=s0,s0=peg$FAILED;if(s0===peg$FAILED)if(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c26?(s1=peg$c26,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c27)),s1!==peg$FAILED){if(s2=peg$currPos,s3=[],(s4=peg$parseAZ())!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),s4=peg$parseAZ();else s3=peg$FAILED;if((s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED){for(s3=[],s4=peg$parseBracketArg();s4!==peg$FAILED;)s3.push(s4),s4=peg$parseBracketArg();s0=s3!==peg$FAILED&&(s4=peg$parse_l())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c33(s2,s3)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c25),s0}function peg$parseInlineElement(){var s0,s1,s2,s3,s4,s5,s6;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c35?(s1=peg$c35,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c36)),s1!==peg$FAILED){if(s2=peg$currPos,s3=[],peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38)),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38));else s3=peg$FAILED;s0=(s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED&&(62===input.charCodeAt(peg$currPos)?(s3=peg$c39,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c40)),s3!==peg$FAILED)&&(123===input.charCodeAt(peg$currPos)?(s4=peg$c28,peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s4!==peg$FAILED)&&(s5=(s5=function peg$parseBraceInlineElementContents(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseBraceInlineElementContent();s0=s1!==peg$FAILED&&(s2=peg$parseBraceInlineElementContents(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c95(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c94);return s0}())===peg$FAILED?null:s5)!==peg$FAILED&&(125===input.charCodeAt(peg$currPos)?(s6=peg$c41,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c42)),s6!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c43(s2,s5)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;if(s0===peg$FAILED){if(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c35?(s1=peg$c35,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c36)),s1!==peg$FAILED){if(s2=peg$currPos,s3=[],peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38)),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38));else s3=peg$FAILED;s0=(s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED&&(62===input.charCodeAt(peg$currPos)?(s3=peg$c39,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c40)),s3!==peg$FAILED)&&(124===input.charCodeAt(peg$currPos)?(s4=peg$c44,peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c45)),s4!==peg$FAILED)&&(s5=(s5=function peg$parsePipeInlineElementContents(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parsePipeInlineElementContent();s0=s1!==peg$FAILED&&(s2=peg$parsePipeInlineElementContents(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c95(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c94);return s0}())===peg$FAILED?null:s5)!==peg$FAILED&&(124===input.charCodeAt(peg$currPos)?(s6=peg$c44,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c45)),s6!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c43(s2,s5)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;if(s0===peg$FAILED)if(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c35?(s1=peg$c35,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c36)),s1!==peg$FAILED){if(s2=peg$currPos,s3=[],peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38)),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),peg$c37.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c38));else s3=peg$FAILED;s0=(s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED&&(62===input.charCodeAt(peg$currPos)?(s3=peg$c39,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c40)),s3!==peg$FAILED)&&(36===input.charCodeAt(peg$currPos)?(s4=peg$c46,peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c47)),s4!==peg$FAILED)&&(s5=(s5=function peg$parseDollarInlineElementContents(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseDollarInlineElementContent();s0=s1!==peg$FAILED&&(s2=peg$parseDollarInlineElementContents(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c95(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c94);return s0}())===peg$FAILED?null:s5)!==peg$FAILED&&(36===input.charCodeAt(peg$currPos)?(s6=peg$c46,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c47)),s6!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c43(s2,s5)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED}return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c34),s0}function peg$parseColumnContent(){var s0,s1,s2;return peg$silentFails++,s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseSinglelineComment())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseBlockElement())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED)&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseUlist())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED)&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseOlist())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED)&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseDlist())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED)&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseParagraph())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED)&&(s1=s0=peg$currPos,peg$silentFails++,s2=peg$parseColumnTerminator(),peg$silentFails--,s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(s2=peg$parseChapter())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c57(s2)):(peg$currPos=s0,peg$FAILED)),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c56),s0}function peg$parseColumnTerminator(){var s0,s1,s2,s3,s4;if(peg$silentFails++,s0=peg$currPos,s1=[],61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),61===input.charCodeAt(peg$currPos)?(s2=peg$c7,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c8));else s1=peg$FAILED;if(s1!==peg$FAILED)if(input.substr(peg$currPos,9)===peg$c59?(s2=peg$c59,peg$currPos+=9):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c60)),s2!==peg$FAILED){for(s3=[],s4=peg$parseSpace();s4!==peg$FAILED;)s3.push(s4),s4=peg$parseSpace();s0=s3!==peg$FAILED&&(s4=peg$parse_l())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c61(s1)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c58),s0}function peg$parseBracketArg(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,91===input.charCodeAt(peg$currPos)?(s1=peg$c63,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c64)),s0=s1!==peg$FAILED&&(s2=function peg$parseBracketArgSubs(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseBracketArgSub();s0=s1!==peg$FAILED&&(s2=peg$parseBracketArgSubs(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c68);return s0}())!==peg$FAILED&&(93===input.charCodeAt(peg$currPos)?(s3=peg$c65,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c66)),s3!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c67(s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c62),s0}function peg$parseBracketArgSub(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c71(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4,s5,s6,s7,s8;if(peg$silentFails++,s2=[],s4=s3=s1=s0=peg$currPos,peg$silentFails++,s5=peg$parseNewline(),peg$silentFails--,s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED),(s3=s4!==peg$FAILED&&(s5=peg$currPos,peg$silentFails++,s6=peg$parseInlineElement(),peg$silentFails--,(s5=s6===peg$FAILED?void 0:(peg$currPos=s5,peg$FAILED))!==peg$FAILED)&&(input.substr(peg$currPos,2)===peg$c73?(s6=peg$c73,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s6===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c75?(s6=peg$c75,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s6===peg$FAILED)&&(92===input.charCodeAt(peg$currPos)?(s6=peg$c77,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s6===peg$FAILED)&&(s7=s6=peg$currPos,peg$silentFails++,93===input.charCodeAt(peg$currPos)?(s8=peg$c65,peg$currPos++):(s8=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c66)),peg$silentFails--,s7=s8===peg$FAILED?void 0:(peg$currPos=s7,peg$FAILED),s6=s7!==peg$FAILED&&(input.length>peg$currPos?(s8=input.charAt(peg$currPos),peg$currPos++):(s8=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s8!==peg$FAILED)?s7=[s7,s8]:(peg$currPos=s6,peg$FAILED)),s6!==peg$FAILED)?s4=[s4,s5,s6]:(peg$currPos=s3,peg$FAILED))!==peg$FAILED)for(;s3!==peg$FAILED;)s2.push(s3),s4=s3=peg$currPos,peg$silentFails++,s5=peg$parseNewline(),peg$silentFails--,s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED),s3=s4!==peg$FAILED&&(s5=peg$currPos,peg$silentFails++,s6=peg$parseInlineElement(),peg$silentFails--,(s5=s6===peg$FAILED?void 0:(peg$currPos=s5,peg$FAILED))!==peg$FAILED)&&(input.substr(peg$currPos,2)===peg$c73?(s6=peg$c73,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s6===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c75?(s6=peg$c75,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s6===peg$FAILED)&&(92===input.charCodeAt(peg$currPos)?(s6=peg$c77,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s6===peg$FAILED)&&(s7=s6=peg$currPos,peg$silentFails++,93===input.charCodeAt(peg$currPos)?(s8=peg$c65,peg$currPos++):(s8=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c66)),peg$silentFails--,s7=s8===peg$FAILED?void 0:(peg$currPos=s7,peg$FAILED),s6=s7!==peg$FAILED&&(input.length>peg$currPos?(s8=input.charAt(peg$currPos),peg$currPos++):(s8=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s8!==peg$FAILED)?s7=[s7,s8]:(peg$currPos=s6,peg$FAILED)),s6!==peg$FAILED)?s4=[s4,s5,s6]:(peg$currPos=s3,peg$FAILED);else s2=peg$FAILED;return(s1=s2!==peg$FAILED?input.substring(s1,peg$currPos):s2)!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c79(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c72),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c71(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c70),s0}function peg$parseBraceArg(){var s0,s1,s2,s3,s4,s5,s6;if(peg$silentFails++,s0=peg$currPos,123===input.charCodeAt(peg$currPos)?(s1=peg$c28,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s1!==peg$FAILED){if(s3=[],s4=s2=peg$currPos,s5=[],peg$c81.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s6!==peg$FAILED)for(;s6!==peg$FAILED;)s5.push(s6),peg$c81.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82));else s5=peg$FAILED;for(s4=s5!==peg$FAILED&&(input.substr(peg$currPos,2)===peg$c73?(s6=peg$c73,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s6===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c83?(s6=peg$c83,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s6===peg$FAILED)&&(92===input.charCodeAt(peg$currPos)?(s6=peg$c77,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78))),(s6=s6===peg$FAILED?null:s6)!==peg$FAILED)?s5=[s5,s6]:(peg$currPos=s4,peg$FAILED);s4!==peg$FAILED;){if(s3.push(s4),s4=peg$currPos,s5=[],peg$c81.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s6!==peg$FAILED)for(;s6!==peg$FAILED;)s5.push(s6),peg$c81.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82));else s5=peg$FAILED;s4=s5!==peg$FAILED&&(input.substr(peg$currPos,2)===peg$c73?(s6=peg$c73,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s6===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c83?(s6=peg$c83,peg$currPos+=2):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s6===peg$FAILED)&&(92===input.charCodeAt(peg$currPos)?(s6=peg$c77,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78))),(s6=s6===peg$FAILED?null:s6)!==peg$FAILED)?s5=[s5,s6]:(peg$currPos=s4,peg$FAILED)}s0=(s2=s3!==peg$FAILED?input.substring(s2,peg$currPos):s3)!==peg$FAILED&&(125===input.charCodeAt(peg$currPos)?(s3=peg$c41,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c42)),s3!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c85(s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c80),s0}function peg$parseBlockElementContent(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseSinglelineComment())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=peg$parseBlockElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseUlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseOlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=peg$parseDlist())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,(s1=(()=>{var s0,s1;return peg$silentFails++,s0=peg$currPos,s0=(s1=function peg$parseBlockElementParagraphSubs(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseBlockElementParagraphSub();s0=s1!==peg$FAILED&&(s2=peg$parseBlockElementParagraphSubs(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c18(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c91);return s0}())!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c16(s1)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c90),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c89(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c88),s0}function peg$parseBlockElementParagraphSub(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c20(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,s14;if(peg$silentFails++,s2=[],s4=s3=s1=s0=peg$currPos,peg$silentFails++,input.substr(peg$currPos,3)===peg$c30?(s5=peg$c30,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s5===peg$FAILED&&(s5=peg$currPos,s6=peg$parseNewline(),s5=s6!==peg$FAILED&&(input.substr(peg$currPos,3)===peg$c30?(s7=peg$c30,peg$currPos+=3):(s7=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s7!==peg$FAILED)?s6=[s6,s7]:(peg$currPos=s5,peg$FAILED)),peg$silentFails--,(s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED))!==peg$FAILED)if((s5=(s5=peg$parseNewline())===peg$FAILED?null:s5)!==peg$FAILED)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseSinglelineComment(),peg$silentFails--,(s6=s7===peg$FAILED?void 0:(peg$currPos=s6,peg$FAILED))!==peg$FAILED)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseBlockElement(),peg$silentFails--,(s7=s8===peg$FAILED?void 0:(peg$currPos=s7,peg$FAILED))!==peg$FAILED)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseUlist(),peg$silentFails--,(s8=s9===peg$FAILED?void 0:(peg$currPos=s8,peg$FAILED))!==peg$FAILED)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseOlist(),peg$silentFails--,(s9=s10===peg$FAILED?void 0:(peg$currPos=s9,peg$FAILED))!==peg$FAILED)if(s10=peg$currPos,peg$silentFails++,s11=peg$parseDlist(),peg$silentFails--,(s10=s11===peg$FAILED?void 0:(peg$currPos=s10,peg$FAILED))!==peg$FAILED){if(s11=[],s13=s12=peg$currPos,peg$silentFails++,s14=peg$parseInlineElement(),peg$silentFails--,s13=s14===peg$FAILED?void 0:(peg$currPos=s13,peg$FAILED),(s12=s13!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s14=input.charAt(peg$currPos),peg$currPos++):(s14=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s14!==peg$FAILED)?s13=[s13,s14]:(peg$currPos=s12,peg$FAILED))!==peg$FAILED)for(;s12!==peg$FAILED;)s11.push(s12),s13=s12=peg$currPos,peg$silentFails++,s14=peg$parseInlineElement(),peg$silentFails--,s13=s14===peg$FAILED?void 0:(peg$currPos=s13,peg$FAILED),s12=s13!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s14=input.charAt(peg$currPos),peg$currPos++):(s14=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s14!==peg$FAILED)?s13=[s13,s14]:(peg$currPos=s12,peg$FAILED);else s11=peg$FAILED;s3=s11!==peg$FAILED&&(s12=(s12=peg$parseNewline())===peg$FAILED?null:s12)!==peg$FAILED?s4=[s4,s5,s6,s7,s8,s9,s10,s11,s12]:(peg$currPos=s3,peg$FAILED)}else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;if(s3!==peg$FAILED)for(;s3!==peg$FAILED;)if(s2.push(s3),s4=s3=peg$currPos,peg$silentFails++,input.substr(peg$currPos,3)===peg$c30?(s5=peg$c30,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s5===peg$FAILED&&(s5=peg$currPos,s6=peg$parseNewline(),s5=s6!==peg$FAILED&&(input.substr(peg$currPos,3)===peg$c30?(s7=peg$c30,peg$currPos+=3):(s7=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s7!==peg$FAILED)?s6=[s6,s7]:(peg$currPos=s5,peg$FAILED)),peg$silentFails--,(s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED))!==peg$FAILED)if((s5=(s5=peg$parseNewline())===peg$FAILED?null:s5)!==peg$FAILED)if(s6=peg$currPos,peg$silentFails++,s7=peg$parseSinglelineComment(),peg$silentFails--,(s6=s7===peg$FAILED?void 0:(peg$currPos=s6,peg$FAILED))!==peg$FAILED)if(s7=peg$currPos,peg$silentFails++,s8=peg$parseBlockElement(),peg$silentFails--,(s7=s8===peg$FAILED?void 0:(peg$currPos=s7,peg$FAILED))!==peg$FAILED)if(s8=peg$currPos,peg$silentFails++,s9=peg$parseUlist(),peg$silentFails--,(s8=s9===peg$FAILED?void 0:(peg$currPos=s8,peg$FAILED))!==peg$FAILED)if(s9=peg$currPos,peg$silentFails++,s10=peg$parseOlist(),peg$silentFails--,(s9=s10===peg$FAILED?void 0:(peg$currPos=s9,peg$FAILED))!==peg$FAILED)if(s10=peg$currPos,peg$silentFails++,s11=peg$parseDlist(),peg$silentFails--,(s10=s11===peg$FAILED?void 0:(peg$currPos=s10,peg$FAILED))!==peg$FAILED){if(s11=[],s13=s12=peg$currPos,peg$silentFails++,s14=peg$parseInlineElement(),peg$silentFails--,s13=s14===peg$FAILED?void 0:(peg$currPos=s13,peg$FAILED),(s12=s13!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s14=input.charAt(peg$currPos),peg$currPos++):(s14=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s14!==peg$FAILED)?s13=[s13,s14]:(peg$currPos=s12,peg$FAILED))!==peg$FAILED)for(;s12!==peg$FAILED;)s11.push(s12),s13=s12=peg$currPos,peg$silentFails++,s14=peg$parseInlineElement(),peg$silentFails--,s13=s14===peg$FAILED?void 0:(peg$currPos=s13,peg$FAILED),s12=s13!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s14=input.charAt(peg$currPos),peg$currPos++):(s14=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s14!==peg$FAILED)?s13=[s13,s14]:(peg$currPos=s12,peg$FAILED);else s11=peg$FAILED;s3=s11!==peg$FAILED&&(s12=(s12=peg$parseNewline())===peg$FAILED?null:s12)!==peg$FAILED?s4=[s4,s5,s6,s7,s8,s9,s10,s11,s12]:(peg$currPos=s3,peg$FAILED)}else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else peg$currPos=s3,s3=peg$FAILED;else s2=peg$FAILED;return(s1=s2!==peg$FAILED?input.substring(s1,peg$currPos):s2)!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c24(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c93),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c20(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c92),s0}function peg$parseBraceInlineElementContent(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c97(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4;if(peg$silentFails++,s1=[],s3=s2=s0=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),(s2=s3!==peg$FAILED&&(s4=peg$parseBraceInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED))!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s3=s2=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),s2=s3!==peg$FAILED&&(s4=peg$parseBraceInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED);else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c100(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c99),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c98(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c96),s0}function peg$parsePipeInlineElementContent(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c97(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4;if(peg$silentFails++,s1=[],s3=s2=s0=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),(s2=s3!==peg$FAILED&&(s4=peg$parsePipeInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED))!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s3=s2=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),s2=s3!==peg$FAILED&&(s4=peg$parsePipeInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED);else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c100(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c99),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c98(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c96),s0}function peg$parseDollarInlineElementContent(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c97(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4;if(peg$silentFails++,s1=[],s3=s2=s0=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),(s2=s3!==peg$FAILED&&(s4=peg$parseDollarInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED))!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s3=s2=peg$currPos,peg$silentFails++,s4=peg$parseInlineElement(),peg$silentFails--,s3=s4===peg$FAILED?void 0:(peg$currPos=s3,peg$FAILED),s2=s3!==peg$FAILED&&(s4=peg$parseDollarInlineElementContentChar())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED);else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c100(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c99),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c98(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c96),s0}function peg$parseBraceInlineElementContentChar(){var s0,s1,s2;return peg$silentFails++,s1=s0=peg$currPos,peg$silentFails++,92===input.charCodeAt(peg$currPos)?(s2=peg$c77,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s2===peg$FAILED&&(125===input.charCodeAt(peg$currPos)?(s2=peg$c41,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c42)),s2===peg$FAILED)&&(input.substr(peg$currPos,2)===peg$c102?(s2=peg$c102,peg$currPos+=2):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c103)),s2===peg$FAILED)&&(10===input.charCodeAt(peg$currPos)?(s2=peg$c104,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c105))),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s2!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c106(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c73?(s1=peg$c73,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c107()),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c83?(s1=peg$c83,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c108()),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c101),s0}function peg$parsePipeInlineElementContentChar(){var s0,s1,s2;return peg$silentFails++,s1=s0=peg$currPos,peg$silentFails++,92===input.charCodeAt(peg$currPos)?(s2=peg$c77,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s2===peg$FAILED&&(124===input.charCodeAt(peg$currPos)?(s2=peg$c44,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c45)),s2===peg$FAILED)&&(input.substr(peg$currPos,2)===peg$c102?(s2=peg$c102,peg$currPos+=2):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c103)),s2===peg$FAILED)&&(10===input.charCodeAt(peg$currPos)?(s2=peg$c104,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c105))),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s2!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c106(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c73?(s1=peg$c73,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c107()),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c109?(s1=peg$c109,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c110)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c111()),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c101),s0}function peg$parseDollarInlineElementContentChar(){var s0,s1,s2;return peg$silentFails++,s1=s0=peg$currPos,peg$silentFails++,92===input.charCodeAt(peg$currPos)?(s2=peg$c77,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s2===peg$FAILED&&(36===input.charCodeAt(peg$currPos)?(s2=peg$c46,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c47)),s2===peg$FAILED)&&(input.substr(peg$currPos,2)===peg$c102?(s2=peg$c102,peg$currPos+=2):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c103)),s2===peg$FAILED)&&(10===input.charCodeAt(peg$currPos)?(s2=peg$c104,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c105))),peg$silentFails--,(s0=(s1=s2===peg$FAILED?void 0:(peg$currPos=s1,peg$FAILED))!==peg$FAILED&&(input.length>peg$currPos?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s2!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c106(s2)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c73?(s1=peg$c73,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c107()),(s0=s1)===peg$FAILED)&&(s0=peg$currPos,input.substr(peg$currPos,2)===peg$c112?(s1=peg$c112,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c113)),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c114()),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c101),s0}function peg$parseSinglelineContent(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s0=(s1=function peg$parseContentInlines(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseContentInline();s0=s1!==peg$FAILED&&(s2=peg$parseContentInlines(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)?(peg$savedPos=s0,s1=peg$c118(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c117);return s0}())!==peg$FAILED&&(s2=(s2=peg$parseNewline())===peg$FAILED?(()=>{var s0,s1;return peg$silentFails++,s0=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),peg$silentFails--,s0=s1===peg$FAILED?void 0:(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c170),s0})():s2)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c116(s1)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c115),s0}function peg$parseContentInline(){var s0,s1;return peg$silentFails++,s0=peg$currPos,(s1=peg$parseInlineElement())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c120(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=(()=>{var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s2=[],s4=s3=s1=s0=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED),(s3=s4!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s5!==peg$FAILED)?s4=[s4,s5]:(peg$currPos=s3,peg$FAILED))!==peg$FAILED)for(;s3!==peg$FAILED;)s2.push(s3),s4=s3=peg$currPos,peg$silentFails++,s5=peg$parseInlineElement(),peg$silentFails--,s4=s5===peg$FAILED?void 0:(peg$currPos=s4,peg$FAILED),s3=s4!==peg$FAILED&&(peg$c22.test(input.charAt(peg$currPos))?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s5!==peg$FAILED)?s4=[s4,s5]:(peg$currPos=s3,peg$FAILED);else s2=peg$FAILED;return(s1=s2!==peg$FAILED?input.substring(s1,peg$currPos):s2)!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c122(s1)),peg$silentFails--,(s0=s1)===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c121),s0})())!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c120(s1)),s0=s1),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c119),s0}function peg$parseUlist(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s0=(s1=(s1=(()=>{var s0,s1,s2,s3,s4;if(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127));else s1=peg$FAILED;if(s1!==peg$FAILED){if(s2=[],42===input.charCodeAt(peg$currPos)?(s3=peg$c128,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c129)),s3!==peg$FAILED)for(;s3!==peg$FAILED;)s2.push(s3),42===input.charCodeAt(peg$currPos)?(s3=peg$c128,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c129));else s2=peg$FAILED;if(s2!==peg$FAILED){for(s3=[],s4=peg$parseSpace();s4!==peg$FAILED;)s3.push(s4),s4=peg$parseSpace();s0=s3!==peg$FAILED&&(s4=peg$parseSinglelineContent())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c130(s2,s4)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c125),s0})())===peg$FAILED?peg$parseSinglelineComment():s1)!==peg$FAILED&&(s2=(s2=peg$parseUlist())===peg$FAILED?null:s2)!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c124(s1,s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c123),s0}function peg$parseOlist(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s0=(s1=(s1=(()=>{var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127));else s1=peg$FAILED;if(s1!==peg$FAILED)if((s2=(()=>{var s0,s1,s2;if(peg$silentFails++,s0=peg$currPos,s1=[],(s2=peg$parseDigit())!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s2=peg$parseDigit();else s1=peg$FAILED;return s0=s1!==peg$FAILED?input.substring(s0,peg$currPos):s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c155),s0})())!==peg$FAILED)if(46===input.charCodeAt(peg$currPos)?(s3=peg$c134,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c135)),s3!==peg$FAILED){for(s4=[],s5=peg$parseSpace();s5!==peg$FAILED;)s4.push(s5),s5=peg$parseSpace();s0=s4!==peg$FAILED&&(s5=peg$parseSinglelineContent())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c136(s2,s5)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c133),s0})())===peg$FAILED?peg$parseSinglelineComment():s1)!==peg$FAILED&&(s2=(s2=peg$parseOlist())===peg$FAILED?null:s2)!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c132(s1,s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c131),s0}function peg$parseDlist(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s0=(s1=(s1=(()=>{var s0,s1,s2,s4,s5,s3;for(peg$silentFails++,s0=peg$currPos,s1=[],32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127));s2!==peg$FAILED;)s1.push(s2),32===input.charCodeAt(peg$currPos)?(s2=peg$c126,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127));if(s1!==peg$FAILED)if(58===input.charCodeAt(peg$currPos)?(s2=peg$c140,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c141)),s2!==peg$FAILED)if(32===input.charCodeAt(peg$currPos)?(s3=peg$c126,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127)),s3!==peg$FAILED){for(s4=[],s5=peg$parseSpace();s5!==peg$FAILED;)s4.push(s5),s5=peg$parseSpace();s0=s4!==peg$FAILED&&(s5=peg$parseSinglelineContent())!==peg$FAILED&&(s3=function peg$parseDlistElementContents(){var s0,s1,s2;peg$silentFails++;s0=peg$currPos;s1=peg$parseDlistElementContent();s0=s1!==peg$FAILED&&(s2=peg$parseDlistElementContents(),(s2=s2===peg$FAILED?null:s2)!==peg$FAILED)&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c144(s1,s2)):(peg$currPos=s0,peg$FAILED);peg$silentFails--;s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c143);return s0}())!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c142(s5,s3)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c139),s0})())===peg$FAILED?peg$parseSinglelineComment():s1)!==peg$FAILED&&(s2=(s2=peg$parseDlist())===peg$FAILED?null:s2)!==peg$FAILED&&peg$parse_l()!==peg$FAILED?(peg$savedPos=s0,s1=peg$c138(s1,s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c137),s0}function peg$parseDlistElementContent(){var s0,s1,s2,s3;if(peg$silentFails++,s0=peg$currPos,s1=[],peg$c146.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),peg$c146.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147));else s1=peg$FAILED;return s0=s1!==peg$FAILED&&(s2=peg$parseSinglelineContent())!==peg$FAILED&&(s3=(s3=peg$parseNewline())===peg$FAILED?null:s3)!==peg$FAILED?(peg$savedPos=s0,s1=peg$c148(s2)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c145),s0}function peg$parseSinglelineComment(){var s0,s1,s2,s3,s4,s5,s6;if(peg$silentFails++,s2=s1=s0=peg$currPos,input.substr(peg$currPos,2)===peg$c152?(s3=peg$c152,peg$currPos+=2):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c153)),s3!==peg$FAILED){for(s4=peg$currPos,s5=[],peg$c22.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23));s6!==peg$FAILED;)s5.push(s6),peg$c22.test(input.charAt(peg$currPos))?(s6=input.charAt(peg$currPos),peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23));s2=(s4=s5!==peg$FAILED?input.substring(s4,peg$currPos):s5)!==peg$FAILED&&(s5=(s5=peg$parseNewline())===peg$FAILED?null:s5)!==peg$FAILED?s3=[s3,s4,s5]:(peg$currPos=s2,peg$FAILED)}else peg$currPos=s2,s2=peg$FAILED;return s0=(s1=s2!==peg$FAILED?input.substring(s1,peg$currPos):s2)!==peg$FAILED&&(s2=peg$parse_l())!==peg$FAILED?(peg$savedPos=s0,s1=peg$c154(s1)):(peg$currPos=s0,peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c151),s0}function peg$parseDigit(){var s0;return peg$silentFails++,peg$c157.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c158)),peg$silentFails--,s0===peg$FAILED&&0===peg$silentFails&&peg$fail(peg$c156),s0}function peg$parseAZ(){var s0;return peg$silentFails++,peg$c160.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c161)),peg$silentFails--,s0===peg$FAILED&&0===peg$silentFails&&peg$fail(peg$c159),s0}function peg$parseNewline(){var s0;return peg$silentFails++,input.substr(peg$currPos,2)===peg$c102?(s0=peg$c102,peg$currPos+=2):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c103)),s0===peg$FAILED&&(10===input.charCodeAt(peg$currPos)?(s0=peg$c104,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c105))),peg$silentFails--,s0===peg$FAILED&&0===peg$silentFails&&peg$fail(peg$c162),s0}function peg$parse_l(){var s0,s1,s2,s3,s4;for(peg$silentFails++,s1=[],s2=s0=peg$currPos,s3=[],peg$c146.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147));s4!==peg$FAILED;)s3.push(s4),peg$c146.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147));for(s2=s3!==peg$FAILED&&(s4=peg$parseNewline())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED);s2!==peg$FAILED;){for(s1.push(s2),s2=peg$currPos,s3=[],peg$c146.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147));s4!==peg$FAILED;)s3.push(s4),peg$c146.test(input.charAt(peg$currPos))?(s4=input.charAt(peg$currPos),peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c147));s2=s3!==peg$FAILED&&(s4=peg$parseNewline())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED)}return s0=s1!==peg$FAILED?input.substring(s0,peg$currPos):s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c163),s0}function peg$parse_(){var s0,s1,s2;for(peg$silentFails++,s0=peg$currPos,s1=[],peg$c165.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c166));s2!==peg$FAILED;)s1.push(s2),peg$c165.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c166));return s0=s1!==peg$FAILED?input.substring(s0,peg$currPos):s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails)&&peg$fail(peg$c164),s0}function peg$parseSpace(){var s0;return peg$silentFails++,peg$c168.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c169)),peg$silentFails--,s0===peg$FAILED&&0===peg$silentFails&&peg$fail(peg$c167),s0}var b=require("../lib/peg/action");if(b.setup({text:function(){return input.substring(peg$savedPos,peg$currPos)},location:function(){return peg$computeLocation(peg$savedPos,peg$currPos)}}),(peg$startRuleFunctions=peg$startRuleFunction())!==peg$FAILED&&peg$currPos===input.length)return peg$startRuleFunctions;throw peg$startRuleFunctions!==peg$FAILED&&peg$currPos<input.length&&peg$fail({type:"end"}),peg$buildStructuredError(peg$maxFailExpected,peg$maxFailPos<input.length?input.charAt(peg$maxFailPos):null,peg$computeLocation(peg$maxFailPos,peg$maxFailPos<input.length?peg$maxFailPos+1:peg$maxFailPos))}}},{"../lib/peg/action":19}]},{},[11])(11)});